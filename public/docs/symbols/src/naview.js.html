<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">//TODO: write up mock tests</span><span class="WHIT">
<span class='line'>  2</span> 
<span class='line'>  3</span> </span><span class="COMM">/**
<span class='line'>  4</span>  * This is the main function
<span class='line'>  5</span>  * @module NaView
<span class='line'>  6</span>  * @namespace
<span class='line'>  7</span>  * @param {string} svg_id id of selected/created svg
<span class='line'>  8</span>  * @param {string} container_id id of selected/created svg container
<span class='line'>  9</span>  * @param {number} svg_width width of selected/created svg (default:1200px)
<span class='line'> 10</span>  * @param {number} svg_height height of selected/created svg (default:500px)
<span class='line'> 11</span>  * @param {Object} style_obj_input styling object for all drawing options. See &lt;b>&lt;i>style_obj&lt;/i>&lt;/b> in Docs
<span class='line'> 12</span>  * @param {string} protein_input UniProt raw text to be processed See &lt;b>&lt;i>parsed_protein_data&lt;/i>&lt;/b> and also &lt;b>&lt;i>processRawUniProt&lt;/i>&lt;/b> in Docs
<span class='line'> 13</span>  * @also
<span class='line'> 14</span>  * @param {Object} protein_input processed data input See &lt;b>&lt;i>parsed_protein_data&lt;/i>&lt;/b> and also &lt;b>&lt;i>processRawUniProt&lt;/i>&lt;/b> in Docs
<span class='line'> 15</span>  * @param {Object} properties residue properties for color mapping and Text drawing by residue selection. See &lt;b>&lt;i>current_resid_properties&lt;/i>&lt;/b> in Docs
<span class='line'> 16</span>  * @param {Array} color_rules Array of strings containing color rules in the color selection syntax. See &lt;b>&lt;i>fillRules&lt;/i>&lt;/b> and also &lt;b>&lt;i>createFillRules&lt;/i>&lt;/b> in Docs
<span class='line'> 17</span>  * @param {Array} text_to_draw Array of strings containing text drawing rules in the text selection syntax. See &lt;b>&lt;i>draw_symbols&lt;/i>&lt;/b> in Docs
<span class='line'> 18</span>  * @param {Array} relationships Array of Objects describing residue relationships to be drawn in plot See &lt;b>&lt;i>draw_residue_relations&lt;/i>&lt;/b> in Docs
<span class='line'> 19</span>  */</span><span class="WHIT">
<span class='line'> 20</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">NaView</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 21</span> </span><span class="WHIT">    </span><span class="NAME">svg_id</span><span class="PUNC">=</span><span class="STRN">"naview_svg"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 22</span> </span><span class="WHIT">    </span><span class="NAME">container_id</span><span class="PUNC">=</span><span class="STRN">"naview_container"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 23</span> </span><span class="WHIT">    </span><span class="NAME">svg_width</span><span class="PUNC">=</span><span class="NUMB">1200</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 24</span> </span><span class="WHIT">    </span><span class="NAME">svg_height</span><span class="PUNC">=</span><span class="NUMB">500</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 25</span> </span><span class="WHIT">    </span><span class="COMM">//TODO: validate functions for all inputs</span><span class="WHIT">
<span class='line'> 26</span> </span><span class="WHIT">    </span><span class="NAME">style_obj_input</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 27</span> </span><span class="WHIT">    </span><span class="NAME">protein_input</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 28</span> </span><span class="WHIT">    </span><span class="COMM">//TODO: convert properties function </span><span class="WHIT">
<span class='line'> 29</span> </span><span class="WHIT">    </span><span class="NAME">properties</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 30</span> </span><span class="WHIT">    </span><span class="NAME">color_rules</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 31</span> </span><span class="WHIT">    </span><span class="NAME">text_to_draw</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 32</span> </span><span class="WHIT">    </span><span class="NAME">relationships</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 33</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 34</span> 
<span class='line'> 35</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'> 36</span>      * Function to generate the default style object.&lt;br>
<span class='line'> 37</span>      * 1. Helices are shown as cartoon&lt;br>
<span class='line'> 38</span>      * 2. Membrane is shown as lipid bilayer&lt;br>
<span class='line'> 39</span>      * 3. All loops have fixed lengths&lt;br>
<span class='line'> 40</span>      * @yields default style object
<span class='line'> 41</span>      * @exports NaView
<span class='line'> 42</span>      * @name generateDefaultStyleObject
<span class='line'> 43</span>      * @namespace
<span class='line'> 44</span>      */</span><span class="WHIT">
<span class='line'> 45</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">generateDefaultStyleObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 46</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">defaultStyleObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 47</span> </span><span class="WHIT">            </span><span class="STRN">"membrane"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 48</span> </span><span class="WHIT">                </span><span class="STRN">"membrane_mode"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"lipid"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 49</span> </span><span class="WHIT">                </span><span class="STRN">"membrane_draw_opts"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 50</span> </span><span class="WHIT">                    </span><span class="STRN">"hfill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"white"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 51</span> </span><span class="WHIT">                    </span><span class="STRN">"hstroke"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"black"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 52</span> </span><span class="WHIT">                    </span><span class="STRN">"hstroke_s"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//px</span><span class="WHIT">
<span class='line'> 53</span> </span><span class="WHIT">                    </span><span class="STRN">"hopacity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 54</span> </span><span class="WHIT">                    </span><span class="STRN">"tfill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"black"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 55</span> </span><span class="WHIT">                    </span><span class="STRN">"tstroke"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"black"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 56</span> </span><span class="WHIT">                    </span><span class="STRN">"tstroke_s"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//px</span><span class="WHIT">
<span class='line'> 57</span> </span><span class="WHIT">                    </span><span class="STRN">"topacity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 58</span> </span><span class="WHIT">                    </span><span class="STRN">"lipid_head_radius_width"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.0075</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox width</span><span class="WHIT">
<span class='line'> 59</span> </span><span class="WHIT">                    </span><span class="STRN">"lipid_head_radius_height"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox height</span><span class="WHIT">
<span class='line'> 60</span> </span><span class="WHIT">                    </span><span class="STRN">"lipid_tail_number"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 61</span> </span><span class="WHIT">                    </span><span class="STRN">"lipid_tail_breaks"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 62</span> </span><span class="WHIT">                    </span><span class="STRN">"lipid_tail_spacing"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.001</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox height</span><span class="WHIT">
<span class='line'> 63</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 64</span> </span><span class="WHIT">                </span><span class="STRN">"membrane_region_height"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'> 65</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 66</span> </span><span class="WHIT">            </span><span class="STRN">"protein"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 67</span> </span><span class="WHIT">                </span><span class="STRN">"helix_mode"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"cartoon"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 68</span> </span><span class="WHIT">                </span><span class="STRN">"helix_draw_opts"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 69</span> </span><span class="WHIT">                    </span><span class="STRN">"draw"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">//example cartoon</span><span class="WHIT">
<span class='line'> 70</span> </span><span class="WHIT">                        </span><span class="STRN">"x_to_end_prop"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NUMB">20</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 71</span> </span><span class="WHIT">                        </span><span class="STRN">"y_to_mid_prop"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NUMB">7</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 72</span> </span><span class="WHIT">                        </span><span class="STRN">"aa_area_perc_displacement"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 73</span> </span><span class="WHIT">                        </span><span class="STRN">"thickness"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.55</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 74</span> </span><span class="WHIT">                        </span><span class="STRN">"front_helix_stroke"</span><span class="PUNC">:</span><span class="STRN">'black'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 75</span> </span><span class="WHIT">                        </span><span class="STRN">"back_helix_stroke"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'black'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 76</span> </span><span class="WHIT">                        </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//px</span><span class="WHIT">
<span class='line'> 77</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 78</span> </span><span class="WHIT">                    </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"dicts"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 79</span> </span><span class="WHIT">                    </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 80</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="STRN">"domain_and_name"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 81</span> </span><span class="WHIT">                        </span><span class="STRN">"I"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">:</span><span class="STRN">"blue"</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 82</span> </span><span class="WHIT">                        </span><span class="STRN">"II"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">:</span><span class="STRN">"blue"</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 83</span> </span><span class="WHIT">                        </span><span class="STRN">"III"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">:</span><span class="STRN">"blue"</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 84</span> </span><span class="WHIT">                        </span><span class="STRN">"IV"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">:</span><span class="STRN">"blue"</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 85</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 86</span> </span><span class="WHIT">                    </span><span class="STRN">"back_fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 87</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="STRN">"domain_and_name"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 88</span> </span><span class="WHIT">                        </span><span class="STRN">"I"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">:</span><span class="STRN">"lightblue"</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 89</span> </span><span class="WHIT">                        </span><span class="STRN">"II"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">:</span><span class="STRN">"lightblue"</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 90</span> </span><span class="WHIT">                        </span><span class="STRN">"III"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">:</span><span class="STRN">"lightblue"</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 91</span> </span><span class="WHIT">                        </span><span class="STRN">"IV"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">:</span><span class="STRN">"lightblue"</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">:</span><span class="STRN">"salmon"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 92</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 93</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 94</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="STRN">"domain_and_name"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 95</span> </span><span class="WHIT">                        </span><span class="STRN">"I"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">:</span><span class="STRN">"blue"</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 96</span> </span><span class="WHIT">                        </span><span class="STRN">"II"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">:</span><span class="STRN">"blue"</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 97</span> </span><span class="WHIT">                        </span><span class="STRN">"III"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">:</span><span class="STRN">"blue"</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 98</span> </span><span class="WHIT">                        </span><span class="STRN">"IV"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">:</span><span class="STRN">"blue"</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">:</span><span class="STRN">"red"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 99</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>100</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>101</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="STRN">"domain_and_name"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>102</span> </span><span class="WHIT">                        </span><span class="STRN">"I"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">:</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>103</span> </span><span class="WHIT">                        </span><span class="STRN">"II"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">:</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>104</span> </span><span class="WHIT">                        </span><span class="STRN">"III"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">:</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>105</span> </span><span class="WHIT">                        </span><span class="STRN">"IV"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">:</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>106</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>107</span> </span><span class="WHIT">                    </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>108</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="STRN">"domain_and_name"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>109</span> </span><span class="WHIT">                        </span><span class="STRN">"I"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>110</span> </span><span class="WHIT">                        </span><span class="STRN">"II"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>111</span> </span><span class="WHIT">                        </span><span class="STRN">"III"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>112</span> </span><span class="WHIT">                        </span><span class="STRN">"IV"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>113</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>114</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>115</span> </span><span class="WHIT">                </span><span class="STRN">"helix_region_width"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>116</span> </span><span class="WHIT">                    </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"domain_and_name"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//pre defined widths</span><span class="WHIT">
<span class='line'>117</span> </span><span class="WHIT">                    </span><span class="STRN">"I"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox, example cartoon</span><span class="WHIT">
<span class='line'>118</span> </span><span class="WHIT">                    </span><span class="STRN">"II"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>119</span> </span><span class="WHIT">                    </span><span class="STRN">"III"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>120</span> </span><span class="WHIT">                    </span><span class="STRN">"IV"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="NUMB">0.02</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>121</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>122</span> </span><span class="WHIT">                </span><span class="STRN">"helix_region_height"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>123</span> </span><span class="WHIT">                    </span><span class="STRN">"I"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>124</span> </span><span class="WHIT">                    </span><span class="STRN">"II"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>125</span> </span><span class="WHIT">                    </span><span class="STRN">"III"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>126</span> </span><span class="WHIT">                    </span><span class="STRN">"IV"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>127</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>128</span> </span><span class="WHIT">                </span><span class="STRN">"helix_spacing_width"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>129</span> </span><span class="WHIT">                    </span><span class="STRN">"I"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// px</span><span class="WHIT">
<span class='line'>130</span> </span><span class="WHIT">                    </span><span class="STRN">"II"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// px</span><span class="WHIT">
<span class='line'>131</span> </span><span class="WHIT">                    </span><span class="STRN">"III"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// px</span><span class="WHIT">
<span class='line'>132</span> </span><span class="WHIT">                    </span><span class="STRN">"IV"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// px</span><span class="WHIT">
<span class='line'>133</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>134</span> </span><span class="WHIT">                </span><span class="STRN">"short_loops_draw_opts"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>135</span> </span><span class="WHIT">                    </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"single"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>136</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"black"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>137</span> </span><span class="WHIT">                    </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>138</span> </span><span class="WHIT">                    </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>139</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"3px"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>140</span> </span><span class="WHIT">                    </span><span class="STRN">"calc_len"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>141</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"reslen"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// fixed, custom, scaled, reslen</span><span class="WHIT">
<span class='line'>142</span> </span><span class="WHIT">                        </span><span class="STRN">"calc"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>143</span> </span><span class="WHIT">                            </span><span class="STRN">"length"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="COMM">//in pixels</span><span class="WHIT">
<span class='line'>144</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>145</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>146</span> </span><span class="WHIT">                    </span><span class="STRN">"shape"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>147</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"simple"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// simple, bulb, mushroom, mushroom_skew</span><span class="WHIT">
<span class='line'>148</span> </span><span class="WHIT">                        </span><span class="STRN">"calc"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>149</span> </span><span class="WHIT">                            </span><span class="STRN">"y_step"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//step used in path searching option in px, ignored in fixed, custom</span><span class="WHIT">
<span class='line'>150</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>151</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>152</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>153</span> </span><span class="WHIT">                </span><span class="STRN">"pore_loops_draw_opts"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>154</span> </span><span class="WHIT">                    </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"single"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>155</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"black"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>156</span> </span><span class="WHIT">                    </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>157</span> </span><span class="WHIT">                    </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>158</span> </span><span class="WHIT">                    </span><span class="COMM">// "stroke_size": "1.5px",</span><span class="WHIT">
<span class='line'>159</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"3px"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>160</span> </span><span class="WHIT">                    </span><span class="STRN">"calc_len"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>161</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"reslen"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// fixed, scaled, reslen</span><span class="WHIT">
<span class='line'>162</span> </span><span class="WHIT">                        </span><span class="STRN">"calc"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>163</span> </span><span class="WHIT">                            </span><span class="STRN">"length"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="COMM">//in pixels</span><span class="WHIT">
<span class='line'>164</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>165</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>166</span> </span><span class="WHIT">                    </span><span class="STRN">"shape"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>167</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"simple_skewed"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// simple_skewed only</span><span class="WHIT">
<span class='line'>168</span> </span><span class="WHIT">                        </span><span class="STRN">"calc"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>169</span> </span><span class="WHIT">                            </span><span class="STRN">"perc_center_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of each distance from x1 to center. modifies curve shape, ignored if break_type is not none </span><span class="WHIT">
<span class='line'>170</span> </span><span class="WHIT">                            </span><span class="STRN">"y_step"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//step used in path searching option in px, ignored in fixed, custom</span><span class="WHIT">
<span class='line'>171</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>172</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>173</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>174</span> </span><span class="WHIT">                </span><span class="STRN">"pore_region_width"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>175</span> </span><span class="WHIT">                    </span><span class="STRN">"I"</span><span class="PUNC">:</span><span class="NUMB">0.01</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>176</span> </span><span class="WHIT">                    </span><span class="STRN">"II"</span><span class="PUNC">:</span><span class="NUMB">0.01</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>177</span> </span><span class="WHIT">                    </span><span class="STRN">"III"</span><span class="PUNC">:</span><span class="NUMB">0.01</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>178</span> </span><span class="WHIT">                    </span><span class="STRN">"IV"</span><span class="PUNC">:</span><span class="NUMB">0.01</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>179</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>180</span> </span><span class="WHIT">                </span><span class="STRN">"pore_region_height"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>181</span> </span><span class="WHIT">                    </span><span class="STRN">"I"</span><span class="PUNC">:</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>182</span> </span><span class="WHIT">                    </span><span class="STRN">"II"</span><span class="PUNC">:</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>183</span> </span><span class="WHIT">                    </span><span class="STRN">"III"</span><span class="PUNC">:</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>184</span> </span><span class="WHIT">                    </span><span class="STRN">"IV"</span><span class="PUNC">:</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>185</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>186</span> </span><span class="WHIT">                </span><span class="STRN">"long_loops_draw_opts"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>187</span> </span><span class="WHIT">                    </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"single"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>188</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"black"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>189</span> </span><span class="WHIT">                    </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>190</span> </span><span class="WHIT">                    </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>191</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"3px"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>192</span> </span><span class="WHIT">                    </span><span class="STRN">"width"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>193</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"scaled"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// fixed, custom, scaled</span><span class="WHIT">
<span class='line'>194</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>195</span> </span><span class="WHIT">                    </span><span class="STRN">"calc_len"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>196</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"reslen"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// fixed, custom, scaled, reslen</span><span class="WHIT">
<span class='line'>197</span> </span><span class="WHIT">                        </span><span class="STRN">"calc"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>198</span> </span><span class="WHIT">                            </span><span class="STRN">"length"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="COMM">//in pixels</span><span class="WHIT">
<span class='line'>199</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>200</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>201</span> </span><span class="WHIT">                    </span><span class="STRN">"shape"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>202</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"mushroom"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// simple, bulb, mushroom, mushroom_skew</span><span class="WHIT">
<span class='line'>203</span> </span><span class="WHIT">                        </span><span class="STRN">"calc"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>204</span> </span><span class="WHIT">                            </span><span class="STRN">"x_step"</span><span class="PUNC">:</span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//step used in path searching option in px, ignored in fixed, custom</span><span class="WHIT">
<span class='line'>205</span> </span><span class="WHIT">                            </span><span class="STRN">"y_step"</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>206</span> </span><span class="WHIT">                            </span><span class="STRN">"perc_center_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.9</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of each distance from x1 to center. modifies mushroom shape</span><span class="WHIT">
<span class='line'>207</span> </span><span class="WHIT">                            </span><span class="STRN">"perc_step_y1"</span><span class="PUNC">:</span><span class="NUMB">0.1</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of each y step for p1 and p5 of path. modifies mushroom shape</span><span class="WHIT">
<span class='line'>208</span> </span><span class="WHIT">                            </span><span class="STRN">"perc_step_y2"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of each y step for p2 and p4 of path. modifies mushroom shape</span><span class="WHIT">
<span class='line'>209</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>210</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>211</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>212</span> </span><span class="WHIT">                </span><span class="STRN">"nter_loop_width"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.05</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>213</span> </span><span class="WHIT">                </span><span class="STRN">"nter_loop_draw_opts"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>214</span> </span><span class="WHIT">                    </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"single"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>215</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"black"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>216</span> </span><span class="WHIT">                    </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>217</span> </span><span class="WHIT">                    </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>218</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"3px"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>219</span> </span><span class="WHIT">                    </span><span class="STRN">"calc_len"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>220</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"reslen"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// fixed, reslen</span><span class="WHIT">
<span class='line'>221</span> </span><span class="WHIT">                        </span><span class="STRN">"calc"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>222</span> </span><span class="WHIT">                            </span><span class="STRN">"length"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//in pixels</span><span class="WHIT">
<span class='line'>223</span> </span><span class="WHIT">                            </span><span class="STRN">"start_loop"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"edge"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>224</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>225</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>226</span> </span><span class="WHIT">                    </span><span class="STRN">"shape"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>227</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"n_curves"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// n_curves</span><span class="WHIT">
<span class='line'>228</span> </span><span class="WHIT">                        </span><span class="STRN">"calc"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>229</span> </span><span class="WHIT">                            </span><span class="STRN">"y_step"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//step used in path searching option in px, ignored in fixed, custom</span><span class="WHIT">
<span class='line'>230</span> </span><span class="WHIT">                            </span><span class="STRN">"n_centers"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//number of waves to draw in curve</span><span class="WHIT">
<span class='line'>231</span> </span><span class="WHIT">                            </span><span class="STRN">"perc_centers_height"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="NUMB">1.0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="COMM">// height percentage of each wave</span><span class="WHIT">
<span class='line'>232</span> </span><span class="WHIT">                            </span><span class="STRN">"loop_rotation"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="WHIT"> </span><span class="COMM">//rotation of loop around starting point</span><span class="WHIT">
<span class='line'>233</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>234</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>235</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>236</span> </span><span class="WHIT">                </span><span class="STRN">"cter_loop_width"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.05</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>237</span> </span><span class="WHIT">                </span><span class="STRN">"cter_loop_draw_opts"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>238</span> </span><span class="WHIT">                    </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"single"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>239</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"black"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>240</span> </span><span class="WHIT">                    </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>241</span> </span><span class="WHIT">                    </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>242</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"3px"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>243</span> </span><span class="WHIT">                    </span><span class="STRN">"calc_len"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>244</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"fixed"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// fixed, reslen</span><span class="WHIT">
<span class='line'>245</span> </span><span class="WHIT">                        </span><span class="STRN">"calc"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>246</span> </span><span class="WHIT">                            </span><span class="STRN">"height"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of membrane to end height</span><span class="WHIT">
<span class='line'>247</span> </span><span class="WHIT">                            </span><span class="STRN">"start_loop"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"edge"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>248</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>249</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>250</span> </span><span class="WHIT">                    </span><span class="STRN">"shape"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>251</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"n_curves"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// n_curves</span><span class="WHIT">
<span class='line'>252</span> </span><span class="WHIT">                        </span><span class="STRN">"calc"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>253</span> </span><span class="WHIT">                            </span><span class="STRN">"y_step"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//step used in path searching option in px, ignored in fixed, custom</span><span class="WHIT">
<span class='line'>254</span> </span><span class="WHIT">                            </span><span class="STRN">"n_centers"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//number of waves to draw in curve</span><span class="WHIT">
<span class='line'>255</span> </span><span class="WHIT">                            </span><span class="STRN">"perc_centers_height"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="NUMB">1.0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.8</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="COMM">// height percentage of each wave</span><span class="WHIT">
<span class='line'>256</span> </span><span class="WHIT">                            </span><span class="STRN">"loop_rotation"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">30</span><span class="WHIT"> </span><span class="COMM">//rotation of loop around starting point</span><span class="WHIT">
<span class='line'>257</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>258</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>259</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>260</span> </span><span class="WHIT">                </span><span class="STRN">"residue_centroid_draw_opts"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>261</span> </span><span class="WHIT">                    </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"single"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>262</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"black"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>263</span> </span><span class="WHIT">                    </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>264</span> </span><span class="WHIT">                    </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>265</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"0px"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>266</span> </span><span class="WHIT">                    </span><span class="STRN">"circle_radius"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"1.5px"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>267</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>268</span> </span><span class="WHIT">                </span><span class="STRN">"residue_relations_draw_opts"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>269</span> </span><span class="WHIT">                    </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"single"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>270</span> </span><span class="WHIT">                    </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>271</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"1.5px"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>272</span> </span><span class="WHIT">                    </span><span class="STRN">"centroid_pos"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>273</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"custom"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>274</span> </span><span class="WHIT">                        </span><span class="STRN">"perc_dict"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>275</span> </span><span class="WHIT">                            </span><span class="STRN">"intramembrane"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>276</span> </span><span class="WHIT">                                </span><span class="STRN">"intramembrane"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">"perc_y"</span><span class="PUNC">:</span><span class="STRN">"between"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"perc_x"</span><span class="PUNC">:</span><span class="STRN">"between"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>277</span> </span><span class="WHIT">                                </span><span class="STRN">"intracellular"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">"perc_y"</span><span class="PUNC">:</span><span class="NUMB">0.65</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"perc_x"</span><span class="PUNC">:</span><span class="STRN">"between"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>278</span> </span><span class="WHIT">                                </span><span class="STRN">"extracellular"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">"perc_y"</span><span class="PUNC">:</span><span class="NUMB">0.35</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"perc_x"</span><span class="PUNC">:</span><span class="STRN">"between"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>279</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>280</span> </span><span class="WHIT">                            </span><span class="STRN">"intracellular"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>281</span> </span><span class="WHIT">                                </span><span class="STRN">"intracellular"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">"perc_y"</span><span class="PUNC">:</span><span class="STRN">"between"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"perc_x"</span><span class="PUNC">:</span><span class="STRN">"between"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>282</span> </span><span class="WHIT">                                </span><span class="STRN">"intramembrane"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">"perc_y"</span><span class="PUNC">:</span><span class="NUMB">0.65</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"perc_x"</span><span class="PUNC">:</span><span class="STRN">"between"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>283</span> </span><span class="WHIT">                                </span><span class="STRN">"extracellular"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">"perc_y"</span><span class="PUNC">:</span><span class="NUMB">0.85</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"perc_x"</span><span class="PUNC">:</span><span class="NUMB">0.95</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>284</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>285</span> </span><span class="WHIT">                            </span><span class="STRN">"extracellular"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>286</span> </span><span class="WHIT">                                </span><span class="STRN">"extracellular"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">"perc_y"</span><span class="PUNC">:</span><span class="STRN">"between"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"perc_x"</span><span class="PUNC">:</span><span class="STRN">"between"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>287</span> </span><span class="WHIT">                                </span><span class="STRN">"intracellular"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">"perc_y"</span><span class="PUNC">:</span><span class="NUMB">0.15</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"perc_x"</span><span class="PUNC">:</span><span class="NUMB">0.05</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>288</span> </span><span class="WHIT">                                </span><span class="STRN">"intramembrane"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="STRN">"perc_y"</span><span class="PUNC">:</span><span class="NUMB">0.35</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"perc_x"</span><span class="PUNC">:</span><span class="STRN">"between"</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>289</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>290</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>291</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>292</span> </span><span class="WHIT">                    </span><span class="STRN">"weight_scaling"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"absolute"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>293</span> </span><span class="WHIT">                    </span><span class="STRN">"path_width_scaling"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>294</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="STRN">"calc"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>295</span> </span><span class="WHIT">                        </span><span class="STRN">"domain"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"min"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"max"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>296</span> </span><span class="WHIT">                        </span><span class="STRN">"range"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>297</span> </span><span class="WHIT">                        </span><span class="STRN">"group_by_type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT">
<span class='line'>298</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>299</span> </span><span class="WHIT">                    </span><span class="STRN">"color_scaling"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>300</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="STRN">"calc"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>301</span> </span><span class="WHIT">                        </span><span class="STRN">"property"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"weight"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>302</span> </span><span class="WHIT">                        </span><span class="STRN">"domain"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"min"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"max"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>303</span> </span><span class="WHIT">                        </span><span class="STRN">"range"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"green"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"blue"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>304</span> </span><span class="WHIT">                        </span><span class="STRN">"lighter_fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT">
<span class='line'>305</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>306</span> </span><span class="WHIT">                    </span><span class="STRN">"element_centroid_scaling"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>307</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="STRN">"fixed"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>308</span> </span><span class="WHIT">                        </span><span class="STRN">"radius"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>309</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>310</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"green"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>311</span> </span><span class="WHIT">                    </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"lightgreen"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>312</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>313</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>314</span> </span><span class="WHIT">            </span><span class="STRN">"canvas"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>315</span> </span><span class="WHIT">                </span><span class="STRN">"border"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>316</span> </span><span class="WHIT">                    </span><span class="STRN">"right"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>317</span> </span><span class="WHIT">                    </span><span class="STRN">"left"</span><span class="PUNC">:</span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>318</span> </span><span class="WHIT">                    </span><span class="STRN">"top"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>319</span> </span><span class="WHIT">                    </span><span class="STRN">"bottom"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.02</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//% of viewbox</span><span class="WHIT">
<span class='line'>320</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>321</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>322</span> </span><span class="WHIT">            </span><span class="STRN">"text_defs"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>323</span> </span><span class="WHIT">                </span><span class="STRN">"font_family"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"sans-serif"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>324</span> </span><span class="WHIT">                </span><span class="STRN">"font_style"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"italic"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>325</span> </span><span class="WHIT">                </span><span class="STRN">"font_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"30px"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>326</span> </span><span class="WHIT">                </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"black"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>327</span> </span><span class="WHIT">                </span><span class="STRN">"center_xy"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>328</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>329</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>330</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">defaultStyleObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>331</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>332</span> 
<span class='line'>333</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>334</span>      * Object which controls every drawing aspect of plot. Contains four main attributes with lots of possible subdivisions and options.&lt;br>
<span class='line'>335</span>      * These four attributes are:&lt;br>
<span class='line'>336</span>      * &lt;br>
<span class='line'>337</span>      * 1. "membrane"&lt;br>
<span class='line'>338</span>      * 2. "canvas"&lt;br>
<span class='line'>339</span>      * 3. "textdefs"&lt;br>
<span class='line'>340</span>      * 4. "protein"&lt;br>
<span class='line'>341</span>      * &lt;br>
<span class='line'>342</span>      * "membrane":&lt;br>
<span class='line'>343</span>      * &lt;br>
<span class='line'>344</span>      * ----Sub-attributes: "membrane_region_height", "membrane_mode", "membrane_draw_opts"&lt;br>
<span class='line'>345</span>      * ----"membrane_region_height": controls % of total svg height occupied by membrane
<span class='line'>346</span>      * ----"membrane_draw_opts" sub-attributes depends on the "membrane_mode".&lt;br>
<span class='line'>347</span>      * &lt;br>
<span class='line'>348</span>      * ----"membrane_mode" has two possible values:&lt;br>
<span class='line'>349</span>      * &lt;br>
<span class='line'>350</span>      * -----> "box" for drawing membranes as a colored rectangle&lt;br>
<span class='line'>351</span>      * -----> "lipid" for drawing membranes as a lipid bilayer&lt;br>
<span class='line'>352</span>      * &lt;br>
<span class='line'>353</span>      * --------"membrane_draw_opts" used sub-attributes for "membrane_mode":"box" are:&lt;br>
<span class='line'>354</span>      * --------"fill": membrane rectangle color&lt;br>
<span class='line'>355</span>      * --------"opacity": membrane rectangle opacity&lt;br>
<span class='line'>356</span>      * &lt;br>
<span class='line'>357</span>      * --------"membrane_draw_opts" used sub-attributes for "membrane_mode":"lipid" are:&lt;br>
<span class='line'>358</span>      * --------"hfill": membrane lipid head group color&lt;br>
<span class='line'>359</span>      * --------"hstroke": membrane lipid head group stroke color&lt;br>
<span class='line'>360</span>      * --------"hstroke_s": membrane lipid head group stroke width in pixels&lt;br>
<span class='line'>361</span>      * --------"hopacity": membrane lipid head group opacity&lt;br>
<span class='line'>362</span>      * --------"tfill": membrane lipid tail group color&lt;br>
<span class='line'>363</span>      * --------"tstroke": membrane lipid tail group stroke color&lt;br>
<span class='line'>364</span>      * --------"tstroke_s": membrane lipid tail group stroke width in pixels&lt;br>
<span class='line'>365</span>      * --------"topacity": membrane lipid tail group opacity&lt;br>
<span class='line'>366</span>      * --------"lipid_head_radius_width": lipid head group width in % of total svg width&lt;br>
<span class='line'>367</span>      * --------"lipid_head_radius_height": lipid head group height in % of total svg height&lt;br>
<span class='line'>368</span>      * --------"lipid_tail_number": number of lipid tails per lipid group&lt;br>
<span class='line'>369</span>      * --------"lipid_tail_breaks": lipid tail breaks per lipid group (currently not used)&lt;br>
<span class='line'>370</span>      * --------"lipid_tail_spacing": lipid upper membrane to lower membrane tails spacing in % of total svg height&lt;br>
<span class='line'>371</span>      * &lt;br>
<span class='line'>372</span>      * "canvas":&lt;br>
<span class='line'>373</span>      * &lt;br>
<span class='line'>374</span>      * ----Sub-attribute: "border" with sub-attributes "right", "left", "top", "bottom"&lt;br>
<span class='line'>375</span>      * ----"right": controls svg right border in % of total svg width&lt;br>
<span class='line'>376</span>      * ----"left": controls svg left border in % of total svg width&lt;br>
<span class='line'>377</span>      * ----"top": controls svg top border in % of total svg height&lt;br>
<span class='line'>378</span>      * ----"bottom": controls svg bottom border in % of total svg height&lt;br>
<span class='line'>379</span>      * &lt;br>
<span class='line'>380</span>      * "textdefs":&lt;br>
<span class='line'>381</span>      * ----Sub-attributes: "font_family", "font_style", "font_size", "fill", "center_xy"&lt;br>
<span class='line'>382</span>      * ----"font_family: controls text default font family&lt;br>
<span class='line'>383</span>      * ----"font_style": controls text default font style&lt;br>
<span class='line'>384</span>      * ----"font_size": controls text default font size&lt;br>
<span class='line'>385</span>      * ----"fill": controls text default color&lt;br>
<span class='line'>386</span>      * ----"center_xy": controls text automatic centering around "absolute" coordinate&lt;br>
<span class='line'>387</span>      * &lt;br>
<span class='line'>388</span>      * "protein":&lt;br>
<span class='line'>389</span>      * &lt;br>
<span class='line'>390</span>      * ----Has many sub-attributes related to the drawing of different elements&lt;br>
<span class='line'>391</span>      * ----Sub-attributes for helices under protein: "helix_mode", "helix_draw_opts", "helix_region_width", "helix_region_height", "helix_spacing_width"&lt;br>
<span class='line'>392</span>      * &lt;br>
<span class='line'>393</span>      * ----"helix_mode": determines type of helix to be drawn: "box", "cylinder" or "cartoon" are possible values.&lt;br>
<span class='line'>394</span>      * ----"helix_draw_opts": determines helix drawing characteristics according to helix type.&lt;br>
<span class='line'>395</span>      * --------"helix_draw_opts" used sub-attributes for "helix_mode":"box" are: NONE&lt;br>
<span class='line'>396</span>      * --------"helix_draw_opts" used sub-attributes for "helix_mode":"cylinder" are:&lt;br>
<span class='line'>397</span>      * --------"top_cylinder_stroke": stroke color of top cylinder circle&lt;br>
<span class='line'>398</span>      * --------"top_cylinder_stroke_size": stroke size of top cylinder circle&lt;br>
<span class='line'>399</span>      * --------"bottom_cylinder_stroke": stroke size of bottom cylinder cirle&lt;br>
<span class='line'>400</span>      * --------"bottom_cylinder_stroke_size": stroke color of bottom cylinder circle&lt;br>
<span class='line'>401</span>      * &lt;br>
<span class='line'>402</span>      * --------"helix_draw_opts" used sub-attributes for "helix_mode":"cartoon" are:&lt;br>
<span class='line'>403</span>      * --------"x_to_end_prop": proportion that influences shape of drawn half helices&lt;br>
<span class='line'>404</span>      * --------"y_to_mid_prop": proportion that influences shape of drawn half helices&lt;br>
<span class='line'>405</span>      * --------"aa_area_perc_displacement": proportion that influences shape of drawn half helices&lt;br>
<span class='line'>406</span>      * --------"thickness": proportion that influences half turn height&lt;br>
<span class='line'>407</span>      * --------"front_helix_stroke": stroke color of front half helices&lt;br>
<span class='line'>408</span>      * --------"back_helix_stroke": stroke color of back half helices&lt;br>
<span class='line'>409</span>      * --------"stroke_size": stroke size of half helices&lt;br>
<span class='line'>410</span>      * &lt;br>
<span class='line'>411</span>      * ----"helix_draw_opts" also has properties that can be applied for any helix element which&lt;br>
<span class='line'>412</span>      * ----have a specific formatting as a dictionary of domain keys mapping to arrays of six elements&lt;br>
<span class='line'>413</span>      * ----corresponding to each helix(H1-H6) of each domain (I-IV)&lt;br>
<span class='line'>414</span>      * --------"fill": color of front turns for each helix of each domain&lt;br>
<span class='line'>415</span>      * --------"back_fill": color of back turns for each helix of each domain&lt;br>
<span class='line'>416</span>      * --------"stroke": color of stroke for each helix of each domain&lt;br>
<span class='line'>417</span>      * --------"stroke_size": size in pixels of stroke for each helix of each domain&lt;br>
<span class='line'>418</span>      * --------"opacity": opacity of each helix in each domain&lt;br>
<span class='line'>419</span>      * --------example: "I": { 1:"red",2:"red",3:"red",4:"blue",5:"red",6:"red"} for colors&lt;br>
<span class='line'>420</span>      * &lt;br>
<span class='line'>421</span>      * ----The helix related attributes: "helix_region_width", "helix_region_height", "helix_spacing_width",&lt;br>
<span class='line'>422</span>      * ----have a specific formatting as a dictionary of domain keys mapping to arrays of six elements&lt;br>
<span class='line'>423</span>      * ----corresponding to each helix(H1-H6) of each domain (I-IV)&lt;br>
<span class='line'>424</span>      * ----"helix_region_width": controls helix plot width in % of total svg width&lt;br>
<span class='line'>425</span>      * ----"helix_region_height": controls helix plot height in % of total svg height&lt;br>
<span class='line'>426</span>      * ----"helix_spacing_width": controls spacing between helices in % of total svg width&lt;br>
<span class='line'>427</span>      * &lt;br>
<span class='line'>428</span>      * ----Sub-attributes for loops include different loops categories such as:&lt;br>&lt;br>
<span class='line'>429</span>      * ----"short_loops_draw_opts" for short, intra domain loops&lt;br>
<span class='line'>430</span>      * ----"long_loops_draw_opts" for long, between domain loops&lt;br>
<span class='line'>431</span>      * ----"pore_loops_draw_opts", "pore_region_width", "pore_region_height" for pore loops&lt;br>
<span class='line'>432</span>      * ---- "nter_loop_width", "nter_loop_draw_opts" for the N-terminal loop&lt;br>
<span class='line'>433</span>      * ---- "cter_loop_width", "cter_loop_draw_opts" for the C-terminal loop&lt;br>
<span class='line'>434</span>      * ---- the sub-attributes of the differnt loops "_draw_opts" objects are mostly equal:&lt;br>
<span class='line'>435</span>      * --------"type": value is "single". has no importance for now but is essential&lt;br>
<span class='line'>436</span>      * --------"stroke": color of loop path stroke&lt;br>
<span class='line'>437</span>      * --------"fill": color of loop path ("none" should be used for non-polygon paths)&lt;br>
<span class='line'>438</span>      * --------"opacity": opacity of loop path&lt;br>
<span class='line'>439</span>      * --------"stroke_size": stroke width of loop path&lt;br>
<span class='line'>440</span>      * &lt;br>
<span class='line'>441</span>      * --------"calc_len": describes how loop length should be calculated. has multiple options of additional attributes&lt;br>
<span class='line'>442</span>      * ------------"type": indicates loop length calculus type. "fixed", "scaled", "reslen" and "custom" are possible options&lt;br>
<span class='line'>443</span>      * ------------"calc": contains additional attributes for each loop length calculus "type"&lt;br>
<span class='line'>444</span>      * &lt;br>
<span class='line'>445</span>      * ------------ "fixed" indicates an equal, similar loop drawn for fixed box with a given height, width (when applicable for loop shape)&lt;br>
<span class='line'>446</span>      * ------------ "fixed" has required attributes inside "calc": "height" "width" indicating % of total svg width, height&lt;br>
<span class='line'>447</span>      * &lt;br>
<span class='line'>448</span>      * ------------ "scaled" indicates each loop should be drawn from boxes with height, widths proportional to their amino acid numbering&lt;br>
<span class='line'>449</span>      * ------------ "scaled" has required attributes inside "calc": "height" "width" indicating maximum % of total svg width, height for biggest loop&lt;br>
<span class='line'>450</span>      * ------------ "scale" which indicates type of aa number loop scaling: "linear", "power" or "log". &lt;br>
<span class='line'>451</span>      * ------------ logarithimic "log" scale can have its base set by a "base" additional attribute inside "calc"&lt;br>
<span class='line'>452</span>      * ------------ power "power" scale can have its exponent set by a "exponent" additional attribute inside "calc"&lt;br>
<span class='line'>453</span>      * ------------ "scale" types are unavailable for "nter_loop_draw_opts" and "cter_loop_draw_opts"&lt;br>
<span class='line'>454</span>      * &lt;br>
<span class='line'>455</span>      * ------------ "reslen" indicates each loops aminoacid should have a given length in pixels&lt;br>
<span class='line'>456</span>      * ------------ "reslen" requires "length" attribute inside "calc" indicating aminoacid length in pixels.&lt;br>
<span class='line'>457</span>      * ------------ please note that loop minimum width is automatically set when bigger than "length" attribute&lt;br>
<span class='line'>458</span>      * ------------ this is calculates by a straight line between helices anchoring points divided by the loop aa number&lt;br>
<span class='line'>459</span>      * &lt;br>
<span class='line'>460</span>      * ------------ "custom" indicates an specific loop length for each loop defined by a dictionary indicating loop position&lt;br>
<span class='line'>461</span>      * ------------ "custom" requires dictionaries for "width" and "height" inside "calc" options.&lt;br>
<span class='line'>462</span>      * ------------ for "short_loops_draw_opts" this dictionary is formatted as the example below:&lt;br>
<span class='line'>463</span>      * ------------ "I": [0.01,0.01,0.01,0.01,0.005,0.01,0.01]&lt;br>
<span class='line'>464</span>      * ------------ for "long_loops_draw_opts" this dictionary is formatted as the example below:&lt;br>
<span class='line'>465</span>      * ------------ {2: 0.01, 3: 0.01, 4: 0.01},&lt;br>
<span class='line'>466</span>      * ------------ for "pore_loops_draw_opts", "nter_loop_draw_opts" and "cter_loop_draw_opts", the "custom" option is not available&lt;br>
<span class='line'>467</span>      * &lt;br>
<span class='line'>468</span>      * --------"shape": describes how loop shape should be drawn&lt;br>
<span class='line'>469</span>      * ------------"type": indicates how loop shape should be drawn in plot&lt;br>
<span class='line'>470</span>      * ------------"calc": contains additional attributes for drawing specific loop shapes&lt;br>
<span class='line'>471</span>      * &lt;br>
<span class='line'>472</span>      * ------------ loop types "simple", "bulb" and "mushroom" are available for &lt;b>&lt;i>both short and long loops&lt;/b>&lt;/i>&lt;br>
<span class='line'>473</span>      * ------------ in loop type "simple", loop points are defined by the two helices anchoring points plus&lt;br>
<span class='line'>474</span>      * ------------ their centroid point, which is scaled in the vertical direction according to "calc_len"&lt;br>
<span class='line'>475</span>      * ------------ "height" definitions and to a "y_step" calc attribute &lt;br>
<span class='line'>476</span>      * ------------ an optional "calc" attribute "perc_center_x" can regulate the x positioning of the centroid&lt;br>
<span class='line'>477</span>      * ------------ point in relation to the anchoring first and second points.&lt;br>
<span class='line'>478</span>      * &lt;br>
<span class='line'>479</span>      * ------------ in loop type "bulb", besides the above points for loop "simple", two additional points are added:&lt;br>
<span class='line'>480</span>      * ------------ one before the first anchoring point and another after the first anchoring point&lt;br>
<span class='line'>481</span>      * ------------ the y position of these points are defined as a percentage of the scaled centroid point height&lt;br>
<span class='line'>482</span>      * ------------ by the "perc_step_y" attribute. their x positions are defined by the "calc_len"&lt;br>
<span class='line'>483</span>      * ------------ "width" definitions and to a "x_step" calc attribute &lt;br>
<span class='line'>484</span>      * &lt;br>
<span class='line'>485</span>      * ------------ in loop type "mushroom", besides the above points for loop "bulb", two additional points are added:&lt;br>
<span class='line'>486</span>      * ------------ one between the first anchoring point and the centroid point&lt;br>
<span class='line'>487</span>      * ------------ and another between the centroid point and the second anchoring point&lt;br>
<span class='line'>488</span>      * ------------ the y position of these points are defined as a percentage of the scaled centroid point height&lt;br>
<span class='line'>489</span>      * ------------ by the "perc_step_y2" attribute. ("perc_step_y1" is used for the "bulb" additional points)&lt;br>
<span class='line'>490</span>      * ------------ their x positions are defined by the "perc_center_x" "calc" attribute which regulates their distance&lt;br>
<span class='line'>491</span>      * ------------ between the anchoring points and the centroid as a frequency (0.0-1.0)&lt;br>
<span class='line'>492</span>      * &lt;br>
<span class='line'>493</span>      * ------------ loop type "swirl" is available only for both &lt;b>&lt;i>short loops&lt;/b>&lt;/i>&lt;br>
<span class='line'>494</span>      * ------------ this is mostly equal to the simple loop but here a "swirl_x" calc attribute is&lt;br>
<span class='line'>495</span>      * ------------ used to calculate the x positioning of two new points relative to the anchoring points centroid&lt;br>
<span class='line'>496</span>      * ------------ these two points are added between the first and centroid and centroid and second points&lt;br>
<span class='line'>497</span>      * ------------ their y positioning is controled by a "perc_step_y" attribute. the x positioning delta of the&lt;br>
<span class='line'>498</span>      * ------------ two new points is also added to the centroid point&lt;br>
<span class='line'>499</span>      * &lt;br>
<span class='line'>500</span>      * ------------ loop type "simple_skewed" is the only available &lt;b>&lt;i>only for pore loops&lt;/b>&lt;/i>&lt;br>
<span class='line'>501</span>      * ------------ this is equal to the "simple" loop definition but with the obligatory attribute&lt;br>
<span class='line'>502</span>      * ------------ "perc_center_x" for controlling the x positioning of the centroid point&lt;br>
<span class='line'>503</span>      * &lt;br>
<span class='line'>504</span>      * ------------ loop type "n_curves" is the only available &lt;b>&lt;i>only for N and C terminal loops&lt;/b>&lt;/i>&lt;br>
<span class='line'>505</span>      * ------------ in loop type "n_curves", loops are initially drawn as a straight line &lt;br>
<span class='line'>506</span>      * ------------ from the "canvas" bottom left corner to Helix 1 of Domain 1 and a number of "waves" are added&lt;br>
<span class='line'>507</span>      * ------------ to these loops. the height of each wave is calculated as percentages of a maximum wave step (attribute "y_step")&lt;br>
<span class='line'>508</span>      * ------------ in the calc attribute "perc_centers_height". the number of waves is defined in the "n_centers" "calc" attribute&lt;br>
<span class='line'>509</span>      * &lt;br>
<span class='line'>510</span>      * --------- Note 1:&lt;br>
<span class='line'>511</span>      * --------- long_loops_draw_opts has an additional "width" attribute that regulates their initial draw areas "width" calculation&lt;br>
<span class='line'>512</span>      * --------- this is done by it's subattribute "type" whose possible values are "fixed" (equal inter domain loops width)&lt;br>
<span class='line'>513</span>      * --------- or "scaled" (inter domain loops width proportional to loop aa number)&lt;br>
<span class='line'>514</span>      * &lt;br>
<span class='line'>515</span>      * ---- Note 2:&lt;br>
<span class='line'>516</span>      * ---- pore loops have two attributes under "protein": &lt;br>
<span class='line'>517</span>      * ---- "pore_region_width" and "pore_region_height" for controlling their draw areas width and height&lt;br>
<span class='line'>518</span>      * ---- as percentages of the svg total width and height. the values of these attributes are dictionaries&lt;br>
<span class='line'>519</span>      * ---- containing keys for the pore loops of each domain as the example below:&lt;br>
<span class='line'>520</span>      * ---- {"I":0.01,"II":0.01,"III":0.01,"IV":0.01}&lt;br>
<span class='line'>521</span>      * &lt;br>
<span class='line'>522</span>      * ---- Note 3:&lt;br>
<span class='line'>523</span>      * ---- N ter and C ter loops have each a single attribute under "protein": &lt;br>
<span class='line'>524</span>      * ---- "nter_loop_width" and "cter_loop_width" controlling their draw areas respective width&lt;br>
<span class='line'>525</span>      * ---- as percentages of the svg total width.&lt;br>
<span class='line'>526</span>      * @namespace
<span class='line'>527</span>      * @type {{}}
<span class='line'>528</span>      * @exports NaView
<span class='line'>529</span>      * @name style_obj
<span class='line'>530</span>      */</span><span class="WHIT">
<span class='line'>531</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>532</span> 
<span class='line'>533</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>534</span>      * Dictionary for residue properties.&lt;br>
<span class='line'>535</span>      * Properties are defined as: residue_index:{"property":property_value}&lt;br>
<span class='line'>536</span>      * Example: {&lt;br>
<span class='line'>537</span>      *     1: {//residue 1 of protein sequence&lt;br>
<span class='line'>538</span>      *         "Conservation": 0.1 //Value of Conservation Property&lt;br>
<span class='line'>539</span>      *     },&lt;br>
<span class='line'>540</span>      *     2: {//residue 2 of protein sequence&lt;br>
<span class='line'>541</span>      *         "Conservation": 0.3 //Value of Conservation Property&lt;br>
<span class='line'>542</span>      *     },&lt;br>
<span class='line'>543</span>      *     3: {//residue 3 of protein sequence&lt;br>
<span class='line'>544</span>      *         "Conservation": 0.6 //Value of Conservation Property&lt;br>
<span class='line'>545</span>      *     },&lt;br>
<span class='line'>546</span>      *     4: {//residue 4 of protein sequence&lt;br>
<span class='line'>547</span>      *         "Conservation": 0.7 //Value of Conservation Property&lt;br>
<span class='line'>548</span>      *     },&lt;br>
<span class='line'>549</span>      *     ...&lt;br>
<span class='line'>550</span>      *     2005: {//residue 2005 of protein sequence&lt;br>
<span class='line'>551</span>      *         "Conservation": 0.9 //Value of Conservation Property&lt;br>
<span class='line'>552</span>      *     }&lt;br>
<span class='line'>553</span>      * }&lt;br>
<span class='line'>554</span>      * @namespace
<span class='line'>555</span>      * @type {{}}
<span class='line'>556</span>      * @exports NaView
<span class='line'>557</span>      * @name current_resid_properties
<span class='line'>558</span>      */</span><span class="WHIT">
<span class='line'>559</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">current_resid_properties</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>560</span> 
<span class='line'>561</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>562</span>      * Global object storing fill rules for residue/elements
<span class='line'>563</span>      * @see createFillRules
<span class='line'>564</span>      * @namespace
<span class='line'>565</span>      * @type {{}}
<span class='line'>566</span>      * @exports NaView
<span class='line'>567</span>      * @name fillRules
<span class='line'>568</span>      */</span><span class="WHIT">
<span class='line'>569</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fillRules</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>570</span> 
<span class='line'>571</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>572</span>      * Global object storing drawing area boundaries for SVG element
<span class='line'>573</span>      * @namespace
<span class='line'>574</span>      * @type {{}}
<span class='line'>575</span>      * @exports NaView
<span class='line'>576</span>      * @name svg_drawarea
<span class='line'>577</span>      */</span><span class="WHIT">
<span class='line'>578</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">svg_drawarea</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>579</span> 
<span class='line'>580</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>581</span>      * Dictionary for converting one letter amino acid syntax to three letter
<span class='line'>582</span>      * @namespace
<span class='line'>583</span>      * @type {{}}
<span class='line'>584</span>      * @exports NaView
<span class='line'>585</span>      * @name one_to_three
<span class='line'>586</span>      */</span><span class="WHIT">
<span class='line'>587</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">one_to_three</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>588</span> </span><span class="WHIT">        </span><span class="STRN">"A"</span><span class="PUNC">:</span><span class="STRN">"ALA"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>589</span> </span><span class="WHIT">        </span><span class="STRN">"C"</span><span class="PUNC">:</span><span class="STRN">"CYS"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>590</span> </span><span class="WHIT">        </span><span class="STRN">"D"</span><span class="PUNC">:</span><span class="STRN">"ASP"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>591</span> </span><span class="WHIT">        </span><span class="STRN">"E"</span><span class="PUNC">:</span><span class="STRN">"GLU"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>592</span> </span><span class="WHIT">        </span><span class="STRN">"F"</span><span class="PUNC">:</span><span class="STRN">"PHE"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>593</span> </span><span class="WHIT">        </span><span class="STRN">"G"</span><span class="PUNC">:</span><span class="STRN">"GLY"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>594</span> </span><span class="WHIT">        </span><span class="STRN">"H"</span><span class="PUNC">:</span><span class="STRN">"HIS"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>595</span> </span><span class="WHIT">        </span><span class="STRN">"I"</span><span class="PUNC">:</span><span class="STRN">"ILE"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>596</span> </span><span class="WHIT">        </span><span class="STRN">"K"</span><span class="PUNC">:</span><span class="STRN">"LYS"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>597</span> </span><span class="WHIT">        </span><span class="STRN">"L"</span><span class="PUNC">:</span><span class="STRN">"LEU"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>598</span> </span><span class="WHIT">        </span><span class="STRN">"M"</span><span class="PUNC">:</span><span class="STRN">"MET"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>599</span> </span><span class="WHIT">        </span><span class="STRN">"N"</span><span class="PUNC">:</span><span class="STRN">"ASN"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>600</span> </span><span class="WHIT">        </span><span class="STRN">"P"</span><span class="PUNC">:</span><span class="STRN">"PRO"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>601</span> </span><span class="WHIT">        </span><span class="STRN">"Q"</span><span class="PUNC">:</span><span class="STRN">"GLN"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>602</span> </span><span class="WHIT">        </span><span class="STRN">"R"</span><span class="PUNC">:</span><span class="STRN">"ARG"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>603</span> </span><span class="WHIT">        </span><span class="STRN">"S"</span><span class="PUNC">:</span><span class="STRN">"SER"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>604</span> </span><span class="WHIT">        </span><span class="STRN">"T"</span><span class="PUNC">:</span><span class="STRN">"THR"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>605</span> </span><span class="WHIT">        </span><span class="STRN">"V"</span><span class="PUNC">:</span><span class="STRN">"VAL"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>606</span> </span><span class="WHIT">        </span><span class="STRN">"W"</span><span class="PUNC">:</span><span class="STRN">"TRP"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>607</span> </span><span class="WHIT">        </span><span class="STRN">"Y"</span><span class="PUNC">:</span><span class="STRN">"TYR"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>608</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>609</span> </span><span class="WHIT">    
<span class='line'>610</span>     </span><span class="COMM">/**
<span class='line'>611</span>      * Dictionary for converting three letter amino acid syntax to one letter
<span class='line'>612</span>      * @namespace
<span class='line'>613</span>      * @type {{}}
<span class='line'>614</span>      * @exports NaView
<span class='line'>615</span>      * @name three_to_one
<span class='line'>616</span>      */</span><span class="WHIT">
<span class='line'>617</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">three_to_one</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>618</span> </span><span class="WHIT">        </span><span class="STRN">"ALA"</span><span class="PUNC">:</span><span class="STRN">"A"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>619</span> </span><span class="WHIT">        </span><span class="STRN">"CYS"</span><span class="PUNC">:</span><span class="STRN">"C"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>620</span> </span><span class="WHIT">        </span><span class="STRN">"ASP"</span><span class="PUNC">:</span><span class="STRN">"D"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>621</span> </span><span class="WHIT">        </span><span class="STRN">"GLU"</span><span class="PUNC">:</span><span class="STRN">"E"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>622</span> </span><span class="WHIT">        </span><span class="STRN">"PHE"</span><span class="PUNC">:</span><span class="STRN">"F"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>623</span> </span><span class="WHIT">        </span><span class="STRN">"GLY"</span><span class="PUNC">:</span><span class="STRN">"G"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>624</span> </span><span class="WHIT">        </span><span class="STRN">"HIS"</span><span class="PUNC">:</span><span class="STRN">"H"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>625</span> </span><span class="WHIT">        </span><span class="STRN">"ILE"</span><span class="PUNC">:</span><span class="STRN">"I"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>626</span> </span><span class="WHIT">        </span><span class="STRN">"LYS"</span><span class="PUNC">:</span><span class="STRN">"K"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>627</span> </span><span class="WHIT">        </span><span class="STRN">"LEU"</span><span class="PUNC">:</span><span class="STRN">"L"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>628</span> </span><span class="WHIT">        </span><span class="STRN">"MET"</span><span class="PUNC">:</span><span class="STRN">"M"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>629</span> </span><span class="WHIT">        </span><span class="STRN">"ASN"</span><span class="PUNC">:</span><span class="STRN">"N"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>630</span> </span><span class="WHIT">        </span><span class="STRN">"PRO"</span><span class="PUNC">:</span><span class="STRN">"P"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>631</span> </span><span class="WHIT">        </span><span class="STRN">"GLN"</span><span class="PUNC">:</span><span class="STRN">"Q"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>632</span> </span><span class="WHIT">        </span><span class="STRN">"ARG"</span><span class="PUNC">:</span><span class="STRN">"R"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>633</span> </span><span class="WHIT">        </span><span class="STRN">"SER"</span><span class="PUNC">:</span><span class="STRN">"S"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>634</span> </span><span class="WHIT">        </span><span class="STRN">"THR"</span><span class="PUNC">:</span><span class="STRN">"T"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>635</span> </span><span class="WHIT">        </span><span class="STRN">"VAL"</span><span class="PUNC">:</span><span class="STRN">"V"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>636</span> </span><span class="WHIT">        </span><span class="STRN">"TRP"</span><span class="PUNC">:</span><span class="STRN">"W"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>637</span> </span><span class="WHIT">        </span><span class="STRN">"TYR"</span><span class="PUNC">:</span><span class="STRN">"Y"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>638</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>639</span> </span><span class="WHIT">    
<span class='line'>640</span>     </span><span class="COMM">/**
<span class='line'>641</span>      * List of allowed names for drawn elements.&lt;br>
<span class='line'>642</span>      * Allowed elements are named according to:&lt;br>&lt;br>
<span class='line'>643</span>      * 1. their Domain (I,II,III,IV) or InterDomain (1,2,3,4,5) references&lt;br>
<span class='line'>644</span>      * 2. A semicolon (;) Domain to Element separator.&lt;br>
<span class='line'>645</span>      * 3. their element types (Helix, Pore, Loop) references&lt;br>
<span class='line'>646</span>      * 4. (Optional) for intradomain Helices and Loops, their element type indexes (1,2,3,4,5,6)&lt;br>
<span class='line'>647</span>      * @namespace
<span class='line'>648</span>      * @type {Array}
<span class='line'>649</span>      * @exports NaView
<span class='line'>650</span>      * @name allowed_element_names
<span class='line'>651</span>      */</span><span class="WHIT">
<span class='line'>652</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">allowed_element_names</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>653</span> </span><span class="WHIT">        </span><span class="STRN">"DomainI;Helix1"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>654</span> </span><span class="WHIT">        </span><span class="STRN">"DomainI;Helix2"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>655</span> </span><span class="WHIT">        </span><span class="STRN">"DomainI;Helix3"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>656</span> </span><span class="WHIT">        </span><span class="STRN">"DomainI;Helix4"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>657</span> </span><span class="WHIT">        </span><span class="STRN">"DomainI;Helix5"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>658</span> </span><span class="WHIT">        </span><span class="STRN">"DomainI;Helix6"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>659</span> </span><span class="WHIT">        </span><span class="STRN">"DomainII;Helix1"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>660</span> </span><span class="WHIT">        </span><span class="STRN">"DomainII;Helix2"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>661</span> </span><span class="WHIT">        </span><span class="STRN">"DomainII;Helix3"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>662</span> </span><span class="WHIT">        </span><span class="STRN">"DomainII;Helix4"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>663</span> </span><span class="WHIT">        </span><span class="STRN">"DomainII;Helix5"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>664</span> </span><span class="WHIT">        </span><span class="STRN">"DomainII;Helix6"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>665</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIII;Helix1"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>666</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIII;Helix2"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>667</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIII;Helix3"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>668</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIII;Helix4"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>669</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIII;Helix5"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>670</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIII;Helix6"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>671</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIV;Helix1"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>672</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIV;Helix2"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>673</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIV;Helix3"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>674</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIV;Helix4"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>675</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIV;Helix5"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>676</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIV;Helix6"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>677</span> </span><span class="WHIT">        </span><span class="STRN">"DomainI;Loop1"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>678</span> </span><span class="WHIT">        </span><span class="STRN">"DomainI;Loop2"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>679</span> </span><span class="WHIT">        </span><span class="STRN">"DomainI;Loop3"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>680</span> </span><span class="WHIT">        </span><span class="STRN">"DomainI;Loop4"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>681</span> </span><span class="WHIT">        </span><span class="STRN">"DomainI;Loop5"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>682</span> </span><span class="WHIT">        </span><span class="STRN">"DomainI;Loop6"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>683</span> </span><span class="WHIT">        </span><span class="STRN">"DomainII;Loop1"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>684</span> </span><span class="WHIT">        </span><span class="STRN">"DomainII;Loop2"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>685</span> </span><span class="WHIT">        </span><span class="STRN">"DomainII;Loop3"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>686</span> </span><span class="WHIT">        </span><span class="STRN">"DomainII;Loop4"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>687</span> </span><span class="WHIT">        </span><span class="STRN">"DomainII;Loop5"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>688</span> </span><span class="WHIT">        </span><span class="STRN">"DomainII;Loop6"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>689</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIII;Loop1"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>690</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIII;Loop2"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>691</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIII;Loop3"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>692</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIII;Loop4"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>693</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIII;Loop5"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>694</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIII;Loop6"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>695</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIV;Loop1"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>696</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIV;Loop2"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>697</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIV;Loop3"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>698</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIV;Loop4"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>699</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIV;Loop5"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>700</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIV;Loop6"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>701</span> </span><span class="WHIT">        </span><span class="STRN">"DomainI;Pore"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>702</span> </span><span class="WHIT">        </span><span class="STRN">"DomainII;Pore"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>703</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIII;Pore"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>704</span> </span><span class="WHIT">        </span><span class="STRN">"DomainIV;Pore"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>705</span> </span><span class="WHIT">        </span><span class="STRN">"InterDomain1;Loop"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>706</span> </span><span class="WHIT">        </span><span class="STRN">"InterDomain2;Loop"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>707</span> </span><span class="WHIT">        </span><span class="STRN">"InterDomain3;Loop"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>708</span> </span><span class="WHIT">        </span><span class="STRN">"InterDomain4;Loop"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>709</span> </span><span class="WHIT">        </span><span class="STRN">"InterDomain5;Loop"</span><span class="WHIT">
<span class='line'>710</span> </span><span class="WHIT">    </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>711</span> 
<span class='line'>712</span> 
<span class='line'>713</span> 
<span class='line'>714</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>715</span>      * Main function for running library. Uses detected parameters to automatically create NaV plot.
<span class='line'>716</span>      * @exports NaView
<span class='line'>717</span>      * @name initLib
<span class='line'>718</span>      * @namespace
<span class='line'>719</span>      */</span><span class="WHIT">
<span class='line'>720</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">initLib</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>721</span> </span><span class="WHIT">        </span><span class="NAME">initMainSvg</span><span class="PUNC">(</span><span class="NAME">svg_id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">container_id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>722</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style_obj_input</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>723</span> </span><span class="WHIT">            </span><span class="NAME">style_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj_input</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>724</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>725</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">style_obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>726</span> </span><span class="WHIT">            </span><span class="NAME">console.warn</span><span class="PUNC">(</span><span class="STRN">'style obj not set. creating a new one...'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>727</span> </span><span class="WHIT">            </span><span class="NAME">style_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateDefaultStyleObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>728</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>729</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">protein_input</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>730</span> </span><span class="WHIT">            </span><span class="NAME">initData</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>731</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>732</span> </span><span class="WHIT">            </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"Error: no protein input data"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>733</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>734</span> </span><span class="WHIT">        </span><span class="NAME">initViz</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>735</span> 
<span class='line'>736</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>737</span> </span><span class="WHIT">    </span><span class="NAME">initLib</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>738</span> 
<span class='line'>739</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>740</span>      * Function to generate the SVG Dom element.&lt;br>
<span class='line'>741</span>      * 1. Detects if current svg container exists, and should be created if not&lt;br>
<span class='line'>742</span>      * 2. Detects if current svg exists and creates it if not&lt;br>
<span class='line'>743</span>      * 3. Sets svg width and height&lt;br>
<span class='line'>744</span>      * @param {string} svg_id id of svg to edit/create
<span class='line'>745</span>      * @param {string} container_id  id of svg to select/create
<span class='line'>746</span>      * @param {number} svg_width width to set svg
<span class='line'>747</span>      * @param {number} svg_height height to set svg
<span class='line'>748</span>      * @exports NaView
<span class='line'>749</span>      * @name initMainSvg
<span class='line'>750</span>      * @namespace
<span class='line'>751</span>      */</span><span class="WHIT">
<span class='line'>752</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">initMainSvg</span><span class="PUNC">(</span><span class="NAME">svg_id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">container_id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>753</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">select_svg_container</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>754</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">container_id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>755</span> </span><span class="WHIT">            </span><span class="NAME">select_svg_container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="STRN">"#"</span><span class="PUNC">+</span><span class="NAME">container_id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>756</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">select_svg_container.size</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>757</span> </span><span class="WHIT">                </span><span class="NAME">select_svg_container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="STRN">"body"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">container_id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>758</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>759</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>760</span> </span><span class="WHIT">            </span><span class="NAME">select_svg_container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="STRN">"body"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>761</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>762</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">select_svg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="STRN">"#"</span><span class="PUNC">+</span><span class="NAME">svg_id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>763</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">select_svg.size</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>764</span> </span><span class="WHIT">            </span><span class="NAME">select_svg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">select_svg_container.append</span><span class="PUNC">(</span><span class="STRN">"svg"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">svg_id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>765</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>766</span> </span><span class="WHIT">        </span><span class="NAME">select_svg</span><span class="WHIT">
<span class='line'>767</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>768</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"height"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>769</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>770</span> 
<span class='line'>771</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>772</span>      * Function to verify and parse the user protein data.
<span class='line'>773</span>      * @exports NaView
<span class='line'>774</span>      * @name initData
<span class='line'>775</span>      * @namespace
<span class='line'>776</span>      */</span><span class="WHIT">
<span class='line'>777</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">initData</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>778</span> </span><span class="WHIT">        </span><span class="COMM">//check if input is already processed or not</span><span class="WHIT">
<span class='line'>779</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">processed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>780</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">key_list</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"fullseq"</span><span class="PUNC">,</span><span class="STRN">"data"</span><span class="PUNC">,</span><span class="STRN">"count_data"</span><span class="PUNC">,</span><span class="STRN">"resid_properties"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>781</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ikl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ikl</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">key_list.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ikl</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>782</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">e_key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">key_list</span><span class="PUNC">[</span><span class="NAME">ikl</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>783</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">protein_input.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">e_key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>784</span> </span><span class="WHIT">                </span><span class="COMM">// throw "Error: input data is missing required data keys"; </span><span class="WHIT">
<span class='line'>785</span> </span><span class="WHIT">                </span><span class="NAME">console.warn</span><span class="PUNC">(</span><span class="STRN">"input data is missing required data keys... trying to parse raw data"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>786</span>                 </span><span class="NAME">processed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>787</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>788</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>789</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>790</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">processed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>791</span> </span><span class="WHIT">            </span><span class="NAME">parsed_protein_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">processRawUniProt</span><span class="PUNC">(</span><span class="NAME">protein_input</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>792</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>793</span> </span><span class="WHIT">            </span><span class="NAME">parsed_protein_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">protein_input</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>794</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>795</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>796</span> 
<span class='line'>797</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>798</span>      * Function to generate the Membrane Plot.&lt;br>
<span class='line'>799</span>      * @exports NaView
<span class='line'>800</span>      * @name initViz
<span class='line'>801</span>      * @namespace
<span class='line'>802</span>      */</span><span class="WHIT">
<span class='line'>803</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">initViz</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>804</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">parsed_protein_data_drawareas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">define_draw_areas</span><span class="PUNC">(</span><span class="NAME">parsed_protein_data.data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>805</span> </span><span class="WHIT">        </span><span class="NAME">parsed_protein_data.data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parsed_protein_data_drawareas</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>806</span> </span><span class="WHIT">        </span><span class="NAME">parsed_protein_data.membrane</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parsed_protein_data_drawareas</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>807</span> </span><span class="WHIT">        </span><span class="NAME">parsed_protein_data.draw_area</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parsed_protein_data_drawareas</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>808</span> </span><span class="WHIT">        </span><span class="NAME">parsed_protein_data.resid_properties</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">properties</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>809</span> </span><span class="WHIT">        </span><span class="NAME">parsed_protein_data.color_rules</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">color_rules</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>810</span> </span><span class="WHIT">        </span><span class="NAME">parsed_protein_data.draw_symbols</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">text_to_draw</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>811</span> </span><span class="WHIT">        </span><span class="NAME">parsed_protein_data.residue_relations</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">relationships</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>812</span> </span><span class="WHIT">        </span><span class="NAME">drawEverything</span><span class="PUNC">(</span><span class="NAME">parsed_protein_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>813</span> </span><span class="WHIT">        </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"generated plot!"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>814</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>815</span> 
<span class='line'>816</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>817</span>      * Helper function for rounding a number up to a given decimal place
<span class='line'>818</span>      * @param {number} num number to be rounded
<span class='line'>819</span>      * @param {number} after_comma number of decimal places to round to
<span class='line'>820</span>      * @namespace
<span class='line'>821</span>      * @exports NaView
<span class='line'>822</span>      * @name roundDecimals
<span class='line'>823</span>      * @yields {number} rounded number up to given decimal places
<span class='line'>824</span>      */</span><span class="WHIT">
<span class='line'>825</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">roundDecimals</span><span class="PUNC">(</span><span class="NAME">num</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">after_comma</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>826</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ten_basis</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">after_comma</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>827</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">num</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">ten_basis</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Number.EPSILON</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">ten_basis</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>828</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>829</span> 
<span class='line'>830</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>831</span>      * Helper function for generating random integer number between two numbers, including those numbers
<span class='line'>832</span>      * @param {number} min  minimum number to generate integer from
<span class='line'>833</span>      * @param {number} max maximum number to generate integer to
<span class='line'>834</span>      * @namespace
<span class='line'>835</span>      * @exports NaView
<span class='line'>836</span>      * @name getRandomIntInclusive
<span class='line'>837</span>      * @yields {number} integer number between min and max
<span class='line'>838</span>      */</span><span class="WHIT">
<span class='line'>839</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getRandomIntInclusive</span><span class="PUNC">(</span><span class="NAME">min</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">max</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>840</span> </span><span class="WHIT">        </span><span class="NAME">min</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">min</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>841</span> </span><span class="WHIT">        </span><span class="NAME">max</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">max</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>842</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">Math.random</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">max</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">min</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">min</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>843</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>844</span> 
<span class='line'>845</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>846</span>      * Helper function for generating random float number between two numbers, including those numbers
<span class='line'>847</span>      * @param {number} min minimum number to generate float from
<span class='line'>848</span>      * @param {number} max maximum number to generate float to
<span class='line'>849</span>      * @namespace
<span class='line'>850</span>      * @exports NaView
<span class='line'>851</span>      * @name getRandomFloatInclusive
<span class='line'>852</span>      * @yields {number} float number between min and max
<span class='line'>853</span>      */</span><span class="WHIT">
<span class='line'>854</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getRandomFloatInclusive</span><span class="PUNC">(</span><span class="NAME">min</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">max</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>855</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.random</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">max</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">min</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">min</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>856</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>857</span> 
<span class='line'>858</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>859</span>      * Helper function for creating an Array of substrings of length n from a string
<span class='line'>860</span>      * @param {string} str string to generate substrings from
<span class='line'>861</span>      * @param {number} n length of desired substrings
<span class='line'>862</span>      * @namespace
<span class='line'>863</span>      * @exports NaView
<span class='line'>864</span>      * @name stringToChunks
<span class='line'>865</span>      * @yields Array of substrings
<span class='line'>866</span>      */</span><span class="WHIT">
<span class='line'>867</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">stringToChunks</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>868</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>869</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>870</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>871</span> </span><span class="WHIT">    
<span class='line'>872</span>         </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">str.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>873</span> </span><span class="WHIT">           </span><span class="NAME">ret.push</span><span class="PUNC">(</span><span class="NAME">str.substr</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>874</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>875</span> </span><span class="WHIT">    
<span class='line'>876</span>         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT">
<span class='line'>877</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>878</span> 
<span class='line'>879</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>880</span>      * Helper function for creating an Array of substrings of the alternating lengths n and s from a string
<span class='line'>881</span>      * @param {string} str string to generate substrings from
<span class='line'>882</span>      * @param {number} n alternating length 1 of desired substrings
<span class='line'>883</span>      * @param {number} s alternating length 2 of desired substrings
<span class='line'>884</span>      * @namespace
<span class='line'>885</span>      * @exports NaView
<span class='line'>886</span>      * @name stringToChunksSkip
<span class='line'>887</span>      * @see stringToChunks for original function this was based on
<span class='line'>888</span>      * @yields Array of substrings
<span class='line'>889</span>      */</span><span class="WHIT">
<span class='line'>890</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">stringToChunksSkip</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>891</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>892</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>893</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>894</span> </span><span class="WHIT">    
<span class='line'>895</span>         </span><span class="COMM">// for(i = 0, len = str.length; i &lt; len; i += n) {</span><span class="WHIT">
<span class='line'>896</span> </span><span class="WHIT">        </span><span class="COMM">//    ret.push(str.substr(i, n))</span><span class="WHIT">
<span class='line'>897</span> </span><span class="WHIT">        </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>898</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">to_skip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>899</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">done_n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>900</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">temp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>901</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">str.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>902</span> </span><span class="WHIT">            </span><span class="NAME">temp</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>903</span> </span><span class="WHIT">            </span><span class="NAME">done_n</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>904</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">to_skip</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>905</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">done_n</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>906</span> </span><span class="WHIT">                    </span><span class="NAME">ret.push</span><span class="PUNC">(</span><span class="NAME">temp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>907</span> </span><span class="WHIT">                    </span><span class="NAME">temp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>908</span> </span><span class="WHIT">                    </span><span class="NAME">done_n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>909</span> </span><span class="WHIT">                    </span><span class="NAME">to_skip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>910</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>911</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>912</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">done_n</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>913</span> </span><span class="WHIT">                    </span><span class="NAME">ret.push</span><span class="PUNC">(</span><span class="NAME">temp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>914</span> </span><span class="WHIT">                    </span><span class="NAME">temp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>915</span> </span><span class="WHIT">                    </span><span class="NAME">done_n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>916</span> </span><span class="WHIT">                    </span><span class="NAME">to_skip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>917</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>918</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>919</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>920</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">temp.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>921</span> </span><span class="WHIT">            </span><span class="NAME">ret.push</span><span class="PUNC">(</span><span class="NAME">temp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>922</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>923</span> </span><span class="WHIT">    
<span class='line'>924</span>         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT">
<span class='line'>925</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>926</span> 
<span class='line'>927</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>928</span>      * Helper function for generating an Array composed of ascending integers
<span class='line'>929</span>      * @param {number} size number of integers in final Array
<span class='line'>930</span>      * @param {number} startAt starting number to ascend from
<span class='line'>931</span>      * @namespace
<span class='line'>932</span>      * @exports NaView
<span class='line'>933</span>      * @name rangeArray
<span class='line'>934</span>      * @yields Array of ascending numbers
<span class='line'>935</span>      */</span><span class="WHIT">
<span class='line'>936</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">rangeArray</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startAt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>937</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">keys</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">map</span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">startAt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>938</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>939</span> 
<span class='line'>940</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>941</span>      * Helper function for generating a deep copy of an Object
<span class='line'>942</span>      * @param {Object} obj obj to generate deep copy
<span class='line'>943</span>      * @namespace
<span class='line'>944</span>      * @exports NaView
<span class='line'>945</span>      * @name deepCopy
<span class='line'>946</span>      * @yields {Object} deep copy of obj input 
<span class='line'>947</span>      */</span><span class="WHIT">
<span class='line'>948</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>949</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">JSON.parse</span><span class="PUNC">(</span><span class="NAME">JSON.stringify</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>950</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>951</span> 
<span class='line'>952</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>953</span>      * Helper function for returning any color as an Array of [r, g, b, a]
<span class='line'>954</span>      * @param {string} color color string. Must be a valid canvas fillStyle
<span class='line'>955</span>      * @namespace
<span class='line'>956</span>      * @exports NaView
<span class='line'>957</span>      * @name colorToRGBA
<span class='line'>958</span>      * @yields {Array} [r, g, b, a] color Array generated from a ghost canvas
<span class='line'>959</span>      */</span><span class="WHIT">
<span class='line'>960</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">colorToRGBA</span><span class="PUNC">(</span><span class="NAME">color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>961</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cvs</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>962</span> </span><span class="WHIT">        </span><span class="NAME">cvs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'canvas'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>963</span> </span><span class="WHIT">        </span><span class="NAME">cvs.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>964</span> </span><span class="WHIT">        </span><span class="NAME">cvs.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>965</span> </span><span class="WHIT">        </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cvs.getContext</span><span class="PUNC">(</span><span class="STRN">'2d'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>966</span> </span><span class="WHIT">        </span><span class="NAME">ctx.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>967</span> </span><span class="WHIT">        </span><span class="NAME">ctx.fillRect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>968</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ctx.getImageData</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>969</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>970</span> 
<span class='line'>971</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>972</span>      * Helper library to lighten/darken colors
<span class='line'>973</span>      * @namespace
<span class='line'>974</span>      * @exports NaView
<span class='line'>975</span>      * @name pSBC
<span class='line'>976</span>      * @see  {@link https://github.com/PimpTrizkit/PJs/wiki/12.-Shade,-Blend-and-Convert-a-Web-Color-(pSBC.js)} for further information.
<span class='line'>977</span>      */</span><span class="WHIT">
<span class='line'>978</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">pSBC</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="NAME">c0</span><span class="PUNC">,</span><span class="NAME">c1</span><span class="PUNC">,</span><span class="NAME">l</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>979</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">P</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">,</span><span class="NAME">m</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">=</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">c1</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"string"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>980</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="STRN">"number"</span><span class="PUNC">||</span><span class="NAME">p</span><span class="PUNC">&lt;</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">||</span><span class="NAME">p</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">||</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">c0</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="STRN">"string"</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">c0</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="STRN">'r'</span><span class="PUNC">&&</span><span class="NAME">c0</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="STRN">'#'</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">c1</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>981</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.pSBCr</span><span class="PUNC">)</span><span class="NAME">this.pSBCr</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">=</span><span class="PUNC">></span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>982</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">=</span><span class="NAME">d.length</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>983</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">></span><span class="NUMB">9</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>984</span> </span><span class="WHIT">                </span><span class="PUNC">[</span><span class="NAME">r</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">d.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">n</span><span class="PUNC">=</span><span class="NAME">d.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>985</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">&lt;</span><span class="NUMB">3</span><span class="PUNC">||</span><span class="NAME">n</span><span class="PUNC">></span><span class="NUMB">4</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>986</span> </span><span class="WHIT">                </span><span class="NAME">x.r</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">"a"</span><span class="PUNC">?</span><span class="NAME">r.slice</span><span class="PUNC">(</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">r.slice</span><span class="PUNC">(</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">x.g</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">x.b</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">x.a</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">?</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>987</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>988</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">==</span><span class="NUMB">8</span><span class="PUNC">||</span><span class="NAME">n</span><span class="PUNC">==</span><span class="NUMB">6</span><span class="PUNC">||</span><span class="NAME">n</span><span class="PUNC">&lt;</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>989</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">&lt;</span><span class="NUMB">6</span><span class="PUNC">)</span><span class="NAME">d</span><span class="PUNC">=</span><span class="STRN">"#"</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">></span><span class="NUMB">4</span><span class="PUNC">?</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>990</span> </span><span class="WHIT">                </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">(</span><span class="NAME">d.slice</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>991</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">==</span><span class="NUMB">9</span><span class="PUNC">||</span><span class="NAME">n</span><span class="PUNC">==</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="NAME">x.r</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">>></span><span class="NUMB">24</span><span class="PUNC">&</span><span class="NUMB">255</span><span class="PUNC">,</span><span class="NAME">x.g</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">>></span><span class="NUMB">16</span><span class="PUNC">&</span><span class="NUMB">255</span><span class="PUNC">,</span><span class="NAME">x.b</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">>></span><span class="NUMB">8</span><span class="PUNC">&</span><span class="NUMB">255</span><span class="PUNC">,</span><span class="NAME">x.a</span><span class="PUNC">=</span><span class="NAME">m</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">&</span><span class="NUMB">255</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">0.255</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">1000</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>992</span> </span><span class="WHIT">                </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">x.r</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">>></span><span class="NUMB">16</span><span class="PUNC">,</span><span class="NAME">x.g</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">>></span><span class="NUMB">8</span><span class="PUNC">&</span><span class="NUMB">255</span><span class="PUNC">,</span><span class="NAME">x.b</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">&</span><span class="NUMB">255</span><span class="PUNC">,</span><span class="NAME">x.a</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>993</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>994</span> </span><span class="WHIT">        </span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">c0.length</span><span class="PUNC">></span><span class="NUMB">9</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">?</span><span class="NAME">c1.length</span><span class="PUNC">></span><span class="NUMB">9</span><span class="PUNC">?</span><span class="KEYW">true</span><span class="PUNC">:</span><span class="NAME">c1</span><span class="PUNC">==</span><span class="STRN">"c"</span><span class="PUNC">?</span><span class="PUNC">!</span><span class="NAME">h</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">:</span><span class="NAME">h</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">this.pSBCr</span><span class="PUNC">(</span><span class="NAME">c0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">P</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">=</span><span class="NAME">c1</span><span class="PUNC">&&</span><span class="NAME">c1</span><span class="PUNC">!=</span><span class="STRN">"c"</span><span class="PUNC">?</span><span class="NAME">this.pSBCr</span><span class="PUNC">(</span><span class="NAME">c1</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">P</span><span class="PUNC">?</span><span class="PUNC">{</span><span class="NAME">r</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">r</span><span class="PUNC">:</span><span class="NUMB">255</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">:</span><span class="NUMB">255</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">:</span><span class="NUMB">255</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">=</span><span class="NAME">P</span><span class="PUNC">?</span><span class="NAME">p</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">p</span><span class="PUNC">,</span><span class="NAME">P</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">p</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>995</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">f</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">t</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>996</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">)</span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">m</span><span class="PUNC">(</span><span class="NAME">P</span><span class="PUNC">*</span><span class="NAME">f.r</span><span class="PUNC">+</span><span class="NAME">p</span><span class="PUNC">*</span><span class="NAME">t.r</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">m</span><span class="PUNC">(</span><span class="NAME">P</span><span class="PUNC">*</span><span class="NAME">f.g</span><span class="PUNC">+</span><span class="NAME">p</span><span class="PUNC">*</span><span class="NAME">t.g</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">m</span><span class="PUNC">(</span><span class="NAME">P</span><span class="PUNC">*</span><span class="NAME">f.b</span><span class="PUNC">+</span><span class="NAME">p</span><span class="PUNC">*</span><span class="NAME">t.b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>997</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">m</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">P</span><span class="PUNC">*</span><span class="NAME">f.r</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">+</span><span class="NAME">p</span><span class="PUNC">*</span><span class="NAME">t.r</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="NUMB">0.5</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">m</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">P</span><span class="PUNC">*</span><span class="NAME">f.g</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">+</span><span class="NAME">p</span><span class="PUNC">*</span><span class="NAME">t.g</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="NUMB">0.5</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">m</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">P</span><span class="PUNC">*</span><span class="NAME">f.b</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">+</span><span class="NAME">p</span><span class="PUNC">*</span><span class="NAME">t.b</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="NUMB">0.5</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>998</span> </span><span class="WHIT">        </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">f.a</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">=</span><span class="NAME">t.a</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">||</span><span class="NAME">t</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">?</span><span class="NAME">a</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">?</span><span class="NAME">t</span><span class="PUNC">:</span><span class="NAME">t</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">?</span><span class="NAME">a</span><span class="PUNC">:</span><span class="NAME">a</span><span class="PUNC">*</span><span class="NAME">P</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">*</span><span class="NAME">p</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>999</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="STRN">"rgb"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">?</span><span class="STRN">"a("</span><span class="PUNC">:</span><span class="STRN">"("</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">r</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">g</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">?</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">m</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">*</span><span class="NUMB">1000</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">1000</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1000</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="STRN">"#"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NUMB">4294967296</span><span class="PUNC">+</span><span class="NAME">r</span><span class="PUNC">*</span><span class="NUMB">16777216</span><span class="PUNC">+</span><span class="NAME">g</span><span class="PUNC">*</span><span class="NUMB">65536</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">*</span><span class="NUMB">256</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">?</span><span class="NAME">m</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">*</span><span class="NUMB">255</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">?</span><span class="NAME">undefined</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1001</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1002</span> 
<span class='line'>1003</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1004</span>      * Helper function for returning unique elements when passed to the Array.prototype.filter() method.
<span class='line'>1005</span>      * @param {number} value value of current Array Object
<span class='line'>1006</span>      * @param {number} index index of current Array Object
<span class='line'>1007</span>      * @param {Array} self any possible Array
<span class='line'>1008</span>      * @namespace
<span class='line'>1009</span>      * @exports NaView
<span class='line'>1010</span>      * @name onlyUnique
<span class='line'>1011</span>      * @example [1,2,2,3,3,4].filter(onlyUnique) returns [1,2,3,4]
<span class='line'>1012</span>      * @yields {Boolean} true when an Object is in Array, false when not
<span class='line'>1013</span>      */</span><span class="WHIT">
<span class='line'>1014</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">onlyUnique</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1015</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self.indexOf</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1016</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1017</span> 
<span class='line'>1018</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1019</span>      * Parses a UniProt formatted text string
<span class='line'>1020</span>      * to the required data format for plotting a NaV channel.&lt;br>&lt;br>
<span class='line'>1021</span>      * Required line types include:&lt;br>
<span class='line'>1022</span>      * 1. The FT (Feature Table) lines for:&lt;br>
<span class='line'>1023</span>      *      a) TOPO_DOM - Topological domain&lt;br>
<span class='line'>1024</span>      *      b) TRANSMEM - Extent of a transmembrane region&lt;br>
<span class='line'>1025</span>      *      c) INTRAMEM - Extent of a region located in a membrane without crossing it&lt;br>
<span class='line'>1026</span>      *      d) CHAIN - Extent of a polypeptide chain in the mature protein.&lt;br>
<span class='line'>1027</span>      *      e) REPEAT - Extent of an internal sequence repetition.&lt;br>
<span class='line'>1028</span>      * 2. The SQ (SeQuence header) lines
<span class='line'>1029</span>      * @param {string} test_raw_protein UniProt text formatted object with needed FT and SQ lines
<span class='line'>1030</span>      * @namespace
<span class='line'>1031</span>      * @exports NaView
<span class='line'>1032</span>      * @name processRawUniProt
<span class='line'>1033</span>      * @yields {Object} Object containing:&lt;br>
<span class='line'>1034</span>      * 1.fullseq: full protein sequence&lt;br>
<span class='line'>1035</span>      * 2.data: generated data Array containing information of each to be drawn protein element&lt;br>
<span class='line'>1036</span>      * 3.count_data: counts per each element type and domain in protein&lt;br>
<span class='line'>1037</span>      * 4.resid_properties: Object with an index for each residue in protein (1,2,3,4... corresponding to each amino acid)
<span class='line'>1038</span>      * @see {@link https://www.uniprot.org/docs/userman.htm} for information on the UniProt text format
<span class='line'>1039</span>      */</span><span class="WHIT">
<span class='line'>1040</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">processRawUniProt</span><span class="PUNC">(</span><span class="NAME">test_raw_protein</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1041</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">test_raw_protein_lines</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">test_raw_protein.split</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1042</span> </span><span class="WHIT">        
<span class='line'>1043</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">start_chain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1044</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">end_chain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1045</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">start_chain_aa</span><span class="PUNC">,</span><span class="NAME">end_chain_aa</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1046</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">prev_test_raw_protein_line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1047</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">doms_to_resnums</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1048</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">line_of_interest_queries</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1049</span> </span><span class="WHIT">            </span><span class="STRN">"FT   TOPO_DOM"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"loop"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1050</span> </span><span class="WHIT">            </span><span class="STRN">"FT   INTRAMEM"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"pore"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1051</span> </span><span class="WHIT">            </span><span class="STRN">"FT   TRANSMEM"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"helix"</span><span class="WHIT">
<span class='line'>1052</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1053</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lines_of_interest</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1054</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_counts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1055</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_type_counts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1056</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">irpl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">irpl</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">test_raw_protein_lines.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">irpl</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1057</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">test_raw_protein_line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">test_raw_protein_lines</span><span class="PUNC">[</span><span class="NAME">irpl</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1058</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">test_raw_protein_line.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">13</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1059</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">header_str</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">test_raw_protein_line.substr</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">13</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1060</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">start_chain</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">end_chain</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1061</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">header_str</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"FT   CHAIN   "</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1062</span> </span><span class="WHIT">                        </span><span class="NAME">start_chain_aa</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">test_raw_protein_line.split</span><span class="PUNC">(</span><span class="STRN">"FT   CHAIN   "</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">".."</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\s+/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1063</span> </span><span class="WHIT">                        </span><span class="NAME">end_chain_aa</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">test_raw_protein_line.split</span><span class="PUNC">(</span><span class="STRN">"FT   CHAIN   "</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">".."</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1064</span> </span><span class="WHIT">                        </span><span class="NAME">start_chain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1065</span> </span><span class="WHIT">                        </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1066</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1067</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">start_chain</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">end_chain</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1068</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Object.keys</span><span class="PUNC">(</span><span class="NAME">line_of_interest_queries</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="NAME">header_str</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1069</span> </span><span class="WHIT">                        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">array_lines</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">header_str</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">test_raw_protein_line</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1070</span> </span><span class="WHIT">                        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">note_line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">test_raw_protein_lines</span><span class="PUNC">[</span><span class="NAME">irpl</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1071</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">note_line.includes</span><span class="PUNC">(</span><span class="STRN">"/note="</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1072</span> </span><span class="WHIT">                            </span><span class="NAME">array_lines.push</span><span class="PUNC">(</span><span class="NAME">note_line</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1073</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1074</span> </span><span class="WHIT">                        </span><span class="NAME">lines_of_interest.push</span><span class="PUNC">(</span><span class="NAME">array_lines</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1075</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1076</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">prev_test_raw_protein_line.includes</span><span class="PUNC">(</span><span class="STRN">".."</span><span class="PUNC">+</span><span class="NAME">end_chain_aa</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1077</span> </span><span class="WHIT">                        </span><span class="NAME">end_chain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1078</span> </span><span class="WHIT">                        </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1079</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1080</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1081</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">header_str</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"FT   REPEAT  "</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1082</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">note_line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">test_raw_protein_lines</span><span class="PUNC">[</span><span class="NAME">irpl</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1083</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">note_line.split</span><span class="PUNC">(</span><span class="STRN">'/note="'</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\"/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1084</span> 
<span class='line'>1085</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_start_aa</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">test_raw_protein_line.split</span><span class="PUNC">(</span><span class="STRN">"FT   REPEAT  "</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">".."</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\s+/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1086</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_end_aa</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">test_raw_protein_line.split</span><span class="PUNC">(</span><span class="STRN">"FT   REPEAT  "</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">".."</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1087</span> 
<span class='line'>1088</span> </span><span class="WHIT">                    </span><span class="NAME">doms_to_resnums</span><span class="PUNC">[</span><span class="NAME">dom_name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">dom_start_aa</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dom_end_aa</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1089</span> </span><span class="WHIT">                    </span><span class="NAME">dom_counts</span><span class="PUNC">[</span><span class="NAME">dom_name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1090</span> </span><span class="WHIT">                    </span><span class="NAME">dom_type_counts</span><span class="PUNC">[</span><span class="NAME">dom_name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1091</span> </span><span class="WHIT">                    </span><span class="NAME">dom_type_counts</span><span class="PUNC">[</span><span class="NAME">dom_name</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"loop"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1092</span> </span><span class="WHIT">                    </span><span class="NAME">dom_type_counts</span><span class="PUNC">[</span><span class="NAME">dom_name</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"helix"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1093</span> </span><span class="WHIT">                    </span><span class="NAME">dom_type_counts</span><span class="PUNC">[</span><span class="NAME">dom_name</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"pore"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1094</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1095</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">header_str</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"SQ   SEQUENCE"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1096</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aa_num</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">test_raw_protein_line.split</span><span class="PUNC">(</span><span class="STRN">"SQ   SEQUENCE"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">" AA;"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\s+/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1097</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">aa_num</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">end_chain_aa</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1098</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1099</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1100</span> </span><span class="WHIT">                    </span><span class="NAME">sequence</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1101</span> </span><span class="WHIT">                    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">irpl1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">irpl</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">irpl1</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">test_raw_protein_lines.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">irpl1</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1102</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">test_raw_protein_lines</span><span class="PUNC">[</span><span class="NAME">irpl1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">includes</span><span class="PUNC">(</span><span class="STRN">"//"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1103</span> </span><span class="WHIT">                            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aminoacids_in_line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">test_raw_protein_lines</span><span class="PUNC">[</span><span class="NAME">irpl1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\s+/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1104</span> </span><span class="WHIT">                            </span><span class="NAME">sequence</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sequence</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">aminoacids_in_line</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1105</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1106</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1107</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1108</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1109</span> </span><span class="WHIT">            </span><span class="NAME">prev_test_raw_protein_line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">test_raw_protein_line</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1110</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1111</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">parsed_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1112</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">previous_domain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1113</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">type_aacounts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1114</span> </span><span class="WHIT">            </span><span class="STRN">"loop"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1115</span> </span><span class="WHIT">            </span><span class="STRN">"helix"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1116</span> </span><span class="WHIT">            </span><span class="STRN">"pore"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1117</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1118</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">border_count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1119</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">type_full_counts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1120</span> </span><span class="WHIT">            </span><span class="STRN">"loop"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1121</span> </span><span class="WHIT">            </span><span class="STRN">"helix"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1122</span> </span><span class="WHIT">            </span><span class="STRN">"pore"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1123</span> </span><span class="WHIT">            </span><span class="STRN">"internal_loop"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>1124</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1125</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aacounts_per_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1126</span> </span><span class="WHIT">            </span><span class="STRN">"loop"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1127</span> </span><span class="WHIT">            </span><span class="STRN">"helix"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1128</span> </span><span class="WHIT">            </span><span class="STRN">"pore"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1129</span> </span><span class="WHIT">            </span><span class="STRN">"internal_loop"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>1130</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1131</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ilip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ilip</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">lines_of_interest.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ilip</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1132</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">array_lines</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lines_of_interest</span><span class="PUNC">[</span><span class="NAME">ilip</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1133</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">resid_start_aa</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">array_lines</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="NAME">array_lines</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">".."</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\s+/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1134</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">resid_end_aa</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">array_lines</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="NAME">array_lines</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">".."</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1135</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">line_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line_of_interest_queries</span><span class="PUNC">[</span><span class="NAME">array_lines</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1136</span> 
<span class='line'>1137</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aa_count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">resid_end_aa</span><span class="PUNC">-</span><span class="NAME">resid_start_aa</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1138</span> </span><span class="WHIT">            </span><span class="NAME">type_aacounts</span><span class="PUNC">[</span><span class="NAME">line_type</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aa_count</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1139</span> </span><span class="WHIT">            </span><span class="NAME">type_full_counts</span><span class="PUNC">[</span><span class="NAME">line_type</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1140</span> </span><span class="WHIT">            </span><span class="NAME">aacounts_per_type</span><span class="PUNC">[</span><span class="NAME">line_type</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">aa_count</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1141</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ilip</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ilip</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">lines_of_interest.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1142</span> </span><span class="WHIT">                </span><span class="NAME">border_count</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aa_count</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1143</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">line_type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"loop"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1144</span> </span><span class="WHIT">                </span><span class="NAME">type_full_counts</span><span class="PUNC">[</span><span class="STRN">"internal_loop"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1145</span> </span><span class="WHIT">                </span><span class="NAME">aacounts_per_type</span><span class="PUNC">[</span><span class="STRN">"internal_loop"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">aa_count</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1146</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1147</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1148</span> </span><span class="WHIT">        </span><span class="NAME">end_chain_aa_alldomains</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">end_chain_aa</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">border_count</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1149</span> 
<span class='line'>1150</span> </span><span class="WHIT">        </span><span class="NAME">type_aacounts</span><span class="PUNC">[</span><span class="STRN">"internal_helix"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">type_aacounts</span><span class="PUNC">[</span><span class="STRN">"helix"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">// - border_count;</span><span class="WHIT">
<span class='line'>1151</span> </span><span class="WHIT">        </span><span class="NAME">type_aacounts</span><span class="PUNC">[</span><span class="STRN">"internal_loop"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">type_aacounts</span><span class="PUNC">[</span><span class="STRN">"loop"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">border_count</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1152</span> </span><span class="WHIT">        </span><span class="NAME">type_aacounts</span><span class="PUNC">[</span><span class="STRN">"internal_pore"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">type_aacounts</span><span class="PUNC">[</span><span class="STRN">"pore"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="COMM">// - border_count;</span><span class="WHIT">
<span class='line'>1153</span> 
<span class='line'>1154</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">type_index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1155</span> </span><span class="WHIT">            </span><span class="STRN">"loop"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1156</span> </span><span class="WHIT">            </span><span class="STRN">"helix"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1157</span> </span><span class="WHIT">            </span><span class="STRN">"pore"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1158</span> </span><span class="WHIT">            </span><span class="STRN">"internal_loop"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>1159</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1160</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">next_domain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1161</span> </span><span class="WHIT">            </span><span class="STRN">"I"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"II"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1162</span> </span><span class="WHIT">            </span><span class="STRN">"II"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"III"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1163</span> </span><span class="WHIT">            </span><span class="STRN">"III"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"IV"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1164</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1165</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">count_inter_domain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1166</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ili</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ili</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">lines_of_interest.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ili</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1167</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">array_lines</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lines_of_interest</span><span class="PUNC">[</span><span class="NAME">ili</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1168</span> </span><span class="WHIT">            
<span class='line'>1169</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">line_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line_of_interest_queries</span><span class="PUNC">[</span><span class="NAME">array_lines</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1170</span> </span><span class="WHIT">            </span><span class="NAME">type_index</span><span class="PUNC">[</span><span class="NAME">line_type</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1171</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ili</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ili</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">lines_of_interest.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">line_type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"loop"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1172</span> </span><span class="WHIT">                </span><span class="NAME">type_index</span><span class="PUNC">[</span><span class="STRN">"internal_loop"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1173</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1174</span> 
<span class='line'>1175</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">noteworthy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">array_lines</span><span class="PUNC">[</span><span class="STRN">"2"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">'/note="'</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">'"'</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1176</span> 
<span class='line'>1177</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">resid_start_aa</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">array_lines</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="NAME">array_lines</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">".."</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\s+/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1178</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">resid_end_aa</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">array_lines</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="NAME">array_lines</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">".."</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1179</span> 
<span class='line'>1180</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aminoacids_of_interest</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sequence.split</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="NAME">resid_start_aa</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">resid_end_aa</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1181</span> 
<span class='line'>1182</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">current_dom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1183</span> 
<span class='line'>1184</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">dom_name</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">doms_to_resnums</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1185</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">doms_to_resnums.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">dom_name</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1186</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_bounds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">doms_to_resnums</span><span class="PUNC">[</span><span class="NAME">dom_name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1187</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">resid_start_aa</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">dom_bounds</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">resid_start_aa</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">dom_bounds</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">resid_end_aa</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">dom_bounds</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">resid_end_aa</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">dom_bounds</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1188</span> </span><span class="WHIT">                        </span><span class="NAME">current_dom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dom_name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1189</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1190</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1191</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1192</span> 
<span class='line'>1193</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">current_dom</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1194</span> </span><span class="WHIT">                </span><span class="NAME">dom_counts</span><span class="PUNC">[</span><span class="NAME">current_dom</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1195</span> </span><span class="WHIT">                </span><span class="NAME">dom_type_counts</span><span class="PUNC">[</span><span class="NAME">current_dom</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">line_type</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1196</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1197</span> 
<span class='line'>1198</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">export_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1199</span> </span><span class="WHIT">                </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">line_type</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1200</span> </span><span class="WHIT">                </span><span class="STRN">"start"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">resid_start_aa</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1201</span> </span><span class="WHIT">                </span><span class="STRN">"end"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">resid_end_aa</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1202</span> </span><span class="WHIT">                </span><span class="STRN">"aanum"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">resid_end_aa</span><span class="PUNC">-</span><span class="NAME">resid_start_aa</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1203</span> </span><span class="WHIT">                </span><span class="COMM">//frequencies by various parsing modes</span><span class="WHIT">
<span class='line'>1204</span> </span><span class="WHIT">                </span><span class="STRN">"aaperc_full"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">resid_end_aa</span><span class="PUNC">-</span><span class="NAME">resid_start_aa</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">end_chain_aa</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1205</span> </span><span class="WHIT">                </span><span class="STRN">"aaperc_bytype_full"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">resid_end_aa</span><span class="PUNC">-</span><span class="NAME">resid_start_aa</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">type_aacounts</span><span class="PUNC">[</span><span class="NAME">line_type</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1206</span> </span><span class="WHIT">                </span><span class="STRN">"aas"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">aminoacids_of_interest.join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1207</span> </span><span class="WHIT">                </span><span class="STRN">"type_i_full"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">type_index</span><span class="PUNC">[</span><span class="NAME">line_type</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1208</span> </span><span class="WHIT">                </span><span class="STRN">"id"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ili</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1209</span> </span><span class="WHIT">                </span><span class="STRN">"prev_dom_name"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">previous_domain</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1210</span> </span><span class="WHIT">                </span><span class="STRN">"next_dom_name"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">next_domain</span><span class="PUNC">[</span><span class="NAME">previous_domain</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1211</span> </span><span class="WHIT">                </span><span class="STRN">"note"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">noteworthy</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1212</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1213</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">current_dom</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1214</span> </span><span class="WHIT">                </span><span class="NAME">export_obj</span><span class="PUNC">[</span><span class="STRN">"dom_name"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current_dom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1215</span> </span><span class="WHIT">                </span><span class="NAME">export_obj</span><span class="PUNC">[</span><span class="STRN">"dom_i"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dom_counts</span><span class="PUNC">[</span><span class="NAME">current_dom</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1216</span> </span><span class="WHIT">                </span><span class="NAME">export_obj</span><span class="PUNC">[</span><span class="STRN">"dom_itype"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dom_type_counts</span><span class="PUNC">[</span><span class="NAME">current_dom</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">line_type</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1217</span> </span><span class="WHIT">                </span><span class="COMM">// export_obj["type_i_domains"]: type_index["internal_loop"],</span><span class="WHIT">
<span class='line'>1218</span> </span><span class="WHIT">                </span><span class="NAME">export_obj</span><span class="PUNC">[</span><span class="STRN">"aaperc_alldomains"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">resid_end_aa</span><span class="PUNC">-</span><span class="NAME">resid_start_aa</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">end_chain_aa_alldomains</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1219</span> </span><span class="WHIT">                </span><span class="NAME">export_obj</span><span class="PUNC">[</span><span class="STRN">"aaperc_bytype_alldomains"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">resid_end_aa</span><span class="PUNC">-</span><span class="NAME">resid_start_aa</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">type_aacounts</span><span class="PUNC">[</span><span class="STRN">"internal_"</span><span class="PUNC">+</span><span class="NAME">line_type</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1220</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1221</span> </span><span class="WHIT">                </span><span class="NAME">export_obj</span><span class="PUNC">[</span><span class="STRN">"dom_name"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1222</span> </span><span class="WHIT">                </span><span class="NAME">export_obj</span><span class="PUNC">[</span><span class="STRN">"dom_i"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1223</span> </span><span class="WHIT">                </span><span class="NAME">export_obj</span><span class="PUNC">[</span><span class="STRN">"dom_itype"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1224</span> </span><span class="WHIT">                </span><span class="NAME">export_obj</span><span class="PUNC">[</span><span class="STRN">"dom_iname"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">count_inter_domain</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1225</span> </span><span class="WHIT">                </span><span class="NAME">count_inter_domain</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1226</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1227</span> </span><span class="WHIT">            </span><span class="NAME">parsed_data.push</span><span class="PUNC">(</span><span class="NAME">export_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1228</span> 
<span class='line'>1229</span> </span><span class="WHIT">            </span><span class="NAME">previous_domain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current_dom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1230</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1231</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">count_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1232</span> </span><span class="WHIT">            </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">type_full_counts</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1233</span> </span><span class="WHIT">            </span><span class="STRN">"aacounts_per_type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">aacounts_per_type</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1234</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1235</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sequence_properties</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1236</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">is</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">is</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sequence.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">is</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1237</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sequence_properties.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">is</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1238</span> </span><span class="WHIT">                </span><span class="NAME">sequence_properties</span><span class="PUNC">[</span><span class="NAME">is</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1239</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1240</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1241</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="STRN">"fullseq"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sequence</span><span class="PUNC">,</span><span class="STRN">"data"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">parsed_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"count_data"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">count_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"resid_properties"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sequence_properties</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1242</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1243</span> 
<span class='line'>1244</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1245</span>      * Calculates draw areas for each element to be drawn on plot
<span class='line'>1246</span>      * @param {Array} array_data data generated from processRawUniProt
<span class='line'>1247</span>      * @namespace
<span class='line'>1248</span>      * @exports NaView
<span class='line'>1249</span>      * @name define_draw_areas
<span class='line'>1250</span>      * @namespace
<span class='line'>1251</span>      * @yields {Array} Array of three draw areas: protein data from processRawUniProt alongside draw areas, draw area for membrane, SVG draw area with borders and membrane main coords
<span class='line'>1252</span>      */</span><span class="WHIT">
<span class='line'>1253</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">define_draw_areas</span><span class="PUNC">(</span><span class="NAME">array_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1254</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valorInicial</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1255</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">perc_total</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">array_data.reduce</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">acumulador</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">valorAtual</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">array</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1256</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">acumulador</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">valorAtual.aaperc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1257</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">valorInicial</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1258</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">svg_drawing_area</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createDrawingArea</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1259</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">parsed_lines_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawDataParsing</span><span class="PUNC">(</span><span class="NAME">array_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1260</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_idom_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calcDomIDomWidths</span><span class="PUNC">(</span><span class="NAME">svg_drawing_area</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parsed_lines_data</span><span class="PUNC">[</span><span class="STRN">"domain_names"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parsed_lines_data</span><span class="PUNC">[</span><span class="STRN">"helices_and_pores_by_domain"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// to_print</span><span class="WHIT">
<span class='line'>1261</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">longLoopWidthF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">distributeLongLoopsWidth</span><span class="PUNC">(</span><span class="NAME">dom_idom_data</span><span class="PUNC">[</span><span class="STRN">"inter_domain_width"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parsed_lines_data</span><span class="PUNC">[</span><span class="STRN">"long_loops"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1262</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">indexed_drawareas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calcElementsDrawAreas</span><span class="PUNC">(</span><span class="NAME">array_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">svg_drawing_area</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parsed_lines_data</span><span class="PUNC">[</span><span class="STRN">"domain_names"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parsed_lines_data</span><span class="PUNC">[</span><span class="STRN">"helices_and_pores_by_domain"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">parsed_lines_data</span><span class="PUNC">[</span><span class="STRN">"internal_short_loops_by_domain"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">parsed_lines_data</span><span class="PUNC">[</span><span class="STRN">"long_loops_by_prevdomain"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">longLoopWidthF</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dom_idom_data</span><span class="PUNC">[</span><span class="STRN">"total_domain_width"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">dom_idom_data</span><span class="PUNC">[</span><span class="STRN">"inter_domain_width"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1263</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">array_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1264</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">nid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">array_data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1265</span> </span><span class="WHIT">            </span><span class="NAME">array_data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">indexed_drawareas.protein</span><span class="PUNC">[</span><span class="NAME">nid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1266</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1267</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">array_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">indexed_drawareas.membrane</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">svg_drawing_area</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1268</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1269</span> 
<span class='line'>1270</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1271</span>      * Calculates main plot draw areas for borders and membrane site
<span class='line'>1272</span>      * @exports NaView
<span class='line'>1273</span>      * @name createDrawingArea
<span class='line'>1274</span>      * @namespace
<span class='line'>1275</span>      * @yields {Object} SVG draw area with borders and membrane main coords
<span class='line'>1276</span>      */</span><span class="WHIT">
<span class='line'>1277</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">createDrawingArea</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1278</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">da_stx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"canvas"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"border"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1279</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">da_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">da_stx</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"canvas"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"border"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1280</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">da_etx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">da_stx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">da_width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1281</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">da_sty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"canvas"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"border"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"top"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1282</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">da_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">da_sty</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">svg_height</span><span class="PUNC">*</span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"canvas"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"border"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"bottom"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1283</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">da_ety</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">da_sty</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">da_height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1284</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">da_ms</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">da_height</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">svg_height</span><span class="PUNC">*</span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"membrane"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"membrane_region_height"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1285</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">da_me</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">da_height</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">svg_height</span><span class="PUNC">*</span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"membrane"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"membrane_region_height"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1286</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">da_mh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="PUNC">*</span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"membrane"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"membrane_region_height"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1287</span> </span><span class="WHIT">        </span><span class="NAME">svg_drawarea</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1288</span> </span><span class="WHIT">            </span><span class="STRN">"start_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">da_stx</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1289</span> </span><span class="WHIT">            </span><span class="STRN">"end_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">da_etx</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1290</span> </span><span class="WHIT">            </span><span class="STRN">"width"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">da_width</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1291</span> </span><span class="WHIT">            </span><span class="STRN">"start_y"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">da_sty</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1292</span> </span><span class="WHIT">            </span><span class="STRN">"end_y"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">da_ety</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1293</span> </span><span class="WHIT">            </span><span class="STRN">"height"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">da_height</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1294</span> </span><span class="WHIT">            </span><span class="STRN">"membrane_start"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">da_ms</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1295</span> </span><span class="WHIT">            </span><span class="STRN">"membrane_height"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">da_mh</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1296</span> </span><span class="WHIT">            </span><span class="STRN">"membrane_end"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">da_me</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1297</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1298</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">svg_drawarea</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1299</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1300</span> 
<span class='line'>1301</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1302</span>      * Separates parsed protein data array into sub groups according to protein element types (helix, pore, internal and external loops)
<span class='line'>1303</span>      * @param {Array} array_data data generated from processRawUniProt
<span class='line'>1304</span>      * @exports NaView
<span class='line'>1305</span>      * @name drawDataParsing
<span class='line'>1306</span>      * @namespace
<span class='line'>1307</span>      * @yields {Object} JSON containing array_data separated by protein element type (helix, pore, internal and external loops)
<span class='line'>1308</span>      */</span><span class="WHIT">
<span class='line'>1309</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">drawDataParsing</span><span class="PUNC">(</span><span class="NAME">array_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1310</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helices_and_pores</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">array_data.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1311</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"helix"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"pore"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1312</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1313</span> </span><span class="WHIT">    
<span class='line'>1314</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helices_and_pores_by_domain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helices_and_pores.reduce</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">reduce_dict</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1315</span> </span><span class="WHIT">            </span><span class="NAME">reduce_dict</span><span class="PUNC">[</span><span class="NAME">a.dom_name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">reduce_dict</span><span class="PUNC">[</span><span class="NAME">a.dom_name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1316</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">reduce_dict</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1317</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1318</span> </span><span class="WHIT">    
<span class='line'>1319</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">internal_short_loops</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">array_data.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1320</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"loop"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a.dom_name</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1321</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1322</span> </span><span class="WHIT">    
<span class='line'>1323</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">internal_short_loops_by_domain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">internal_short_loops.reduce</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">reduce_dict</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1324</span> </span><span class="WHIT">            </span><span class="NAME">reduce_dict</span><span class="PUNC">[</span><span class="NAME">a.dom_name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">reduce_dict</span><span class="PUNC">[</span><span class="NAME">a.dom_name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1325</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">reduce_dict</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1326</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1327</span> </span><span class="WHIT">        
<span class='line'>1328</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">long_loops</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">array_data.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1329</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"loop"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a.prev_dom_name</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a.dom_name</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a.next_dom_name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1330</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1331</span> </span><span class="WHIT">    
<span class='line'>1332</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">long_loops_by_prevdomain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">long_loops.reduce</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">reduce_dict</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1333</span> </span><span class="WHIT">            </span><span class="COMM">// reduce_dict[a.prev_dom_name] = [...reduce_dict[a.prev_dom_name] || [], a];</span><span class="WHIT">
<span class='line'>1334</span> </span><span class="WHIT">            </span><span class="NAME">reduce_dict</span><span class="PUNC">[</span><span class="NAME">a.prev_dom_name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1335</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">reduce_dict</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1336</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1337</span> </span><span class="WHIT">    
<span class='line'>1338</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">domain_names</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Object.keys</span><span class="PUNC">(</span><span class="NAME">helices_and_pores_by_domain</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1339</span> </span><span class="WHIT">        
<span class='line'>1340</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">result_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1341</span> </span><span class="WHIT">            </span><span class="STRN">"helices_and_pores"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">helices_and_pores</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1342</span> </span><span class="WHIT">            </span><span class="STRN">"helices_and_pores_by_domain"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">helices_and_pores_by_domain</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1343</span> </span><span class="WHIT">            </span><span class="STRN">"internal_short_loops"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">internal_short_loops</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1344</span> </span><span class="WHIT">            </span><span class="STRN">"internal_short_loops_by_domain"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">internal_short_loops_by_domain</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1345</span> </span><span class="WHIT">            </span><span class="STRN">"long_loops"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">long_loops</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1346</span> </span><span class="WHIT">            </span><span class="STRN">"long_loops_by_prevdomain"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">long_loops_by_prevdomain</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1347</span> </span><span class="WHIT">            </span><span class="STRN">"domain_names"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">domain_names</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1348</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1349</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1350</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1351</span> 
<span class='line'>1352</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1353</span>      * Calculates each domain width from style_obj, determines full interdomain width
<span class='line'>1354</span>      * @param {Object} svg_drawing_area SVG draw area with borders and membrane main coords
<span class='line'>1355</span>      * @param {Array} domain_names list of domain names
<span class='line'>1356</span>      * @param {Array} helices_and_pores_by_domain Array of Objects from processRawUniProt for helices and pores of each domain
<span class='line'>1357</span>      * @exports NaView
<span class='line'>1358</span>      * @name calcDomIDomWidths
<span class='line'>1359</span>      * @namespace
<span class='line'>1360</span>      * @yields {Object} JSON for total domain width, interdomain width and dictionary for each domain's width
<span class='line'>1361</span>      */</span><span class="WHIT">
<span class='line'>1362</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">calcDomIDomWidths</span><span class="PUNC">(</span><span class="NAME">svg_drawing_area</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">domain_names</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">helices_and_pores_by_domain</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1363</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">total_domain_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1364</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">domain_to_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1365</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">idn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idn</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">domain_names.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idn</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1366</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">domain_name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">domain_names</span><span class="PUNC">[</span><span class="NAME">idn</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1367</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">domain_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1368</span> </span><span class="WHIT">            </span><span class="COMM">// let domain_spacing_width = (helices_and_pores_by_domain[domain_name].length-1)* style_obj["protein"]["helix_spacing_width"];</span><span class="WHIT">
<span class='line'>1369</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">domain_spacing_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"helix_spacing_width"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">domain_name</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">reduce</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1370</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1371</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1372</span> </span><span class="WHIT">            </span><span class="NAME">domain_width</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">domain_spacing_width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1373</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">total_perc_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"helix_region_width"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">domain_name</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">reduce</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1374</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1375</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1376</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">domain_helices_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">total_perc_width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1377</span> </span><span class="WHIT">            </span><span class="NAME">domain_width</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">domain_helices_width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1378</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">domain_pore_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"pore_region_width"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">domain_name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1379</span> </span><span class="WHIT">            </span><span class="NAME">domain_width</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">domain_pore_width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1380</span> </span><span class="WHIT">            </span><span class="NAME">domain_to_width</span><span class="PUNC">[</span><span class="NAME">domain_name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">domain_width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1381</span> </span><span class="WHIT">            </span><span class="NAME">total_domain_width</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">domain_width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1382</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1383</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">n_ter_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"nter_loop_width"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1384</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">c_ter_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"cter_loop_width"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1385</span> </span><span class="WHIT">    
<span class='line'>1386</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">inter_domain_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_drawing_area</span><span class="PUNC">[</span><span class="STRN">"width"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">total_domain_width</span><span class="PUNC">+</span><span class="NAME">n_ter_width</span><span class="PUNC">+</span><span class="NAME">c_ter_width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1387</span> </span><span class="WHIT">    
<span class='line'>1388</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">return_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1389</span> </span><span class="WHIT">            </span><span class="STRN">"total_domain_width"</span><span class="PUNC">:</span><span class="NAME">total_domain_width</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1390</span> </span><span class="WHIT">            </span><span class="STRN">"inter_domain_width"</span><span class="PUNC">:</span><span class="NAME">inter_domain_width</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1391</span> </span><span class="WHIT">            </span><span class="STRN">"domain_to_width"</span><span class="PUNC">:</span><span class="NAME">domain_to_width</span><span class="WHIT">
<span class='line'>1392</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1393</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">return_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1394</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1395</span> 
<span class='line'>1396</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1397</span>      * Creates scale functions for calculating the interdomain loops widths.&lt;br>
<span class='line'>1398</span>      * Three setups are possible as defined in the style_obj:&lt;br>
<span class='line'>1399</span>      * 1. Custom: user defined inside the style_obj &lt;br>
<span class='line'>1400</span>      * 2. Scaled: according to amino acid number of each loop&lt;br>
<span class='line'>1401</span>      * 3. Fixed: equally divided between the different loops &lt;br>
<span class='line'>1402</span>      * @param {number} total_width the total interdomain width to be distributed
<span class='line'>1403</span>      * @param {Array} long_loops_array Array containing the interdomain loop objects from processRawUniProt
<span class='line'>1404</span>      * @exports NaView
<span class='line'>1405</span>      * @name distributeLongLoopsWidth
<span class='line'>1406</span>      * @namespace
<span class='line'>1407</span>      * @yields {Function} scale function for calculating the interdomain loops width
<span class='line'>1408</span>      */</span><span class="WHIT">
<span class='line'>1409</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">distributeLongLoopsWidth</span><span class="PUNC">(</span><span class="NAME">total_width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">long_loops_array</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1410</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loops_print_vars</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"long_loops_draw_opts"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1411</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">w_dist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loops_print_vars</span><span class="PUNC">[</span><span class="STRN">"width"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1412</span> </span><span class="WHIT">        </span><span class="COMM">// let calc_len = loops_print_vars["calc_len"];</span><span class="WHIT">
<span class='line'>1413</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length_function</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1414</span> </span><span class="WHIT">        </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">w_dist.type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1415</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"custom"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1416</span> </span><span class="WHIT">                </span><span class="NAME">length_function</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1417</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">calc_len</span><span class="PUNC">[</span><span class="NAME">context</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1418</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1419</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1420</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"scaled"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1421</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">total_aanum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">long_loops_array.reduce</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1422</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">a.aanum</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1423</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1424</span> </span><span class="WHIT">                </span><span class="NAME">length_function</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.scaleLinear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">range</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">total_width</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">domain</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">total_aanum</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1425</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1426</span> </span><span class="WHIT">            </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"reslen"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1427</span> </span><span class="WHIT">                </span><span class="COMM">//this one requires pre-rendering which has not been implemented</span><span class="WHIT">
<span class='line'>1428</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1429</span> </span><span class="WHIT">            </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="COMM">//fixed</span><span class="WHIT">
<span class='line'>1430</span> </span><span class="WHIT">                </span><span class="NAME">length_function</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1431</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">total_width</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">long_loops_array.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1432</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1433</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1434</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1435</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">length_function</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1436</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1437</span> 
<span class='line'>1438</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1439</span>      * Calculates main plot area for drawing the membrane
<span class='line'>1440</span>      * @param {Object} drawing_area SVG draw area with borders and membrane main coords
<span class='line'>1441</span>      * @exports NaView
<span class='line'>1442</span>      * @name calculateDrawAreaMembrane
<span class='line'>1443</span>      * @namespace
<span class='line'>1444</span>      * @yields {Object} draw area object for drawing the plasmatic membrane
<span class='line'>1445</span>      */</span><span class="WHIT">
<span class='line'>1446</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">calculateDrawAreaMembrane</span><span class="PUNC">(</span><span class="NAME">drawing_area</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1447</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_stx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"start_x"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1448</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_etx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"end_x"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1449</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el_etx</span><span class="PUNC">-</span><span class="NAME">el_stx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1450</span> </span><span class="WHIT">    
<span class='line'>1451</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_sty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"membrane_start"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1452</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_ety</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"membrane_end"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1453</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el_ety</span><span class="PUNC">-</span><span class="NAME">el_sty</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1454</span> </span><span class="WHIT">    
<span class='line'>1455</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">positioned_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1456</span> </span><span class="WHIT">            </span><span class="STRN">"start_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_stx</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1457</span> </span><span class="WHIT">            </span><span class="STRN">"end_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_etx</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1458</span> </span><span class="WHIT">            </span><span class="STRN">"width"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_width</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1459</span> </span><span class="WHIT">            </span><span class="STRN">"start_y"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_sty</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1460</span> </span><span class="WHIT">            </span><span class="STRN">"end_y"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_ety</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1461</span> </span><span class="WHIT">            </span><span class="STRN">"height"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_height</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1462</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1463</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">positioned_element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1464</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1465</span> 
<span class='line'>1466</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1467</span>      * Calculates main plot area for drawing N or C terminus loops by using style_obj definitions
<span class='line'>1468</span>      * @param {String} terminus_type N or C for the respective terminus type
<span class='line'>1469</span>      * @param {Object} drawing_area  SVG draw area with borders and membrane main coords
<span class='line'>1470</span>      * @param {Object} terminus_data  Object containing the terminus object from processRawUniProt
<span class='line'>1471</span>      * @param {number} total_domain_width total plot width for domain elements
<span class='line'>1472</span>      * @param {number} inter_domain_width total plot width for interdomain loops
<span class='line'>1473</span>      * @exports NaView
<span class='line'>1474</span>      * @name calculateDrawAreaTermini
<span class='line'>1475</span>      * @namespace
<span class='line'>1476</span>      * @yields {Object} draw area object for drawing N or C terminus loops
<span class='line'>1477</span>      */</span><span class="WHIT">
<span class='line'>1478</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">calculateDrawAreaTermini</span><span class="PUNC">(</span><span class="NAME">terminus_type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">terminus_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">total_domain_width</span><span class="PUNC">,</span><span class="NAME">inter_domain_width</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1479</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">return_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1480</span> </span><span class="WHIT">            </span><span class="STRN">"objs"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1481</span> </span><span class="WHIT">            </span><span class="STRN">"end_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1482</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1483</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_stx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"start_x"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1484</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"nter_loop_width"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1485</span> </span><span class="WHIT">        
<span class='line'>1486</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">terminus_type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"C"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1487</span> </span><span class="WHIT">            </span><span class="NAME">el_stx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"start_x"</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">el_width</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">total_domain_width</span><span class="PUNC">+</span><span class="NAME">inter_domain_width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1488</span> </span><span class="WHIT">            </span><span class="NAME">el_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"cter_loop_width"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1489</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1490</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_etx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el_stx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">el_width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1491</span> </span><span class="WHIT">    
<span class='line'>1492</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_sty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"start_y"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1493</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_ety</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"membrane_start"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1494</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">terminus_data.note</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"Cytoplasmic"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1495</span> </span><span class="WHIT">            </span><span class="NAME">el_sty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"membrane_end"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1496</span> </span><span class="WHIT">            </span><span class="NAME">el_ety</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"end_y"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1497</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1498</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el_ety</span><span class="PUNC">-</span><span class="NAME">el_sty</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1499</span> </span><span class="WHIT">    
<span class='line'>1500</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">positioned_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1501</span> </span><span class="WHIT">            </span><span class="STRN">"start_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_stx</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1502</span> </span><span class="WHIT">            </span><span class="STRN">"end_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_etx</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1503</span> </span><span class="WHIT">            </span><span class="STRN">"width"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_width</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1504</span> </span><span class="WHIT">            </span><span class="STRN">"start_y"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_sty</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1505</span> </span><span class="WHIT">            </span><span class="STRN">"end_y"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_ety</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1506</span> </span><span class="WHIT">            </span><span class="STRN">"height"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_height</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1507</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1508</span> </span><span class="WHIT">        </span><span class="NAME">terminus_data</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">positioned_element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1509</span> </span><span class="WHIT">        </span><span class="NAME">return_obj</span><span class="PUNC">[</span><span class="STRN">"objs"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">terminus_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1510</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">return_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1511</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1512</span> 
<span class='line'>1513</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1514</span>      * Calculates main plot area for drawing domain intramembranar helices or pores by using style_obj definitions
<span class='line'>1515</span>      * @param {String} domain_name Name of current domain (I, II, III, IV)
<span class='line'>1516</span>      * @param {Array} helices_and_pores_array Array of Objects from processRawUniProt for helices and pores of each domain
<span class='line'>1517</span>      * @param {Object} drawing_area SVG draw area with borders and membrane main coords
<span class='line'>1518</span>      * @param {number} cumulative_x cumulative width of previously determined plot elements (left to right)
<span class='line'>1519</span>      * @exports NaView
<span class='line'>1520</span>      * @name calculateDrawAreaHelicesPoresByDomain
<span class='line'>1521</span>      * @namespace
<span class='line'>1522</span>      * @yields {Object} draw area object for drawing domain intramembranar helices or pores
<span class='line'>1523</span>      */</span><span class="WHIT">
<span class='line'>1524</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">calculateDrawAreaHelicesPoresByDomain</span><span class="PUNC">(</span><span class="NAME">domain_name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">helices_and_pores_array</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cumulative_x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1525</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">return_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1526</span> </span><span class="WHIT">            </span><span class="STRN">"objs"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1527</span> </span><span class="WHIT">            </span><span class="STRN">"end_y"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1528</span> </span><span class="WHIT">            </span><span class="STRN">"end_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1529</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1530</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">accumulated_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cumulative_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1531</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">hcount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1532</span> 
<span class='line'>1533</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">prev_dom_name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1534</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1535</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">iel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iel</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">helices_and_pores_array.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iel</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1536</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helix_or_pore</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helices_and_pores_array</span><span class="PUNC">[</span><span class="NAME">iel</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1537</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helix_or_pore</span><span class="PUNC">[</span><span class="STRN">"dom_name"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1538</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_stx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">accumulated_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1539</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_sty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"membrane_start"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1540</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//style_obj["protein"]["helix_width"];</span><span class="WHIT">
<span class='line'>1541</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//style_obj["protein"]["helix_height"];</span><span class="WHIT">
<span class='line'>1542</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dom_name</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">prev_dom_name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1543</span> </span><span class="WHIT">                </span><span class="NAME">dom_index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1544</span> </span><span class="WHIT">                </span><span class="NAME">prev_dom_name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dom_name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1545</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1546</span> </span><span class="WHIT">            </span><span class="NAME">dom_index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1547</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">helix_or_pore.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"pore"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1548</span> </span><span class="WHIT">                </span><span class="NAME">el_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"pore_region_width"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">domain_name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1549</span> </span><span class="WHIT">                </span><span class="NAME">el_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"pore_region_height"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">domain_name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1550</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1551</span> </span><span class="WHIT">                </span><span class="NAME">el_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"helix_region_width"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">domain_name</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">hcount</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1552</span> </span><span class="WHIT">                </span><span class="NAME">el_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"helix_region_height"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">domain_name</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">hcount</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1553</span> </span><span class="WHIT">                </span><span class="NAME">hcount</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1554</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1555</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">positioned_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1556</span> </span><span class="WHIT">                </span><span class="STRN">"start_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_stx</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1557</span> </span><span class="WHIT">                </span><span class="STRN">"end_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el_stx</span><span class="PUNC">+</span><span class="NAME">el_width</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1558</span> </span><span class="WHIT">                </span><span class="STRN">"width"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_width</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1559</span> </span><span class="WHIT">                </span><span class="STRN">"start_y"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_sty</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1560</span> </span><span class="WHIT">                </span><span class="STRN">"end_y"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el_sty</span><span class="PUNC">+</span><span class="NAME">el_height</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1561</span> </span><span class="WHIT">                </span><span class="STRN">"height"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_height</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1562</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1563</span> </span><span class="WHIT">            </span><span class="NAME">helices_and_pores_array</span><span class="PUNC">[</span><span class="NAME">iel</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">positioned_element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1564</span> </span><span class="WHIT">            </span><span class="NAME">return_obj</span><span class="PUNC">[</span><span class="STRN">"objs"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">helices_and_pores_array</span><span class="PUNC">[</span><span class="NAME">iel</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1565</span> </span><span class="WHIT">            </span><span class="NAME">return_obj</span><span class="PUNC">[</span><span class="STRN">"end_y"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el_sty</span><span class="PUNC">+</span><span class="NAME">el_height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1566</span> 
<span class='line'>1567</span> </span><span class="WHIT">            </span><span class="NAME">accumulated_x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el_width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1568</span> </span><span class="WHIT">            </span><span class="COMM">// let helixpore_spacing = style_obj["protein"]["helix_spacing_width"];</span><span class="WHIT">
<span class='line'>1569</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helixpore_spacing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"helix_spacing_width"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">dom_name</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">dom_index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1570</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">iel</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">helices_and_pores_array.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1571</span> </span><span class="WHIT">                </span><span class="COMM">// helixpore_spacing = (iel+1) * style_obj["protein"]["helix_spacing_width"];</span><span class="WHIT">
<span class='line'>1572</span> </span><span class="WHIT">                </span><span class="NAME">accumulated_x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helixpore_spacing</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1573</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1574</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1575</span> </span><span class="WHIT">        </span><span class="NAME">return_obj</span><span class="PUNC">[</span><span class="STRN">"end_x"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">accumulated_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1576</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">return_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1577</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1578</span> 
<span class='line'>1579</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1580</span>      * Inserts processRawUniProt objects containing draw areas in a dictionary according to their N to C termini indexa and style_obj definitions
<span class='line'>1581</span>      * @param {Object} protein_dict Object containing each processRawUniProt object according to their N to C termini index
<span class='line'>1582</span>      * @param {Array} array_to_dict Array of processRawUniProt objects containing draw areas
<span class='line'>1583</span>      * @exports NaView
<span class='line'>1584</span>      * @name indexDrawAreas
<span class='line'>1585</span>      * @namespace
<span class='line'>1586</span>      * @yields {Object} protein_dict Object containing each processRawUniProt object according to their N to C termini index
<span class='line'>1587</span>      */</span><span class="WHIT">
<span class='line'>1588</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">indexDrawAreas</span><span class="PUNC">(</span><span class="NAME">protein_dict</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">array_to_dict</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1589</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">iatd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iatd</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">array_to_dict.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iatd</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1590</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">array_to_dict</span><span class="PUNC">[</span><span class="NAME">iatd</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1591</span> </span><span class="WHIT">            </span><span class="NAME">protein_dict</span><span class="PUNC">[</span><span class="NAME">obj.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">obj.draw_area</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1592</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1593</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">protein_dict</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1594</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1595</span> 
<span class='line'>1596</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1597</span>      * Calculates main plot area for drawing domain loops connecting helices or pores and style_obj definitions
<span class='line'>1598</span>      * @param {Array} internal_short_loops_array Array of Objects from processRawUniProt for loops connecting helices and pores of each domain
<span class='line'>1599</span>      * @param {Array} helixpore_objs Array of Objects from processRawUniProt for helices and pores of each domain
<span class='line'>1600</span>      * @param {Object} drawing_area SVG draw area with borders and membrane main coords
<span class='line'>1601</span>      * @param {number} cumulative_x cumulative width of previously determined plot elements (left to right)
<span class='line'>1602</span>      * @exports NaView
<span class='line'>1603</span>      * @name calculateDrawAreaShortLoopsByDomain
<span class='line'>1604</span>      * @yields {Object} draw area object for drawing domain loops connecting helices or pores
<span class='line'>1605</span>      * @namespace 
<span class='line'>1606</span>      */</span><span class="WHIT">
<span class='line'>1607</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">calculateDrawAreaShortLoopsByDomain</span><span class="PUNC">(</span><span class="NAME">internal_short_loops_array</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">helixpore_objs</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cumulative_x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1608</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">return_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1609</span> </span><span class="WHIT">            </span><span class="STRN">"objs"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1610</span> </span><span class="WHIT">            </span><span class="STRN">"width"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1611</span> </span><span class="WHIT">            </span><span class="STRN">"end_y"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1612</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1613</span> </span><span class="WHIT">    
<span class='line'>1614</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">accumulated_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cumulative_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1615</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">isl</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">internal_short_loops_array.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">isl</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1616</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">current_internal_short_loop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">internal_short_loops_array</span><span class="PUNC">[</span><span class="NAME">isl</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1617</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">previous_helixpore_el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helixpore_objs</span><span class="PUNC">[</span><span class="NAME">isl</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1618</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">next_helixpore_el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helixpore_objs</span><span class="PUNC">[</span><span class="NAME">isl</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1619</span> </span><span class="WHIT">            </span><span class="COMM">// let el_stx = accumulated_x; //end of previous element</span><span class="WHIT">
<span class='line'>1620</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_stx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">previous_helixpore_el</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"end_x"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">previous_helixpore_el</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"width"</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1621</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_etx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">next_helixpore_el</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"start_x"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">next_helixpore_el</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"width"</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1622</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el_etx</span><span class="PUNC">-</span><span class="NAME">el_stx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1623</span> </span><span class="WHIT">    
<span class='line'>1624</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_sty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"start_y"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1625</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_ety</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"membrane_start"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1626</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">current_internal_short_loop.note</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"Cytoplasmic"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1627</span> </span><span class="WHIT">                </span><span class="NAME">el_sty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"membrane_end"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1628</span> </span><span class="WHIT">                </span><span class="NAME">el_ety</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"end_y"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1629</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1630</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el_ety</span><span class="PUNC">-</span><span class="NAME">el_sty</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1631</span> </span><span class="WHIT">    
<span class='line'>1632</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">positioned_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1633</span> </span><span class="WHIT">                </span><span class="STRN">"start_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_stx</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1634</span> </span><span class="WHIT">                </span><span class="STRN">"end_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_etx</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1635</span> </span><span class="WHIT">                </span><span class="STRN">"width"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_width</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1636</span> </span><span class="WHIT">                </span><span class="STRN">"start_y"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_sty</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1637</span> </span><span class="WHIT">                </span><span class="STRN">"end_y"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_ety</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1638</span> </span><span class="WHIT">                </span><span class="STRN">"height"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_height</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1639</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1640</span> </span><span class="WHIT">            </span><span class="NAME">internal_short_loops_array</span><span class="PUNC">[</span><span class="NAME">isl</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">positioned_element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1641</span> </span><span class="WHIT">            </span><span class="NAME">return_obj</span><span class="PUNC">[</span><span class="STRN">"objs"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">internal_short_loops_array</span><span class="PUNC">[</span><span class="NAME">isl</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1642</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1643</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">return_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1644</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1645</span> 
<span class='line'>1646</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1647</span>      * Calculates main plot area for drawing interdomain loops by using style_obj definitions
<span class='line'>1648</span>      * @param {Object} long_loop_obj Object containing each processRawUniProt interdomain loop object
<span class='line'>1649</span>      * @param {number} cumulative_x cumulative width of previously determined plot elements (left to right)
<span class='line'>1650</span>      * @param {number} last_y plot y positioning of the last intradomain helix (Helix:6)
<span class='line'>1651</span>      * @param {Function} longLoopWidthF scale function for calculating the interdomain loops width from &lt;i>&lt;b>distributeLongLoopsWidth&lt;/b>&lt;/i>
<span class='line'>1652</span>      * @param {Object} drawing_area  SVG draw area with borders and membrane main coords
<span class='line'>1653</span>      * @exports NaView
<span class='line'>1654</span>      * @name calculateDrawAreaLongLoops
<span class='line'>1655</span>      * @yields {Object} draw area object for drawing interdomain loops
<span class='line'>1656</span>      * @namespace
<span class='line'>1657</span>      */</span><span class="WHIT">
<span class='line'>1658</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">calculateDrawAreaLongLoops</span><span class="PUNC">(</span><span class="NAME">long_loop_obj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cumulative_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">last_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">longLoopWidthF</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1659</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">return_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1660</span> </span><span class="WHIT">            </span><span class="STRN">"objs"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1661</span> </span><span class="WHIT">            </span><span class="STRN">"end_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1662</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1663</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">accumulated_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cumulative_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1664</span> </span><span class="WHIT">        
<span class='line'>1665</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">prev_dom_helix_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"helix_region_width"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">long_loop_obj.prev_dom_name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1666</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">prev_dom_helix_data_sub</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">prev_dom_helix_data</span><span class="PUNC">[</span><span class="NAME">prev_dom_helix_data.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1667</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">next_dom_helix_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"helix_region_width"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">long_loop_obj.next_dom_name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1668</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">next_dom_helix_data_add</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">next_dom_helix_data</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1669</span> </span><span class="WHIT">    
<span class='line'>1670</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_stx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">accumulated_x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">prev_dom_helix_data_sub</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1671</span> </span><span class="WHIT">    
<span class='line'>1672</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">context_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">long_loop_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1673</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"long_loops_draw_opts"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"width"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"type"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">"custom"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1674</span> </span><span class="WHIT">            </span><span class="NAME">context_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">long_loop_obj.aanum</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1675</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1676</span> </span><span class="WHIT">    
<span class='line'>1677</span>         </span><span class="COMM">// let calc_width = longLoopWidthF(long_loop_obj.aanum);</span><span class="WHIT">
<span class='line'>1678</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">calc_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">longLoopWidthF</span><span class="PUNC">(</span><span class="NAME">context_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1679</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calc_width</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">prev_dom_helix_data_sub</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">next_dom_helix_data_add</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1680</span> </span><span class="WHIT">        </span><span class="COMM">// let el_etx = accumulated_x + el_width;</span><span class="WHIT">
<span class='line'>1681</span> </span><span class="WHIT">    
<span class='line'>1682</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_sty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"start_y"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1683</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_ety</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"membrane_start"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1684</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">long_loop_obj.note</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"Cytoplasmic"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1685</span> </span><span class="WHIT">            </span><span class="NAME">el_sty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"membrane_end"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1686</span> </span><span class="WHIT">            </span><span class="NAME">el_ety</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawing_area</span><span class="PUNC">[</span><span class="STRN">"end_y"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1687</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1688</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el_ety</span><span class="PUNC">-</span><span class="NAME">el_sty</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1689</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">positioned_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1690</span> </span><span class="WHIT">            </span><span class="STRN">"start_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_stx</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1691</span> </span><span class="WHIT">            </span><span class="STRN">"end_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el_stx</span><span class="PUNC">+</span><span class="NAME">el_width</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1692</span> </span><span class="WHIT">            </span><span class="STRN">"width"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_width</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1693</span> </span><span class="WHIT">            </span><span class="STRN">"start_y"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_sty</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1694</span> </span><span class="WHIT">            </span><span class="STRN">"end_y"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el_sty</span><span class="PUNC">+</span><span class="NAME">el_height</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1695</span> </span><span class="WHIT">            </span><span class="STRN">"height"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el_height</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1696</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1697</span> </span><span class="WHIT">        </span><span class="NAME">long_loop_obj</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">positioned_element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1698</span> </span><span class="WHIT">        </span><span class="NAME">return_obj</span><span class="PUNC">[</span><span class="STRN">"objs"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">long_loop_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1699</span> </span><span class="WHIT">        </span><span class="COMM">// accumulated_x += longLoopWidthF(long_loop_obj.aanum);</span><span class="WHIT">
<span class='line'>1700</span> </span><span class="WHIT">        </span><span class="NAME">accumulated_x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">longLoopWidthF</span><span class="PUNC">(</span><span class="NAME">context_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1701</span> </span><span class="WHIT">        </span><span class="NAME">return_obj</span><span class="PUNC">[</span><span class="STRN">"end_x"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">accumulated_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1702</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">return_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1703</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1704</span> 
<span class='line'>1705</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1706</span>      * Function organizes protein element order for generating draw areas for every protein and membrane elements.&lt;br>
<span class='line'>1707</span>      * @see calculateDrawAreaMembrane
<span class='line'>1708</span>      * @see calculateDrawAreaTermini
<span class='line'>1709</span>      * @see calculateDrawAreaHelicesPoresByDomain
<span class='line'>1710</span>      * @see indexDrawAreas
<span class='line'>1711</span>      * @see calculateDrawAreaLongLoops
<span class='line'>1712</span>      * @param {Array} array_data data generated from processRawUniProt
<span class='line'>1713</span>      * @param {Object} svg_drawing_area SVG draw area with borders and membrane main coords
<span class='line'>1714</span>      * @param {Array} domain_names list of names for each domain(I,II,III,IV)
<span class='line'>1715</span>      * @param {Object} helices_and_pores_by_domain dictionary for helices and pore elements according to their domain names (I,II,III,IV)
<span class='line'>1716</span>      * @param {Object} internal_short_loops_by_domain dictionary for loops connecting helices and pore elements according to their domain names (I,II,III,IV)
<span class='line'>1717</span>      * @param {Object} long_loops_by_prevdomain dictionary for interdomain loop elements according to their previous domain names (I,II,III)
<span class='line'>1718</span>      * @param {Function} longLoopWidthF scale function for calculating the interdomain loops width from &lt;i>&lt;b>distributeLongLoopsWidth&lt;/b>&lt;/i>
<span class='line'>1719</span>      * @param {number} total_domain_width total plot width for domain objects
<span class='line'>1720</span>      * @param {number} inter_domain_width total plot width for interdomain objects
<span class='line'>1721</span>      * @exports NaView
<span class='line'>1722</span>      * @name calcElementsDrawAreas
<span class='line'>1723</span>      * @namespace
<span class='line'>1724</span>      * @yields {Object} Object containing draw areas for every protein and membrane elements
<span class='line'>1725</span>      */</span><span class="WHIT">
<span class='line'>1726</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">calcElementsDrawAreas</span><span class="PUNC">(</span><span class="NAME">array_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">svg_drawing_area</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">domain_names</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">helices_and_pores_by_domain</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">internal_short_loops_by_domain</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">long_loops_by_prevdomain</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">longLoopWidthF</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">total_domain_width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">inter_domain_width</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1727</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">indexed_drawareas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1728</span> </span><span class="WHIT">            </span><span class="STRN">"protein"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1729</span> </span><span class="WHIT">            </span><span class="STRN">"membrane"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT">
<span class='line'>1730</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1731</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">plines</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1732</span> </span><span class="WHIT">        
<span class='line'>1733</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">membrane_drawarea</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateDrawAreaMembrane</span><span class="PUNC">(</span><span class="NAME">svg_drawing_area</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1734</span> </span><span class="WHIT">        </span><span class="NAME">indexed_drawareas.membrane</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">membrane_drawarea</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1735</span> </span><span class="WHIT">        
<span class='line'>1736</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cumulative_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_drawing_area</span><span class="PUNC">[</span><span class="STRN">"start_x"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">svg_width</span><span class="PUNC">*</span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"nter_loop_width"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//cter_loop_width</span><span class="WHIT">
<span class='line'>1737</span> </span><span class="WHIT">    
<span class='line'>1738</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">n_terminus_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">array_data</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1739</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">n_terminus_drawarea</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateDrawAreaTermini</span><span class="PUNC">(</span><span class="STRN">"N"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">svg_drawing_area</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">n_terminus_data</span><span class="PUNC">,</span><span class="NAME">total_domain_width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">inter_domain_width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1740</span> </span><span class="WHIT">        </span><span class="COMM">// indexed_drawareas.protein[0] = n_terminus_drawarea.objs[0].draw_area;</span><span class="WHIT">
<span class='line'>1741</span> </span><span class="WHIT">        </span><span class="NAME">indexed_drawareas.protein</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">n_terminus_drawarea.objs</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">draw_area</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1742</span> </span><span class="WHIT">    
<span class='line'>1743</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">c_terminus_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">array_data</span><span class="PUNC">[</span><span class="NAME">array_data.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1744</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">c_terminus_drawarea</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateDrawAreaTermini</span><span class="PUNC">(</span><span class="STRN">"C"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">svg_drawing_area</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c_terminus_data</span><span class="PUNC">,</span><span class="NAME">total_domain_width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">inter_domain_width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1745</span> </span><span class="WHIT">        </span><span class="COMM">// indexed_drawareas.protein[array_data.length-1] = c_terminus_drawarea.objs[c_terminus_drawarea.objs.length-1].draw_area;</span><span class="WHIT">
<span class='line'>1746</span> </span><span class="WHIT">        </span><span class="NAME">indexed_drawareas.protein</span><span class="PUNC">[</span><span class="NAME">array_data.length</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c_terminus_drawarea.objs</span><span class="PUNC">[</span><span class="NAME">c_terminus_drawarea.objs.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">draw_area</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1747</span> </span><span class="WHIT">    
<span class='line'>1748</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">idn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idn</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">domain_names.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idn</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1749</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">domain_name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">domain_names</span><span class="PUNC">[</span><span class="NAME">idn</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1750</span> </span><span class="WHIT">    
<span class='line'>1751</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">domain_assignment_results_helixpore</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateDrawAreaHelicesPoresByDomain</span><span class="PUNC">(</span><span class="NAME">domain_name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">helices_and_pores_by_domain</span><span class="PUNC">[</span><span class="NAME">domain_name</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">svg_drawing_area</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cumulative_x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1752</span> </span><span class="WHIT">            </span><span class="NAME">indexed_drawareas.protein</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">indexDrawAreas</span><span class="PUNC">(</span><span class="NAME">indexed_drawareas.protein</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">domain_assignment_results_helixpore.objs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1753</span> </span><span class="WHIT">    
<span class='line'>1754</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">domain_assignment_results_shortloops</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateDrawAreaShortLoopsByDomain</span><span class="PUNC">(</span><span class="NAME">internal_short_loops_by_domain</span><span class="PUNC">[</span><span class="NAME">domain_name</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">domain_assignment_results_helixpore.objs</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">svg_drawing_area</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cumulative_x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1755</span> </span><span class="WHIT">            </span><span class="NAME">indexed_drawareas.protein</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">indexDrawAreas</span><span class="PUNC">(</span><span class="NAME">indexed_drawareas.protein</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">domain_assignment_results_shortloops.objs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1756</span> </span><span class="WHIT">    
<span class='line'>1757</span>             </span><span class="COMM">// cumulative_x += domain_assignment_results_helixpore.width;</span><span class="WHIT">
<span class='line'>1758</span> </span><span class="WHIT">            </span><span class="COMM">// cumulative_x += domain_to_width[domain_name];</span><span class="WHIT">
<span class='line'>1759</span> </span><span class="WHIT">            </span><span class="NAME">cumulative_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">domain_assignment_results_helixpore.end_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1760</span> </span><span class="WHIT">            
<span class='line'>1761</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">last_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">domain_assignment_results_helixpore.end_y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1762</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">long_loop_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">long_loops_by_prevdomain</span><span class="PUNC">[</span><span class="NAME">domain_name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1763</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">long_loop_obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1764</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">inter_domain_assignment_results</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateDrawAreaLongLoops</span><span class="PUNC">(</span><span class="NAME">long_loop_obj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cumulative_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">last_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">longLoopWidthF</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">svg_drawing_area</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1765</span> </span><span class="WHIT">                </span><span class="NAME">indexed_drawareas.protein</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">indexDrawAreas</span><span class="PUNC">(</span><span class="NAME">indexed_drawareas.protein</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">inter_domain_assignment_results.objs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1766</span> </span><span class="WHIT">                </span><span class="NAME">cumulative_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">inter_domain_assignment_results.end_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1767</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1768</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1769</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">indexed_drawareas</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1770</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1771</span> 
<span class='line'>1772</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1773</span>      * Draws whole plot using various accessory functions
<span class='line'>1774</span>      * @param {Array} parsed_protein_data data generated from processRawUniProt containing draw areas
<span class='line'>1775</span>      * @exports NaView
<span class='line'>1776</span>      * @name drawEverything
<span class='line'>1777</span>      * @namespace
<span class='line'>1778</span>      * @see createFillRules
<span class='line'>1779</span>      * @see draw_membrane
<span class='line'>1780</span>      * @see mergeDrawData
<span class='line'>1781</span>      * @see createResidData
<span class='line'>1782</span>      * @see calculateResidOrientation
<span class='line'>1783</span>      * @see draw_helices
<span class='line'>1784</span>      * @see gen_shortloop_anchordata
<span class='line'>1785</span>      * @see draw_shortLoops
<span class='line'>1786</span>      * @see gen_poreloop_anchordata
<span class='line'>1787</span>      * @see draw_poreLoops
<span class='line'>1788</span>      * @see gen_longloop_anchordata
<span class='line'>1789</span>      * @see draw_longLoops
<span class='line'>1790</span>      * @see gen_termini_anchordata
<span class='line'>1791</span>      * @see draw_termini
<span class='line'>1792</span>      * @see createResidElementToCentroidData
<span class='line'>1793</span>      * @see draw_residue_relations
<span class='line'>1794</span>      * @see draw_symbols
<span class='line'>1795</span>      */</span><span class="WHIT">
<span class='line'>1796</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">drawEverything</span><span class="PUNC">(</span><span class="NAME">parsed_protein_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1797</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">membrane_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parsed_protein_data.membrane</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1798</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">membrane_draw_key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">style_obj.membrane.membrane_draw_opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1799</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style_obj.membrane.membrane_draw_opts.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">membrane_draw_key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1800</span> </span><span class="WHIT">                </span><span class="NAME">membrane_data</span><span class="PUNC">[</span><span class="NAME">membrane_draw_key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.membrane.membrane_draw_opts</span><span class="PUNC">[</span><span class="NAME">membrane_draw_key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1801</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1802</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1803</span> </span><span class="WHIT">        </span><span class="NAME">current_resid_properties</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">parsed_protein_data.resid_properties</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1804</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parsed_protein_data.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"color_rules"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1805</span> </span><span class="WHIT">            </span><span class="NAME">createFillRules</span><span class="PUNC">(</span><span class="NAME">parsed_protein_data.color_rules</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1806</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1807</span> </span><span class="WHIT">        </span><span class="NAME">draw_membrane</span><span class="PUNC">(</span><span class="NAME">membrane_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1808</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helices_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parsed_protein_data.data.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1809</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"helix"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1810</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1811</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helices_pores_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parsed_protein_data.data.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1812</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"helix"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"pore"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1813</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1814</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parsed_protein_data.data.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1815</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"loop"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a.dom_name</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1816</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1817</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">longloop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parsed_protein_data.data.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1818</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"loop"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a.dom_name</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a.prev_dom_name</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a.next_dom_name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1819</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1820</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">nter_loop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parsed_protein_data.data.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1821</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"loop"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a.dom_name</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a.prev_dom_name</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">a.next_dom_name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1822</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1823</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cter_loop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parsed_protein_data.data.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1824</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"loop"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a.dom_name</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a.prev_dom_name</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">a.next_dom_name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1825</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1826</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">all_loop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parsed_protein_data.data.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1827</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"loop"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1828</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1829</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parsed_protein_data.data.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1830</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"pore"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1831</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1832</span> 
<span class='line'>1833</span> </span><span class="WHIT">        </span><span class="COMM">// let n_terminus_note = parsed_protein_data.data[0].note;</span><span class="WHIT">
<span class='line'>1834</span> 
<span class='line'>1835</span> </span><span class="WHIT">        </span><span class="NAME">helices_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mergeDrawData</span><span class="PUNC">(</span><span class="STRN">"helix"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">helices_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1836</span> </span><span class="WHIT">        </span><span class="NAME">helices_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createResidData</span><span class="PUNC">(</span><span class="NAME">helices_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1837</span> </span><span class="WHIT">        </span><span class="NAME">helices_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateResidOrientation</span><span class="PUNC">(</span><span class="NAME">helices_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">all_loop_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1838</span> </span><span class="WHIT">        </span><span class="NAME">draw_helices</span><span class="PUNC">(</span><span class="NAME">helices_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1839</span> 
<span class='line'>1840</span> </span><span class="WHIT">        </span><span class="NAME">short_loop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mergeDrawData</span><span class="PUNC">(</span><span class="STRN">"short_loops"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1841</span> </span><span class="WHIT">        </span><span class="NAME">short_loop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createResidData</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1842</span> </span><span class="WHIT">        </span><span class="NAME">short_loop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">gen_shortloop_anchordata</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">helices_pores_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1843</span> </span><span class="WHIT">        </span><span class="NAME">draw_shortLoops</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1844</span> 
<span class='line'>1845</span> </span><span class="WHIT">        </span><span class="NAME">pores_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mergeDrawData</span><span class="PUNC">(</span><span class="STRN">"pore_loops"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1846</span> </span><span class="WHIT">        </span><span class="NAME">pores_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createResidData</span><span class="PUNC">(</span><span class="NAME">pores_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1847</span> </span><span class="WHIT">        </span><span class="NAME">pores_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">gen_poreloop_anchordata</span><span class="PUNC">(</span><span class="NAME">pores_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1848</span> </span><span class="WHIT">        </span><span class="NAME">draw_poreLoops</span><span class="PUNC">(</span><span class="NAME">pores_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1849</span> 
<span class='line'>1850</span> </span><span class="WHIT">        </span><span class="NAME">longloop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mergeDrawData</span><span class="PUNC">(</span><span class="STRN">"long_loops"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">longloop_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1851</span> </span><span class="WHIT">        </span><span class="NAME">longloop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createResidData</span><span class="PUNC">(</span><span class="NAME">longloop_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1852</span> </span><span class="WHIT">        </span><span class="NAME">longloop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">gen_longloop_anchordata</span><span class="PUNC">(</span><span class="NAME">longloop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">helices_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1853</span> </span><span class="WHIT">        </span><span class="NAME">draw_longLoops</span><span class="PUNC">(</span><span class="NAME">longloop_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1854</span> 
<span class='line'>1855</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sorted_helices</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">helices_data</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1856</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.start</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">b.start</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1857</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1858</span> 
<span class='line'>1859</span> </span><span class="WHIT">        </span><span class="NAME">nter_loop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mergeDrawData</span><span class="PUNC">(</span><span class="STRN">"nter_loop"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nter_loop_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1860</span> </span><span class="WHIT">        </span><span class="NAME">nter_loop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createResidData</span><span class="PUNC">(</span><span class="NAME">nter_loop_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1861</span> </span><span class="WHIT">        </span><span class="NAME">nter_loop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">gen_termini_anchordata</span><span class="PUNC">(</span><span class="NAME">nter_loop_data</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">sorted_helices</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"N"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1862</span> </span><span class="WHIT">        </span><span class="NAME">draw_termini</span><span class="PUNC">(</span><span class="NAME">nter_loop_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1863</span> 
<span class='line'>1864</span> </span><span class="WHIT">        </span><span class="NAME">cter_loop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mergeDrawData</span><span class="PUNC">(</span><span class="STRN">"cter_loop"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cter_loop_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1865</span> </span><span class="WHIT">        </span><span class="NAME">cter_loop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createResidData</span><span class="PUNC">(</span><span class="NAME">cter_loop_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1866</span> </span><span class="WHIT">        </span><span class="NAME">cter_loop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">gen_termini_anchordata</span><span class="PUNC">(</span><span class="NAME">cter_loop_data</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">sorted_helices</span><span class="PUNC">[</span><span class="NAME">sorted_helices.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"C"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1867</span> </span><span class="WHIT">        </span><span class="NAME">draw_termini</span><span class="PUNC">(</span><span class="NAME">cter_loop_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1868</span> </span><span class="WHIT">        </span><span class="NAME">parsed_protein_data.residue_element_centroids</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createResidElementToCentroidData</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1869</span> 
<span class='line'>1870</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parsed_protein_data.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"residue_relations"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1871</span> </span><span class="WHIT">            </span><span class="NAME">draw_residue_relations</span><span class="PUNC">(</span><span class="NAME">parsed_protein_data.residue_relations</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parsed_protein_data.residue_element_centroids</span><span class="PUNC">,</span><span class="NAME">parsed_protein_data.data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1872</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1873</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parsed_protein_data.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"draw_symbols"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1874</span> </span><span class="WHIT">            </span><span class="NAME">draw_symbols</span><span class="PUNC">(</span><span class="NAME">parsed_protein_data.draw_symbols</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parsed_protein_data.residue_element_centroids</span><span class="PUNC">,</span><span class="NAME">parsed_protein_data.resid_properties</span><span class="PUNC">,</span><span class="NAME">parsed_protein_data.data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1875</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1876</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parsed_protein_data.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"color_rules"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1877</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parsed_protein_data.color_rules.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1878</span> </span><span class="WHIT">                </span><span class="NAME">d3.selectAll</span><span class="PUNC">(</span><span class="STRN">".element_path"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style</span><span class="PUNC">(</span><span class="STRN">"visibility"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"hidden"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1879</span> </span><span class="WHIT">                </span><span class="NAME">d3.selectAll</span><span class="PUNC">(</span><span class="STRN">".residue_path"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style</span><span class="PUNC">(</span><span class="STRN">"visibility"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1880</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1881</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1882</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1883</span> 
<span class='line'>1884</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1885</span>      * Resets global fillRules object and generates a new color filling object for each user defined color rule.&lt;br>
<span class='line'>1886</span>      * When multiple user defined color rules are applied to the same residue/element, the last rule takes precedence.&lt;br>
<span class='line'>1887</span>      * Color rules allow the selection of residues or elements (helices, pore, loops) by the "selection,color" syntax.&lt;br>
<span class='line'>1888</span>      * Multiple "selection" possibilities are allowed including: &lt;br>
<span class='line'>1889</span>      * "W" -> Selects all tryptophan residues &lt;br>
<span class='line'>1890</span>      * "Trp" -> Select all tryptophan residues &lt;br>
<span class='line'>1891</span>      * "1" -> Selects first residue of protein sequence &lt;br>
<span class='line'>1892</span>      * "W1" -> Selects first residue of protein sequence &lt;br>
<span class='line'>1893</span>      * "Trp1" -> Selects first residue of protein sequence &lt;br>
<span class='line'>1894</span>      * "Domain:I" -> Selects first domain &lt;br>
<span class='line'>1895</span>      * "Domain:I&Helix:1" -> Selects first domain &lt;br>
<span class='line'>1896</span>      * "Domain:I&Loop:1" -> Selects first domain &lt;br>
<span class='line'>1897</span>      * "Helix:1" -> Selects first helix of all domains &lt;br>
<span class='line'>1898</span>      * "Loop:1" -> Selects first loop of all domains &lt;br>
<span class='line'>1899</span>      * "Id:1" -> Selects first residue of protein sequence &lt;br>
<span class='line'>1900</span>      * "ALL" -> Selects all protein residues &lt;br>
<span class='line'>1901</span>      * The "color" possibilities include both named and hexadecimal colors: &lt;br> &lt;br>
<span class='line'>1902</span>      * "white" -> colors selection white &lt;br>
<span class='line'>1903</span>      * "#FFFFFF" -> colors selection white &lt;br>
<span class='line'>1904</span>      * an advanced color mapping to user inputted residue properties is also possible using the following syntax after a "selection" string: &lt;br>
<span class='line'>1905</span>      * "by:Residue_Property_Name,color_range,color_property_domain" &lt;br>
<span class='line'>1906</span>      * Residue_Property_Name -> refers to the user inputted residue property &lt;br>
<span class='line'>1907</span>      * color_range -> a color range from each to map this property. valid examples: "white;green" or "red;white;blue" &lt;br>
<span class='line'>1908</span>      * color_property_domain -> the color domain to which the color range refers to. valid examples: "min;max" (from minimum to maximum value), "0.0;0.5;1.0" &lt;br>
<span class='line'>1909</span>      * @param {Array} data_color list of Strings inputted from user to generate per element/residue color filling rules
<span class='line'>1910</span>      * @namespace
<span class='line'>1911</span>      * @exports NaView
<span class='line'>1912</span>      * @name createFillRules
<span class='line'>1913</span>      */</span><span class="WHIT">
<span class='line'>1914</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">createFillRules</span><span class="PUNC">(</span><span class="NAME">data_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1915</span> </span><span class="WHIT">        </span><span class="NAME">fillRules</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1916</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">idc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idc</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">data_color.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idc</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1917</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">fillObj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1918</span> </span><span class="WHIT">                </span><span class="STRN">"check_keys"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1919</span> </span><span class="WHIT">                </span><span class="STRN">"check_values"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1920</span> </span><span class="WHIT">                </span><span class="STRN">"color"</span><span class="PUNC">:</span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1921</span> </span><span class="WHIT">                </span><span class="STRN">"range"</span><span class="PUNC">:</span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1922</span> </span><span class="WHIT">                </span><span class="STRN">"domain"</span><span class="PUNC">:</span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1923</span> </span><span class="WHIT">                </span><span class="STRN">"get"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1924</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1925</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">selection_text</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data_color</span><span class="PUNC">[</span><span class="NAME">idc</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1926</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">color_rule</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selection_text.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1927</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">color_rule_keys</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">color_rule.split</span><span class="PUNC">(</span><span class="STRN">"&"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1928</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">crk</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">crk</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">color_rule_keys.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">crk</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1929</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">color_rule</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">color_rule_keys</span><span class="PUNC">[</span><span class="NAME">crk</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1930</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="REGX">/\d+/</span><span class="PUNC">.</span><span class="NAME">test</span><span class="PUNC">(</span><span class="NAME">color_rule</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1931</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">color_number</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">color_rule.match</span><span class="PUNC">(</span><span class="REGX">/\d+/</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1932</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">color_rule_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">color_rule.split</span><span class="PUNC">(</span><span class="NAME">color_number</span><span class="PUNC">+</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1933</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">color_rule_type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"Helix:"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1934</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_keys.push</span><span class="PUNC">(</span><span class="STRN">"type"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1935</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_values.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"helix"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1936</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_keys.push</span><span class="PUNC">(</span><span class="STRN">"dom_itype"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1937</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_values.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">color_number</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1938</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">color_rule_type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"Loop:"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1939</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_keys.push</span><span class="PUNC">(</span><span class="STRN">"type"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1940</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_values.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"loop"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1941</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_keys.push</span><span class="PUNC">(</span><span class="STRN">"dom_itype"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1942</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_values.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">color_number</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1943</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">color_rule_type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"Id:"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1944</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_keys.push</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1945</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_values.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">color_number</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1946</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Object.keys</span><span class="PUNC">(</span><span class="NAME">one_to_three</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="NAME">color_rule_type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1947</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_keys.push</span><span class="PUNC">(</span><span class="STRN">"res_ind"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1948</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_values.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">color_number</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1949</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_keys.push</span><span class="PUNC">(</span><span class="STRN">"res_1"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1950</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_values.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">color_rule_type</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1951</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Object.keys</span><span class="PUNC">(</span><span class="NAME">three_to_one</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="NAME">color_rule_type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1952</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_keys.push</span><span class="PUNC">(</span><span class="STRN">"res_ind"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1953</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_values.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">color_number</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1954</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_keys.push</span><span class="PUNC">(</span><span class="STRN">"res_3"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1955</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_values.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">color_rule_type</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1956</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">color_rule_type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1957</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_keys.push</span><span class="PUNC">(</span><span class="STRN">"res_ind"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1958</span> </span><span class="WHIT">                        </span><span class="NAME">fillObj.check_values.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">color_number</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1959</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1960</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">color_rule.includes</span><span class="PUNC">(</span><span class="STRN">"Domain:"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1961</span> </span><span class="WHIT">                    </span><span class="NAME">fillObj.check_keys.push</span><span class="PUNC">(</span><span class="STRN">"dom_name"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1962</span> </span><span class="WHIT">                    </span><span class="NAME">fillObj.check_values.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">color_rule.split</span><span class="PUNC">(</span><span class="STRN">"Domain:"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1963</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Object.keys</span><span class="PUNC">(</span><span class="NAME">one_to_three</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="NAME">color_rule</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1964</span> </span><span class="WHIT">                    </span><span class="NAME">fillObj.check_keys.push</span><span class="PUNC">(</span><span class="STRN">"res_1"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1965</span> </span><span class="WHIT">                    </span><span class="NAME">fillObj.check_values.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">color_rule</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1966</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Object.keys</span><span class="PUNC">(</span><span class="NAME">three_to_one</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="NAME">color_rule</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1967</span> </span><span class="WHIT">                    </span><span class="NAME">fillObj.check_keys.push</span><span class="PUNC">(</span><span class="STRN">"res_3"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1968</span> </span><span class="WHIT">                    </span><span class="NAME">fillObj.check_values.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">color_rule</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1969</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">color_rule</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"ALL"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1970</span> </span><span class="WHIT">                    </span><span class="NAME">fillObj.check_keys.push</span><span class="PUNC">(</span><span class="STRN">"res_3"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1971</span> </span><span class="WHIT">                    </span><span class="NAME">fillObj.check_values.push</span><span class="PUNC">(</span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">Object.keys</span><span class="PUNC">(</span><span class="NAME">three_to_one</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1972</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1973</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1974</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">color_to_map</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selection_text.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1975</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">color_to_map.includes</span><span class="PUNC">(</span><span class="STRN">"by:"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1976</span> </span><span class="WHIT">                </span><span class="NAME">fillObj.get</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">color_to_map.split</span><span class="PUNC">(</span><span class="STRN">"by:"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1977</span> </span><span class="WHIT">                </span><span class="NAME">fillObj.range</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selection_text.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">";"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1978</span> </span><span class="WHIT">                </span><span class="NAME">fillObj.domain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selection_text.split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">";"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1979</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1980</span> </span><span class="WHIT">                </span><span class="NAME">fillObj.color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">color_to_map</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1981</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1982</span> </span><span class="WHIT">            </span><span class="NAME">fillRules.push</span><span class="PUNC">(</span><span class="NAME">fillObj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1983</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1984</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1985</span> 
<span class='line'>1986</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1987</span>      * Plots membrane as a rectangle
<span class='line'>1988</span>      * @param {Object} data draw area Object merged to style_obj for drawing membrane
<span class='line'>1989</span>      * @param {String} dataId membrane main g element id attribute 
<span class='line'>1990</span>      * @namespace
<span class='line'>1991</span>      * @exports NaView
<span class='line'>1992</span>      * @name draw_membrane_box
<span class='line'>1993</span>      */</span><span class="WHIT">
<span class='line'>1994</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_membrane_box</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dataId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1995</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">svg_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="STRN">"#"</span><span class="PUNC">+</span><span class="NAME">svg_id</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1996</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1997</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"membrane_group"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1998</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">"rect"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1999</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"x"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"start_x"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2000</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"y"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"start_y"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2001</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"width"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2002</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"height"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"height"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2003</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2004</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2005</span> </span><span class="WHIT">            </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2006</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dataId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2007</span> </span><span class="WHIT">            </span><span class="NAME">svg_element.attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dataId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2008</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2009</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2010</span> 
<span class='line'>2011</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2012</span>      * Generates lipid head related data for drawing ellipses representing the membrane bilayer lipids head grouś
<span class='line'>2013</span>      * @param {number} number_of_lipids total number of lipids to be drawn on a single membrane layer 
<span class='line'>2014</span>      * @param {number} shead_x starting x coordinate of a lipid
<span class='line'>2015</span>      * @param {number} head_y1  starting y coordinate of a lipid in the top bilayer
<span class='line'>2016</span>      * @param {number} head_y2  starting y coordinate of a lipid in the bottom bilayer
<span class='line'>2017</span>      * @param {String} head_fill color of each lipid head
<span class='line'>2018</span>      * @param {number} head_opacity opacity of each lipid head
<span class='line'>2019</span>      * @param {String} head_stroke  stroke color of each lipid head
<span class='line'>2020</span>      * @param {String} head_stroke_s stroke width (px) of each lipid head
<span class='line'>2021</span>      * @param {number} lip_rad lipid head ellipse radii 1
<span class='line'>2022</span>      * @param {number} lip_rad_y  lipid head ellipse radii 1
<span class='line'>2023</span>      * @namespace
<span class='line'>2024</span>      * @exports NaView
<span class='line'>2025</span>      * @name gen_lipid_head_data
<span class='line'>2026</span>      * @yields {Array} list of plot related data for generating lipid head ellipse drawings
<span class='line'>2027</span>      */</span><span class="WHIT">
<span class='line'>2028</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">gen_lipid_head_data</span><span class="PUNC">(</span><span class="NAME">number_of_lipids</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">shead_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">head_y1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">head_y2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">head_fill</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">head_opacity</span><span class="PUNC">,</span><span class="NAME">head_stroke</span><span class="PUNC">,</span><span class="NAME">head_stroke_s</span><span class="PUNC">,</span><span class="NAME">lip_rad</span><span class="PUNC">,</span><span class="NAME">lip_rad_y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2029</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">head_array</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2030</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">lip</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">number_of_lipids</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">lip</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2031</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">head_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lip</span><span class="PUNC">*</span><span class="NAME">lip_rad</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">shead_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2032</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">head_obj1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2033</span> </span><span class="WHIT">                </span><span class="STRN">"cx"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">head_x</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2034</span> </span><span class="WHIT">                </span><span class="STRN">"cy"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">head_y1</span><span class="PUNC">,</span><span class="COMM">//+lip_rad_y,</span><span class="WHIT">
<span class='line'>2035</span> </span><span class="WHIT">                </span><span class="STRN">"r"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">lip_rad</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2036</span> </span><span class="WHIT">                </span><span class="STRN">"rx"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">lip_rad</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2037</span> </span><span class="WHIT">                </span><span class="STRN">"ry"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">lip_rad_y</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2038</span> </span><span class="WHIT">                </span><span class="COMM">// "ry": lip_rad,</span><span class="WHIT">
<span class='line'>2039</span> </span><span class="WHIT">                </span><span class="COMM">// "ry": lip_rad*(svg_height/svg_width),</span><span class="WHIT">
<span class='line'>2040</span> </span><span class="WHIT">                </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">head_fill</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2041</span> </span><span class="WHIT">                </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">head_opacity</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2042</span> </span><span class="WHIT">                </span><span class="STRN">"stroke"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">head_stroke</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2043</span> </span><span class="WHIT">                </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">head_stroke_s</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2044</span> </span><span class="WHIT">                </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"upper"</span><span class="WHIT">
<span class='line'>2045</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2046</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">head_obj2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2047</span> </span><span class="WHIT">                </span><span class="STRN">"cx"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">head_x</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2048</span> </span><span class="WHIT">                </span><span class="STRN">"cy"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">head_y2</span><span class="PUNC">,</span><span class="COMM">//-lip_rad_y,</span><span class="WHIT">
<span class='line'>2049</span> </span><span class="WHIT">                </span><span class="STRN">"r"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">lip_rad</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2050</span> </span><span class="WHIT">                </span><span class="STRN">"rx"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">lip_rad</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2051</span> </span><span class="WHIT">                </span><span class="STRN">"ry"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">lip_rad_y</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2052</span> </span><span class="WHIT">                </span><span class="COMM">// "ry": lip_rad,</span><span class="WHIT">
<span class='line'>2053</span> </span><span class="WHIT">                </span><span class="COMM">// "ry": lip_rad*(svg_height/svg_width),</span><span class="WHIT">
<span class='line'>2054</span> </span><span class="WHIT">                </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">head_fill</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2055</span> </span><span class="WHIT">                </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">head_opacity</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2056</span> </span><span class="WHIT">                </span><span class="STRN">"stroke"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">head_stroke</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2057</span> </span><span class="WHIT">                </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">head_stroke_s</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2058</span> </span><span class="WHIT">                </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"lower"</span><span class="WHIT">
<span class='line'>2059</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2060</span> </span><span class="WHIT">            </span><span class="NAME">head_array.push</span><span class="PUNC">(</span><span class="NAME">head_obj1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2061</span> </span><span class="WHIT">            </span><span class="NAME">head_array.push</span><span class="PUNC">(</span><span class="NAME">head_obj2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2062</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2063</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">head_array</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2064</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2065</span> 
<span class='line'>2066</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2067</span>      * Calculates the y coordinate of a point in the surface of a sphere.
<span class='line'>2068</span>      * This is done given:&lt;br>
<span class='line'>2069</span>      * the x coordinates&lt;br>
<span class='line'>2070</span>      * the ellipse center coordinates &lt;br>
<span class='line'>2071</span>      * the ellipse radii &lt;br>
<span class='line'>2072</span>      * @param {number} gx x coordinate of point at ellipse surface
<span class='line'>2073</span>      * @param {number} cx x coordinate of ellipse center
<span class='line'>2074</span>      * @param {number} cy y coordinate of ellipse center
<span class='line'>2075</span>      * @param {number} rx ellipse radii 1
<span class='line'>2076</span>      * @param {number} ry ellipse radii 2
<span class='line'>2077</span>      * @namespace
<span class='line'>2078</span>      * @exports NaView
<span class='line'>2079</span>      * @name ellipsis_equation_y
<span class='line'>2080</span>      * @yields {number} y coordinate of a point in the surface of a sphere.
<span class='line'>2081</span>      */</span><span class="WHIT">
<span class='line'>2082</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">ellipsis_equation_y</span><span class="PUNC">(</span><span class="NAME">gx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ry</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2083</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">gx</span><span class="PUNC">-</span><span class="NAME">cx</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">rx</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">ry</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">cy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2084</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2085</span> 
<span class='line'>2086</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2087</span>      * Generate lipid tail paths data by calculating tail start and end points.&lt;br>
<span class='line'>2088</span>      * For double lipid tails, it is necessary to find the y coordinates of a point in the surface
<span class='line'>2089</span>      * of the lipid heads ellipse elements.
<span class='line'>2090</span>      * @see ellipsis_equation_y
<span class='line'>2091</span>      * @param {Array} head_data list of plot related data for generating lipid head ellipse drawings
<span class='line'>2092</span>      * @param {number} lipid_tail_number  total number of lipids to be drawn on a single membrane layer 
<span class='line'>2093</span>      * @param {number} lipid_break_num  total number of lipid breaks (not implemented)
<span class='line'>2094</span>      * @param {number} tail_max_length lipid tail total length (px)
<span class='line'>2095</span>      * @param {number} tail_head_dist (deprecated)
<span class='line'>2096</span>      * @param {String} tail_fill color of lipid tail fill
<span class='line'>2097</span>      * @param {number} tail_opacity opacity of lipid tail
<span class='line'>2098</span>      * @param {String} tail_stroke stroke color of lipid tail
<span class='line'>2099</span>      * @param {String} tail_stroke_s stroke size (px) of lipid tail
<span class='line'>2100</span>      * @namespace
<span class='line'>2101</span>      * @exports NaView
<span class='line'>2102</span>      * @name gen_lipid_tail_data
<span class='line'>2103</span>      * @yields {Array} list of plot related data for generating lipid tail path drawings
<span class='line'>2104</span>      */</span><span class="WHIT">
<span class='line'>2105</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">gen_lipid_tail_data</span><span class="PUNC">(</span><span class="NAME">head_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lipid_tail_number</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lipid_break_num</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tail_max_length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tail_head_dist</span><span class="PUNC">,</span><span class="NAME">tail_fill</span><span class="PUNC">,</span><span class="NAME">tail_opacity</span><span class="PUNC">,</span><span class="NAME">tail_stroke</span><span class="PUNC">,</span><span class="NAME">tail_stroke_s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2106</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lipid_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2107</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ihd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ihd</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">head_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ihd</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2108</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">h_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">head_data</span><span class="PUNC">[</span><span class="NAME">ihd</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2109</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lipid_objs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2110</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lipid_tail_number</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2111</span> </span><span class="WHIT">                </span><span class="COMM">//add one lipid tail</span><span class="WHIT">
<span class='line'>2112</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lipid_line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2113</span> </span><span class="WHIT">                    </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tail_fill</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2114</span> </span><span class="WHIT">                    </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tail_opacity</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2115</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tail_stroke</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2116</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tail_stroke_s</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2117</span> </span><span class="WHIT">                    </span><span class="STRN">"coords"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>2118</span> </span><span class="WHIT">                        </span><span class="PUNC">[</span><span class="NAME">h_data.cx</span><span class="PUNC">,</span><span class="NAME">h_data.cy</span><span class="PUNC">+</span><span class="NAME">h_data.ry</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>2119</span> </span><span class="WHIT">                    </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2120</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2121</span> </span><span class="WHIT">                </span><span class="NAME">lipid_objs.push</span><span class="PUNC">(</span><span class="NAME">lipid_line</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2122</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2123</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">one_third_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">h_data.cx</span><span class="PUNC">-</span><span class="NAME">h_data.rx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h_data.rx</span><span class="PUNC">/</span><span class="NUMB">1.8</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2124</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">two_thirds_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">h_data.cx</span><span class="PUNC">+</span><span class="NAME">h_data.rx</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">h_data.rx</span><span class="PUNC">/</span><span class="NUMB">1.8</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2125</span> 
<span class='line'>2126</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">other_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ellipsis_equation_y</span><span class="PUNC">(</span><span class="NAME">one_third_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">h_data.cx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">h_data.cy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">h_data.rx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">h_data.ry</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2127</span> </span><span class="WHIT">                </span><span class="COMM">// let other_y = h_data.cy;</span><span class="WHIT">
<span class='line'>2128</span> </span><span class="WHIT">                </span><span class="COMM">// other_y += (tail_stroke_s)/2;</span><span class="WHIT">
<span class='line'>2129</span> </span><span class="WHIT">                </span><span class="COMM">// other_y += (h_data.stroke_size);</span><span class="WHIT">
<span class='line'>2130</span> </span><span class="WHIT">                </span><span class="COMM">// other_y += Math.sqrt(h_data.stroke_size);</span><span class="WHIT">
<span class='line'>2131</span> 
<span class='line'>2132</span> </span><span class="WHIT">                </span><span class="COMM">//add two lipid tails</span><span class="WHIT">
<span class='line'>2133</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lipid_line1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2134</span> </span><span class="WHIT">                    </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tail_fill</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2135</span> </span><span class="WHIT">                    </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tail_opacity</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2136</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tail_stroke</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2137</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tail_stroke_s</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2138</span> </span><span class="WHIT">                    </span><span class="STRN">"coords"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>2139</span> </span><span class="WHIT">                        </span><span class="PUNC">[</span><span class="NAME">one_third_x</span><span class="PUNC">,</span><span class="NAME">other_y</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>2140</span> </span><span class="WHIT">                    </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2141</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2142</span> </span><span class="WHIT">                </span><span class="NAME">lipid_objs.push</span><span class="PUNC">(</span><span class="NAME">lipid_line1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2143</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lipid_line2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2144</span> </span><span class="WHIT">                    </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tail_fill</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2145</span> </span><span class="WHIT">                    </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tail_opacity</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2146</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tail_stroke</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2147</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tail_stroke_s</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2148</span> </span><span class="WHIT">                    </span><span class="STRN">"coords"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>2149</span> </span><span class="WHIT">                        </span><span class="PUNC">[</span><span class="NAME">two_thirds_x</span><span class="PUNC">,</span><span class="NAME">other_y</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>2150</span> </span><span class="WHIT">                    </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2151</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2152</span> </span><span class="WHIT">                </span><span class="NAME">lipid_objs.push</span><span class="PUNC">(</span><span class="NAME">lipid_line2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2153</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2154</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lipid_break_num</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2155</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">prevy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2156</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">defy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tail_max_length</span><span class="PUNC">/</span><span class="NAME">lipid_break_num</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2157</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ilo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ilo</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">lipid_objs.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ilo</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2158</span> </span><span class="WHIT">                    </span><span class="COMM">//TODO</span><span class="WHIT">
<span class='line'>2159</span> </span><span class="WHIT">                    </span><span class="COMM">//calculate breaks for each lipid tail</span><span class="WHIT">
<span class='line'>2160</span> </span><span class="WHIT">                    </span><span class="COMM">//for each break, move forward xperc then backward x perc</span><span class="WHIT">
<span class='line'>2161</span> </span><span class="WHIT">                    </span><span class="COMM">// lipid_objs[ilo];</span><span class="WHIT">
<span class='line'>2162</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2163</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2164</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2165</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">prevy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2166</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">defy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tail_max_length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2167</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h_data.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"lower"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2168</span> </span><span class="WHIT">                    </span><span class="NAME">prevy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">h_data.ry</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">h_data.stroke_size</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2169</span> </span><span class="WHIT">                    </span><span class="NAME">defy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tail_max_length</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2170</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2171</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ilo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ilo</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">lipid_objs.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ilo</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2172</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">prev_coord</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lipid_objs</span><span class="PUNC">[</span><span class="NAME">ilo</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">coords</span><span class="PUNC">[</span><span class="NAME">lipid_objs</span><span class="PUNC">[</span><span class="NAME">ilo</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">coords.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2173</span> </span><span class="WHIT">                    </span><span class="NAME">prev_coord</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prevy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2174</span> </span><span class="WHIT">                    </span><span class="NAME">lipid_objs</span><span class="PUNC">[</span><span class="NAME">ilo</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">coords.push</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2175</span> </span><span class="WHIT">                        </span><span class="PUNC">[</span><span class="NAME">prev_coord</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">prev_coord</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">defy</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>2176</span> </span><span class="WHIT">                    </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2177</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2178</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2179</span> </span><span class="WHIT">            </span><span class="COMM">//extend lipid_data with each lipid tail line obj;</span><span class="WHIT">
<span class='line'>2180</span> </span><span class="WHIT">            </span><span class="NAME">lipid_data.push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">lipid_objs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2181</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2182</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">lipid_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2183</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2184</span> 
<span class='line'>2185</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2186</span>      * Plots membrane as a lipid bilayer
<span class='line'>2187</span>      * @see gen_lipid_head_data
<span class='line'>2188</span>      * @see gen_lipid_tail_data
<span class='line'>2189</span>      * @param {Object} data data object for membrane draw area object merged to style_obj definitions
<span class='line'>2190</span>      * @param {String} dataId membrane main g element id attribute 
<span class='line'>2191</span>      * @param {number} tail_head_dist deprecated: height ratio between head and tail groups
<span class='line'>2192</span>      * @namespace
<span class='line'>2193</span>      * @exports NaView
<span class='line'>2194</span>      * @name draw_membrane_lipid
<span class='line'>2195</span>      */</span><span class="WHIT">
<span class='line'>2196</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_membrane_lipid</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dataId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tail_head_dist</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2197</span> 
<span class='line'>2198</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lipid_head_radius_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"lipid_head_radius_width"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2199</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ratio_wh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="PUNC">/</span><span class="NAME">svg_width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2200</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lipid_head_radius_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lipid_head_radius_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">ratio_wh</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2201</span> 
<span class='line'>2202</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">number_of_lipids</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"width"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lipid_head_radius_width</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2203</span> </span><span class="WHIT">        
<span class='line'>2204</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">shead_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"start_x"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lipid_head_radius_width</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2205</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">head_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"start_y"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lipid_head_radius_height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2206</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">head_y2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"end_y"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lipid_head_radius_height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2207</span> 
<span class='line'>2208</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">head_fill</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"hfill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2209</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">head_stroke</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"hstroke"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2210</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">head_stroke_s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"hstroke_s"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2211</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">head_opacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"hopacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2212</span> 
<span class='line'>2213</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">head_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">gen_lipid_head_data</span><span class="PUNC">(</span><span class="NAME">number_of_lipids</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">shead_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">head_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">head_y2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">head_fill</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">head_opacity</span><span class="PUNC">,</span><span class="NAME">head_stroke</span><span class="PUNC">,</span><span class="NAME">head_stroke_s</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lipid_head_radius_width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lipid_head_radius_height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2214</span> 
<span class='line'>2215</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">membrane_mid_point</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_drawarea</span><span class="PUNC">[</span><span class="STRN">"height"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2216</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tail_max_length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_drawarea</span><span class="PUNC">[</span><span class="STRN">"membrane_height"</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">lipid_head_radius_height</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">svg_height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"lipid_tail_spacing"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2217</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">tail_head_dist</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2218</span> </span><span class="WHIT">            </span><span class="NAME">tail_head_dist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2219</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2220</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tail_fill</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"tfill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2221</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tail_opacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"topacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2222</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tail_stroke</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"tstroke"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2223</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tail_stroke_s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"tstroke_s"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2224</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tail_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">gen_lipid_tail_data</span><span class="PUNC">(</span><span class="NAME">head_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"lipid_tail_number"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"lipid_tail_breaks"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tail_max_length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tail_head_dist</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tail_fill</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tail_opacity</span><span class="PUNC">,</span><span class="NAME">tail_stroke</span><span class="PUNC">,</span><span class="NAME">tail_stroke_s</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2225</span> 
<span class='line'>2226</span> </span><span class="WHIT">        </span><span class="COMM">//draw membrane heads</span><span class="WHIT">
<span class='line'>2227</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">membrane_group</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="STRN">"#"</span><span class="PUNC">+</span><span class="NAME">svg_id</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2228</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2229</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"membrane_group"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2230</span> 
<span class='line'>2231</span> </span><span class="WHIT">        </span><span class="NAME">membrane_group.append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="STRN">"membrane_heads"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2232</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">selectAll</span><span class="PUNC">(</span><span class="STRN">".lipid_heads"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2233</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="NAME">head_data</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2234</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2235</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">enter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2236</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">enter</span><span class="WHIT">
<span class='line'>2237</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">"ellipse"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2238</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"lipid_heads"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2239</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"cx"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2240</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.cx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2241</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2242</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"cy"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2243</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.cy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2244</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2245</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"rx"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.rx</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2246</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"ry"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.ry</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2247</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.fill</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2248</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2249</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke-width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke_size</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2250</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.opacity</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2251</span> </span><span class="WHIT">                    </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2252</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2253</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2254</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">exit.remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2255</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2256</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2257</span> 
<span class='line'>2258</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tail_lines</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.line</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2259</span> 
<span class='line'>2260</span> </span><span class="WHIT">        </span><span class="NAME">membrane_group.append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="STRN">"membrane_tails"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2261</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">selectAll</span><span class="PUNC">(</span><span class="STRN">".lipid_tails"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2262</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="NAME">tail_data</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2263</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2264</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">enter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2265</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">enter</span><span class="WHIT">
<span class='line'>2266</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2267</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"lipid_tails"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2268</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"d"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2269</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">tail_lines</span><span class="PUNC">(</span><span class="NAME">d.coords</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2270</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2271</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.fill</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2272</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2273</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke-width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke_size</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2274</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.opacity</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2275</span> </span><span class="WHIT">                    </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2276</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2277</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2278</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">exit.remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2279</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2280</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2281</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2282</span> 
<span class='line'>2283</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2284</span>      * Draws membrane object as either a single rectangle (mode box) or as a lipid bilayer
<span class='line'>2285</span>      * @see draw_membrane_box
<span class='line'>2286</span>      * @see draw_membrane_lipid
<span class='line'>2287</span>      * @param {Object} data data object for membrane draw area object merged to style_obj definitions
<span class='line'>2288</span>      * @namespace
<span class='line'>2289</span>      * @exports NaView
<span class='line'>2290</span>      * @name draw_membrane
<span class='line'>2291</span>      */</span><span class="WHIT">
<span class='line'>2292</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_membrane</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2293</span> </span><span class="WHIT">        </span><span class="COMM">//membrane can be box or lipid</span><span class="WHIT">
<span class='line'>2294</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style_obj.membrane.membrane_mode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"box"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2295</span> </span><span class="WHIT">            </span><span class="NAME">draw_membrane_box</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"membrane"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2296</span> </span><span class="WHIT">            </span><span class="COMM">// draw_membrane_box(data, "membrane", "membrane");</span><span class="WHIT">
<span class='line'>2297</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style_obj.membrane.membrane_mode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"lipid"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2298</span> </span><span class="WHIT">            </span><span class="COMM">// draw_membrane_lipid(data, "membrane", "membrane");</span><span class="WHIT">
<span class='line'>2299</span> </span><span class="WHIT">            </span><span class="NAME">draw_membrane_lipid</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"membrane"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2300</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2301</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2302</span> 
<span class='line'>2303</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2304</span>      * Merges data from the user defined style_obj draw_opts to the current residue/element selection
<span class='line'>2305</span>      * @param {String} mergeType element name in the style_obj ("element_name"+draw_opts)
<span class='line'>2306</span>      * @param {Array} data data array for a given element (helices, pores, intra or inter domain loops)
<span class='line'>2307</span>      * @yields {Array} data array for a given element with user defined style_obj draw_opts definitions
<span class='line'>2308</span>      * @namespace
<span class='line'>2309</span>      * @exports NaView
<span class='line'>2310</span>      * @name mergeDrawData
<span class='line'>2311</span>      */</span><span class="WHIT">
<span class='line'>2312</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">mergeDrawData</span><span class="PUNC">(</span><span class="NAME">mergeType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2313</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">drawKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mergeType</span><span class="PUNC">+</span><span class="STRN">"_draw_opts"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2314</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">drawDict</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">drawKey</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2315</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">properties</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Object.keys</span><span class="PUNC">(</span><span class="NAME">drawDict</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2316</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">drawDict.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"dicts"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2317</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2318</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ip</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">properties.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ip</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2319</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">prop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">properties</span><span class="PUNC">[</span><span class="NAME">ip</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2320</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">to_draw</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawDict</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2321</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">to_draw.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"domain_and_name"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2322</span> </span><span class="WHIT">                        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2323</span> </span><span class="WHIT">                        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">itypen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_itype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2324</span> </span><span class="WHIT">                        </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">to_draw</span><span class="PUNC">[</span><span class="NAME">dom</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">itypen</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2325</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">to_draw.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"domain"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2326</span> </span><span class="WHIT">                        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2327</span> </span><span class="WHIT">                        </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">to_draw</span><span class="PUNC">[</span><span class="NAME">dom</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2328</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">to_draw.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"name"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2329</span> </span><span class="WHIT">                        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">itypen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_itype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2330</span> </span><span class="WHIT">                        </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">to_draw</span><span class="PUNC">[</span><span class="NAME">itypen</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2331</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2332</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2333</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2334</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">drawDict.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"single"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2335</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2336</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ip</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">properties.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ip</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2337</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">prop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">properties</span><span class="PUNC">[</span><span class="NAME">ip</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2338</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">prop</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">"type"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2339</span> </span><span class="WHIT">                        </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">drawDict</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2340</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2341</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2342</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2343</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2344</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2345</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2346</span> </span><span class="WHIT">    
<span class='line'>2347</span>     </span><span class="COMM">/**
<span class='line'>2348</span>      * Builds data for each residue for a given element specific (helices, pores, intra or inter domain loops) data array
<span class='line'>2349</span>      * @param {Array} data data array for a given element (helices, pores, intra or inter domain loops)
<span class='line'>2350</span>      * @yields {Array} element specific data array with per residue information now appended
<span class='line'>2351</span>      * @namespace
<span class='line'>2352</span>      * @exports NaView
<span class='line'>2353</span>      * @name createResidData
<span class='line'>2354</span>      */</span><span class="WHIT">
<span class='line'>2355</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">createResidData</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2356</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2357</span> </span><span class="WHIT">            </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">resids</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2358</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">resids</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">aas.split</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2359</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">resid_index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">start</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2360</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ir</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ir</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">resids.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ir</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2361</span> </span><span class="WHIT">                </span><span class="NAME">resid_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2362</span> </span><span class="WHIT">                    </span><span class="STRN">"res_1"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">resids</span><span class="PUNC">[</span><span class="NAME">ir</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2363</span> </span><span class="WHIT">                    </span><span class="STRN">"res_3"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">one_to_three</span><span class="PUNC">[</span><span class="NAME">resids</span><span class="PUNC">[</span><span class="NAME">ir</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2364</span> </span><span class="WHIT">                    </span><span class="STRN">"res_ind"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">resid_index</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2365</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2366</span> </span><span class="WHIT">                </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">resids.push</span><span class="PUNC">(</span><span class="NAME">resid_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2367</span> </span><span class="WHIT">                </span><span class="NAME">resid_index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2368</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2369</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2370</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2371</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">    
<span class='line'>2372</span> 
<span class='line'>2373</span>     </span><span class="COMM">/**
<span class='line'>2374</span>      * Calculates helix residue ordering based on loops intracellular or extracellular positioning
<span class='line'>2375</span>      * @param {Array} helices_data helices data generated from processRawUniProt
<span class='line'>2376</span>      * @param {Array} all_loop_data all loop data generated from processRawUniProt
<span class='line'>2377</span>      * @namespace
<span class='line'>2378</span>      * @exports NaView
<span class='line'>2379</span>      * @name calculateResidOrientation 
<span class='line'>2380</span>      * @yields {Array} helices data generated from processRawUniProt with additional residue orientation variable
<span class='line'>2381</span>      */</span><span class="WHIT">
<span class='line'>2382</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">calculateResidOrientation</span><span class="PUNC">(</span><span class="NAME">helices_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">all_loop_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2383</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">all_loop_data_by_domain_position</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">all_loop_data.reduce</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">reduce_dict</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2384</span> </span><span class="WHIT">            </span><span class="NAME">reduce_dict</span><span class="PUNC">[</span><span class="NAME">a.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2385</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">reduce_dict</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2386</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2387</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ihd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ihd</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">helices_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ihd</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2388</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">previous_loop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">all_loop_data_by_domain_position</span><span class="PUNC">[</span><span class="NAME">helices_data</span><span class="PUNC">[</span><span class="NAME">ihd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2389</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">previous_loop.note</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"Cytoplasmic"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2390</span> </span><span class="WHIT">                </span><span class="NAME">helices_data</span><span class="PUNC">[</span><span class="NAME">ihd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">inverted</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2391</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2392</span> </span><span class="WHIT">                </span><span class="NAME">helices_data</span><span class="PUNC">[</span><span class="NAME">ihd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">inverted</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2393</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2394</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2395</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">helices_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2396</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2397</span> 
<span class='line'>2398</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2399</span>      * Calculates centroid points of each residue and loop/helix elements in plot and stores it in global variable
<span class='line'>2400</span>      * @namespace
<span class='line'>2401</span>      * @exports NaView
<span class='line'>2402</span>      * @name createResidElementToCentroidData 
<span class='line'>2403</span>      */</span><span class="WHIT">
<span class='line'>2404</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">createResidElementToCentroidData</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2405</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">residueCentroidDict</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2406</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">all_residue_paths</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.selectAll</span><span class="PUNC">(</span><span class="STRN">".single_residue_path"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2407</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">done_resind</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2408</span> </span><span class="WHIT">        </span><span class="NAME">all_residue_paths.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2409</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">resname</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"resname"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2410</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">res_ind</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d.res_ind</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2411</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">done_resind.indexOf</span><span class="PUNC">(</span><span class="NAME">d.res_ind</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2412</span> </span><span class="WHIT">                </span><span class="NAME">done_resind.push</span><span class="PUNC">(</span><span class="NAME">d.res_ind</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2413</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2414</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">residueCentroidDict.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">res_ind</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2415</span> </span><span class="WHIT">                </span><span class="NAME">residueCentroidDict</span><span class="PUNC">[</span><span class="NAME">res_ind</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"path_data"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2416</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">old_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">residueCentroidDict</span><span class="PUNC">[</span><span class="NAME">res_ind</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"point"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2417</span> </span><span class="WHIT">                </span><span class="NAME">residueCentroidDict</span><span class="PUNC">[</span><span class="NAME">res_ind</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"point"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>2418</span> </span><span class="WHIT">                    </span><span class="PUNC">(</span><span class="NAME">old_centroid</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">d.centroid</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2419</span> </span><span class="WHIT">                    </span><span class="PUNC">(</span><span class="NAME">old_centroid</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">d.centroid</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2420</span> </span><span class="WHIT">                </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2421</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2422</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">to_dict_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2423</span> </span><span class="WHIT">                    </span><span class="STRN">"res_ind"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">res_ind</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2424</span> </span><span class="WHIT">                    </span><span class="STRN">"resname"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">resname</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2425</span> </span><span class="WHIT">                    </span><span class="STRN">"path_data"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2426</span> </span><span class="WHIT">                    </span><span class="STRN">"point"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">d.centroid</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2427</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2428</span> </span><span class="WHIT">                </span><span class="NAME">to_dict_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mergeDrawData</span><span class="PUNC">(</span><span class="STRN">"residue_centroid"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">to_dict_obj</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2429</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">ky</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2430</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">ky</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">to_dict_obj.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">ky</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2431</span> </span><span class="WHIT">                        </span><span class="NAME">to_dict_obj</span><span class="PUNC">[</span><span class="NAME">ky</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">ky</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2432</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2433</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2434</span> </span><span class="WHIT">                </span><span class="NAME">residueCentroidDict</span><span class="PUNC">[</span><span class="NAME">res_ind</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">to_dict_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2435</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2436</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2437</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">all_element_paths</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.selectAll</span><span class="PUNC">(</span><span class="STRN">".element_path_group"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2438</span> </span><span class="WHIT">        </span><span class="NAME">all_element_paths.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2439</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">elname</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2440</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">element_centroid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2441</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"helix"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2442</span> </span><span class="WHIT">                </span><span class="NAME">elname</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Domain"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="NAME">d.dom_name</span><span class="PUNC">+</span><span class="STRN">";Helix"</span><span class="PUNC">+</span><span class="NAME">d.dom_itype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2443</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helix_bbox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getBBox</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2444</span> </span><span class="WHIT">                </span><span class="NAME">element_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">helix_bbox.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">helix_bbox.width</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">helix_bbox.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">helix_bbox.height</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2445</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"pore"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2446</span> </span><span class="WHIT">                </span><span class="NAME">elname</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Domain"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="NAME">d.dom_name</span><span class="PUNC">+</span><span class="STRN">";Pore"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2447</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">pathg_bbox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getBBox</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2448</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">path_half_length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">select</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">node</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTotalLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2449</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">center_of_path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">select</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">node</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getPointAtLength</span><span class="PUNC">(</span><span class="NAME">path_half_length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2450</span> </span><span class="WHIT">                </span><span class="NAME">element_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">center_of_path.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center_of_path.y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2451</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_deviation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pathg_bbox.height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">0.4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2452</span> </span><span class="WHIT">                </span><span class="COMM">// let y_deviation = viewport_height * 0.05;</span><span class="WHIT">
<span class='line'>2453</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pathg_bbox.y</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">svg_height</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2454</span> </span><span class="WHIT">                    </span><span class="NAME">y_deviation</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2455</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2456</span> </span><span class="WHIT">                </span><span class="NAME">element_centroid</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y_deviation</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2457</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"loop"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">d.dom_name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2458</span> </span><span class="WHIT">                </span><span class="NAME">elname</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Domain"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="NAME">d.dom_name</span><span class="PUNC">+</span><span class="STRN">";Loop"</span><span class="PUNC">+</span><span class="NAME">d.dom_itype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2459</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">pathg_bbox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getBBox</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2460</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">path_half_length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">select</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">node</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTotalLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2461</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">center_of_path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">select</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">node</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getPointAtLength</span><span class="PUNC">(</span><span class="NAME">path_half_length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2462</span> </span><span class="WHIT">                </span><span class="NAME">element_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">center_of_path.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center_of_path.y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2463</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_deviation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pathg_bbox.height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">0.4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2464</span> </span><span class="WHIT">                </span><span class="COMM">// let y_deviation = viewport_height * 0.05;</span><span class="WHIT">
<span class='line'>2465</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pathg_bbox.y</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">svg_height</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2466</span> </span><span class="WHIT">                    </span><span class="NAME">y_deviation</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2467</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2468</span> </span><span class="WHIT">                </span><span class="NAME">element_centroid</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y_deviation</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2469</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2470</span> </span><span class="WHIT">                </span><span class="NAME">elname</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"InterDomain"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="NAME">d.dom_iname</span><span class="PUNC">+</span><span class="STRN">";Loop"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2471</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">pathg_bbox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getBBox</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2472</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">path_half_length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">select</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">node</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTotalLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2473</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">center_of_path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">select</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">node</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getPointAtLength</span><span class="PUNC">(</span><span class="NAME">path_half_length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2474</span> </span><span class="WHIT">                </span><span class="NAME">element_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">center_of_path.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center_of_path.y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2475</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_deviation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pathg_bbox.height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">0.4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2476</span> </span><span class="WHIT">                </span><span class="COMM">// let y_deviation = viewport_height * 0.05;</span><span class="WHIT">
<span class='line'>2477</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pathg_bbox.y</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">svg_height</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2478</span> </span><span class="WHIT">                    </span><span class="NAME">y_deviation</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2479</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2480</span> </span><span class="WHIT">                </span><span class="NAME">element_centroid</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y_deviation</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2481</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2482</span> </span><span class="WHIT">            </span><span class="COMM">// console.log(elname);</span><span class="WHIT">
<span class='line'>2483</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">to_dict_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2484</span> </span><span class="WHIT">                </span><span class="STRN">"el_ind"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">d.id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2485</span> </span><span class="WHIT">                </span><span class="STRN">"elname"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">elname</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2486</span> </span><span class="WHIT">                </span><span class="STRN">"path_data"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2487</span> </span><span class="WHIT">                </span><span class="STRN">"point"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">element_centroid</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2488</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2489</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">new_to_dict_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mergeDrawData</span><span class="PUNC">(</span><span class="STRN">"residue_centroid"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">to_dict_obj</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2490</span> </span><span class="WHIT">            </span><span class="NAME">new_to_dict_obj</span><span class="PUNC">[</span><span class="STRN">"circle_radius"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"5px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2491</span> </span><span class="WHIT">            </span><span class="NAME">residueCentroidDict</span><span class="PUNC">[</span><span class="NAME">elname</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">new_to_dict_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2492</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2493</span> </span><span class="WHIT">        </span><span class="COMM">// DONE: calculate each path element (helix_group, loop path, etc) centroid and anchor pts</span><span class="WHIT">
<span class='line'>2494</span> </span><span class="WHIT">        </span><span class="COMM">// for helices it is center of membrane</span><span class="WHIT">
<span class='line'>2495</span> </span><span class="WHIT">        </span><span class="COMM">// for loop it is point at 0.5 length of loop -/+ perc of height for y (right below)</span><span class="WHIT">
<span class='line'>2496</span> </span><span class="WHIT">        </span><span class="COMM">// console.log("residueCentroidDict");</span><span class="WHIT">
<span class='line'>2497</span> </span><span class="WHIT">        </span><span class="COMM">// console.log(residueCentroidDict);</span><span class="WHIT">
<span class='line'>2498</span> </span><span class="WHIT">        </span><span class="COMM">// plotDotsCircles(Object.values(residueCentroidDict), "residue_centroids", "residue_centroids_circles");</span><span class="WHIT">
<span class='line'>2499</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">residueCentroidDict</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2500</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2501</span> 
<span class='line'>2502</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2503</span>      * Calculate short loop x,y anchors of element based on previously drawn elements
<span class='line'>2504</span>      * @namespace
<span class='line'>2505</span>      * @exports NaView
<span class='line'>2506</span>      * @name gen_shortloop_anchordata 
<span class='line'>2507</span>      * @param {Array} short_loop_data intradomain short loop data generated from processRawUniProt 
<span class='line'>2508</span>      * @param {Array} helices_pores_data helices and pore loop data generated from processRawUniProt 
<span class='line'>2509</span>      * @yields {Array} intradomain short loop data generated from processRawUniProt with additional x,y helix anchors
<span class='line'>2510</span>      */</span><span class="WHIT">
<span class='line'>2511</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">gen_shortloop_anchordata</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">helices_pores_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2512</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helices_and_pores_by_domain_position</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helices_pores_data.reduce</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">reduce_dict</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2513</span> </span><span class="WHIT">            </span><span class="NAME">reduce_dict</span><span class="PUNC">[</span><span class="NAME">a.dom_name</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">a.dom_i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2514</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">reduce_dict</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2515</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2516</span> 
<span class='line'>2517</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isld</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">isld</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">short_loop_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">isld</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2518</span> </span><span class="WHIT">            </span><span class="COMM">// const element = array[isld];</span><span class="WHIT">
<span class='line'>2519</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">short_loop_dom_name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2520</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">short_loop_dom_i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2521</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">short_loop_side</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">note</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2522</span> </span><span class="WHIT">            </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2523</span> </span><span class="WHIT">                </span><span class="STRN">"p1"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2524</span> </span><span class="WHIT">                </span><span class="STRN">"p2"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT">
<span class='line'>2525</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2526</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">previous_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helices_and_pores_by_domain_position</span><span class="PUNC">[</span><span class="NAME">short_loop_dom_name</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">short_loop_dom_i</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2527</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">next_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helices_and_pores_by_domain_position</span><span class="PUNC">[</span><span class="NAME">short_loop_dom_name</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">short_loop_dom_i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2528</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">previous_element.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"pore"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2529</span> </span><span class="WHIT">                </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">previous_element.draw_area.end_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previous_element.draw_area.start_y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2530</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2531</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">short_loop_side</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"Extracellular"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2532</span> </span><span class="WHIT">                    </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">previous_element.anchor.top</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2533</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">  </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2534</span> </span><span class="WHIT">                    </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">previous_element.anchor.bottom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2535</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2536</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2537</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">next_element.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"pore"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2538</span> </span><span class="WHIT">                </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">next_element.draw_area.start_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previous_element.draw_area.start_y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2539</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2540</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">short_loop_side</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"Extracellular"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2541</span> </span><span class="WHIT">                    </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">next_element.anchor.top</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2542</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">  </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2543</span> </span><span class="WHIT">                    </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">next_element.anchor.bottom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2544</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2545</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2546</span> </span><span class="WHIT">            </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.dist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">euclideanDistance</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2547</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2548</span> </span><span class="WHIT">    </span><span class="COMM">//     calc_len</span><span class="WHIT">
<span class='line'>2549</span> </span><span class="WHIT">    </span><span class="COMM">// shape</span><span class="WHIT">
<span class='line'>2550</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2551</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2552</span> 
<span class='line'>2553</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2554</span>      * Calculate pore loop x,y anchors of element based on previously drawn elements
<span class='line'>2555</span>      * @namespace
<span class='line'>2556</span>      * @exports NaView
<span class='line'>2557</span>      * @name gen_poreloop_anchordata 
<span class='line'>2558</span>      * @param {Array} pores_data pore loop data generated from processRawUniProt 
<span class='line'>2559</span>      * @param {Array} short_loop_data intradomain short loop data generated from processRawUniProt 
<span class='line'>2560</span>      * @yields {Array} intradomain pore loop data generated from processRawUniProt with additional x,y short loop anchors
<span class='line'>2561</span>      */</span><span class="WHIT">
<span class='line'>2562</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">gen_poreloop_anchordata</span><span class="PUNC">(</span><span class="NAME">pores_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2563</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">short_loop_by_domain_position</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_data.reduce</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">reduce_dict</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2564</span> </span><span class="WHIT">            </span><span class="NAME">reduce_dict</span><span class="PUNC">[</span><span class="NAME">a.dom_name</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">a.dom_i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2565</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">reduce_dict</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2566</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2567</span> 
<span class='line'>2568</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ipd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ipd</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">pores_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ipd</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2569</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">pore_dom_name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2570</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">pore_dom_i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2571</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">pore_side</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">note</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2572</span> </span><span class="WHIT">            </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2573</span> </span><span class="WHIT">                </span><span class="STRN">"p1"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2574</span> </span><span class="WHIT">                </span><span class="STRN">"p2"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT">
<span class='line'>2575</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2576</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">previous_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_by_domain_position</span><span class="PUNC">[</span><span class="NAME">pore_dom_name</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">pore_dom_i</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2577</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">next_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_by_domain_position</span><span class="PUNC">[</span><span class="NAME">pore_dom_name</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">pore_dom_i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2578</span> </span><span class="WHIT">            </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">previous_element.anchorage.p2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2579</span> </span><span class="WHIT">            </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">next_element.anchorage.p1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2580</span> </span><span class="WHIT">            </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.dist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">euclideanDistance</span><span class="PUNC">(</span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2581</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2582</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2583</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2584</span> 
<span class='line'>2585</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2586</span>      * Calculate interdomain loop x,y anchors of element based on previously drawn elements
<span class='line'>2587</span>      * @namespace
<span class='line'>2588</span>      * @exports NaView
<span class='line'>2589</span>      * @name gen_longloop_anchordata 
<span class='line'>2590</span>      * @param {Array} longloop_data interdomain loop data generated from processRawUniProt 
<span class='line'>2591</span>      * @param {Array} helices_data helices data generated from processRawUniProt 
<span class='line'>2592</span>      * @yields {Array} interdomain long loop data generated from processRawUniProt with additional x,y helix anchors
<span class='line'>2593</span>      */</span><span class="WHIT">
<span class='line'>2594</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">gen_longloop_anchordata</span><span class="PUNC">(</span><span class="NAME">longloop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">helices_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2595</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helices_by_domain_position</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helices_data.reduce</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">reduce_dict</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2596</span> </span><span class="WHIT">            </span><span class="NAME">reduce_dict</span><span class="PUNC">[</span><span class="NAME">a.dom_name</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">a.dom_i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2597</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">reduce_dict</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2598</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2599</span> 
<span class='line'>2600</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">last_dom_index_by_name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2601</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ihd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ihd</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">helices_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ihd</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2602</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">last_dom_index_by_name.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">helices_data</span><span class="PUNC">[</span><span class="NAME">ihd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2603</span> </span><span class="WHIT">                </span><span class="NAME">last_dom_index_by_name</span><span class="PUNC">[</span><span class="NAME">helices_data</span><span class="PUNC">[</span><span class="NAME">ihd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helices_data</span><span class="PUNC">[</span><span class="NAME">ihd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2604</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">helices_data</span><span class="PUNC">[</span><span class="NAME">ihd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_i</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">last_dom_index_by_name</span><span class="PUNC">[</span><span class="NAME">helices_data</span><span class="PUNC">[</span><span class="NAME">ihd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_name</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2605</span> </span><span class="WHIT">                </span><span class="NAME">last_dom_index_by_name</span><span class="PUNC">[</span><span class="NAME">helices_data</span><span class="PUNC">[</span><span class="NAME">ihd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helices_data</span><span class="PUNC">[</span><span class="NAME">ihd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2606</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2607</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2608</span> 
<span class='line'>2609</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">illd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">illd</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">longloop_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">illd</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2610</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">prev_dom_name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">longloop_data</span><span class="PUNC">[</span><span class="NAME">illd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">prev_dom_name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2611</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">next_dom_name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">longloop_data</span><span class="PUNC">[</span><span class="NAME">illd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">next_dom_name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2612</span> </span><span class="WHIT">            </span><span class="NAME">longloop_data</span><span class="PUNC">[</span><span class="NAME">illd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2613</span> </span><span class="WHIT">                </span><span class="STRN">"p1"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2614</span> </span><span class="WHIT">                </span><span class="STRN">"p2"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT">
<span class='line'>2615</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2616</span> </span><span class="WHIT">            </span><span class="COMM">// let previous_element = helices_by_domain_position[prev_dom_name+"_"+1];</span><span class="WHIT">
<span class='line'>2617</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">previous_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helices_by_domain_position</span><span class="PUNC">[</span><span class="NAME">prev_dom_name</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">last_dom_index_by_name</span><span class="PUNC">[</span><span class="NAME">prev_dom_name</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2618</span> </span><span class="WHIT">            </span><span class="COMM">// let next_element = helices_by_domain_position[next_dom_name+"_"+last_dom_index_by_name[next_dom_name]];</span><span class="WHIT">
<span class='line'>2619</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">next_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helices_by_domain_position</span><span class="PUNC">[</span><span class="NAME">next_dom_name</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2620</span> </span><span class="WHIT">            </span><span class="NAME">longloop_data</span><span class="PUNC">[</span><span class="NAME">illd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">previous_element.anchor.bottom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2621</span> </span><span class="WHIT">            </span><span class="NAME">longloop_data</span><span class="PUNC">[</span><span class="NAME">illd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">next_element.anchor.bottom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2622</span> </span><span class="WHIT">            </span><span class="NAME">longloop_data</span><span class="PUNC">[</span><span class="NAME">illd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.dist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">euclideanDistance</span><span class="PUNC">(</span><span class="NAME">longloop_data</span><span class="PUNC">[</span><span class="NAME">illd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">longloop_data</span><span class="PUNC">[</span><span class="NAME">illd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2623</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2624</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">longloop_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2625</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2626</span> </span><span class="WHIT">    
<span class='line'>2627</span>     </span><span class="COMM">/**
<span class='line'>2628</span>      * Calculate termini x,y anchors of element based on previously drawn elements
<span class='line'>2629</span>      * @namespace
<span class='line'>2630</span>      * @exports NaView
<span class='line'>2631</span>      * @name gen_termini_anchordata 
<span class='line'>2632</span>      * @param {Object} termini_data termini loop data generated from processRawUniProt 
<span class='line'>2633</span>      * @param {Object} neighboring_helix neighbouring termini helix data generated from processRawUniProt
<span class='line'>2634</span>      * @param {String} termini_type "N" or "C" for N-terminal or C-terminal loop
<span class='line'>2635</span>      * @yields {Object} termini loop data generated from processRawUniProt with additional x,y helix anchors
<span class='line'>2636</span>      */</span><span class="WHIT">
<span class='line'>2637</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">gen_termini_anchordata</span><span class="PUNC">(</span><span class="NAME">termini_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">neighboring_helix</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">termini_type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2638</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">current_point</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2639</span> </span><span class="WHIT">        </span><span class="NAME">termini_data.terminus_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">termini_type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2640</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">termini_type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"N"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2641</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style_obj.protein.nter_loop_draw_opts.calc_len.calc.start_loop</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"membrane"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2642</span> </span><span class="WHIT">                </span><span class="NAME">current_point</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">termini_data.draw_area.start_x</span><span class="PUNC">,</span><span class="NAME">termini_data.draw_area.start_y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2643</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style_obj.protein.nter_loop_draw_opts.calc_len.calc.start_loop</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"edge"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2644</span> </span><span class="WHIT">                </span><span class="NAME">current_point</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">termini_data.draw_area.start_x</span><span class="PUNC">,</span><span class="NAME">termini_data.draw_area.end_y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2645</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2646</span> </span><span class="WHIT">            </span><span class="NAME">termini_data.anchorage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2647</span> </span><span class="WHIT">                </span><span class="STRN">"p1"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">current_point</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2648</span> </span><span class="WHIT">                </span><span class="STRN">"p2"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">neighboring_helix.anchor.bottom</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2649</span> </span><span class="WHIT">                </span><span class="STRN">"dist"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">euclideanDistance</span><span class="PUNC">(</span><span class="NAME">current_point</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">neighboring_helix.anchor.bottom</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2650</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2651</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2652</span> </span><span class="WHIT">            </span><span class="COMM">// current_point = [termini_data.draw_area.end_x,termini_data.draw_area.end_y];</span><span class="WHIT">
<span class='line'>2653</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style_obj.protein.cter_loop_draw_opts.calc_len.calc.start_loop</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"membrane"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2654</span> </span><span class="WHIT">                </span><span class="NAME">current_point</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">termini_data.draw_area.end_x</span><span class="PUNC">,</span><span class="NAME">termini_data.draw_area.start_y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2655</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style_obj.protein.cter_loop_draw_opts.calc_len.calc.start_loop</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"edge"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2656</span> </span><span class="WHIT">                </span><span class="NAME">current_point</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">termini_data.draw_area.end_x</span><span class="PUNC">,</span><span class="NAME">termini_data.draw_area.end_y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2657</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2658</span> </span><span class="WHIT">            </span><span class="NAME">termini_data.anchorage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2659</span> </span><span class="WHIT">                </span><span class="STRN">"p1"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">neighboring_helix.anchor.bottom</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2660</span> </span><span class="WHIT">                </span><span class="STRN">"p2"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">current_point</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2661</span> </span><span class="WHIT">                </span><span class="STRN">"dist"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">euclideanDistance</span><span class="PUNC">(</span><span class="NAME">current_point</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">neighboring_helix.anchor.bottom</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2662</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2663</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2664</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">termini_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2665</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2666</span> 
<span class='line'>2667</span> 
<span class='line'>2668</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2669</span>      * Generates a d3.scaleLinear color scale from user inputted color filling rules that use a
<span class='line'>2670</span>      * ",by:property,domain,range" syntax.
<span class='line'>2671</span>      * @see createFillRules
<span class='line'>2672</span>      * @param {String} fillproperty residue property name to map color scale to
<span class='line'>2673</span>      * @param {Array} fillrange fill scale linear color range
<span class='line'>2674</span>      * @param {Array} filldomain fill scale linear color domain. "min" and "max" strings are properly parsed
<span class='line'>2675</span>      * @yields {Function} d3.scaleLinear for a color scale of the desired range and domain
<span class='line'>2676</span>      * @namespace
<span class='line'>2677</span>      * @exports NaView
<span class='line'>2678</span>      * @name createFillScale 
<span class='line'>2679</span>      */</span><span class="WHIT">
<span class='line'>2680</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">createFillScale</span><span class="PUNC">(</span><span class="NAME">fillproperty</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fillrange</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">filldomain</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2681</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">prop_values</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2682</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">scale_min</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">filldomain</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2683</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">scale_min</span><span class="PUNC">+</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">includes</span><span class="PUNC">(</span><span class="STRN">"min"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2684</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">min_res</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.min</span><span class="PUNC">(</span><span class="NAME">Object.keys</span><span class="PUNC">(</span><span class="NAME">current_resid_properties</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2685</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">max_res</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.min</span><span class="PUNC">(</span><span class="NAME">Object.keys</span><span class="PUNC">(</span><span class="NAME">current_resid_properties</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2686</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i_res</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">min_res</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i_res</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">max_res</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i_res</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2687</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">prop_value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current_resid_properties</span><span class="PUNC">[</span><span class="NAME">i_res</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">fillproperty</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2688</span> </span><span class="WHIT">                </span><span class="NAME">prop_values.push</span><span class="PUNC">(</span><span class="NAME">prop_value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2689</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2690</span> </span><span class="WHIT">            </span><span class="NAME">scale_min</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.min</span><span class="PUNC">(</span><span class="NAME">prop_values</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2691</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2692</span> </span><span class="WHIT">        </span><span class="NAME">filldomain</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scale_min</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2693</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">scale_max</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">filldomain</span><span class="PUNC">[</span><span class="NAME">filldomain.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2694</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">scale_max</span><span class="PUNC">+</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">includes</span><span class="PUNC">(</span><span class="STRN">"max"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2695</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">prop_values.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2696</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">min_res</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.min</span><span class="PUNC">(</span><span class="NAME">Object.keys</span><span class="PUNC">(</span><span class="NAME">current_resid_properties</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2697</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">max_res</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.min</span><span class="PUNC">(</span><span class="NAME">Object.keys</span><span class="PUNC">(</span><span class="NAME">current_resid_properties</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2698</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i_res</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">min_res</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i_res</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">max_res</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i_res</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2699</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">prop_value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current_resid_properties</span><span class="PUNC">[</span><span class="NAME">i_res</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">fillproperty</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2700</span> </span><span class="WHIT">                    </span><span class="NAME">prop_values.push</span><span class="PUNC">(</span><span class="NAME">prop_value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2701</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2702</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2703</span> </span><span class="WHIT">            </span><span class="NAME">scale_max</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.max</span><span class="PUNC">(</span><span class="NAME">prop_values</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2704</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2705</span> </span><span class="WHIT">        </span><span class="NAME">filldomain</span><span class="PUNC">[</span><span class="NAME">filldomain.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scale_max</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2706</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d3.scaleLinear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2707</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">domain</span><span class="PUNC">(</span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">filldomain</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2708</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">range</span><span class="PUNC">(</span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">fillrange</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2709</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2710</span> </span><span class="WHIT">    
<span class='line'>2711</span>     </span><span class="COMM">/**
<span class='line'>2712</span>      * Parses fillRules global object checking if object meets any rule criteria.&lt;br>
<span class='line'>2713</span>      * If so, the appropriate color/color scale is then returned.
<span class='line'>2714</span>      * @param {String} data_obj Helix/pore/loop element current datum
<span class='line'>2715</span>      * @yields false or a rgb/hex/named color. opacity check currently deprecated
<span class='line'>2716</span>      * @namespace
<span class='line'>2717</span>      * @exports NaView
<span class='line'>2718</span>      * @name checkFillResidue 
<span class='line'>2719</span>      */</span><span class="WHIT">
<span class='line'>2720</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">data_obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2721</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">this_residue_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2722</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">get_value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2723</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">each_rule_index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">each_rule_index</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">fillRules.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">each_rule_index</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2724</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">current_rule</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fillRules</span><span class="PUNC">[</span><span class="NAME">each_rule_index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2725</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">fillproperty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current_rule.get</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2726</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">fillrange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current_rule.range</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2727</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">filldomain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current_rule.domain</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2728</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">colorFunction</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2729</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">current_rule.get</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2730</span> </span><span class="WHIT">                </span><span class="NAME">colorFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createFillScale</span><span class="PUNC">(</span><span class="NAME">fillproperty</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fillrange</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">filldomain</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2731</span> </span><span class="WHIT">                </span><span class="NAME">get_value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current_resid_properties</span><span class="PUNC">[</span><span class="NAME">data_obj.res_ind</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">fillproperty</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2732</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2733</span> </span><span class="WHIT">                </span><span class="NAME">colorFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">etc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2734</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">current_rule.color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2735</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2736</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2737</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">current_rule_keys_to_check</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current_rule.check_keys</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2738</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">color_this_residue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2739</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">check_key_index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">check_key_index</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">current_rule_keys_to_check.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">check_key_index</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2740</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">check_key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current_rule_keys_to_check</span><span class="PUNC">[</span><span class="NAME">check_key_index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2741</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">check_values</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current_rule.check_values</span><span class="PUNC">[</span><span class="NAME">check_key_index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2742</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">check_values.indexOf</span><span class="PUNC">(</span><span class="NAME">data_obj</span><span class="PUNC">[</span><span class="NAME">check_key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2743</span> </span><span class="WHIT">                    </span><span class="NAME">color_this_residue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2744</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">  </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2745</span> </span><span class="WHIT">                    </span><span class="NAME">color_this_residue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2746</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2747</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2748</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2749</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">color_this_residue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2750</span> </span><span class="WHIT">                </span><span class="NAME">this_residue_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">colorFunction</span><span class="PUNC">(</span><span class="NAME">get_value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2751</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2752</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2753</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">this_residue_color</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//color, opacity</span><span class="WHIT">
<span class='line'>2754</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2755</span> 
<span class='line'>2756</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2757</span>      * Creates single rectangle SVG elements for each residue of a rectangle helix.
<span class='line'>2758</span>      * @param {D3 Selection} enter_element d3 selection element containing drawn plot helices
<span class='line'>2759</span>      * @namespace
<span class='line'>2760</span>      * @exports NaView
<span class='line'>2761</span>      * @name draw_helices_resids_box 
<span class='line'>2762</span>      */</span><span class="WHIT">
<span class='line'>2763</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_helices_resids_box</span><span class="PUNC">(</span><span class="NAME">enter_element</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2764</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">g_helix_resids</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">enter_element.append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2765</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2766</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"g_helix_resids_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.dom_name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.dom_itype</span><span class="WHIT">
<span class='line'>2767</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2768</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"g_helix_resids residue_path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2769</span> </span><span class="WHIT">        </span><span class="COMM">// .style("display", "none")</span><span class="WHIT">
<span class='line'>2770</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">style</span><span class="PUNC">(</span><span class="STRN">"visibility"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"hidden"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2771</span> </span><span class="WHIT">    
<span class='line'>2772</span>         </span><span class="NAME">g_helix_resids.selectAll</span><span class="PUNC">(</span><span class="PUNC">+</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">pd</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2773</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">".helices_rect_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">pd.dom_name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">pd.dom_itype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2774</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2775</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">pd</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2776</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aa_array</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pd.aas.split</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2777</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aa_indarray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rangeArray</span><span class="PUNC">(</span><span class="NAME">pd.aas.length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pd.start</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2778</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pd.inverted</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2779</span> </span><span class="WHIT">                </span><span class="NAME">aa_array.reverse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2780</span> </span><span class="WHIT">                </span><span class="NAME">aa_indarray.reverse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2781</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2782</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">height_per_aa</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pd.draw_area.height</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">aa_array.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2783</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">d_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2784</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">iaaa</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iaaa</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aa_array.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iaaa</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2785</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aa1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aa_array</span><span class="PUNC">[</span><span class="NAME">iaaa</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2786</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aa3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">one_to_three</span><span class="PUNC">[</span><span class="NAME">aa_array</span><span class="PUNC">[</span><span class="NAME">iaaa</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2787</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aai</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aa_indarray</span><span class="PUNC">[</span><span class="NAME">iaaa</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2788</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">start_x1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pd.draw_area.start_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2789</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">start_y1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pd.draw_area.start_y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">height_per_aa</span><span class="PUNC">*</span><span class="NAME">iaaa</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2790</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">width1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pd.draw_area.width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2791</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">height1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">height_per_aa</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2792</span> </span><span class="WHIT">                </span><span class="NAME">d_data.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2793</span> </span><span class="WHIT">                    </span><span class="STRN">"id"</span><span class="PUNC">:</span><span class="NAME">pd.id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2794</span> </span><span class="WHIT">                    </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="NAME">pd.type</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2795</span> </span><span class="WHIT">                    </span><span class="STRN">"dom_name"</span><span class="PUNC">:</span><span class="NAME">pd.dom_name</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2796</span> </span><span class="WHIT">                    </span><span class="STRN">"dom_itype"</span><span class="PUNC">:</span><span class="NAME">pd.dom_itype</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2797</span> </span><span class="WHIT">                    </span><span class="STRN">"start_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">start_x1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2798</span> </span><span class="WHIT">                    </span><span class="STRN">"start_y"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">start_y1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2799</span> </span><span class="WHIT">                    </span><span class="STRN">"width"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">width1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2800</span> </span><span class="WHIT">                    </span><span class="STRN">"height"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">height1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2801</span> </span><span class="WHIT">                    </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="NAME">pd.fill</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2802</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke"</span><span class="PUNC">:</span><span class="NAME">pd.fill</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2803</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_width"</span><span class="PUNC">:</span><span class="NAME">pd.stroke_width</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2804</span> </span><span class="WHIT">                    </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="NAME">pd.opacity</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2805</span> </span><span class="WHIT">                    </span><span class="STRN">"res_1"</span><span class="PUNC">:</span><span class="NAME">aa1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2806</span> </span><span class="WHIT">                    </span><span class="STRN">"res_3"</span><span class="PUNC">:</span><span class="NAME">aa3</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2807</span> </span><span class="WHIT">                    </span><span class="STRN">"res_ind"</span><span class="PUNC">:</span><span class="NAME">aai</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2808</span> </span><span class="WHIT">                    </span><span class="STRN">"centroid"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>2809</span> </span><span class="WHIT">                        </span><span class="PUNC">(</span><span class="NAME">start_x1</span><span class="PUNC">+</span><span class="NAME">width1</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2810</span> </span><span class="WHIT">                        </span><span class="PUNC">(</span><span class="NAME">start_y1</span><span class="PUNC">+</span><span class="NAME">height1</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2811</span> </span><span class="WHIT">                    </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2812</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2813</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2814</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2815</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2816</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2817</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">enter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2818</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">enter.append</span><span class="PUNC">(</span><span class="STRN">"rect"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2819</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"helices_rect_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.dom_name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.dom_itype</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" single_residue_path"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2820</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"resname"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.res_3</span><span class="PUNC">+</span><span class="NAME">d.res_ind</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2821</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"x"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"start_x"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2822</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"y"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"start_y"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2823</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"width"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2824</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"height"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"height"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2825</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2826</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2827</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2828</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2829</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2830</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2831</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2832</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2833</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2834</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2835</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="PUNC">;</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2836</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2837</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2838</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2839</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2840</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2841</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2842</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2843</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2844</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2845</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2846</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke-width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke_size</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2847</span> </span><span class="WHIT">                </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2848</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2849</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">update</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2850</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">update</span><span class="WHIT">
<span class='line'>2851</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">transition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2852</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2853</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2854</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2855</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2856</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2857</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2858</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2859</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2860</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2861</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2862</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="PUNC">;</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2863</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2864</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2865</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2866</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2867</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2868</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2869</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2870</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2871</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2872</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2873</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2874</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2875</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">exit.remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2876</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2877</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2878</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2879</span> </span><span class="WHIT">    
<span class='line'>2880</span>     </span><span class="COMM">/**
<span class='line'>2881</span>      * Plots Helices in Box mode (rectangles).
<span class='line'>2882</span>      * @param {Array} data  helices data generated from processRawUniProt function
<span class='line'>2883</span>      * @param {String} dataId helices main g element id attribute 
<span class='line'>2884</span>      * @namespace
<span class='line'>2885</span>      * @exports NaView
<span class='line'>2886</span>      * @name draw_helices_box 
<span class='line'>2887</span>      */</span><span class="WHIT">
<span class='line'>2888</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_helices_box</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dataId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2889</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">svg_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="STRN">"#"</span><span class="PUNC">+</span><span class="NAME">svg_id</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2890</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2891</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"helices_group"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2892</span> </span><span class="WHIT">        
<span class='line'>2893</span>         </span><span class="NAME">svg_element.selectAll</span><span class="PUNC">(</span><span class="STRN">".helices_rect"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2894</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2895</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2896</span> </span><span class="WHIT">                </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">enter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2897</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">enter.append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2898</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"g_helix_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.dom_name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.dom_itype</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2899</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"element_path_group"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2900</span> </span><span class="WHIT">    
<span class='line'>2901</span>                     </span><span class="NAME">e.append</span><span class="PUNC">(</span><span class="STRN">"rect"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2902</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"helices_rect element_path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2903</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"x"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"start_x"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2904</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"y"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"start_y"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2905</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"width"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2906</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"height"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"height"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2907</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2908</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2909</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2910</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke-width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke_size</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2911</span> </span><span class="WHIT">                        </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2912</span> </span><span class="WHIT">    
<span class='line'>2913</span>                     </span><span class="NAME">draw_helices_resids_box</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2914</span> </span><span class="WHIT">    
<span class='line'>2915</span>                     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2916</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2917</span> </span><span class="WHIT">                </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2918</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">exit.remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2919</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2920</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2921</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dataId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2922</span> </span><span class="WHIT">            </span><span class="NAME">svg_element.attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dataId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2923</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2924</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2925</span> 
<span class='line'>2926</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2927</span>      * Creates single rectangle SVG elements for each residue of cylinder helix.
<span class='line'>2928</span>      * @param {D3 Selection} enter_element d3 selection element containing drawn plot helices
<span class='line'>2929</span>      * @namespace
<span class='line'>2930</span>      * @exports NaView
<span class='line'>2931</span>      * @name draw_helices_resids_cylinder 
<span class='line'>2932</span>      */</span><span class="WHIT">
<span class='line'>2933</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_helices_resids_cylinder</span><span class="PUNC">(</span><span class="NAME">enter_element</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2934</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">g_helix_resids</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">enter_element.append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2935</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"g_helix_resids_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.dom_name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.dom_itype</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2936</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"g_helix_resids residue_path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2937</span> </span><span class="WHIT">        </span><span class="COMM">// .style("display", "none")</span><span class="WHIT">
<span class='line'>2938</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">style</span><span class="PUNC">(</span><span class="STRN">"visibility"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"hidden"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2939</span> </span><span class="WHIT">        
<span class='line'>2940</span>         </span><span class="NAME">g_helix_resids.selectAll</span><span class="PUNC">(</span><span class="PUNC">+</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2941</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">".helices_cylinders_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.dom_name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.dom_itype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2942</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2943</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2944</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aa_array</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d.aas.split</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2945</span> </span><span class="WHIT">            </span><span class="COMM">// let aa_array = data.aas.split('');</span><span class="WHIT">
<span class='line'>2946</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aa_indarray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rangeArray</span><span class="PUNC">(</span><span class="NAME">d.aas.length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d.start</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2947</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d.inverted</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2948</span> </span><span class="WHIT">                </span><span class="NAME">aa_array.reverse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2949</span> </span><span class="WHIT">                </span><span class="NAME">aa_indarray.reverse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2950</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2951</span> </span><span class="WHIT">    
<span class='line'>2952</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">height_per_aa</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d.draw_area.height</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">aa_array.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2953</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">d_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2954</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">iaaa</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iaaa</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aa_array.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iaaa</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2955</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aa1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aa_array</span><span class="PUNC">[</span><span class="NAME">iaaa</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2956</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aa3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">one_to_three</span><span class="PUNC">[</span><span class="NAME">aa_array</span><span class="PUNC">[</span><span class="NAME">iaaa</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2957</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aai</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aa_indarray</span><span class="PUNC">[</span><span class="NAME">iaaa</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2958</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">start_x1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d.draw_area.start_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2959</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">start_y1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d.draw_area.start_y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">height_per_aa</span><span class="PUNC">*</span><span class="NAME">iaaa</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2960</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">width1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d.draw_area.width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2961</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">height1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">height_per_aa</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2962</span> </span><span class="WHIT">                </span><span class="NAME">d_data.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2963</span> </span><span class="WHIT">                    </span><span class="STRN">"id"</span><span class="PUNC">:</span><span class="NAME">d.id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2964</span> </span><span class="WHIT">                    </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="NAME">d.type</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2965</span> </span><span class="WHIT">                    </span><span class="STRN">"dom_name"</span><span class="PUNC">:</span><span class="NAME">d.dom_name</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2966</span> </span><span class="WHIT">                    </span><span class="STRN">"dom_itype"</span><span class="PUNC">:</span><span class="NAME">d.dom_itype</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2967</span> </span><span class="WHIT">                    </span><span class="STRN">"start_x"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">start_x1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2968</span> </span><span class="WHIT">                    </span><span class="STRN">"start_y"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">start_y1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2969</span> </span><span class="WHIT">                    </span><span class="STRN">"width"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">width1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2970</span> </span><span class="WHIT">                    </span><span class="STRN">"height"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">height1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2971</span> </span><span class="WHIT">                    </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="NAME">d.fill</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2972</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke"</span><span class="PUNC">:</span><span class="NAME">d.fill</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2973</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_width"</span><span class="PUNC">:</span><span class="NAME">d.stroke_width</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2974</span> </span><span class="WHIT">                    </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="NAME">d.opacity</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2975</span> </span><span class="WHIT">                    </span><span class="STRN">"res_1"</span><span class="PUNC">:</span><span class="NAME">aa1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2976</span> </span><span class="WHIT">                    </span><span class="STRN">"res_3"</span><span class="PUNC">:</span><span class="NAME">aa3</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2977</span> </span><span class="WHIT">                    </span><span class="STRN">"res_ind"</span><span class="PUNC">:</span><span class="NAME">aai</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2978</span> </span><span class="WHIT">                    </span><span class="STRN">"centroid"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>2979</span> </span><span class="WHIT">                        </span><span class="PUNC">(</span><span class="NAME">start_x1</span><span class="PUNC">+</span><span class="NAME">width1</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2980</span> </span><span class="WHIT">                        </span><span class="PUNC">(</span><span class="NAME">start_y1</span><span class="PUNC">+</span><span class="NAME">height1</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2981</span> </span><span class="WHIT">                    </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2982</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2983</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2984</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2985</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2986</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2987</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">enter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2988</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">enter.append</span><span class="PUNC">(</span><span class="STRN">"rect"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2989</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"helices_rect_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.dom_name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.dom_itype</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" single_residue_path"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2990</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"resname"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.res_3</span><span class="PUNC">+</span><span class="NAME">d.res_ind</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2991</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"x"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"start_x"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2992</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"y"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"start_y"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2993</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"width"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2994</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"height"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"height"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2995</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke-width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke_size</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2996</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2997</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2998</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2999</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3000</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3001</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3002</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3003</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3004</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3005</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3006</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="PUNC">;</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3007</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3008</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3009</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3010</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3011</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3012</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3013</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3014</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3015</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3016</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3017</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke-dasharray"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3018</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">max_i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">g_helix_resids.data</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3019</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">max_i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3020</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"width"</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"height"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"width"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3021</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3022</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3023</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3024</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">on</span><span class="PUNC">(</span><span class="STRN">"mouseover"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3025</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3026</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"#######"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3027</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"MOUSE OVER PATH"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3028</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"data:"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3029</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3030</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"#######"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3031</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3032</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3033</span> </span><span class="WHIT">                </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3034</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3035</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">update</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3036</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">update</span><span class="WHIT">
<span class='line'>3037</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">transition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3038</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3039</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3040</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3041</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3042</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3043</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3044</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3045</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3046</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3047</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3048</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="PUNC">;</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3049</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3050</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3051</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3052</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3053</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3054</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3055</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3056</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3057</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3058</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3059</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3060</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3061</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3062</span> </span><span class="WHIT">    
<span class='line'>3063</span>     </span><span class="COMM">/**
<span class='line'>3064</span>      * Plots Helices in Cylinder mode.&lt;br>
<span class='line'>3065</span>      * Cylinder is composed of circle-rectangle-circle
<span class='line'>3066</span>      * @see draw_helices_resids_cylinder
<span class='line'>3067</span>      * @param {Array} data helices data generated from processRawUniProt function
<span class='line'>3068</span>      * @param {String} dataId helices main g element id attribute
<span class='line'>3069</span>      * @namespace
<span class='line'>3070</span>      * @exports NaView
<span class='line'>3071</span>      * @name draw_helices_cylinder 
<span class='line'>3072</span>      */</span><span class="WHIT">
<span class='line'>3073</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_helices_cylinder</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dataId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3074</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ratio_wh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="PUNC">/</span><span class="NAME">svg_width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3075</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cylinder_radius_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">draw_area.width</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3076</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cylinder_radius_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cylinder_radius_x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">ratio_wh</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3077</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">top_cylinder_stroke</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.protein.helix_draw_opts.draw.top_cylinder_stroke</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>3078</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">top_cylinder_stroke_size</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.protein.helix_draw_opts.draw.top_cylinder_stroke_size</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>3079</span>         </span><span class="COMM">// let top_cylinder_fill = style_obj.protein.helix_draw_opts.draw.top_cylinder_fill;</span><span class="WHIT">
<span class='line'>3080</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bottom_cylinder_stroke</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">style_obj.protein.helix_draw_opts.draw.bottom_cylinder_stroke</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>3081</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bottom_cylinder_stroke_size</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.protein.helix_draw_opts.draw.bottom_cylinder_stroke_size</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>3082</span>         </span><span class="COMM">// let bottom_cylinder_fill = style_obj.protein.helix_draw_opts.draw.bottom_cylinder_fill;</span><span class="WHIT">
<span class='line'>3083</span> </span><span class="WHIT">    
<span class='line'>3084</span>         </span><span class="COMM">// let lipid_head_radius_height = lipid_head_radius_width * ratio_wh * 2;</span><span class="WHIT">
<span class='line'>3085</span> </span><span class="WHIT">    
<span class='line'>3086</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">svg_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="STRN">"#"</span><span class="PUNC">+</span><span class="NAME">svg_id</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3087</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3088</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"helices_group"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3089</span> </span><span class="WHIT">        
<span class='line'>3090</span>         </span><span class="NAME">svg_element.selectAll</span><span class="PUNC">(</span><span class="STRN">".helices_cylinder"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3091</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3092</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>3093</span> </span><span class="WHIT">                </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">enter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3094</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">enter.append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3095</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"g_helix_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.dom_name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.dom_itype</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3096</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"helices_cylinder element_path_group"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3097</span> </span><span class="WHIT">    
<span class='line'>3098</span>                     </span><span class="NAME">e.append</span><span class="PUNC">(</span><span class="STRN">"ellipse"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3099</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"helices_cyl_bottom_circle"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3100</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"cx"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"start_x"</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">cylinder_radius_x</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3101</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"cy"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"end_y"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3102</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"rx"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cylinder_radius_x</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3103</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"ry"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cylinder_radius_y</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3104</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3105</span> </span><span class="WHIT">                            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d.resids</span><span class="PUNC">[</span><span class="NAME">d.resids.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3106</span> </span><span class="WHIT">                            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3107</span> </span><span class="WHIT">                                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3108</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3109</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3110</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3111</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3112</span> </span><span class="WHIT">                            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d.resids</span><span class="PUNC">[</span><span class="NAME">d.resids.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3113</span> </span><span class="WHIT">                            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3114</span> </span><span class="WHIT">                                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="PUNC">;</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3115</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3116</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3117</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3118</span> </span><span class="WHIT">                        </span><span class="COMM">// .attr("fill", function(d) {</span><span class="WHIT">
<span class='line'>3119</span> </span><span class="WHIT">                        </span><span class="COMM">//     return d["fill"];</span><span class="WHIT">
<span class='line'>3120</span> </span><span class="WHIT">                        </span><span class="COMM">// } )</span><span class="WHIT">
<span class='line'>3121</span> </span><span class="WHIT">                        </span><span class="COMM">// .attr("opacity", function(d) { return d["opacity"];} )</span><span class="WHIT">
<span class='line'>3122</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bottom_cylinder_stroke</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3123</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke-width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bottom_cylinder_stroke_size</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3124</span> </span><span class="WHIT">                        </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3125</span> </span><span class="WHIT">                    </span><span class="NAME">e.append</span><span class="PUNC">(</span><span class="STRN">"rect"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3126</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"helices_cyl_rect element_path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3127</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"x"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"start_x"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3128</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"y"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"start_y"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3129</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"width"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3130</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"height"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"height"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3131</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3132</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3133</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3134</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke-width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke_size</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3135</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke-dasharray"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"width"</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"height"</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"width"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3136</span> </span><span class="WHIT">                        </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3137</span> </span><span class="WHIT">                    </span><span class="NAME">draw_helices_resids_cylinder</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3138</span> </span><span class="WHIT">                    </span><span class="NAME">e.append</span><span class="PUNC">(</span><span class="STRN">"ellipse"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3139</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"helices_cyl_top_circle"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3140</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"cx"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"start_x"</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">cylinder_radius_x</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3141</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"cy"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"start_y"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3142</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"rx"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cylinder_radius_x</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3143</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"ry"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cylinder_radius_y</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3144</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3145</span> </span><span class="WHIT">                            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d.resids</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3146</span> </span><span class="WHIT">                            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3147</span> </span><span class="WHIT">                                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3148</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3149</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3150</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3151</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3152</span> </span><span class="WHIT">                            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d.resids</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3153</span> </span><span class="WHIT">                            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3154</span> </span><span class="WHIT">                                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="PUNC">;</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3155</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3156</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3157</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3158</span> </span><span class="WHIT">                        </span><span class="COMM">// .attr("fill", function(d) {</span><span class="WHIT">
<span class='line'>3159</span> </span><span class="WHIT">                            </span><span class="COMM">// return d["fill"];</span><span class="WHIT">
<span class='line'>3160</span> </span><span class="WHIT">                        </span><span class="COMM">// } )</span><span class="WHIT">
<span class='line'>3161</span> </span><span class="WHIT">                        </span><span class="COMM">// .attr("opacity", function(d) { return d["opacity"];} )</span><span class="WHIT">
<span class='line'>3162</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top_cylinder_stroke</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3163</span> </span><span class="WHIT">                        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke-width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top_cylinder_stroke_size</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3164</span> </span><span class="WHIT">                        </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3165</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3166</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3167</span> </span><span class="WHIT">                </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">update</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3168</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">update.select</span><span class="PUNC">(</span><span class="STRN">".helices_cyl_bottom_circle"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3169</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">transition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3170</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3171</span> </span><span class="WHIT">                        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d.resids</span><span class="PUNC">[</span><span class="NAME">d.resids.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3172</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3173</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3174</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3175</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3176</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3177</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3178</span> </span><span class="WHIT">                        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d.resids</span><span class="PUNC">[</span><span class="NAME">d.resids.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3179</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3180</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="PUNC">;</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3181</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3182</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3183</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3184</span> </span><span class="WHIT">                    </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3185</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">update.select</span><span class="PUNC">(</span><span class="STRN">".helices_cyl_top_circle"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3186</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">transition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3187</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3188</span> </span><span class="WHIT">                        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d.resids</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3189</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3190</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3191</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3192</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3193</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3194</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3195</span> </span><span class="WHIT">                        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d.resids</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3196</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3197</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="PUNC">;</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3198</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3199</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3200</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3201</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">update</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3202</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3203</span> </span><span class="WHIT">                </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3204</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">exit.remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3205</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3206</span> </span><span class="WHIT">            </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3207</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dataId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3208</span> </span><span class="WHIT">            </span><span class="NAME">svg_element.attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dataId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3209</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3210</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3211</span> 
<span class='line'>3212</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3213</span>      * Constructs Path "d" attribute from a datum element containing a "points" attribute
<span class='line'>3214</span>      * @param {Object} d datum element containing a "points" attribute
<span class='line'>3215</span>      * @namespace
<span class='line'>3216</span>      * @exports NaView
<span class='line'>3217</span>      * @name buildPathStringFromData 
<span class='line'>3218</span>      * @yields {String} Path "d" attribute
<span class='line'>3219</span>      */</span><span class="WHIT">
<span class='line'>3220</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">buildPathStringFromData</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3221</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cmdarray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"M"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3222</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i_todraw</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i_todraw</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">d.points.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i_todraw</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3223</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">points_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d.points</span><span class="PUNC">[</span><span class="NAME">i_todraw</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3224</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">points_element_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">points_element.type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3225</span> </span><span class="WHIT">            </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">points_element_type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3226</span> </span><span class="WHIT">                </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"curvB"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3227</span> </span><span class="WHIT">                    </span><span class="NAME">cmdarray.push</span><span class="PUNC">(</span><span class="STRN">"C"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//start downward curves</span><span class="WHIT">
<span class='line'>3228</span> </span><span class="WHIT">                    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">icrvD</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">icrvD</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">points_element.p.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">icrvD</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3229</span> </span><span class="WHIT">                        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">crvP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">points_element.p</span><span class="PUNC">[</span><span class="NAME">icrvD</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3230</span> </span><span class="WHIT">                        </span><span class="NAME">cmdarray.push</span><span class="PUNC">(</span><span class="NAME">crvP</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//downward curves movement</span><span class="WHIT">
<span class='line'>3231</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3232</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3233</span> </span><span class="WHIT">                </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"lineP"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3234</span> </span><span class="WHIT">                    </span><span class="NAME">cmdarray.push</span><span class="PUNC">(</span><span class="STRN">"L"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//start downward curves</span><span class="WHIT">
<span class='line'>3235</span> </span><span class="WHIT">                    </span><span class="NAME">cmdarray.push</span><span class="PUNC">(</span><span class="NAME">points_element.p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//start downward curves</span><span class="WHIT">
<span class='line'>3236</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3237</span> </span><span class="WHIT">                </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3238</span> </span><span class="WHIT">                    </span><span class="NAME">cmdarray.push</span><span class="PUNC">(</span><span class="NAME">points_element.p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//start movement</span><span class="WHIT">
<span class='line'>3239</span> </span><span class="WHIT">                    </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3240</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3241</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3242</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d.pathclose</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3243</span> </span><span class="WHIT">            </span><span class="NAME">cmdarray.push</span><span class="PUNC">(</span><span class="STRN">"z"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//finish movement</span><span class="WHIT">
<span class='line'>3244</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3245</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">string_d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3246</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">icmd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">icmd</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">cmdarray.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">icmd</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3247</span> </span><span class="WHIT">            </span><span class="NAME">string_d</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cmdarray</span><span class="PUNC">[</span><span class="NAME">icmd</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3248</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3249</span> </span><span class="WHIT">        </span><span class="NAME">string_d</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cmdarray</span><span class="PUNC">[</span><span class="NAME">cmdarray.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3250</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">string_d</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3251</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3252</span> </span><span class="WHIT">    
<span class='line'>3253</span>     </span><span class="COMM">/**
<span class='line'>3254</span>      * Retrieves points from a D3 Path selection
<span class='line'>3255</span>      * @param {D3 Path Selection} d3path D3 Path selection to get desired points
<span class='line'>3256</span>      * @param {String} searchchar optional path selection. searches for a points refering to a given curve or line
<span class='line'>3257</span>      * @namespace
<span class='line'>3258</span>      * @exports NaView
<span class='line'>3259</span>      * @name pathStringToStringPoints 
<span class='line'>3260</span>      * @yields {Array} Coordinate Array of points for given path
<span class='line'>3261</span>      */</span><span class="WHIT">
<span class='line'>3262</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">pathStringToStringPoints</span><span class="PUNC">(</span><span class="NAME">d3path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">searchchar</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3263</span> </span><span class="WHIT">        </span><span class="COMM">// var re = new RegExp("a|b");</span><span class="WHIT">
<span class='line'>3264</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">path_string</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3path.attr</span><span class="PUNC">(</span><span class="STRN">"d"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3265</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">arrayOfStrings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">path_string.split</span><span class="PUNC">(</span><span class="REGX">/(?=[MCL])/g</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3266</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">searchchar</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3267</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">results</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3268</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i_strarr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i_strarr</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arrayOfStrings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i_strarr</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3269</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">string_el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrayOfStrings</span><span class="PUNC">[</span><span class="NAME">i_strarr</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3270</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">string_el.indexOf</span><span class="PUNC">(</span><span class="NAME">searchchar</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3271</span> </span><span class="WHIT">                    </span><span class="NAME">results.push</span><span class="PUNC">(</span><span class="NAME">string_el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3272</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3273</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3274</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">results.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3275</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3276</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3277</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3278</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3279</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">arrayOfStrings</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3280</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3281</span> 
<span class='line'>3282</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3283</span>      * Converts SVG point object to Array of coordinates
<span class='line'>3284</span>      * @param {Object} dot1 point to be converted to Array of coordinates
<span class='line'>3285</span>      * @namespace
<span class='line'>3286</span>      * @exports NaView
<span class='line'>3287</span>      * @name dotToCoords 
<span class='line'>3288</span>      * @yields {Array} Coordinate Array of given point
<span class='line'>3289</span>      */</span><span class="WHIT">
<span class='line'>3290</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">dotToCoords</span><span class="PUNC">(</span><span class="NAME">dot1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3291</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ndot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3292</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dot1.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3293</span> </span><span class="WHIT">            </span><span class="NAME">ndot.push</span><span class="PUNC">(</span><span class="NAME">dot1.x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3294</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3295</span> </span><span class="WHIT">            </span><span class="NAME">ndot.push</span><span class="PUNC">(</span><span class="NAME">dot1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3296</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3297</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dot1.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3298</span> </span><span class="WHIT">            </span><span class="NAME">ndot.push</span><span class="PUNC">(</span><span class="NAME">dot1.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3299</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3300</span> </span><span class="WHIT">            </span><span class="NAME">ndot.push</span><span class="PUNC">(</span><span class="NAME">dot1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3301</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3302</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ndot</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3303</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3304</span> </span><span class="WHIT">    
<span class='line'>3305</span>     </span><span class="COMM">/**
<span class='line'>3306</span>      * Generate mid point between two points [x,y]
<span class='line'>3307</span>      * @param {Array} dot1 point 1 to generate mid point
<span class='line'>3308</span>      * @param {Array} dot2 point 2 to generate mid point
<span class='line'>3309</span>      * @namespace
<span class='line'>3310</span>      * @exports NaView
<span class='line'>3311</span>      * @name calculateDotArrayMiddlePoint 
<span class='line'>3312</span>      * @yields {Array} Coordinate Array of Mid Points
<span class='line'>3313</span>      */</span><span class="WHIT">
<span class='line'>3314</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">calculateDotArrayMiddlePoint</span><span class="PUNC">(</span><span class="NAME">dot1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dot2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3315</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">dot1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dot2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">dot1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dot2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3316</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3317</span> </span><span class="WHIT">    
<span class='line'>3318</span>     </span><span class="COMM">/**
<span class='line'>3319</span>      * Generate mid point between two SVG Path points {"x":x,"y":y}
<span class='line'>3320</span>      * @param {Object} dot1 point 1 to generate mid point
<span class='line'>3321</span>      * @param {Object} dot2 point 2 to generate mid point
<span class='line'>3322</span>      * @namespace
<span class='line'>3323</span>      * @exports NaView
<span class='line'>3324</span>      * @name calculateDotMiddlePoint 
<span class='line'>3325</span>      * @yields {Array} Coordinate Array of Mid Points
<span class='line'>3326</span>      */</span><span class="WHIT">
<span class='line'>3327</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">calculateDotMiddlePoint</span><span class="PUNC">(</span><span class="NAME">dot1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dot2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3328</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">dot1.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dot2.x</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">dot1.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dot2.y</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3329</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3330</span> </span><span class="WHIT">    
<span class='line'>3331</span>     </span><span class="COMM">/**
<span class='line'>3332</span>      * Generate X mid points equally spaced between two points
<span class='line'>3333</span>      * @param {Object} dot1 point 1 to generate mid points
<span class='line'>3334</span>      * @param {Object} dot2 point 2 to generate mid points
<span class='line'>3335</span>      * @param {number} xmids number of equally spaced mid points
<span class='line'>3336</span>      * @yields {Array} Array of equally spaced X mid points
<span class='line'>3337</span>      * @namespace
<span class='line'>3338</span>      * @exports NaView
<span class='line'>3339</span>      * @name generateXMidPts 
<span class='line'>3340</span>      */</span><span class="WHIT">
<span class='line'>3341</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">generateXMidPts</span><span class="PUNC">(</span><span class="NAME">dot1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dot2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xmids</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3342</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dots</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3343</span> </span><span class="WHIT">        </span><span class="NAME">dots.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">dot1.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dot1.y</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3344</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">deltaX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dot2.x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">dot1.x</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">xmids</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3345</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">deltaY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dot2.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">dot1.y</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">xmids</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3346</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">idot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idot</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">xmids</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idot</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3347</span> </span><span class="WHIT">            </span><span class="NAME">dots.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">dot1.x</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">deltaX</span><span class="PUNC">*</span><span class="NAME">idot</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">dot1.y</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">deltaY</span><span class="PUNC">*</span><span class="NAME">idot</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3348</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3349</span> </span><span class="WHIT">        </span><span class="NAME">dots.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">dot2.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dot2.y</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3350</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">dots</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3351</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3352</span> </span><span class="WHIT">    
<span class='line'>3353</span>     </span><span class="COMM">/**
<span class='line'>3354</span>      * Sample points from a SVG path from a start length to end length
<span class='line'>3355</span>      * @param {HTMLElement} dompath half turn parent path element as DOM Object
<span class='line'>3356</span>      * @param {number} segmentstart start length of sampling
<span class='line'>3357</span>      * @param {number} segmentend end length of sampling
<span class='line'>3358</span>      * @param {number} sampling_step step of sampling
<span class='line'>3359</span>      * @param {number} sampling_stepend final step of sampling
<span class='line'>3360</span>      * @yields {Array} Array of sampled path points
<span class='line'>3361</span>      * @namespace
<span class='line'>3362</span>      * @exports NaView
<span class='line'>3363</span>      * @name pathSegmentToXYPoints 
<span class='line'>3364</span>      */</span><span class="WHIT">
<span class='line'>3365</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">pathSegmentToXYPoints</span><span class="PUNC">(</span><span class="NAME">dompath</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">segmentstart</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">segmentend</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sampling_step</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sampling_stepend</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3366</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sampling_step</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3367</span> </span><span class="WHIT">            </span><span class="NAME">sampling_step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.25</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3368</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3369</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sampling_stepend</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3370</span> </span><span class="WHIT">            </span><span class="NAME">sampling_stepend</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sampling_step</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3371</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3372</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">segs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3373</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">segmentstart</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;=</span><span class="NAME">segmentend</span><span class="PUNC">+</span><span class="NAME">sampling_stepend</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">sampling_step</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3374</span> </span><span class="WHIT">        </span><span class="COMM">// for (var i=segmentstart; i&lt;segmentend; i+=sampling_step) {</span><span class="WHIT">
<span class='line'>3375</span> </span><span class="WHIT">            </span><span class="COMM">//length to generate point is translations from i and accumulated previous path points to pieceSize</span><span class="WHIT">
<span class='line'>3376</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sampled_point</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dompath.getPointAtLength</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3377</span> </span><span class="WHIT">            </span><span class="NAME">segs.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">sampled_point.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sampled_point.y</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3378</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3379</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">segs</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3380</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3381</span> </span><span class="WHIT">    
<span class='line'>3382</span>     </span><span class="COMM">/**
<span class='line'>3383</span>      * Generates drawing information for bezier curves that define each half turn object.&lt;br>
<span class='line'>3384</span>      * This is done according to a helix number of turns (division by three).&lt;br>
<span class='line'>3385</span>      * And also to style_obj helix width and height definitions, as well as to the number of residues in each half turn.&lt;br>
<span class='line'>3386</span>      * @namespace
<span class='line'>3387</span>      * @exports NaView
<span class='line'>3388</span>      * @name gen_helix_cartoon_halfturn_data 
<span class='line'>3389</span>      * @param {Array} data helix data generated by processRawUniProt
<span class='line'>3390</span>      * @yields {Object} Object containing:&lt;br>
<span class='line'>3391</span>      * 1. back and front half turn points to generate half turn paths:&lt;br>
<span class='line'>3392</span>      * 2. Total turn number for a helix&lt;br>
<span class='line'>3393</span>      * 3. Parity of half helix front turn number (deprecated) &lt;br>
<span class='line'>3394</span>      */</span><span class="WHIT">
<span class='line'>3395</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">gen_helix_cartoon_halfturn_data</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3396</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aanum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data.aanum</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3397</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helix_drawarea</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data.draw_area</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3398</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helix_hstart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helix_drawarea.start_y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3399</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helix_wstart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helix_drawarea.start_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3400</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helixwidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helix_drawarea.width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3401</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helixheight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helix_drawarea.height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3402</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">resid_inversion</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data.inverted</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3403</span> </span><span class="WHIT">    
<span class='line'>3404</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aa_array</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data.aas.split</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3405</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aa_indarray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rangeArray</span><span class="PUNC">(</span><span class="NAME">data.aas.length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data.start</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3406</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">resid_inversion</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3407</span> </span><span class="WHIT">            </span><span class="NAME">aa_array.reverse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3408</span> </span><span class="WHIT">            </span><span class="NAME">aa_indarray.reverse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3409</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3410</span> </span><span class="WHIT">    
<span class='line'>3411</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">end_bck</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3412</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">end_frt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3413</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ends_at</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3414</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">number_of_turns_integer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3415</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">half_turns_number</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3416</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">counter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3417</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">iaa</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iaa</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aanum</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iaa</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3418</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">counter</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">//fourth is skip</span><span class="WHIT">
<span class='line'>3419</span> </span><span class="WHIT">                </span><span class="NAME">number_of_turns_integer</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3420</span> </span><span class="WHIT">                </span><span class="NAME">half_turns_number</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3421</span> </span><span class="WHIT">                </span><span class="NAME">ends_at</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"back"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3422</span> </span><span class="WHIT">                </span><span class="NAME">end_bck</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3423</span> </span><span class="WHIT">                </span><span class="NAME">end_frt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3424</span> </span><span class="WHIT">                </span><span class="NAME">counter</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3425</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">counter</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3426</span> </span><span class="WHIT">                </span><span class="NAME">half_turns_number</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3427</span> </span><span class="WHIT">                </span><span class="NAME">ends_at</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"front"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3428</span> </span><span class="WHIT">                </span><span class="NAME">end_frt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3429</span> </span><span class="WHIT">                </span><span class="NAME">end_bck</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3430</span> </span><span class="WHIT">                </span><span class="NAME">counter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3431</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3432</span> </span><span class="WHIT">                </span><span class="NAME">counter</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3433</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3434</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3435</span> </span><span class="WHIT">        
<span class='line'>3436</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">half_turn_resids</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">stringToChunksSkip</span><span class="PUNC">(</span><span class="NAME">data.aas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3437</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">half_turn_resids2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">stringToChunksSkip</span><span class="PUNC">(</span><span class="NAME">data.aas.slice</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3438</span> </span><span class="WHIT">        </span><span class="COMM">// half_turns_number = half_turn_resids.length;</span><span class="WHIT">
<span class='line'>3439</span> </span><span class="WHIT">    
<span class='line'>3440</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">back_half_turn_resids</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">half_turn_resids.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3441</span> </span><span class="WHIT">            </span><span class="COMM">// return a.length === 3;</span><span class="WHIT">
<span class='line'>3442</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">parity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3443</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">end_frt</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">half_turn_resids.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3444</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3445</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3446</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parity</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3447</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3448</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">front_half_turn_resids</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">half_turn_resids2.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3449</span> </span><span class="WHIT">            </span><span class="COMM">// return a.length === 3;</span><span class="WHIT">
<span class='line'>3450</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">end_bck</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">half_turn_resids.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3451</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3452</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3453</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3454</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3455</span> </span><span class="WHIT">        </span><span class="NAME">half_turns_number</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">back_half_turn_resids.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">front_half_turn_resids.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3456</span> </span><span class="WHIT">    
<span class='line'>3457</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">height_step_per_full_turn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helixheight</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">half_turns_number</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3458</span> </span><span class="WHIT">        </span><span class="COMM">// var height_step_per_full_turn = helixheight / number_of_turns_integer;</span><span class="WHIT">
<span class='line'>3459</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">height_step_per_half_turn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">height_step_per_full_turn</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3460</span> </span><span class="WHIT">    
<span class='line'>3461</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helix_draw_thickness</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"helix_draw_opts"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"draw"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"thickness"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3462</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">thickness_step_per_half_turn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">height_step_per_half_turn</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">helix_draw_thickness</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3463</span> </span><span class="WHIT">    
<span class='line'>3464</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width_step_per_half_turn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helixwidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3465</span> </span><span class="WHIT">    
<span class='line'>3466</span>         
<span class='line'>3467</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">width_step_per_half_turn</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3468</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">height_step_per_half_turn</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3469</span> </span><span class="WHIT">    
<span class='line'>3470</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helix_draw_x_to_end_proportion</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"helix_draw_opts"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"draw"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"x_to_end_prop"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3471</span> </span><span class="WHIT">        </span><span class="COMM">//let helix_draw_thickness = helix_draw_thickness;</span><span class="WHIT">
<span class='line'>3472</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helix_draw_y_to_mid_proportion</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"helix_draw_opts"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"draw"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"y_to_mid_prop"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3473</span> </span><span class="WHIT">    
<span class='line'>3474</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">helix_draw_x_to_end_proportion</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3475</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">helix_draw_thickness</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// helix half turn height</span><span class="WHIT">
<span class='line'>3476</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">py</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helix_draw_y_to_mid_proportion</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3477</span> </span><span class="WHIT">    
<span class='line'>3478</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">back_helix_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data.back_fill</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3479</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">front_helix_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data.fill</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3480</span> </span><span class="WHIT">    
<span class='line'>3481</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helix_stroke_size</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"helix_draw_opts"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"draw"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"stroke_size"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3482</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">back_helix_stroke</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"helix_draw_opts"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"draw"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"back_helix_stroke"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3483</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">front_helix_stroke</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"helix_draw_opts"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"draw"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"front_helix_stroke"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3484</span> </span><span class="WHIT">    
<span class='line'>3485</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">parsed_resnum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3486</span> </span><span class="WHIT">    
<span class='line'>3487</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helix_bck_resnum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3488</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">helix_bck_draw_array</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3489</span> </span><span class="WHIT">    
<span class='line'>3490</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helix_frt_resnum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3491</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">helix_frt_draw_array</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3492</span> </span><span class="WHIT">    
<span class='line'>3493</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">half_turn_i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">half_turn_i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">half_turns_number</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">half_turn_i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3494</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">half_turn_oddeven</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">half_turn_i</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3495</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helix_wstart</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">width_step_per_half_turn</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">half_turn_oddeven</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3496</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helix_hstart</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">half_turn_i</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">height_step_per_half_turn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3497</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">parts_division</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3498</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">half_turn_i</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3499</span> </span><span class="WHIT">                </span><span class="NAME">parts_division</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3500</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">half_turn_i</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">half_turns_number</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3501</span> </span><span class="WHIT">                </span><span class="NAME">parts_division</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3502</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3503</span> </span><span class="WHIT">                </span><span class="NAME">parts_division</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3504</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3505</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">half_turn_oddeven</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3506</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bckresids</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3507</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bck_resid_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">back_half_turn_resids</span><span class="PUNC">[</span><span class="NAME">helix_bck_resnum</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3508</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bck_respos_index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">half_turn_i</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3509</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ibrd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ibrd</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">bck_resid_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ibrd</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3510</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">res_1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bck_resid_data</span><span class="PUNC">[</span><span class="NAME">ibrd</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3511</span> </span><span class="WHIT">                    </span><span class="NAME">bckresids.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3512</span> </span><span class="WHIT">                        </span><span class="STRN">"id"</span><span class="PUNC">:</span><span class="NAME">data.id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3513</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="NAME">data.type</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3514</span> </span><span class="WHIT">                        </span><span class="STRN">"dom_name"</span><span class="PUNC">:</span><span class="NAME">data.dom_name</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3515</span> </span><span class="WHIT">                        </span><span class="STRN">"dom_itype"</span><span class="PUNC">:</span><span class="NAME">data.dom_itype</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3516</span> </span><span class="WHIT">                        </span><span class="STRN">"res_1"</span><span class="PUNC">:</span><span class="NAME">aa_array</span><span class="PUNC">[</span><span class="NAME">bck_respos_index</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3517</span> </span><span class="WHIT">                        </span><span class="STRN">"res_3"</span><span class="PUNC">:</span><span class="NAME">one_to_three</span><span class="PUNC">[</span><span class="NAME">aa_array</span><span class="PUNC">[</span><span class="NAME">bck_respos_index</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3518</span> </span><span class="WHIT">                        </span><span class="COMM">// "res_ind": data.start+(bck_respos_index),</span><span class="WHIT">
<span class='line'>3519</span> </span><span class="WHIT">                        </span><span class="STRN">"res_ind"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">aa_indarray</span><span class="PUNC">[</span><span class="NAME">bck_respos_index</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3520</span> </span><span class="WHIT">                        </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">data.opacity</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3521</span> </span><span class="WHIT">                        </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">back_helix_color</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3522</span> </span><span class="WHIT">                        </span><span class="STRN">"stroke_color"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">back_helix_stroke</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3523</span> </span><span class="WHIT">                        </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">helix_stroke_size</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3524</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3525</span> </span><span class="WHIT">                    </span><span class="COMM">// if (aa_array[bck_respos_index] !== res_1) {</span><span class="WHIT">
<span class='line'>3526</span> </span><span class="WHIT">                    </span><span class="COMM">//     console.log("##############");</span><span class="WHIT">
<span class='line'>3527</span> </span><span class="WHIT">                    </span><span class="COMM">//     console.log("!!! FATAL ERROR: WRONG RESIDUE");</span><span class="WHIT">
<span class='line'>3528</span> </span><span class="WHIT">                    </span><span class="COMM">//     console.log("##############");</span><span class="WHIT">
<span class='line'>3529</span> </span><span class="WHIT">                    </span><span class="COMM">//     return;</span><span class="WHIT">
<span class='line'>3530</span> </span><span class="WHIT">                    </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>3531</span> </span><span class="WHIT">                    </span><span class="NAME">bck_respos_index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3532</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3533</span> </span><span class="WHIT">    
<span class='line'>3534</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">xend</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">w</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3535</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_add</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3536</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bckresids.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3537</span> </span><span class="WHIT">                    </span><span class="NAME">xend</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3538</span> </span><span class="WHIT">                    </span><span class="NAME">parts_division</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parts_division.slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3539</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bckresids.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3540</span> </span><span class="WHIT">                    </span><span class="NAME">xend</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3541</span> </span><span class="WHIT">                    </span><span class="NAME">parts_division</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parts_division.slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3542</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3543</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">half_turn_i</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">half_turns_number</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3544</span> </span><span class="WHIT">                    </span><span class="NAME">y_add</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3545</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3546</span> </span><span class="WHIT">    
<span class='line'>3547</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">yend</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">+</span><span class="NAME">y_add</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3548</span> </span><span class="WHIT">    
<span class='line'>3549</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">+</span><span class="NAME">y_add</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3550</span> </span><span class="WHIT">    
<span class='line'>3551</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bx1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">tx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3552</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bx2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xend</span><span class="WHIT">  </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">tx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3553</span> </span><span class="WHIT">                
<span class='line'>3554</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">by1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">+</span><span class="NAME">y_add</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">+</span><span class="NAME">y_add</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">py</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3555</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">by2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">+</span><span class="NAME">y_add</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="WHIT">  </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">+</span><span class="NAME">y_add</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">py</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3556</span> </span><span class="WHIT">    
<span class='line'>3557</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">by3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">yend</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">+</span><span class="NAME">y_add</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">+</span><span class="NAME">y_add</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">py</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3558</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">by4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">yend</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">+</span><span class="NAME">y_add</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="WHIT">  </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">+</span><span class="NAME">y_add</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">py</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3559</span> </span><span class="WHIT">    
<span class='line'>3560</span>                 </span><span class="NAME">helix_bck_resnum</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3561</span> </span><span class="WHIT">    
<span class='line'>3562</span>                 </span><span class="NAME">helix_bck_draw_array.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3563</span> </span><span class="WHIT">                    </span><span class="STRN">"id"</span><span class="PUNC">:</span><span class="NAME">data.id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3564</span> </span><span class="WHIT">                    </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="NAME">data.type</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3565</span> </span><span class="WHIT">                    </span><span class="STRN">"dom_name"</span><span class="PUNC">:</span><span class="NAME">data.dom_name</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3566</span> </span><span class="WHIT">                    </span><span class="STRN">"dom_itype"</span><span class="PUNC">:</span><span class="NAME">data.dom_itype</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3567</span> </span><span class="WHIT">                    </span><span class="STRN">"resids"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">bckresids</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3568</span> </span><span class="WHIT">                    </span><span class="STRN">"pathclose"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3569</span> </span><span class="WHIT">                    </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">back_helix_color</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3570</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_color"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">back_helix_stroke</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3571</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">helix_stroke_size</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3572</span> </span><span class="WHIT">                    </span><span class="STRN">"parts_division"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">parts_division</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3573</span> </span><span class="WHIT">                    </span><span class="STRN">"points"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>3574</span> </span><span class="WHIT">                        </span><span class="PUNC">{</span><span class="STRN">"turn_index"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">half_turn_i</span><span class="PUNC">,</span><span class="STRN">"pathtype"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"bck"</span><span class="PUNC">,</span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"addP"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"p"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3575</span> </span><span class="WHIT">                        </span><span class="PUNC">{</span><span class="STRN">"turn_index"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">half_turn_i</span><span class="PUNC">,</span><span class="STRN">"pathtype"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"bck"</span><span class="PUNC">,</span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"addP"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"p"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3576</span> </span><span class="WHIT">                        </span><span class="PUNC">{</span><span class="STRN">"turn_index"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">half_turn_i</span><span class="PUNC">,</span><span class="STRN">"pathtype"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"bck"</span><span class="PUNC">,</span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"curvB"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"p"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">bx1</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">by1</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT">   </span><span class="NAME">bx2</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">by2</span><span class="PUNC">,</span><span class="WHIT">   </span><span class="NAME">xend</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">yend</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3577</span> </span><span class="WHIT">                        </span><span class="PUNC">{</span><span class="STRN">"turn_index"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">half_turn_i</span><span class="PUNC">,</span><span class="STRN">"pathtype"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"bck"</span><span class="PUNC">,</span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"lineP"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"p"</span><span class="PUNC">:</span><span class="NAME">xend</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">yend</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3578</span> </span><span class="WHIT">                        </span><span class="PUNC">{</span><span class="STRN">"turn_index"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">half_turn_i</span><span class="PUNC">,</span><span class="STRN">"pathtype"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"bck"</span><span class="PUNC">,</span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"curvB"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"p"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">bx2</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">by3</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT">   </span><span class="NAME">bx1</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">by4</span><span class="PUNC">,</span><span class="WHIT">   </span><span class="NAME">x</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3579</span> </span><span class="WHIT">                    </span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>3580</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3581</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3582</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">half_turn_oddeven</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3583</span> </span><span class="WHIT">                </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helix_hstart</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">half_turn_i</span><span class="PUNC">-</span><span class="NUMB">0.5</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">height_step_per_half_turn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3584</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helix_hstart</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">half_turn_i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">height_step_per_half_turn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3585</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helix_hstart</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">half_turn_i</span><span class="PUNC">+</span><span class="NUMB">0.5</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">height_step_per_half_turn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3586</span> </span><span class="WHIT">    
<span class='line'>3587</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">frtresids</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3588</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">frt_resid_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">front_half_turn_resids</span><span class="PUNC">[</span><span class="NAME">helix_frt_resnum</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3589</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">frt_respos_index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">half_turn_i</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3590</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ifrd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ifrd</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">frt_resid_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ifrd</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3591</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">res_1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">frt_resid_data</span><span class="PUNC">[</span><span class="NAME">ifrd</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3592</span> </span><span class="WHIT">                    </span><span class="NAME">frtresids.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3593</span> </span><span class="WHIT">                        </span><span class="STRN">"id"</span><span class="PUNC">:</span><span class="NAME">data.id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3594</span> </span><span class="WHIT">                        </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="NAME">data.type</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3595</span> </span><span class="WHIT">                        </span><span class="STRN">"dom_name"</span><span class="PUNC">:</span><span class="NAME">data.dom_name</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3596</span> </span><span class="WHIT">                        </span><span class="STRN">"dom_itype"</span><span class="PUNC">:</span><span class="NAME">data.dom_itype</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3597</span> </span><span class="WHIT">                        </span><span class="STRN">"res_1"</span><span class="PUNC">:</span><span class="NAME">aa_array</span><span class="PUNC">[</span><span class="NAME">frt_respos_index</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3598</span> </span><span class="WHIT">                        </span><span class="STRN">"res_3"</span><span class="PUNC">:</span><span class="NAME">one_to_three</span><span class="PUNC">[</span><span class="NAME">aa_array</span><span class="PUNC">[</span><span class="NAME">frt_respos_index</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3599</span> </span><span class="WHIT">                        </span><span class="COMM">// "res_ind": data.start+(frt_respos_index),</span><span class="WHIT">
<span class='line'>3600</span> </span><span class="WHIT">                        </span><span class="STRN">"res_ind"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">aa_indarray</span><span class="PUNC">[</span><span class="NAME">frt_respos_index</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3601</span> </span><span class="WHIT">                        </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">data.opacity</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3602</span> </span><span class="WHIT">                        </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">front_helix_color</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3603</span> </span><span class="WHIT">                        </span><span class="STRN">"stroke_color"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">front_helix_stroke</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3604</span> </span><span class="WHIT">                        </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">helix_stroke_size</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3605</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3606</span> </span><span class="WHIT">                    </span><span class="COMM">// if (aa_array[frt_respos_index] !== res_1) {</span><span class="WHIT">
<span class='line'>3607</span> </span><span class="WHIT">                    </span><span class="COMM">//     console.log("##############");</span><span class="WHIT">
<span class='line'>3608</span> </span><span class="WHIT">                    </span><span class="COMM">//     console.log("!!! FATAL ERROR: WRONG RESIDUE");</span><span class="WHIT">
<span class='line'>3609</span> </span><span class="WHIT">                    </span><span class="COMM">//     console.log("##############");</span><span class="WHIT">
<span class='line'>3610</span> </span><span class="WHIT">                    </span><span class="COMM">//     return;</span><span class="WHIT">
<span class='line'>3611</span> </span><span class="WHIT">                    </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>3612</span> </span><span class="WHIT">                    </span><span class="NAME">frt_respos_index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3613</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3614</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">xend</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">-</span><span class="NAME">w</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3615</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">frtresids.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3616</span> </span><span class="WHIT">                    </span><span class="NAME">xend</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3617</span> </span><span class="WHIT">                    </span><span class="NAME">parts_division</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parts_division.slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3618</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">frtresids.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3619</span> </span><span class="WHIT">                    </span><span class="NAME">xend</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3620</span> </span><span class="WHIT">                    </span><span class="NAME">parts_division</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parts_division.slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3621</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3622</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">half_turn_i</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">half_turns_number</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3623</span> </span><span class="WHIT">                    </span><span class="NAME">y3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3624</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3625</span> </span><span class="WHIT">    
<span class='line'>3626</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">yend</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y3</span><span class="PUNC">+</span><span class="NAME">h</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3627</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">yend2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="PUNC">+</span><span class="NAME">h</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3628</span> </span><span class="WHIT">    
<span class='line'>3629</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3630</span> </span><span class="WHIT">    
<span class='line'>3631</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bx1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">tx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3632</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bx2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xend</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">tx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3633</span> </span><span class="WHIT">                
<span class='line'>3634</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">by1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y2</span><span class="PUNC">+</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">py</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3635</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">by2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y2</span><span class="PUNC">+</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="WHIT">  </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">py</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3636</span> </span><span class="WHIT">    
<span class='line'>3637</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">by3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">yend2</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">py</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3638</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">by4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">yend2</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="WHIT">  </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">py</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3639</span> </span><span class="WHIT">    
<span class='line'>3640</span>                 </span><span class="NAME">helix_frt_resnum</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3641</span> </span><span class="WHIT">                </span><span class="NAME">helix_frt_draw_array.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3642</span> </span><span class="WHIT">                    </span><span class="STRN">"id"</span><span class="PUNC">:</span><span class="NAME">data.id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3643</span> </span><span class="WHIT">                    </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="NAME">data.type</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3644</span> </span><span class="WHIT">                    </span><span class="STRN">"dom_name"</span><span class="PUNC">:</span><span class="NAME">data.dom_name</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3645</span> </span><span class="WHIT">                    </span><span class="STRN">"dom_itype"</span><span class="PUNC">:</span><span class="NAME">data.dom_itype</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3646</span> </span><span class="WHIT">                    </span><span class="STRN">"resids"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">frtresids</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3647</span> </span><span class="WHIT">                    </span><span class="STRN">"pathclose"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3648</span> </span><span class="WHIT">                    </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">front_helix_color</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3649</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_color"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">front_helix_stroke</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3650</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">helix_stroke_size</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3651</span> </span><span class="WHIT">                    </span><span class="STRN">"parts_division"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">parts_division</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3652</span> </span><span class="WHIT">                    </span><span class="STRN">"points"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>3653</span> </span><span class="WHIT">                        </span><span class="PUNC">{</span><span class="STRN">"turn_index"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">half_turn_i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"pathtype"</span><span class="PUNC">:</span><span class="STRN">"frt"</span><span class="PUNC">,</span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"addP"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"p"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3654</span> </span><span class="WHIT">                        </span><span class="PUNC">{</span><span class="STRN">"turn_index"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">half_turn_i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"pathtype"</span><span class="PUNC">:</span><span class="STRN">"frt"</span><span class="PUNC">,</span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"addP"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"p"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3655</span> </span><span class="WHIT">                        </span><span class="PUNC">{</span><span class="STRN">"turn_index"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">half_turn_i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"pathtype"</span><span class="PUNC">:</span><span class="STRN">"frt"</span><span class="PUNC">,</span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"curvB"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"p"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">bx1</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">by1</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT">   </span><span class="NAME">bx2</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">by2</span><span class="PUNC">,</span><span class="WHIT">   </span><span class="NAME">xend</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">yend</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3656</span> </span><span class="WHIT">                        </span><span class="PUNC">{</span><span class="STRN">"turn_index"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">half_turn_i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"pathtype"</span><span class="PUNC">:</span><span class="STRN">"frt"</span><span class="PUNC">,</span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"lineP"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"p"</span><span class="PUNC">:</span><span class="NAME">xend</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">yend</span><span class="PUNC">-</span><span class="NAME">ty</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3657</span> </span><span class="WHIT">                        </span><span class="PUNC">{</span><span class="STRN">"turn_index"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">half_turn_i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"pathtype"</span><span class="PUNC">:</span><span class="STRN">"frt"</span><span class="PUNC">,</span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"curvB"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"p"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">bx2</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">by3</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT">   </span><span class="NAME">bx1</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">by4</span><span class="PUNC">,</span><span class="WHIT">   </span><span class="NAME">x</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3658</span> </span><span class="WHIT">                    </span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>3659</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3660</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3661</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3662</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helix_to_draw_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3663</span> </span><span class="WHIT">            </span><span class="STRN">"back"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">helix_bck_draw_array</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3664</span> </span><span class="WHIT">            </span><span class="STRN">"front"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">helix_frt_draw_array</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3665</span> </span><span class="WHIT">            </span><span class="STRN">"half_turns_number"</span><span class="PUNC">:</span><span class="NAME">half_turns_number</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3666</span> </span><span class="WHIT">            </span><span class="STRN">"aanum_parity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">aanum</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3667</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3668</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">helix_to_draw_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3669</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3670</span> 
<span class='line'>3671</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3672</span>      * Defines boundaries of each residue in parent path half helix polygon for residue partitioning function
<span class='line'>3673</span>      * @namespace
<span class='line'>3674</span>      * @exports NaView
<span class='line'>3675</span>      * @name getHalfHelixBoundaries 
<span class='line'>3676</span>      * @param {HTMLElement} dom_created_path half turn parent path element as DOM Object
<span class='line'>3677</span>      * @param {number} dom_created_path_length total length of half turn parent path element
<span class='line'>3678</span>      * @param {number} height_sline pixel height of each half turn symetrical left and right vertical lines
<span class='line'>3679</span>      * @param {Array} division number of residues and residue proportion in each half turn element
<span class='line'>3680</span>      * @yields {Array} Array of three important objects:&lt;br>
<span class='line'>3681</span>      * 1.bottom "left" and "right" coordinates of half turn parent path element&lt;br>
<span class='line'>3682</span>      * 2.top "left" and "right" coordinates of half turn parent path element&lt;br>
<span class='line'>3683</span>      * 3.proportion of each residue in parent path half helix polygon
<span class='line'>3684</span>      */</span><span class="WHIT">
<span class='line'>3685</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getHalfHelixBoundaries</span><span class="PUNC">(</span><span class="NAME">dom_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dom_created_path_length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">height_sline</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">division</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3686</span> </span><span class="WHIT">        </span><span class="COMM">//and subtract 2 times line height and divide by 2</span><span class="WHIT">
<span class='line'>3687</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dom_created_path_length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">height_sline</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3688</span> </span><span class="WHIT">        
<span class='line'>3689</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">curve_length</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3690</span> </span><span class="WHIT">    
<span class='line'>3691</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_div_size</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curve_length</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">division.size</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3692</span> </span><span class="WHIT">    
<span class='line'>3693</span>         </span><span class="COMM">//division.curve_steps indicates proportion of polygons</span><span class="WHIT">
<span class='line'>3694</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_step_size_f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curve_length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3695</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_step_size_1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">division.curve_steps</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">size</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">curve_div_size</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3696</span> </span><span class="WHIT">        </span><span class="NAME">division.curve_steps</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">csize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curve_step_size_1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3697</span> </span><span class="WHIT">        
<span class='line'>3698</span>         </span><span class="NAME">curve_step_size_f</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curve_step_size_1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3699</span> </span><span class="WHIT">    
<span class='line'>3700</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_step_size_2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3701</span> </span><span class="WHIT">    
<span class='line'>3702</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">division.curve_steps.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3703</span> </span><span class="WHIT">            </span><span class="NAME">curve_step_size_2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">division.curve_steps</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">size</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">curve_div_size</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3704</span> </span><span class="WHIT">            </span><span class="NAME">division.curve_steps</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">csize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curve_step_size_2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3705</span> </span><span class="WHIT">            </span><span class="NAME">curve_step_size_f</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curve_step_size_2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3706</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3707</span> </span><span class="WHIT">    
<span class='line'>3708</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">displacement_ps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curve_step</span><span class="PUNC">*</span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"helix_draw_opts"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"draw"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"aa_area_perc_displacement"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3709</span> </span><span class="WHIT">        
<span class='line'>3710</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">displacement_ps1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curve_step_size_1</span><span class="PUNC">*</span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"helix_draw_opts"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"draw"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"aa_area_perc_displacement"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3711</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">displacement_psf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curve_step_size_f</span><span class="PUNC">*</span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"helix_draw_opts"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"draw"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"aa_area_perc_displacement"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3712</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">displacement_ps2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3713</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">division.curve_steps.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3714</span> </span><span class="WHIT">            </span><span class="NAME">displacement_ps2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curve_step_size_2</span><span class="PUNC">*</span><span class="NAME">style_obj</span><span class="PUNC">[</span><span class="STRN">"protein"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"helix_draw_opts"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"draw"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"aa_area_perc_displacement"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3715</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3716</span> </span><span class="WHIT">    
<span class='line'>3717</span>         </span><span class="COMM">//the use getpointatlength for getting the desired points at each third of path</span><span class="WHIT">
<span class='line'>3718</span> </span><span class="WHIT">    
<span class='line'>3719</span>         </span><span class="COMM">//division.curve_steps indicates proportion of polygons.</span><span class="WHIT">
<span class='line'>3720</span> </span><span class="WHIT">        </span><span class="COMM">//first curve start for both back and front half-helices is after going down (left/right) lines</span><span class="WHIT">
<span class='line'>3721</span> </span><span class="WHIT">        </span><span class="COMM">//first curve "third" should be summed first step, this is clear</span><span class="WHIT">
<span class='line'>3722</span> </span><span class="WHIT">    
<span class='line'>3723</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_curve_start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">height_sline</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3724</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_curve_fthird</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">f_curve_start</span><span class="PUNC">+</span><span class="NAME">curve_step_size_1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3725</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_curve_sthird</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3726</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">division.curve_steps.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3727</span> </span><span class="WHIT">            </span><span class="COMM">//first curve second "third" should be summed second step, this is also clear</span><span class="WHIT">
<span class='line'>3728</span> </span><span class="WHIT">            </span><span class="NAME">f_curve_sthird</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">f_curve_start</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">curve_step_size_1</span><span class="PUNC">+</span><span class="NAME">curve_step_size_2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3729</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3730</span> </span><span class="WHIT">    
<span class='line'>3731</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">s_curve_start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">height_sline</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">curve_length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3732</span> </span><span class="WHIT">        </span><span class="COMM">//now it is a bit unclear. second curve shoudl also be summed first step</span><span class="WHIT">
<span class='line'>3733</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">s_curve_fthird</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s_curve_start</span><span class="PUNC">+</span><span class="NAME">curve_step_size_f</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3734</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">s_curve_sthird</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3735</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">division.curve_steps.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3736</span> </span><span class="WHIT">            </span><span class="NAME">s_curve_sthird</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s_curve_start</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">curve_step_size_2</span><span class="PUNC">+</span><span class="NAME">curve_step_size_f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3737</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3738</span> </span><span class="WHIT">    
<span class='line'>3739</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">fp_btm_curve</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dom_created_path.getPointAtLength</span><span class="PUNC">(</span><span class="NAME">f_curve_fthird</span><span class="PUNC">+</span><span class="NAME">displacement_ps1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3740</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sp_btm_curve</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3741</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">fp_top_curve</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dom_created_path.getPointAtLength</span><span class="PUNC">(</span><span class="NAME">s_curve_fthird</span><span class="PUNC">+</span><span class="NAME">displacement_psf</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3742</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sp_top_curve</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3743</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">division.curve_steps.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3744</span> </span><span class="WHIT">            </span><span class="NAME">sp_btm_curve</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dom_created_path.getPointAtLength</span><span class="PUNC">(</span><span class="NAME">f_curve_sthird</span><span class="PUNC">+</span><span class="NAME">displacement_psf</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3745</span> </span><span class="WHIT">            </span><span class="NAME">sp_top_curve</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dom_created_path.getPointAtLength</span><span class="PUNC">(</span><span class="NAME">s_curve_sthird</span><span class="PUNC">+</span><span class="NAME">displacement_ps1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3746</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3747</span> </span><span class="WHIT">        
<span class='line'>3748</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">default_curve_point</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3749</span> </span><span class="WHIT">            </span><span class="STRN">"x"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3750</span> </span><span class="WHIT">            </span><span class="STRN">"y"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3751</span> </span><span class="WHIT">            </span><span class="STRN">"path_len_to_pt"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3752</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3753</span> </span><span class="WHIT">    
<span class='line'>3754</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bottom_curve_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3755</span> </span><span class="WHIT">            </span><span class="STRN">"left"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">default_curve_point</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3756</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3757</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">top_curve_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3758</span> </span><span class="WHIT">            </span><span class="STRN">"left"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">default_curve_point</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3759</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3760</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">division.curve_steps.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3761</span> </span><span class="WHIT">            </span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">default_curve_point</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3762</span> </span><span class="WHIT">            </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">default_curve_point</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3763</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3764</span> </span><span class="WHIT">        
<span class='line'>3765</span>         </span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"x"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fp_btm_curve.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3766</span> </span><span class="WHIT">        </span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"y"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fp_btm_curve.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3767</span> </span><span class="WHIT">        </span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"path_len_to_pt"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">f_curve_fthird</span><span class="PUNC">+</span><span class="NAME">displacement_ps</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3768</span> </span><span class="WHIT">    
<span class='line'>3769</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">division.curve_steps.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3770</span> </span><span class="WHIT">            </span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"x"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sp_btm_curve.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3771</span> </span><span class="WHIT">            </span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"y"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sp_btm_curve.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3772</span> </span><span class="WHIT">            </span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"path_len_to_pt"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">f_curve_sthird</span><span class="PUNC">+</span><span class="NAME">displacement_ps</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3773</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3774</span> </span><span class="WHIT">    
<span class='line'>3775</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">division.curve_steps.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3776</span> </span><span class="WHIT">            </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"x"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fp_top_curve.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3777</span> </span><span class="WHIT">            </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"y"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fp_top_curve.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3778</span> </span><span class="WHIT">            </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"path_len_to_pt"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s_curve_fthird</span><span class="PUNC">+</span><span class="NAME">displacement_ps</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3779</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3780</span> </span><span class="WHIT">    
<span class='line'>3781</span>         </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"x"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sp_top_curve.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3782</span> </span><span class="WHIT">        </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"y"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sp_top_curve.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3783</span> </span><span class="WHIT">        </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"path_len_to_pt"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s_curve_sthird</span><span class="PUNC">+</span><span class="NAME">displacement_ps</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3784</span> </span><span class="WHIT">    
<span class='line'>3785</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">division.curve_steps.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3786</span> </span><span class="WHIT">            </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"x"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fp_top_curve.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3787</span> </span><span class="WHIT">            </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"y"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fp_top_curve.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3788</span> </span><span class="WHIT">            </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"path_len_to_pt"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s_curve_fthird</span><span class="PUNC">+</span><span class="NAME">displacement_ps</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3789</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3790</span> </span><span class="WHIT">        
<span class='line'>3791</span>         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">bottom_curve_points</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top_curve_points</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_step_size_1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_step_size_2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3792</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3793</span> 
<span class='line'>3794</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3795</span>      * Calculate Parent Path division points and Plots residue specific path elements for half turns representing a single residue
<span class='line'>3796</span>      * @namespace
<span class='line'>3797</span>      * @exports NaView
<span class='line'>3798</span>      * @name drawSingleHalfHelixResidue 
<span class='line'>3799</span>      * @param {Object} data data object for each half helix turn representing a single residue
<span class='line'>3800</span>      * @param {String} path_class name to generate group element class of new sub paths
<span class='line'>3801</span>      * @param {number} data_index index of half turn parent element
<span class='line'>3802</span>      * @param {HTMLElement} dom_created_path half turn parent path element as DOM Object
<span class='line'>3803</span>      */</span><span class="WHIT">
<span class='line'>3804</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">drawSingleHalfHelixResidue</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path_class</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data_index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dom_created_path</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3805</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">d3_created_path_parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="NAME">dom_created_path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3806</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">g_res_polygons</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="STRN">"#"</span><span class="PUNC">+</span><span class="NAME">path_class</span><span class="PUNC">+</span><span class="STRN">"_resids"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3807</span> </span><span class="WHIT">        
<span class='line'>3808</span>         </span><span class="NAME">data.resids</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"path_d"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3_created_path_parent.attr</span><span class="PUNC">(</span><span class="STRN">"d"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3809</span> </span><span class="WHIT">        </span><span class="NAME">g_res_polygons</span><span class="WHIT">
<span class='line'>3810</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">selectAll</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">+</span><span class="NAME">path_class</span><span class="PUNC">+</span><span class="STRN">"_resids_"</span><span class="PUNC">+</span><span class="NAME">data_index</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3811</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="NAME">data.resids</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3812</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>3813</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">enter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3814</span> </span><span class="WHIT">                </span><span class="NAME">enter.append</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3815</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path_class</span><span class="PUNC">+</span><span class="STRN">"_resids_"</span><span class="PUNC">+</span><span class="NAME">data_index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" single_residue_path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3816</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"resname"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3817</span> </span><span class="WHIT">                    </span><span class="COMM">// if (!d.res3 || !d.res_ind) {</span><span class="WHIT">
<span class='line'>3818</span> </span><span class="WHIT">                        </span><span class="COMM">// console.log("d");</span><span class="WHIT">
<span class='line'>3819</span> </span><span class="WHIT">                        </span><span class="COMM">// console.log(d);</span><span class="WHIT">
<span class='line'>3820</span> </span><span class="WHIT">                    </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>3821</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.res_3</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.res_ind</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3822</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3823</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"d"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3824</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.path_d</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3825</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3826</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'stroke'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3827</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3828</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3829</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3830</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3831</span> </span><span class="WHIT">                    </span><span class="COMM">// return d["fill"];</span><span class="WHIT">
<span class='line'>3832</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"stroke"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3833</span> </span><span class="WHIT">                    </span><span class="COMM">// return "black";</span><span class="WHIT">
<span class='line'>3834</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3835</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3836</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3837</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3838</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3839</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3840</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3841</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3842</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3843</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3844</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3845</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="PUNC">;</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3846</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3847</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3848</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3849</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'stroke-width'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3850</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke_size</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3851</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3852</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">on</span><span class="PUNC">(</span><span class="STRN">"mouseover"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3853</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3854</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"#######"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3855</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"MOUSE OVER PATH"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3856</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"data:"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3857</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3858</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"#######"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3859</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3860</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3861</span> </span><span class="WHIT">                </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3862</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3863</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">update</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3864</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">update.transition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3865</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'stroke'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3866</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3867</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3868</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3869</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3870</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3871</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3872</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3873</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3874</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3875</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3876</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3877</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3878</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3879</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3880</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3881</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3882</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="PUNC">;</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3883</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3884</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3885</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3886</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3887</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3888</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">exit.remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3889</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3890</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3891</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">created_paths</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementsByClassName</span><span class="PUNC">(</span><span class="NAME">path_class</span><span class="PUNC">+</span><span class="STRN">"_resids_"</span><span class="PUNC">+</span><span class="NAME">data_index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3892</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">icp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">icp</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">created_paths.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">icp</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3893</span> </span><span class="WHIT">            </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">created_paths</span><span class="PUNC">[</span><span class="NAME">icp</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3894</span> </span><span class="WHIT">            </span><span class="COMM">// let path_box = element.getBoundingClientRect();</span><span class="WHIT">
<span class='line'>3895</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">path_box</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">element.getBBox</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3896</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">xCenter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">path_box.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">path_box.width</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3897</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">yCenter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">path_box.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">path_box.height</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3898</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">new_datum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">datum</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3899</span> </span><span class="WHIT">            </span><span class="NAME">new_datum</span><span class="PUNC">[</span><span class="STRN">"centroid"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">xCenter</span><span class="PUNC">,</span><span class="NAME">yCenter</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3900</span> </span><span class="WHIT">            </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">datum</span><span class="PUNC">(</span><span class="NAME">new_datum</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3901</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">new_datum.res_ind</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"NaN"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3902</span> </span><span class="WHIT">                </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3903</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3904</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3905</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3906</span> </span><span class="WHIT">    
<span class='line'>3907</span>     </span><span class="COMM">/**
<span class='line'>3908</span>      * Calculate Parent Path division points and Plots residue specific path elements for half turns representing 2 or 3 possible residues.
<span class='line'>3909</span>      * d3.curveCardinal is used for drawing new Paths from old points
<span class='line'>3910</span>      * @namespace
<span class='line'>3911</span>      * @exports NaView
<span class='line'>3912</span>      * @name drawHalfHelixResidPolygons 
<span class='line'>3913</span>      * @param {Object} data data object for each half helix turn representing 2 or 3 possible residues
<span class='line'>3914</span>      * @param {String} path_class name to generate group element class of new sub paths
<span class='line'>3915</span>      * @param {number} data_index index of half turn parent element
<span class='line'>3916</span>      * @param {HTMLElement} dom_created_path half turn parent path element as DOM Object
<span class='line'>3917</span>      * @param {number} dom_created_path_length total length of half turn parent path element
<span class='line'>3918</span>      * @param {Object} bottom_curve_points bottom "left" and "right" coordinates of half turn parent path element
<span class='line'>3919</span>      * @param {Object} top_curve_points top "left" and "right" coordinates of half turn parent path element
<span class='line'>3920</span>      * @param {number} height_sline pixel height of each half turn symetrical left and right vertical lines
<span class='line'>3921</span>      * @param {number} curve_length pixel length of each half turn symetrical top and bottom bezier curves
<span class='line'>3922</span>      * @param {Array} division_curve_lengths proportion of each residue in parent path half helix polygon
<span class='line'>3923</span>      */</span><span class="WHIT">
<span class='line'>3924</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">drawHalfHelixResidPolygons</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path_class</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data_index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dom_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dom_created_path_length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bottom_curve_points</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top_curve_points</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">height_sline</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">division_curve_lengths</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3925</span> </span><span class="WHIT">        </span><span class="COMM">// var svg = d3.select("#"+svg_id);</span><span class="WHIT">
<span class='line'>3926</span> </span><span class="WHIT">        </span><span class="COMM">// let gresareas = svg.append("g").attr("class", "helix_aa_areas");</span><span class="WHIT">
<span class='line'>3927</span> </span><span class="WHIT">        </span><span class="COMM">// console.log("data2");</span><span class="WHIT">
<span class='line'>3928</span> </span><span class="WHIT">        </span><span class="COMM">// console.log(data);</span><span class="WHIT">
<span class='line'>3929</span> </span><span class="WHIT">        </span><span class="COMM">// let g_res_polygons = d3.select("#g_helix_resids_" + data.dom_name + "_" + data.dom_itype);</span><span class="WHIT">
<span class='line'>3930</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">g_res_polygons</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="STRN">"#"</span><span class="PUNC">+</span><span class="NAME">path_class</span><span class="PUNC">+</span><span class="STRN">"_resids"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3931</span> </span><span class="WHIT">        
<span class='line'>3932</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cardinalDrawing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.line</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">curve</span><span class="PUNC">(</span><span class="NAME">d3.curveCardinal</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//https://github.com/d3/d3-shape#curveCardinalClosed</span><span class="WHIT">
<span class='line'>3933</span> </span><span class="WHIT">    
<span class='line'>3934</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">left_mid_pt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateDotMiddlePoint</span><span class="PUNC">(</span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3935</span> </span><span class="WHIT">    
<span class='line'>3936</span>         </span><span class="NAME">division_curve_lengths</span><span class="WHIT">
<span class='line'>3937</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">right_mid_pt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3938</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">division_curve_lengths</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3939</span> </span><span class="WHIT">            </span><span class="NAME">right_mid_pt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateDotMiddlePoint</span><span class="PUNC">(</span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3940</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3941</span> </span><span class="WHIT">    
<span class='line'>3942</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">smleft_bottom_to_top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>3943</span> </span><span class="WHIT">            </span><span class="NAME">dotToCoords</span><span class="PUNC">(</span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3944</span> </span><span class="WHIT">            </span><span class="NAME">dotToCoords</span><span class="PUNC">(</span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3945</span> </span><span class="WHIT">        </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3946</span> </span><span class="WHIT">    
<span class='line'>3947</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">left_bottom_to_top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateXMidPts</span><span class="PUNC">(</span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3948</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">left_top_to_bottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateXMidPts</span><span class="PUNC">(</span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3949</span> </span><span class="WHIT">    
<span class='line'>3950</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">right_bottom_to_top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3951</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">right_top_to_bottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3952</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">division_curve_lengths</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3953</span> </span><span class="WHIT">            </span><span class="NAME">right_bottom_to_top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateXMidPts</span><span class="PUNC">(</span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3954</span> </span><span class="WHIT">            </span><span class="NAME">right_top_to_bottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateXMidPts</span><span class="PUNC">(</span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3955</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3956</span> </span><span class="WHIT">    
<span class='line'>3957</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">array_of_pathpts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3958</span> </span><span class="WHIT">        
<span class='line'>3959</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">division_curve_lengths</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3960</span> </span><span class="WHIT">            </span><span class="COMM">// each polygon class should be index of half turn residue for easy coloring</span><span class="WHIT">
<span class='line'>3961</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>3962</span> </span><span class="WHIT">                </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// first polygon (left in bck, right in frt)</span><span class="WHIT">
<span class='line'>3963</span> </span><span class="WHIT">                </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// center polygon</span><span class="WHIT">
<span class='line'>3964</span> </span><span class="WHIT">                </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="COMM">//right polygon (right in bck, left in frt)</span><span class="WHIT">
<span class='line'>3965</span> </span><span class="WHIT">            </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3966</span> </span><span class="WHIT">    
<span class='line'>3967</span>             </span><span class="COMM">//first polygon downward segment</span><span class="WHIT">
<span class='line'>3968</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">pathSegmentToXYPoints</span><span class="PUNC">(</span><span class="NAME">dom_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">height_sline</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3969</span> </span><span class="WHIT">            </span><span class="COMM">//first polygon horizontal segment 1</span><span class="WHIT">
<span class='line'>3970</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">pathSegmentToXYPoints</span><span class="PUNC">(</span><span class="NAME">dom_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">height_sline</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"path_len_to_pt"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3971</span> </span><span class="WHIT">            </span><span class="COMM">// first polygon upward segment</span><span class="WHIT">
<span class='line'>3972</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">left_bottom_to_top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3973</span> </span><span class="WHIT">            </span><span class="COMM">// array_of_pathpts[0].push(...pathSegmentToXYPoints(dom_created_path, height_sline, bottom_curve_points["left"]["path_len_to_pt"], 5));</span><span class="WHIT">
<span class='line'>3974</span> </span><span class="WHIT">            </span><span class="COMM">//first polygon horizontal segment 2</span><span class="WHIT">
<span class='line'>3975</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">pathSegmentToXYPoints</span><span class="PUNC">(</span><span class="NAME">dom_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"path_len_to_pt"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dom_created_path_length</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3976</span> </span><span class="WHIT">    
<span class='line'>3977</span>             </span><span class="COMM">//second polygon downward segment</span><span class="WHIT">
<span class='line'>3978</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">left_top_to_bottom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3979</span> </span><span class="WHIT">            </span><span class="COMM">//second polygon horizontal segment 1</span><span class="WHIT">
<span class='line'>3980</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">pathSegmentToXYPoints</span><span class="PUNC">(</span><span class="NAME">dom_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"path_len_to_pt"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"path_len_to_pt"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3981</span> </span><span class="WHIT">            </span><span class="COMM">// second polygon upward segment</span><span class="WHIT">
<span class='line'>3982</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">right_bottom_to_top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3983</span> </span><span class="WHIT">            </span><span class="COMM">//second polygon horizontal segment 2</span><span class="WHIT">
<span class='line'>3984</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">pathSegmentToXYPoints</span><span class="PUNC">(</span><span class="NAME">dom_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"path_len_to_pt"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"path_len_to_pt"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3985</span> </span><span class="WHIT">    
<span class='line'>3986</span>             </span><span class="COMM">//third polygon downward segment</span><span class="WHIT">
<span class='line'>3987</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">right_top_to_bottom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3988</span> </span><span class="WHIT">            </span><span class="COMM">//third polygon horizontal segment 1</span><span class="WHIT">
<span class='line'>3989</span> </span><span class="WHIT">            </span><span class="COMM">// array_of_pathpts[2].push(...pathSegmentToXYPoints(dom_created_path, bottom_curve_points["right"]["path_len_to_pt"], (height_sline+curve_length), 5));</span><span class="WHIT">
<span class='line'>3990</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">pathSegmentToXYPoints</span><span class="PUNC">(</span><span class="NAME">dom_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"path_len_to_pt"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">height_sline</span><span class="PUNC">+</span><span class="NAME">division_curve_lengths</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3991</span> </span><span class="WHIT">            </span><span class="COMM">// third polygon upward segment</span><span class="WHIT">
<span class='line'>3992</span> </span><span class="WHIT">            </span><span class="COMM">// array_of_pathpts[2].push(...pathSegmentToXYPoints(dom_created_path, (height_sline+curve_length), ((height_sline*2)+curve_length), 5));</span><span class="WHIT">
<span class='line'>3993</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">pathSegmentToXYPoints</span><span class="PUNC">(</span><span class="NAME">dom_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">height_sline</span><span class="PUNC">+</span><span class="NAME">division_curve_lengths</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">height_sline</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">division_curve_lengths</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3994</span> </span><span class="WHIT">            </span><span class="COMM">//third polygon horizontal segment 2</span><span class="WHIT">
<span class='line'>3995</span> </span><span class="WHIT">            </span><span class="COMM">// array_of_pathpts[2].push(...pathSegmentToXYPoints(dom_created_path, ((height_sline*2)+curve_length), top_curve_points["right"]["path_len_to_pt"],2));</span><span class="WHIT">
<span class='line'>3996</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">pathSegmentToXYPoints</span><span class="PUNC">(</span><span class="NAME">dom_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">height_sline</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">division_curve_lengths</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"path_len_to_pt"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3997</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3998</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>3999</span> </span><span class="WHIT">                </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// first polygon (left in bck, right in frt)</span><span class="WHIT">
<span class='line'>4000</span> </span><span class="WHIT">                </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// center polygon</span><span class="WHIT">
<span class='line'>4001</span> </span><span class="WHIT">            </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4002</span> </span><span class="WHIT">    
<span class='line'>4003</span>             </span><span class="COMM">//first polygon downward segment</span><span class="WHIT">
<span class='line'>4004</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">pathSegmentToXYPoints</span><span class="PUNC">(</span><span class="NAME">dom_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">height_sline</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4005</span> </span><span class="WHIT">            </span><span class="COMM">//first polygon horizontal segment 1</span><span class="WHIT">
<span class='line'>4006</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">pathSegmentToXYPoints</span><span class="PUNC">(</span><span class="NAME">dom_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">height_sline</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bottom_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"path_len_to_pt"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4007</span> </span><span class="WHIT">            </span><span class="COMM">// first polygon upward segment</span><span class="WHIT">
<span class='line'>4008</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">left_bottom_to_top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4009</span> </span><span class="WHIT">            </span><span class="COMM">// array_of_pathpts[0].push(...pathSegmentToXYPoints(dom_created_path, height_sline, bottom_curve_points["left"]["path_len_to_pt"], 5));</span><span class="WHIT">
<span class='line'>4010</span> </span><span class="WHIT">            </span><span class="COMM">//first polygon horizontal segment 2</span><span class="WHIT">
<span class='line'>4011</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">pathSegmentToXYPoints</span><span class="PUNC">(</span><span class="NAME">dom_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top_curve_points</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"path_len_to_pt"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dom_created_path_length</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4012</span> </span><span class="WHIT">            
<span class='line'>4013</span>             </span><span class="COMM">// second polygon downward segment</span><span class="WHIT">
<span class='line'>4014</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">left_top_to_bottom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4015</span> </span><span class="WHIT">            </span><span class="COMM">// second polygon horizontal segment 1</span><span class="WHIT">
<span class='line'>4016</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">pathSegmentToXYPoints</span><span class="PUNC">(</span><span class="NAME">dom_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">height_sline</span><span class="PUNC">+</span><span class="NAME">division_curve_lengths</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">height_sline</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">curve_length</span><span class="PUNC">-</span><span class="NAME">division_curve_lengths</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4017</span> </span><span class="WHIT">            </span><span class="COMM">// second polygon upward segment</span><span class="WHIT">
<span class='line'>4018</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">pathSegmentToXYPoints</span><span class="PUNC">(</span><span class="NAME">dom_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">height_sline</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">curve_length</span><span class="PUNC">-</span><span class="NAME">division_curve_lengths</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">height_sline</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">curve_length</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4019</span> </span><span class="WHIT">            </span><span class="COMM">// second polygon horizontal segment 2</span><span class="WHIT">
<span class='line'>4020</span> </span><span class="WHIT">            </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">pathSegmentToXYPoints</span><span class="PUNC">(</span><span class="NAME">dom_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">height_sline</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">curve_length</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">height_sline</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">curve_length</span><span class="PUNC">-</span><span class="NAME">division_curve_lengths</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">curve_length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4021</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4022</span> </span><span class="WHIT">    
<span class='line'>4023</span>     
<span class='line'>4024</span>         
<span class='line'>4025</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">iapp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iapp</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">array_of_pathpts.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iapp</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4026</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">polygon_pathpts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">array_of_pathpts</span><span class="PUNC">[</span><span class="NAME">iapp</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4027</span> </span><span class="WHIT">            </span><span class="NAME">data.resids</span><span class="PUNC">[</span><span class="NAME">iapp</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"pathpts"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">polygon_pathpts</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4028</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4029</span> </span><span class="WHIT">    
<span class='line'>4030</span>         </span><span class="NAME">g_res_polygons</span><span class="WHIT">
<span class='line'>4031</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">selectAll</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">+</span><span class="NAME">path_class</span><span class="PUNC">+</span><span class="STRN">"_resids_"</span><span class="PUNC">+</span><span class="NAME">data_index</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4032</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="NAME">data.resids</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4033</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>4034</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">enter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4035</span> </span><span class="WHIT">                </span><span class="NAME">enter.append</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4036</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path_class</span><span class="PUNC">+</span><span class="STRN">"_resids_"</span><span class="PUNC">+</span><span class="NAME">data_index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" single_residue_path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4037</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"resname"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4038</span> </span><span class="WHIT">                    </span><span class="COMM">// if (!d.res3 || !d.res_ind) {</span><span class="WHIT">
<span class='line'>4039</span> </span><span class="WHIT">                        </span><span class="COMM">// console.log("d");</span><span class="WHIT">
<span class='line'>4040</span> </span><span class="WHIT">                        </span><span class="COMM">// console.log(d);</span><span class="WHIT">
<span class='line'>4041</span> </span><span class="WHIT">                    </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>4042</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.res_3</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.res_ind</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4043</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4044</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"d"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4045</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">cardinalDrawing</span><span class="PUNC">(</span><span class="NAME">d.pathpts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4046</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4047</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'stroke'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4048</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4049</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4050</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4051</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4052</span> </span><span class="WHIT">                    </span><span class="COMM">// return d["fill"];</span><span class="WHIT">
<span class='line'>4053</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"stroke"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4054</span> </span><span class="WHIT">                    </span><span class="COMM">// return "black";</span><span class="WHIT">
<span class='line'>4055</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4056</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4057</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4058</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4059</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4060</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4061</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4062</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4063</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4064</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4065</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4066</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="PUNC">;</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4067</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4068</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4069</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4070</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'stroke-width'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4071</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke_size</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4072</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4073</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">on</span><span class="PUNC">(</span><span class="STRN">"mouseover"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4074</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4075</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"#######"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4076</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"MOUSE OVER PATH"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4077</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"data:"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4078</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4079</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"#######"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4080</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4081</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4082</span> </span><span class="WHIT">                </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4083</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4084</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">update</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4085</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">update.transition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4086</span> </span><span class="WHIT">    
<span class='line'>4087</span>                 </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'stroke'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4088</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4089</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4090</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4091</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4092</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4093</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4094</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4095</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4096</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4097</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4098</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4099</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4100</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4101</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4102</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4103</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4104</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="PUNC">;</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4105</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4106</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4107</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4108</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4109</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4110</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">exit.remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4111</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4112</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4113</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">created_paths</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementsByClassName</span><span class="PUNC">(</span><span class="NAME">path_class</span><span class="PUNC">+</span><span class="STRN">"_resids_"</span><span class="PUNC">+</span><span class="NAME">data_index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4114</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">icp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">icp</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">created_paths.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">icp</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4115</span> </span><span class="WHIT">            </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">created_paths</span><span class="PUNC">[</span><span class="NAME">icp</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4116</span> </span><span class="WHIT">            </span><span class="COMM">// let path_box = element.getBoundingClientRect();</span><span class="WHIT">
<span class='line'>4117</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">path_box</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">element.getBBox</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4118</span> </span><span class="WHIT">            </span><span class="COMM">// let xCenter = (path_box.left + path_box.right) / 2;</span><span class="WHIT">
<span class='line'>4119</span> </span><span class="WHIT">            </span><span class="COMM">// let yCenter = (path_box.top + path_box.bottom) / 2;</span><span class="WHIT">
<span class='line'>4120</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">xCenter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">path_box.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">path_box.width</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4121</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">yCenter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">path_box.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">path_box.height</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4122</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">new_datum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">datum</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4123</span> </span><span class="WHIT">            </span><span class="NAME">new_datum</span><span class="PUNC">[</span><span class="STRN">"centroid"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">xCenter</span><span class="PUNC">,</span><span class="NAME">yCenter</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4124</span> </span><span class="WHIT">            </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">datum</span><span class="PUNC">(</span><span class="NAME">new_datum</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4125</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">new_datum.res_ind</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"NaN"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4126</span> </span><span class="WHIT">                </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4127</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4128</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4129</span> </span><span class="WHIT">        </span><span class="COMM">// for (let icp = 0; icp &lt; created_paths.length; icp++) {</span><span class="WHIT">
<span class='line'>4130</span> </span><span class="WHIT">        </span><span class="COMM">//     const element = created_paths[icp];</span><span class="WHIT">
<span class='line'>4131</span> </span><span class="WHIT">        </span><span class="COMM">//     console.log(d3.select(element).datum());</span><span class="WHIT">
<span class='line'>4132</span> </span><span class="WHIT">        </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>4133</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4134</span> </span><span class="WHIT">    
<span class='line'>4135</span>     </span><span class="COMM">/**
<span class='line'>4136</span>      * Partitions half-helix paths into new path elements, each corresponding to a single residue
<span class='line'>4137</span>      * @namespace
<span class='line'>4138</span>      * @exports NaView
<span class='line'>4139</span>      * @name draw_helices_resids_cartoon 
<span class='line'>4140</span>      * @see pathStringToStringPoints
<span class='line'>4141</span>      * @see getHalfHelixBoundaries
<span class='line'>4142</span>      * @see drawHalfHelixResidPolygons
<span class='line'>4143</span>      * @see drawSingleHalfHelixResidue
<span class='line'>4144</span>      * @param {Array} data back half helices or front half helices specific data array
<span class='line'>4145</span>      * @param {String} path_class name to generate group element class of new sub paths
<span class='line'>4146</span>      */</span><span class="WHIT">
<span class='line'>4147</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_helices_resids_cartoon</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path_class</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4148</span> </span><span class="WHIT">        </span><span class="COMM">// function draw_helices_resids_cartoon(data, path_class, half_turns_number, aanum_parity) {</span><span class="WHIT">
<span class='line'>4149</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">g_helix_resids</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="STRN">"#g_helix_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_itype</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4150</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4151</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4152</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">path_class</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_resids"</span><span class="WHIT">
<span class='line'>4153</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4154</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"g_helix_resids residue_path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4155</span> </span><span class="WHIT">        </span><span class="COMM">// .style("display", "none")</span><span class="WHIT">
<span class='line'>4156</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">style</span><span class="PUNC">(</span><span class="STRN">"visibility"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"hidden"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4157</span> </span><span class="WHIT">        </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4158</span> </span><span class="WHIT">    
<span class='line'>4159</span>     
<span class='line'>4160</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">created_paths</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementsByClassName</span><span class="PUNC">(</span><span class="NAME">path_class</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4161</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i_path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i_path</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">created_paths.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i_path</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4162</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">start_a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mid_a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">end_a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4163</span> </span><span class="WHIT">            
<span class='line'>4164</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_created_path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">created_paths</span><span class="PUNC">[</span><span class="NAME">i_path</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4165</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_cpath_bbox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dom_created_path.getBBox</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4166</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_created_path_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">dom_cpath_bbox.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dom_cpath_bbox.width</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dom_cpath_bbox.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dom_cpath_bbox.height</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4167</span> </span><span class="WHIT">    
<span class='line'>4168</span>             </span><span class="COMM">// mid_a = [dom_created_path_centroid[0], dom_created_path_centroid[1]];</span><span class="WHIT">
<span class='line'>4169</span> </span><span class="WHIT">    
<span class='line'>4170</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">d3_created_path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="NAME">dom_created_path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4171</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">path_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3_created_path.datum</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4172</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ptype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">path_data.points</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">pathtype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4173</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">pind</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">path_data.points</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">turn_index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4174</span> </span><span class="WHIT">    
<span class='line'>4175</span>             </span><span class="COMM">// let creation_string ="Domain: "+ path_data.dom_name +" Helix: "+ path_data.dom_itype +" Half Type: "+ ptype +" Half Index: "+ pind;</span><span class="WHIT">
<span class='line'>4176</span> </span><span class="WHIT">            </span><span class="COMM">// console.log(creation_string);</span><span class="WHIT">
<span class='line'>4177</span> </span><span class="WHIT">    
<span class='line'>4178</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">parts_division</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">path_data.parts_division</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4179</span> </span><span class="WHIT">    
<span class='line'>4180</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">path_sline_str</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pathStringToStringPoints</span><span class="PUNC">(</span><span class="NAME">d3_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"M"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4181</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">path_sline_split</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">path_sline_str.split</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4182</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">height_sline</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">path_sline_split</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">path_sline_split</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4183</span> </span><span class="WHIT">            
<span class='line'>4184</span>             </span><span class="COMM">//for this use getTotalLength of path for curves</span><span class="WHIT">
<span class='line'>4185</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_created_path_length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dom_created_path.getTotalLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4186</span> </span><span class="WHIT">    
<span class='line'>4187</span>             </span><span class="COMM">//and subtract 2 times line height and divide by 2</span><span class="WHIT">
<span class='line'>4188</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dom_created_path_length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">height_sline</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4189</span> </span><span class="WHIT">            
<span class='line'>4190</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">curve_length</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4191</span> </span><span class="WHIT">            </span><span class="COMM">// let displacement_ps = curve_step*style_obj["protein"]["helix_draw_opts"]["draw"]["aa_area_perc_displacement"];</span><span class="WHIT">
<span class='line'>4192</span> </span><span class="WHIT">            </span><span class="COMM">// //the use getpointatlength for getting the desired points at each third of path</span><span class="WHIT">
<span class='line'>4193</span> </span><span class="WHIT">            
<span class='line'>4194</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">current_division</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4195</span> </span><span class="WHIT">                </span><span class="STRN">"size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">d3.sum</span><span class="PUNC">(</span><span class="NAME">parts_division</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4196</span> </span><span class="WHIT">                </span><span class="STRN">"curve_steps"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>4197</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4198</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ipd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ipd</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">parts_division.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ipd</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4199</span> </span><span class="WHIT">                </span><span class="NAME">current_division</span><span class="PUNC">[</span><span class="STRN">"curve_steps"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="STRN">"size"</span><span class="PUNC">:</span><span class="NAME">parts_division</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"csize"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4200</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4201</span> </span><span class="WHIT">    
<span class='line'>4202</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parts_division.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4203</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">results_pts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4204</span> </span><span class="WHIT">                </span><span class="NAME">results_pts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getHalfHelixBoundaries</span><span class="PUNC">(</span><span class="NAME">dom_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dom_created_path_length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">height_sline</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">current_division</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4205</span> </span><span class="WHIT">                </span><span class="NAME">drawHalfHelixResidPolygons</span><span class="PUNC">(</span><span class="NAME">path_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path_class</span><span class="PUNC">,</span><span class="NAME">i_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dom_created_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dom_created_path_length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">results_pts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">results_pts</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">height_sline</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">results_pts</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">results_pts</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4206</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4207</span> </span><span class="WHIT">                </span><span class="NAME">drawSingleHalfHelixResidue</span><span class="PUNC">(</span><span class="NAME">path_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path_class</span><span class="PUNC">,</span><span class="NAME">i_path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dom_created_path</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4208</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4209</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4210</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4211</span> </span><span class="WHIT">    
<span class='line'>4212</span>     </span><span class="COMM">/**
<span class='line'>4213</span>      * Plots helices in Cartoon Mode.
<span class='line'>4214</span>      * 1. Generates data for each Helix half turns
<span class='line'>4215</span>      * 2. Builds bezier curves according to helix properties set in style_obj
<span class='line'>4216</span>      * 3. Partition Path Helix Half Turns SVG Object into sub-objects for each residue.
<span class='line'>4217</span>      * @namespace
<span class='line'>4218</span>      * @exports NaView
<span class='line'>4219</span>      * @name draw_helices_cartoon 
<span class='line'>4220</span>      * @see gen_helix_cartoon_halfturn_data
<span class='line'>4221</span>      * @see buildPathStringFromData
<span class='line'>4222</span>      * @see draw_helices_resids_cartoon
<span class='line'>4223</span>      * @param {Array} data helix data generated from processRawUniProt
<span class='line'>4224</span>      */</span><span class="WHIT">
<span class='line'>4225</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_helices_cartoon</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4226</span> </span><span class="WHIT">    </span><span class="COMM">// function draw_helices_cartoon(data, dataId, dataClass) {</span><span class="WHIT">
<span class='line'>4227</span> </span><span class="WHIT">    
<span class='line'>4228</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">svg_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="STRN">"#"</span><span class="PUNC">+</span><span class="NAME">svg_id</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4229</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4230</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"helices_group"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4231</span> </span><span class="WHIT">    
<span class='line'>4232</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4233</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4234</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helix_to_draw_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">gen_helix_cartoon_halfturn_data</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4235</span> </span><span class="WHIT">            
<span class='line'>4236</span>             </span><span class="COMM">//create helix g and draw it</span><span class="WHIT">
<span class='line'>4237</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cartoon_helix_g</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_element.append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4238</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4239</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"g_helix_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">obj.dom_name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">obj.dom_itype</span><span class="WHIT">
<span class='line'>4240</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4241</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"element_path_group"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4242</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">datum</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4243</span> </span><span class="WHIT">            </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4244</span> </span><span class="WHIT">    
<span class='line'>4245</span>             </span><span class="COMM">//draw back helix path</span><span class="WHIT">
<span class='line'>4246</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bck_path_class</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"bck_h_hel_path_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">obj.dom_name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">obj.dom_itype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4247</span> </span><span class="WHIT">            </span><span class="NAME">cartoon_helix_g.append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4248</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"back_half_helix element_path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4249</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">selectAll</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">+</span><span class="NAME">bck_path_class</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4250</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="NAME">helix_to_draw_data</span><span class="PUNC">[</span><span class="STRN">"back"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4251</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">enter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4252</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">'path'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4253</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bck_path_class</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4254</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'d'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4255</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">buildPathStringFromData</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4256</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4257</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'stroke'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke_color</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4258</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'stroke-width'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke_size</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4259</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'fill'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.fill</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4260</span> </span><span class="WHIT">                </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4261</span> </span><span class="WHIT">    
<span class='line'>4262</span>             </span><span class="COMM">// draw_helices_resids_cartoon(helix_to_draw_data["back"], bck_path_class,  helix_to_draw_data["half_turns_number"], helix_to_draw_data["aanum_parity"]);</span><span class="WHIT">
<span class='line'>4263</span> </span><span class="WHIT">            </span><span class="NAME">draw_helices_resids_cartoon</span><span class="PUNC">(</span><span class="NAME">helix_to_draw_data</span><span class="PUNC">[</span><span class="STRN">"back"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bck_path_class</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4264</span> </span><span class="WHIT">            
<span class='line'>4265</span>             </span><span class="COMM">//draw front helix path</span><span class="WHIT">
<span class='line'>4266</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">frt_path_class</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"frt_h_hel_path_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">obj.dom_name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">obj.dom_itype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4267</span> </span><span class="WHIT">            </span><span class="NAME">cartoon_helix_g.append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4268</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"front_half_helix element_path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4269</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">selectAll</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">+</span><span class="NAME">frt_path_class</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4270</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="NAME">helix_to_draw_data</span><span class="PUNC">[</span><span class="STRN">"front"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4271</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">enter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4272</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">'path'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4273</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">frt_path_class</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4274</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'d'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4275</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">buildPathStringFromData</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4276</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4277</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'stroke'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke_color</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4278</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'stroke-width'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke_size</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4279</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'fill'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.fill</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4280</span> </span><span class="WHIT">                </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4281</span> </span><span class="WHIT">                </span><span class="COMM">// draw_helices_resids_cartoon(helix_to_draw_data["front"], frt_path_class,  helix_to_draw_data["half_turns_number"], helix_to_draw_data["aanum_parity"]);</span><span class="WHIT">
<span class='line'>4282</span> </span><span class="WHIT">                </span><span class="NAME">draw_helices_resids_cartoon</span><span class="PUNC">(</span><span class="NAME">helix_to_draw_data</span><span class="PUNC">[</span><span class="STRN">"front"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">frt_path_class</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4283</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4284</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4285</span> </span><span class="WHIT">    
<span class='line'>4286</span>     </span><span class="COMM">/**
<span class='line'>4287</span>      * Calculates helices anchoring points for loop elements
<span class='line'>4288</span>      * @namespace
<span class='line'>4289</span>      * @exports NaView
<span class='line'>4290</span>      * @name get_helices_endpoints 
<span class='line'>4291</span>      * @param {String} helix_mode helix drawing mode defined in stye_obj
<span class='line'>4292</span>      * @param {Array} helices_data already plotted helix data generated from processRawUniProt with draw areas
<span class='line'>4293</span>      * @yields {Array} already plotted helix data now also including anchoring points
<span class='line'>4294</span>      */</span><span class="WHIT">
<span class='line'>4295</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">get_helices_endpoints</span><span class="PUNC">(</span><span class="NAME">helix_mode</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">helices_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4296</span> </span><span class="WHIT">        </span><span class="COMM">//iterate over helices, get their elements, calculate centroid or box points, push to data</span><span class="WHIT">
<span class='line'>4297</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ihg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ihg</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">helices_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ihg</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4298</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helix_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helices_data</span><span class="PUNC">[</span><span class="NAME">ihg</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4299</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helix_group</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"g_helix_"</span><span class="PUNC">+</span><span class="NAME">helix_data.dom_name</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">helix_data.dom_itype</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4300</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">residue_groups</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helix_group.getElementsByClassName</span><span class="PUNC">(</span><span class="STRN">"g_helix_resids"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4301</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">helix_group_bcr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helix_group.getBBox</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4302</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">maximum_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4303</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">maximum_bbox</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4304</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">element_of_maximum_y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4305</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">irg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">irg</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">residue_groups.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">irg</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4306</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">residue_group</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">residue_groups</span><span class="PUNC">[</span><span class="NAME">irg</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4307</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">residue_elements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">residue_group.childNodes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4308</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ire</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ire</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">residue_elements.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ire</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4309</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">residue_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">residue_elements</span><span class="PUNC">[</span><span class="NAME">ire</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4310</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">residue_element_box</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">residue_element.getBoundingClientRect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4311</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">residue_element_box.y</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">maximum_y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4312</span> </span><span class="WHIT">                        </span><span class="NAME">element_of_maximum_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">residue_element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4313</span> </span><span class="WHIT">                        </span><span class="NAME">maximum_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">residue_element_box.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4314</span> </span><span class="WHIT">                        </span><span class="NAME">maximum_bbox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">residue_element.getBBox</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4315</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4316</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4317</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4318</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_anchor_start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helix_group_bcr.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">helix_group_bcr.width</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4319</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_anchor_end</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maximum_bbox.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">maximum_bbox.width</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4320</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">helix_mode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"cartoon"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4321</span> </span><span class="WHIT">                </span><span class="NAME">x_anchor_start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helix_group_bcr.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4322</span> </span><span class="WHIT">                </span><span class="NAME">x_anchor_end</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maximum_bbox.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">maximum_bbox.width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4323</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">element_to_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">element_of_maximum_y.querySelector</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4324</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">element_to_data_class</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="NAME">element_to_data</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4325</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">element_to_data_class.includes</span><span class="PUNC">(</span><span class="STRN">"frt"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4326</span> </span><span class="WHIT">                    </span><span class="NAME">x_anchor_end</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maximum_bbox.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4327</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4328</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4329</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_anchor_start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">helix_group_bcr.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4330</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_anchor_end</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maximum_bbox.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">maximum_bbox.height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4331</span> </span><span class="WHIT">            </span><span class="NAME">helices_data</span><span class="PUNC">[</span><span class="NAME">ihg</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4332</span> </span><span class="WHIT">                </span><span class="STRN">"top"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="NAME">x_anchor_start</span><span class="PUNC">,</span><span class="NAME">y_anchor_start</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4333</span> </span><span class="WHIT">                </span><span class="STRN">"bottom"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="NAME">x_anchor_end</span><span class="PUNC">,</span><span class="NAME">y_anchor_end</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>4334</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4335</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4336</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">helices_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4337</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4338</span> </span><span class="WHIT">    
<span class='line'>4339</span>     </span><span class="COMM">/**
<span class='line'>4340</span>      * Plots helices in mode defined by style_obj.
<span class='line'>4341</span>      * @namespace
<span class='line'>4342</span>      * @exports NaView
<span class='line'>4343</span>      * @name draw_helices 
<span class='line'>4344</span>      * @see draw_helices_box
<span class='line'>4345</span>      * @see draw_helices_cylinder
<span class='line'>4346</span>      * @see draw_helices_cartoon
<span class='line'>4347</span>      * @see get_helices_endpoints
<span class='line'>4348</span>      * @param {Array} helices_data helix data generated from processRawUniProt with draw area
<span class='line'>4349</span>      * @yields {Array}  helix data generated from processRawUniProt with additional information generated from plot
<span class='line'>4350</span>      */</span><span class="WHIT">
<span class='line'>4351</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_helices</span><span class="PUNC">(</span><span class="NAME">helices_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4352</span> </span><span class="WHIT">        </span><span class="COMM">//helix can be box, cylinder or cartoon helix</span><span class="WHIT">
<span class='line'>4353</span> </span><span class="WHIT">        </span><span class="COMM">//membrane can be box or lipid</span><span class="WHIT">
<span class='line'>4354</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style_obj.protein.helix_mode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"box"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4355</span> </span><span class="WHIT">            </span><span class="COMM">// draw_helices_box(helices_data, "helices", "helices");</span><span class="WHIT">
<span class='line'>4356</span> </span><span class="WHIT">            </span><span class="NAME">draw_helices_box</span><span class="PUNC">(</span><span class="NAME">helices_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"helices"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4357</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style_obj.protein.helix_mode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"cylinder"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4358</span> </span><span class="WHIT">            </span><span class="COMM">// draw_helices_cylinder(helices_data, "helices", "helices");</span><span class="WHIT">
<span class='line'>4359</span> </span><span class="WHIT">            </span><span class="NAME">draw_helices_cylinder</span><span class="PUNC">(</span><span class="NAME">helices_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"helices"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4360</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style_obj.protein.helix_mode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"cartoon"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4361</span> </span><span class="WHIT">            </span><span class="COMM">// draw_helices_cartoon(helices_data, "helices", "helices");</span><span class="WHIT">
<span class='line'>4362</span> </span><span class="WHIT">            </span><span class="NAME">draw_helices_cartoon</span><span class="PUNC">(</span><span class="NAME">helices_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4363</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4364</span> </span><span class="WHIT">        </span><span class="NAME">helices_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">get_helices_endpoints</span><span class="PUNC">(</span><span class="NAME">style_obj.protein.helix_mode</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">helices_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4365</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">helices_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4366</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4367</span> </span><span class="WHIT">    
<span class='line'>4368</span>     </span><span class="COMM">/**
<span class='line'>4369</span>      * Creates a vector from the difference of two 2d-vectors
<span class='line'>4370</span>      * @namespace
<span class='line'>4371</span>      * @exports NaView
<span class='line'>4372</span>      * @name createVector 
<span class='line'>4373</span>      * @param {Array} p1 array of coordinates 1
<span class='line'>4374</span>      * @param {Array} p2 array of coordinates 2
<span class='line'>4375</span>      * @yields {Array} array of coordinates from the difference between two vectors
<span class='line'>4376</span>      */</span><span class="WHIT">
<span class='line'>4377</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">createVector</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4378</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4379</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4380</span> 
<span class='line'>4381</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4382</span>      * Normalizes a 2d-vector
<span class='line'>4383</span>      * @namespace
<span class='line'>4384</span>      * @exports NaView
<span class='line'>4385</span>      * @name normalizeVector 
<span class='line'>4386</span>      * @param {Array} v1 array of coordinates 1
<span class='line'>4387</span>      * @yields {Array} normalized array of coordinates
<span class='line'>4388</span>      */</span><span class="WHIT">
<span class='line'>4389</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">normalizeVector</span><span class="PUNC">(</span><span class="NAME">v1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4390</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">v1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">v1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4391</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">v1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NAME">dist</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NAME">dist</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4392</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4393</span> </span><span class="WHIT">    
<span class='line'>4394</span>     </span><span class="COMM">/**
<span class='line'>4395</span>      * Scales a 2d-vector to a given length
<span class='line'>4396</span>      * @namespace
<span class='line'>4397</span>      * @exports NaView
<span class='line'>4398</span>      * @name scaleVector 
<span class='line'>4399</span>      * @param {Array} v1 array of coordinates 1
<span class='line'>4400</span>      * @param {number} val length to scale vector to
<span class='line'>4401</span>      * @yields {Array} scaled array of coordinates
<span class='line'>4402</span>      */</span><span class="WHIT">
<span class='line'>4403</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">scaleVector</span><span class="PUNC">(</span><span class="NAME">v1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4404</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">v1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4405</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4406</span> 
<span class='line'>4407</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4408</span>      * Rotates a 2d-vector 90 degrees in the clockwise or anticlockwise directions
<span class='line'>4409</span>      * @namespace
<span class='line'>4410</span>      * @exports NaView
<span class='line'>4411</span>      * @name rotate90 
<span class='line'>4412</span>      * @param {Array} v1 array of coordinates 1
<span class='line'>4413</span>      * @param {String} direction String that defines clockwise or anticlockwise 90 rotation of vector
<span class='line'>4414</span>      * @param {Array} centerp array of coordinates to center rotated vector
<span class='line'>4415</span>      * @yields {Array} rotated array of coordinates
<span class='line'>4416</span>      */</span><span class="WHIT">
<span class='line'>4417</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">rotate90</span><span class="PUNC">(</span><span class="NAME">v1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">direction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">centerp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4418</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">direction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4419</span> </span><span class="WHIT">            </span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"clockwise"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4420</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4421</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">centerp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4422</span> </span><span class="WHIT">            </span><span class="NAME">centerp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4423</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4424</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"clockwise"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4425</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>4426</span> </span><span class="WHIT">                </span><span class="COMM">// (v1[1] - centerp[1]) + centerp[0],</span><span class="WHIT">
<span class='line'>4427</span> </span><span class="WHIT">                </span><span class="COMM">// (-1*(v1[0]-centerp[0]))+centerp[1]</span><span class="WHIT">
<span class='line'>4428</span> </span><span class="WHIT">                </span><span class="NAME">v1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">centerp</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4429</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">*</span><span class="NAME">v1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">centerp</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>4430</span> </span><span class="WHIT">            </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4431</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4432</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>4433</span> </span><span class="WHIT">                </span><span class="COMM">// (-1*(v1[1] -centerp[1])) + centerp[0],</span><span class="WHIT">
<span class='line'>4434</span> </span><span class="WHIT">                </span><span class="COMM">// (v1[0]-centerp[0])+centerp[1]</span><span class="WHIT">
<span class='line'>4435</span> </span><span class="WHIT">                </span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">*</span><span class="NAME">v1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">centerp</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4436</span> </span><span class="WHIT">                </span><span class="NAME">v1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">centerp</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>4437</span> </span><span class="WHIT">            </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4438</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4439</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4440</span> 
<span class='line'>4441</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4442</span>      * Rotates a 2d-vector by a given angle
<span class='line'>4443</span>      * @namespace
<span class='line'>4444</span>      * @exports NaView
<span class='line'>4445</span>      * @name rotateByAng 
<span class='line'>4446</span>      * @param {Array} v1 array of coordinates 1
<span class='line'>4447</span>      * @param {Array} centerp array of coordinates to center rotated vector
<span class='line'>4448</span>      * @param {number} angle angle in degrees to rotate a vector to
<span class='line'>4449</span>      * @yields {Array} rotated array of coordinates
<span class='line'>4450</span>      */</span><span class="WHIT">
<span class='line'>4451</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">rotateByAng</span><span class="PUNC">(</span><span class="NAME">v1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">centerp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4452</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4453</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4454</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">centerp</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4455</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">centerp</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4456</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">radians</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">180</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4457</span> </span><span class="WHIT">            </span><span class="NAME">cos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">radians</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4458</span> </span><span class="WHIT">            </span><span class="NAME">sin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">radians</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4459</span> </span><span class="WHIT">            </span><span class="COMM">// nx = (cos * (x - cx)) + (sin * (y - cy)) + cx,</span><span class="WHIT">
<span class='line'>4460</span> </span><span class="WHIT">            </span><span class="COMM">// ny = (cos * (y - cy)) - (sin * (x - cx)) + cy;</span><span class="WHIT">
<span class='line'>4461</span> </span><span class="WHIT">            </span><span class="NAME">nx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cos</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sin</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cx</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4462</span> </span><span class="WHIT">            </span><span class="NAME">ny</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cos</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sin</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4463</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">nx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ny</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4464</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4465</span> 
<span class='line'>4466</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4467</span>      * Calculates coordinates at a given angle and distance from another point
<span class='line'>4468</span>      * @namespace
<span class='line'>4469</span>      * @exports NaView
<span class='line'>4470</span>      * @name getPointAtAngleDistance 
<span class='line'>4471</span>      * @param {number} x coordinate x of initial point
<span class='line'>4472</span>      * @param {number} y coordinate y of initial point
<span class='line'>4473</span>      * @param {number} angle desired angle to find a point
<span class='line'>4474</span>      * @param {number} distance desired distance to find a point
<span class='line'>4475</span>      * @yields {Array} coordinates at a given angle and distance
<span class='line'>4476</span>      */</span><span class="WHIT">
<span class='line'>4477</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getPointAtAngleDistance</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4478</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4479</span> </span><span class="WHIT">        </span><span class="NAME">result.push</span><span class="PUNC">(</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">180</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4480</span> </span><span class="WHIT">        </span><span class="NAME">result.push</span><span class="PUNC">(</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">180</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4481</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4482</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4483</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4484</span>      * Calculates angle between three points. Center point is B
<span class='line'>4485</span>      * @namespace
<span class='line'>4486</span>      * @exports NaView
<span class='line'>4487</span>      * @name find_angle 
<span class='line'>4488</span>      * @param {Array} A array of coordinates A
<span class='line'>4489</span>      * @param {Array} B array of coordinates B (center)
<span class='line'>4490</span>      * @param {Array} C array of coordinates C
<span class='line'>4491</span>      * @yields {number} coordinates at a given angle and distance
<span class='line'>4492</span>      */</span><span class="WHIT">
<span class='line'>4493</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">find_angle</span><span class="PUNC">(</span><span class="NAME">A</span><span class="PUNC">,</span><span class="NAME">B</span><span class="PUNC">,</span><span class="NAME">C</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4494</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">AB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">B</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">A</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">B</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">A</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    
<span class='line'>4495</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">BC</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">B</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">C</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">B</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">C</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>4496</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">AC</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">C</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">A</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">C</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">A</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4497</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">radians_angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.acos</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">BC</span><span class="PUNC">*</span><span class="NAME">BC</span><span class="PUNC">+</span><span class="NAME">AB</span><span class="PUNC">*</span><span class="NAME">AB</span><span class="PUNC">-</span><span class="NAME">AC</span><span class="PUNC">*</span><span class="NAME">AC</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">BC</span><span class="PUNC">*</span><span class="NAME">AB</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4498</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">radians_angle</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">180</span><span class="PUNC">/</span><span class="NAME">Math.PI</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4499</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4500</span> 
<span class='line'>4501</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4502</span>      * Calculates the length of a SVG path without displaying it on a screen
<span class='line'>4503</span>      * @namespace
<span class='line'>4504</span>      * @exports NaView
<span class='line'>4505</span>      * @name getGhostPathLength 
<span class='line'>4506</span>      * @param {Array} pts Array of coordinates to draw a path using d3.curveNatural
<span class='line'>4507</span>      * @param {String} path_id_keep id of generated "ghost" path. if set, vector is not automatically removed from SVG
<span class='line'>4508</span>      * @yields {number} calculated length of a vector
<span class='line'>4509</span>      */</span><span class="WHIT">
<span class='line'>4510</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getGhostPathLength</span><span class="PUNC">(</span><span class="NAME">pts</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path_id_keep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4511</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.line</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">curve</span><span class="PUNC">(</span><span class="NAME">d3.curveNatural</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4512</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">pg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="STRN">"#"</span><span class="PUNC">+</span><span class="NAME">svg_id</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4513</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4514</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4515</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">path_id_keep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4516</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"par"</span><span class="PUNC">+</span><span class="NAME">path_id_keep</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4517</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4518</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4519</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4520</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"visibility"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"hidden"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4521</span> 
<span class='line'>4522</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pg.append</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4523</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4524</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">path_id_keep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4525</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">path_id_keep</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4526</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4527</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4528</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4529</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"d"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4530</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">curve</span><span class="PUNC">(</span><span class="NAME">pts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4531</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4532</span> 
<span class='line'>4533</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.node</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTotalLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4534</span> </span><span class="WHIT">        </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">roundDecimals</span><span class="PUNC">(</span><span class="NAME">val</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4535</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">path_id_keep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4536</span> </span><span class="WHIT">            </span><span class="NAME">pg.remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4537</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4538</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4539</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4540</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4541</span>      * Calculates length of a vector between two points using the pythagorean theorem
<span class='line'>4542</span>      * @namespace
<span class='line'>4543</span>      * @exports NaView
<span class='line'>4544</span>      * @name euclideanDistance 
<span class='line'>4545</span>      * @param {Array} p1 array of coordinates 1
<span class='line'>4546</span>      * @param {Array} p2 array of coordinates 2
<span class='line'>4547</span>      * @yields {number} length of vector between two coordinates
<span class='line'>4548</span>      */</span><span class="WHIT">
<span class='line'>4549</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">euclideanDistance</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4550</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4551</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4552</span> 
<span class='line'>4553</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4554</span>      * Simple loop curve generating function.&lt;br>
<span class='line'>4555</span>      * 1. A centroid is calculated between two points&lt;br>
<span class='line'>4556</span>      * 2. This centroid y position is raised by a given step in a given direction (scaled_centroid point)&lt;br>
<span class='line'>4557</span>      *    2a. A skew value CAN added to the x positioning of this centroid point&lt;br>
<span class='line'>4558</span>      * 3. Original and scaled centroid are returned.&lt;br>
<span class='line'>4559</span>      * @namespace
<span class='line'>4560</span>      * @exports NaView
<span class='line'>4561</span>      * @name generateSimpleLoopPoints 
<span class='line'>4562</span>      * @param {Array} p1 point 1 (start)
<span class='line'>4563</span>      * @param {Array} p2 point 2 (end)
<span class='line'>4564</span>      * @param {number} step_y number of pixels to scale centroid generating y scaled curve center
<span class='line'>4565</span>      * @param {number} y_direction (1.0 or -1.0), y direction to scale step
<span class='line'>4566</span>      * @param {number} x_skew_perc Optional percentual between centroid x and point 1 x to move the y scaled curve center
<span class='line'>4567</span>      * @param {Object} add_wavefold_obj Optional: addition of a folding object. See &lt;i>&lt;b>&lt;/b>&lt;/i>
<span class='line'>4568</span>      * @yields {Array} list of three points composing curve to be generated by d3.curveNatural left to right: (p1, scaled_centroid, p2)
<span class='line'>4569</span>      */</span><span class="WHIT">
<span class='line'>4570</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">generateSimpleLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">step_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4571</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">y_direction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4572</span> </span><span class="WHIT">            </span><span class="NAME">y_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4573</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4574</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">x_skew_perc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4575</span> </span><span class="WHIT">            </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4576</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4577</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4578</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4579</span> 
<span class='line'>4580</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4581</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4582</span> 
<span class='line'>4583</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">xc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x1</span><span class="PUNC">+</span><span class="NAME">x2</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4584</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">yc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y1</span><span class="PUNC">+</span><span class="NAME">y2</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4585</span> 
<span class='line'>4586</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x_skew_perc</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">xc</span><span class="PUNC">-</span><span class="NAME">x1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4587</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">yc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">y_direction</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">step_y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4588</span> 
<span class='line'>4589</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">resulting_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>4590</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4591</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x_p1</span><span class="PUNC">,</span><span class="NAME">y_p1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4592</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x2</span><span class="PUNC">,</span><span class="NAME">y2</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>4593</span> </span><span class="WHIT">        </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4594</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4595</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">add_wavefold_obj.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"fold"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4596</span> </span><span class="WHIT">                </span><span class="NAME">resulting_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">foldAddition</span><span class="PUNC">(</span><span class="NAME">resulting_points</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4597</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4598</span> </span><span class="WHIT">            </span><span class="COMM">// } else if (add_wavefold_obj.type === "wave")  {</span><span class="WHIT">
<span class='line'>4599</span> </span><span class="WHIT">            </span><span class="COMM">//     resulting_points = waveAddition(resulting_points, add_wavefold_obj);</span><span class="WHIT">
<span class='line'>4600</span> </span><span class="WHIT">            </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>4601</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4602</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resulting_points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4603</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4604</span> 
<span class='line'>4605</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4606</span>      * Swirled loop curve generating function.&lt;br>
<span class='line'>4607</span>      * 1. A centroid is calculated between two points&lt;br>
<span class='line'>4608</span>      * 2. This centroid y position is raised by a given step in a given direction (scaled_centroid point)&lt;br>
<span class='line'>4609</span>      *    2a. A skew value CAN added to the x positioning of this centroid point&lt;br>
<span class='line'>4610</span>      *    2b. A swirl value is added to the x positioning of this centroid point&lt;br>
<span class='line'>4611</span>      * 3. Original and scaled centroid are returned.&lt;br>
<span class='line'>4612</span>      * 4. Two new points (swirl points) are generated.&lt;br>
<span class='line'>4613</span>      *    4a. Their x coordinates are guided by the opposite swirl value (-1*) of the centroid swirl&lt;br>
<span class='line'>4614</span>      *    4b. Their y coordinates are guided by a percentage of the total y step&lt;br>
<span class='line'>4615</span>      * @namespace
<span class='line'>4616</span>      * @exports NaView
<span class='line'>4617</span>      * @name generateSwirlLoopPoints 
<span class='line'>4618</span>      * @param {Array} p1 point 1 (start)
<span class='line'>4619</span>      * @param {Array} p2 point 2 (end)
<span class='line'>4620</span>      * @param {number} swirl_x swirling value to generate wavy curve
<span class='line'>4621</span>      * @param {number} step_y number of pixels to scale centroid generating y scaled curve center
<span class='line'>4622</span>      * @param {number} perc_step_y  (0 to 1), percentage of y step to generate swirl points
<span class='line'>4623</span>      * @param {number} y_direction (1.0 or -1.0), y direction to scale step
<span class='line'>4624</span>      * @param {Object} add_wavefold_obj Optional: addition of a folding object. See &lt;i>&lt;b>&lt;/b>&lt;/i>
<span class='line'>4625</span>      * @yields {Array} list of five points composing curve to be generated by d3.curveNatural left to right: (p1, pswirl1, scaled_centroid, pswirl2, p2)
<span class='line'>4626</span>      */</span><span class="WHIT">
<span class='line'>4627</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">generateSwirlLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">swirl_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">step_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4628</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">y_direction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4629</span> </span><span class="WHIT">            </span><span class="NAME">y_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4630</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4631</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4632</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4633</span> 
<span class='line'>4634</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4635</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4636</span> 
<span class='line'>4637</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">xc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x1</span><span class="PUNC">+</span><span class="NAME">x2</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4638</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">yc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y1</span><span class="PUNC">+</span><span class="NAME">y2</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4639</span> 
<span class='line'>4640</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">swirl_value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">swirl_x</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">xc</span><span class="PUNC">-</span><span class="NAME">x1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4641</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">swirl_value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4642</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">yc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">y_direction</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_y</span><span class="PUNC">*</span><span class="NAME">perc_step_y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4643</span> </span><span class="WHIT">        
<span class='line'>4644</span>         </span><span class="COMM">// let x_p2 = xc + ((x_direction*-1) * swirl_value);</span><span class="WHIT">
<span class='line'>4645</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xc</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">swirl_value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4646</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">yc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">y_direction</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">step_y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4647</span> 
<span class='line'>4648</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_p3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">swirl_value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4649</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_p3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">yc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">y_direction</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_y</span><span class="PUNC">*</span><span class="NAME">perc_step_y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4650</span> 
<span class='line'>4651</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">resulting_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>4652</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4653</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x_p1</span><span class="PUNC">,</span><span class="NAME">y_p1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4654</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x_p2</span><span class="PUNC">,</span><span class="NAME">y_p2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4655</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x_p3</span><span class="PUNC">,</span><span class="NAME">y_p3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4656</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x2</span><span class="PUNC">,</span><span class="NAME">y2</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>4657</span> </span><span class="WHIT">        </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4658</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resulting_points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4659</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4660</span> 
<span class='line'>4661</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4662</span>      * Bulb loop curve generating function.&lt;br>
<span class='line'>4663</span>      * 1. A centroid is calculated between two points&lt;br>
<span class='line'>4664</span>      * 2. This centroid y position is raised by a given step in a given direction (scaled_centroid point)&lt;br>
<span class='line'>4665</span>      *    2a. A skew value CAN added to the x positioning of this centroid point&lt;br>
<span class='line'>4666</span>      * 3. Original and scaled centroid are returned.&lt;br>
<span class='line'>4667</span>      * 4. Two new points (bulb points) are generated:&lt;br>
<span class='line'>4668</span>      *    4a. They are created before the first point and after the second point (horizontally) by a given x_step&lt;br>
<span class='line'>4669</span>      *    4b. Their vertical position is arranged at a percentage of the y step&lt;br>
<span class='line'>4670</span>      * @namespace
<span class='line'>4671</span>      * @exports NaView
<span class='line'>4672</span>      * @name generateBulbLoopPoints 
<span class='line'>4673</span>      * @param {Array} p1 point 1 (start)
<span class='line'>4674</span>      * @param {Array} p2 point 2 (end)
<span class='line'>4675</span>      * @param {number} step_x number of pixels to scale bulb points
<span class='line'>4676</span>      * @param {number} step_y number of pixels to scale centroid generating y scaled curve center
<span class='line'>4677</span>      * @param {number} perc_step_y  (0 to 1), percentage of y step to generate bulb points
<span class='line'>4678</span>      * @param {number} y_direction (1.0 or -1.0), y direction to scale bulb points
<span class='line'>4679</span>      * @param {number} x_skew_perc Optional percentual between centroid x and point 1 x to move the y scaled curve center
<span class='line'>4680</span>      * @param {Object} add_wavefold_obj Optional: addition of a folding object. See &lt;i>&lt;b>&lt;/b>&lt;/i>
<span class='line'>4681</span>      * @yields {Array} list of five points composing curve to be generated by d3.curveNatural. left to right: (pbulb1, p1, scaled_centroid, p3, pbulb2)
<span class='line'>4682</span>      */</span><span class="WHIT">
<span class='line'>4683</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">generateBulbLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">step_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">step_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4684</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">y_direction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4685</span> </span><span class="WHIT">            </span><span class="NAME">y_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4686</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4687</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">x_skew_perc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4688</span> </span><span class="WHIT">            </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4689</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4690</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4691</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4692</span> 
<span class='line'>4693</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4694</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4695</span> 
<span class='line'>4696</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">xc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x1</span><span class="PUNC">+</span><span class="NAME">x2</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4697</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">yc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y1</span><span class="PUNC">+</span><span class="NAME">y2</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4698</span> 
<span class='line'>4699</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="PUNC">-</span><span class="NAME">step_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4700</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">yc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">y_direction</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_y</span><span class="PUNC">*</span><span class="NAME">perc_step_y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4701</span> 
<span class='line'>4702</span> 
<span class='line'>4703</span> </span><span class="WHIT">        </span><span class="COMM">// let x_p2 = xc;</span><span class="WHIT">
<span class='line'>4704</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x_skew_perc</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">xc</span><span class="PUNC">-</span><span class="NAME">x1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4705</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">yc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">y_direction</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">step_y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4706</span> 
<span class='line'>4707</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_p3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="PUNC">+</span><span class="NAME">step_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4708</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_p3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">yc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">y_direction</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_y</span><span class="PUNC">*</span><span class="NAME">perc_step_y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4709</span> 
<span class='line'>4710</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">resulting_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>4711</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4712</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x_p1</span><span class="PUNC">,</span><span class="NAME">y_p1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4713</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x_p2</span><span class="PUNC">,</span><span class="NAME">y_p2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4714</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x_p3</span><span class="PUNC">,</span><span class="NAME">y_p3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4715</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x2</span><span class="PUNC">,</span><span class="NAME">y2</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>4716</span> </span><span class="WHIT">        </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4717</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4718</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">add_wavefold_obj.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"fold"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4719</span> </span><span class="WHIT">                </span><span class="NAME">resulting_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">foldAddition</span><span class="PUNC">(</span><span class="NAME">resulting_points</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4720</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4721</span> </span><span class="WHIT">            </span><span class="COMM">// } else if (add_wavefold_obj.type === "wave")  {</span><span class="WHIT">
<span class='line'>4722</span> </span><span class="WHIT">            </span><span class="COMM">//     resulting_points = waveAddition(resulting_points, add_wavefold_obj);</span><span class="WHIT">
<span class='line'>4723</span> </span><span class="WHIT">            </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>4724</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4725</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resulting_points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4726</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4727</span> 
<span class='line'>4728</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4729</span>      * Mushroom loop curve generating function.&lt;br>
<span class='line'>4730</span>      * 1. A centroid is calculated between two points&lt;br>
<span class='line'>4731</span>      * 2. This centroid y position is raised by a given step in a given direction (scaled_centroid point)&lt;br>
<span class='line'>4732</span>     *    2a. A skew value CAN added to the x positioning of this centroid point&lt;br>
<span class='line'>4733</span>      * 3. Original and scaled centroid are returned.&lt;br>
<span class='line'>4734</span>      * 4. Two new points (bulb points) are generated:&lt;br>
<span class='line'>4735</span>      *    4a. They are created before the first point and after the second point (horizontally) by a given x_step&lt;br>
<span class='line'>4736</span>      *    4b. Their vertical position is arranged at a percentage of the y step&lt;br>
<span class='line'>4737</span>      * 5. Two new points (mushroom points) are generated:&lt;br>
<span class='line'>4738</span>      *    5a. Their x coordinate is defined by a percentage of the centroid to p1 and p2&lt;br>
<span class='line'>4739</span>      *    5b. Their y coordinate is arranged at a percentage of the y step&lt;br>
<span class='line'>4740</span>      * @namespace
<span class='line'>4741</span>      * @exports NaView
<span class='line'>4742</span>      * @name generateMushRoomLoopPoints 
<span class='line'>4743</span>      * @param {Array} p1 point 1 (start)
<span class='line'>4744</span>      * @param {Array} p2 point 2 (end)
<span class='line'>4745</span>      * @param {number} step_x number of pixels to scale bulb points
<span class='line'>4746</span>      * @param {number} step_y number of pixels to scale centroid generating y scaled curve center
<span class='line'>4747</span>      * @param {number} perc_center_x (0 to 1), percentage of p1-center and p2-center for mushroom points
<span class='line'>4748</span>      * @param {number} perc_step_y1  (0 to 1), percentage of y step to generate bulb points
<span class='line'>4749</span>      * @param {number} perc_step_y2  (0 to 1), percentage of y step to generate mushroom points
<span class='line'>4750</span>      * @param {number} y_direction (1.0 or -1.0), y direction to scale step
<span class='line'>4751</span>      * @param {number} x_skew_perc Optional percentual between centroid x and point 1 x to move the y scaled curve center
<span class='line'>4752</span>      * @param {Object} add_wavefold_obj Optional: addition of a folding object. See &lt;i>&lt;b>&lt;/b>&lt;/i>
<span class='line'>4753</span>      * @yields {Array} list of seven points composing curve to be generated by d3.curveNatural. left to right: (pbulb1, p1, pmush1, scaled_centroid, pmush2, p3, pbulb2)
<span class='line'>4754</span>      */</span><span class="WHIT">
<span class='line'>4755</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">generateMushRoomLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">step_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">step_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_center_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4756</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">y_direction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4757</span> </span><span class="WHIT">            </span><span class="NAME">y_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4758</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4759</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">x_skew_perc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4760</span> </span><span class="WHIT">            </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4761</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4762</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4763</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4764</span> 
<span class='line'>4765</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4766</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4767</span> 
<span class='line'>4768</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">xc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x1</span><span class="PUNC">+</span><span class="NAME">x2</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4769</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">yc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y1</span><span class="PUNC">+</span><span class="NAME">y2</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4770</span> 
<span class='line'>4771</span> </span><span class="WHIT">        </span><span class="COMM">// let x_p3 = xc;</span><span class="WHIT">
<span class='line'>4772</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_p3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x_skew_perc</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">xc</span><span class="PUNC">-</span><span class="NAME">x1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4773</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_p3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">yc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">y_direction</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">step_y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4774</span> 
<span class='line'>4775</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xc</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">perc_center_x</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">xc</span><span class="PUNC">-</span><span class="NAME">x1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4776</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">yc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">y_direction</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">step_y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">perc_step_y1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4777</span> </span><span class="WHIT">        
<span class='line'>4778</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">step_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4779</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">yc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">y_direction</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">step_y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">perc_step_y2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4780</span> </span><span class="WHIT">        
<span class='line'>4781</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_p4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">step_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4782</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_p4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">yc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">y_direction</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">step_y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">perc_step_y2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4783</span> 
<span class='line'>4784</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_p5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">perc_center_x</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">xc</span><span class="PUNC">-</span><span class="NAME">x1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4785</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_p5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">yc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">y_direction</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">step_y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">perc_step_y1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4786</span> 
<span class='line'>4787</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">resulting_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>4788</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4789</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x_p1</span><span class="PUNC">,</span><span class="NAME">y_p1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4790</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x_p2</span><span class="PUNC">,</span><span class="NAME">y_p2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4791</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x_p3</span><span class="PUNC">,</span><span class="NAME">y_p3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4792</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x_p4</span><span class="PUNC">,</span><span class="NAME">y_p4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4793</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x_p5</span><span class="PUNC">,</span><span class="NAME">y_p5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4794</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x2</span><span class="PUNC">,</span><span class="NAME">y2</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>4795</span> </span><span class="WHIT">        </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4796</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4797</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">add_wavefold_obj.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"fold"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4798</span> </span><span class="WHIT">                </span><span class="NAME">resulting_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">foldAddition</span><span class="PUNC">(</span><span class="NAME">resulting_points</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4799</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4800</span> </span><span class="WHIT">            </span><span class="COMM">// } else if (add_wavefold_obj.type === "wave")  {</span><span class="WHIT">
<span class='line'>4801</span> </span><span class="WHIT">            </span><span class="COMM">//     resulting_points = waveAddition(resulting_points, add_wavefold_obj);</span><span class="WHIT">
<span class='line'>4802</span> </span><span class="WHIT">            </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>4803</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4804</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resulting_points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4805</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4806</span> 
<span class='line'>4807</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4808</span>      * Skewed loop curve generating function.&lt;br>
<span class='line'>4809</span>      * 1. A centroid is calculated between two points&lt;br>
<span class='line'>4810</span>      * 2. This centroid y position is raised by a given step in a given direction (skewed_centroid point)&lt;br>
<span class='line'>4811</span>      *    2a. A skew value is added to the x positioning of this centroid point&lt;br>
<span class='line'>4812</span>      * @namespace
<span class='line'>4813</span>      * @exports NaView
<span class='line'>4814</span>      * @name generateSkewedSimpleLoopPoints 
<span class='line'>4815</span>      * @param {Array} p1 point 1 (start)
<span class='line'>4816</span>      * @param {Array} p2 point 2 (end)
<span class='line'>4817</span>      * @param {number} perc_center_x (0 to 1), percentage of p1-center for skewed point
<span class='line'>4818</span>      * @param {number} step_y number of pixels to scale centroid generating y scaled curve center
<span class='line'>4819</span>      * @param {number} y_direction (1.0 or -1.0), y direction to scale step
<span class='line'>4820</span>      * @yields {Array} list of three points composing curve to be generated by d3.curveNatural left to right: (p1, skewed_centroid, p2)
<span class='line'>4821</span>      */</span><span class="WHIT">
<span class='line'>4822</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">generateSkewedSimpleLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_center_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">step_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4823</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">y_direction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4824</span> </span><span class="WHIT">            </span><span class="NAME">y_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4825</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4826</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4827</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4828</span> 
<span class='line'>4829</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4830</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4831</span> 
<span class='line'>4832</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">xc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x1</span><span class="PUNC">+</span><span class="NAME">x2</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4833</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">yc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y1</span><span class="PUNC">+</span><span class="NAME">y2</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4834</span> 
<span class='line'>4835</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">perc_center_x</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">xc</span><span class="PUNC">-</span><span class="NAME">x1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4836</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">yc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">y_direction</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">step_y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4837</span> 
<span class='line'>4838</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">resulting_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>4839</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4840</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x_p1</span><span class="PUNC">,</span><span class="NAME">y_p1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4841</span> </span><span class="WHIT">            </span><span class="PUNC">[</span><span class="NAME">x2</span><span class="PUNC">,</span><span class="NAME">y2</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>4842</span> </span><span class="WHIT">        </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4843</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resulting_points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4844</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4845</span> 
<span class='line'>4846</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4847</span>      * Wavy loop curve generating function.&lt;br>
<span class='line'>4848</span>      * 1. N points are created between the start and end points&lt;br>
<span class='line'>4849</span>      * 2. Each point is a created from a Normal from the vector between the start and end points&lt;br>
<span class='line'>4850</span>      * 3. Height scales of N curves is defined as a percentage of a given maximum step&lt;br>
<span class='line'>4851</span>      * @namespace
<span class='line'>4852</span>      * @exports NaView
<span class='line'>4853</span>      * @name generateNWaveCurves 
<span class='line'>4854</span>      * @param {Array} p1 point 1 (start)
<span class='line'>4855</span>      * @param {Array} p2 point 2 (end)
<span class='line'>4856</span>      * @param {number} n_of_centers number of wave peaks to generate
<span class='line'>4857</span>      * @param {number} step_height number of pixels to generate wave peaks centers
<span class='line'>4858</span>      * @param {Array} perc_centers_height array of percentages to generate wave peaks from step height
<span class='line'>4859</span>      * @param {Boolean} clockwise starting orientation of generated wave peaks clockwise (true) or counterclockwise (false)
<span class='line'>4860</span>      * @param {number} rotate_loop angle to rotate final path in relation to the its anchored point
<span class='line'>4861</span>      * @yields {Array} list of N points composing curve to be generated by d3.curveNatural left to right: (p1, ... , p2)
<span class='line'>4862</span>      */</span><span class="WHIT">
<span class='line'>4863</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">generateNWaveCurves</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">n_of_centers</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">step_height</span><span class="PUNC">,</span><span class="NAME">perc_centers_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clockwise</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rotate_loop</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4864</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">clockwise</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4865</span> </span><span class="WHIT">            </span><span class="NAME">clockwise</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4866</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4867</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">resulting_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4868</span> </span><span class="WHIT">        
<span class='line'>4869</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4870</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4871</span> 
<span class='line'>4872</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4873</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4874</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rotate_loop</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4875</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">y1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4876</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vecp1p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createVector</span><span class="PUNC">(</span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4877</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p2rotation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rotateByAng</span><span class="PUNC">(</span><span class="NAME">vecp1p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rotate_loop</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4878</span> </span><span class="WHIT">                </span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p2rotation</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4879</span> </span><span class="WHIT">                </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p2rotation</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4880</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4881</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vecp1p2_2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createVector</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4882</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p1rotation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rotateByAng</span><span class="PUNC">(</span><span class="NAME">vecp1p2_2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">x2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rotate_loop</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4883</span> 
<span class='line'>4884</span> </span><span class="WHIT">                </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p1rotation</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4885</span> </span><span class="WHIT">                </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p1rotation</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4886</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4887</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4888</span> </span><span class="WHIT">        </span><span class="NAME">resulting_points.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4889</span> 
<span class='line'>4890</span> </span><span class="WHIT">        </span><span class="COMM">// let n_of_centers = perc_x_centers_array.length;</span><span class="WHIT">
<span class='line'>4891</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_step_size</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x2</span><span class="PUNC">-</span><span class="NAME">x1</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">n_of_centers</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4892</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_step_size</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y2</span><span class="PUNC">-</span><span class="NAME">y1</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">n_of_centers</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4893</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">prev_xpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4894</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">prev_ypc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4895</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">n_of_centers</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4896</span> 
<span class='line'>4897</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_pc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">x_step_size</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4898</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_pc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">y_step_size</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4899</span> 
<span class='line'>4900</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">current_step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">step_height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">perc_centers_height</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4901</span> 
<span class='line'>4902</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">rotation_direction</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4903</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">clockwise</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4904</span> </span><span class="WHIT">                </span><span class="NAME">rotation_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"clockwise"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4905</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4906</span> </span><span class="WHIT">                </span><span class="NAME">rotation_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"anticlockwise"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4907</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4908</span> </span><span class="WHIT">            </span><span class="NAME">clockwise</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">clockwise</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4909</span> 
<span class='line'>4910</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">v_pc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createVector</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">x_pc</span><span class="PUNC">+</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_pc</span><span class="PUNC">+</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">prev_xpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prev_ypc</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4911</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">v_pc_norm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">normalizeVector</span><span class="PUNC">(</span><span class="NAME">v_pc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4912</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">v_pc_scale</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scaleVector</span><span class="PUNC">(</span><span class="NAME">v_pc_norm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">current_step</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4913</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">v_pc_rot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rotate90</span><span class="PUNC">(</span><span class="NAME">v_pc_scale</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rotation_direction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">x_pc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_pc</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4914</span> </span><span class="WHIT">            </span><span class="NAME">resulting_points.push</span><span class="PUNC">(</span><span class="NAME">v_pc_rot</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4915</span> </span><span class="WHIT">            </span><span class="NAME">prev_xpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x_pc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4916</span> </span><span class="WHIT">            </span><span class="NAME">prev_ypc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y_pc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4917</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4918</span> </span><span class="WHIT">        </span><span class="NAME">resulting_points.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">x2</span><span class="PUNC">,</span><span class="NAME">y2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4919</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">resulting_points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4920</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4921</span> 
<span class='line'>4922</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4923</span>      * Function to add horizontal folds on Simple, Bulb and Mushroom curves.&lt;br>
<span class='line'>4924</span>      * Works by finding x centroid of current curve and y point connected to closest membrane (anchored centroid) &lt;br>
<span class='line'>4925</span>      * Folds are then created by creating copies of the curve points with scaled distances to this anchored centroid
<span class='line'>4926</span>      * with the first and last points excluded.&lt;br>
<span class='line'>4927</span>      * @namespace
<span class='line'>4928</span>      * @exports NaView
<span class='line'>4929</span>      * @name foldAddition 
<span class='line'>4930</span>      * @param {Array} resulting_points curve points to draw d3.curveNatural curve
<span class='line'>4931</span>      * @param {Object} add_fold_obj Object part of style_obj describing shape of this horizontal fold (number of folds, relative heights)
<span class='line'>4932</span>      * @yields {Array} list of N points composing curve to be generated by d3.curveNatural left to right: (p1, ... , p2)
<span class='line'>4933</span>      */</span><span class="WHIT">
<span class='line'>4934</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">foldAddition</span><span class="PUNC">(</span><span class="NAME">resulting_points</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_fold_obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4935</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">new_resulting_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4936</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">half_index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">resulting_points.length</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4937</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ghost_length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getGhostPathLength</span><span class="PUNC">(</span><span class="NAME">resulting_points</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"ghostParent"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4938</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ghost_path_doc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"ghostParent"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4939</span> </span><span class="WHIT">        
<span class='line'>4940</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">start_abs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ghost_length</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">add_fold_obj.start</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4941</span> 
<span class='line'>4942</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">first_point</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ghost_path_doc.getPointAtLength</span><span class="PUNC">(</span><span class="NAME">start_abs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4943</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">first_point_xy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">first_point.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">first_point.y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4944</span> 
<span class='line'>4945</span> </span><span class="WHIT">        </span><span class="NAME">new_resulting_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">resulting_points</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">half_index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4946</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">new_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4947</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">anchored_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateDotArrayMiddlePoint</span><span class="PUNC">(</span><span class="NAME">resulting_points</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">resulting_points</span><span class="PUNC">[</span><span class="NAME">resulting_points.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4948</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">add_fold_obj.x_scaling</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4949</span> </span><span class="WHIT">            </span><span class="NAME">anchored_centroid</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchored_centroid</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">euclideanDistance</span><span class="PUNC">(</span><span class="NAME">anchored_centroid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">resulting_points</span><span class="PUNC">[</span><span class="NAME">resulting_points.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">add_fold_obj.x_scaling</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4950</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4951</span> 
<span class='line'>4952</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">resulting_points_no_fl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">resulting_points</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4953</span> </span><span class="WHIT">        </span><span class="NAME">resulting_points_no_fl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">resulting_points_no_fl.slice</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">resulting_points.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4954</span> </span><span class="WHIT">        
<span class='line'>4955</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ih</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ih</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">add_fold_obj.heights.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ih</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4956</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">scale_factor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">add_fold_obj.heights</span><span class="PUNC">[</span><span class="NAME">ih</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4957</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">to_new_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4958</span> </span><span class="WHIT">            </span><span class="COMM">// let starting_loop_point;</span><span class="WHIT">
<span class='line'>4959</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ih</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4960</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">iep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">resulting_points_no_fl.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iep</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iep</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4961</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">point</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">resulting_points_no_fl</span><span class="PUNC">[</span><span class="NAME">iep</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4962</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dist_to_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">euclideanDistance</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchored_centroid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4963</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">scale_value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dist_to_centroid</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scale_factor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4964</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vector_point_to_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createVector</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchored_centroid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4965</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vector_point_to_centroid_norm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">normalizeVector</span><span class="PUNC">(</span><span class="NAME">vector_point_to_centroid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4966</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vector_point_to_centroid_norm_scaled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scaleVector</span><span class="PUNC">(</span><span class="NAME">vector_point_to_centroid_norm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scale_value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4967</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">point_to_centroid_norm_scaled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createVector</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vector_point_to_centroid_norm_scaled</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4968</span> 
<span class='line'>4969</span> </span><span class="WHIT">                    </span><span class="NAME">to_new_points.push</span><span class="PUNC">(</span><span class="NAME">point_to_centroid_norm_scaled</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4970</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4971</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4972</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">iep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iep</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">resulting_points_no_fl.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iep</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4973</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">point</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">resulting_points_no_fl</span><span class="PUNC">[</span><span class="NAME">iep</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4974</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dist_to_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">euclideanDistance</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchored_centroid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4975</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">scale_value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dist_to_centroid</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scale_factor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4976</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vector_point_to_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createVector</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchored_centroid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4977</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vector_point_to_centroid_norm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">normalizeVector</span><span class="PUNC">(</span><span class="NAME">vector_point_to_centroid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4978</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vector_point_to_centroid_norm_scaled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scaleVector</span><span class="PUNC">(</span><span class="NAME">vector_point_to_centroid_norm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scale_value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4979</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">point_to_centroid_norm_scaled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createVector</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vector_point_to_centroid_norm_scaled</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4980</span> 
<span class='line'>4981</span> </span><span class="WHIT">                    </span><span class="NAME">to_new_points.push</span><span class="PUNC">(</span><span class="NAME">point_to_centroid_norm_scaled</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4982</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4983</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4984</span> </span><span class="WHIT">            </span><span class="NAME">new_points.push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">to_new_points</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4985</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4986</span> </span><span class="WHIT">        </span><span class="NAME">new_resulting_points.push</span><span class="PUNC">(</span><span class="NAME">first_point_xy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4987</span> </span><span class="WHIT">        </span><span class="NAME">new_resulting_points.push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">new_points</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4988</span> </span><span class="WHIT">        </span><span class="NAME">new_resulting_points.push</span><span class="PUNC">(</span><span class="NAME">resulting_points</span><span class="PUNC">[</span><span class="NAME">resulting_points.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4989</span> </span><span class="WHIT">        
<span class='line'>4990</span>         </span><span class="COMM">// plotPoints(new_points);</span><span class="WHIT">
<span class='line'>4991</span> </span><span class="WHIT">        </span><span class="COMM">// plotPoints([anchored_centroid]);</span><span class="WHIT">
<span class='line'>4992</span> </span><span class="WHIT">        </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="STRN">"#parghostParent"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4993</span> </span><span class="WHIT">        </span><span class="COMM">// return resulting_points;</span><span class="WHIT">
<span class='line'>4994</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">new_resulting_points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4995</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4996</span> 
<span class='line'>4997</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4998</span>      * For scaled loops, generate a linear, power or log scale
<span class='line'>4999</span>      * @namespace
<span class='line'>5000</span>      * @exports NaView
<span class='line'>5001</span>      * @name makeLoopScaling 
<span class='line'>5002</span>      * @param {Object} scale_var variable containing "domain" and "range" of loop scale
<span class='line'>5003</span>      * @param {Object} loop_length_calculation variable part of style_obj containing additional information about scale such as exponent and base
<span class='line'>5004</span>      * @yields d3.js scale function for loop length calculations
<span class='line'>5005</span>      */</span><span class="WHIT">
<span class='line'>5006</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">makeLoopScaling</span><span class="PUNC">(</span><span class="NAME">scale_var</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5007</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_scaling</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5008</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">scale_var.scale</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"linear"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5009</span> </span><span class="WHIT">            </span><span class="NAME">loop_scaling</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.scaleLinear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5010</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">domain</span><span class="PUNC">(</span><span class="NAME">scale_var.domain</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5011</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">range</span><span class="PUNC">(</span><span class="NAME">scale_var.range</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5012</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">scale_var.scale</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"power"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5013</span> </span><span class="WHIT">            </span><span class="NAME">loop_scaling</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.scalePow</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5014</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">exponent</span><span class="PUNC">(</span><span class="NAME">loop_length_calculation.calc.exponent</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5015</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">domain</span><span class="PUNC">(</span><span class="NAME">scale_var.domain</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5016</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">range</span><span class="PUNC">(</span><span class="NAME">scale_var.range</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5017</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">scale_var.scale</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"log"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5018</span> </span><span class="WHIT">            </span><span class="NAME">loop_scaling</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.scaleLog</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5019</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">base</span><span class="PUNC">(</span><span class="NAME">loop_length_calculation.calc.base</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5020</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">domain</span><span class="PUNC">(</span><span class="NAME">scale_var.domain</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5021</span> </span><span class="WHIT">            </span><span class="PUNC">.</span><span class="NAME">range</span><span class="PUNC">(</span><span class="NAME">scale_var.range</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5022</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5023</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">loop_scaling</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5024</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5025</span> </span><span class="WHIT">    
<span class='line'>5026</span>     </span><span class="COMM">/**
<span class='line'>5027</span>      * Verifies if a fold object should be added to this given loop
<span class='line'>5028</span>      * @namespace
<span class='line'>5029</span>      * @exports NaView
<span class='line'>5030</span>      * @name checkWaveFold 
<span class='line'>5031</span>      * @param {Array} loop_data loop data generated from processRawUniProt function
<span class='line'>5032</span>      * @param {Object} add_wave_fold_dict_array object part of style_obj describing loops in which folds should be added
<span class='line'>5033</span>      * @yield null or Object part of style_obj describing how loop should be folded
<span class='line'>5034</span>      */</span><span class="WHIT">
<span class='line'>5035</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">checkWaveFold</span><span class="PUNC">(</span><span class="NAME">loop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wave_fold_dict_array</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5036</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">wave_fold_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5037</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5038</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_itype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5039</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_data.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"dom_name"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">loop_data.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"dom_itype"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5040</span> </span><span class="WHIT">            </span><span class="NAME">dom_name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_data.dom_name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5041</span> </span><span class="WHIT">            </span><span class="NAME">dom_itype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_data.dom_itype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5042</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5043</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dom_name</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">dom_itype</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5044</span> </span><span class="WHIT">            </span><span class="NAME">wave_fold_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">add_wave_fold_dict_array</span><span class="PUNC">[</span><span class="NAME">dom_name</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">dom_itype</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5045</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_data.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"dom_iname"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5046</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_iname</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_data.dom_iname</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5047</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dom_iname</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5048</span> </span><span class="WHIT">                </span><span class="NAME">wave_fold_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">add_wave_fold_dict_array</span><span class="PUNC">[</span><span class="NAME">dom_iname</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5049</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5050</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5051</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">wave_fold_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5052</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5053</span> </span><span class="WHIT">    
<span class='line'>5054</span>     </span><span class="COMM">/**
<span class='line'>5055</span>      * Checks for an array of coordinate points if any coordinate is NaN
<span class='line'>5056</span>      * @namespace
<span class='line'>5057</span>      * @exports NaView
<span class='line'>5058</span>      * @name checkForNaN 
<span class='line'>5059</span>      * @param {Array} points array of coordinate points
<span class='line'>5060</span>      * @yields {Boolean} true if NaN is present or false if NaN is absent
<span class='line'>5061</span>      */</span><span class="WHIT">
<span class='line'>5062</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">checkForNaN</span><span class="PUNC">(</span><span class="NAME">points</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5063</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ip</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">points.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ip</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5064</span> </span><span class="WHIT">            </span><span class="COMM">// const element = points[ip];</span><span class="WHIT">
<span class='line'>5065</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">ip</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">ip</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5066</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5067</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5068</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5069</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5070</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5071</span> 
<span class='line'>5072</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5073</span>      * Generate loop points for short and long loops of fixed height and width
<span class='line'>5074</span>      * @namespace
<span class='line'>5075</span>      * @exports NaView
<span class='line'>5076</span>      * @name calculateFixedPointData 
<span class='line'>5077</span>      * @param {Array} short_loop_data array of short or long loop data generated by processRawUniProt
<span class='line'>5078</span>      * @param {Object} loop_length_calculation Object part of style_obj describing how loop length should be calculated
<span class='line'>5079</span>      * @param {Object} loop_drawing_shape Object part of style_obj describing which loop shape should be drawn
<span class='line'>5080</span>      * @yields {Array} array of short or long loop data generated by processRawUniProt with points describing loop added
<span class='line'>5081</span>      */</span><span class="WHIT">
<span class='line'>5082</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">calculateFixedPointData</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5083</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5084</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5085</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"simple"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5086</span> </span><span class="WHIT">            </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.calc.height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5087</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"swirl"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5088</span> </span><span class="WHIT">            </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.calc.height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5089</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"bulb"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5090</span> </span><span class="WHIT">            </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.calc.height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5091</span> </span><span class="WHIT">            </span><span class="NAME">curve_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.calc.width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5092</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"mushroom"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5093</span> </span><span class="WHIT">            </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.calc.height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5094</span> </span><span class="WHIT">            </span><span class="NAME">curve_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.calc.width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5095</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5096</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isld</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">isld</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">short_loop_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">isld</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5097</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5098</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5099</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5100</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">note</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"Cytoplasmic"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5101</span> </span><span class="WHIT">                </span><span class="NAME">y_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5102</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5103</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5104</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"simple"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5105</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5106</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"x_skew_perc"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5107</span> </span><span class="WHIT">                    </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.x_skew_perc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5108</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5109</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5110</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"add_wave_fold"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5111</span> </span><span class="WHIT">                    </span><span class="NAME">add_wavefold_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkWaveFold</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.add_wave_fold</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5112</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5113</span> </span><span class="WHIT">                </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateSimpleLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5114</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"swirl"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5115</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">swirl_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.swirl_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5116</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_step_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_step_y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5117</span> </span><span class="WHIT">                </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateSwirlLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">swirl_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5118</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"bulb"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5119</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_step_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_step_y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5120</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5121</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"add_wave_fold"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5122</span> </span><span class="WHIT">                    </span><span class="NAME">add_wavefold_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkWaveFold</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.add_wave_fold</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5123</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5124</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5125</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"x_skew_perc"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5126</span> </span><span class="WHIT">                    </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.x_skew_perc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5127</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5128</span> </span><span class="WHIT">                </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateBulbLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="NAME">x_skew_perc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5129</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"mushroom"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5130</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_step_y1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_step_y1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5131</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_step_y2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_step_y2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5132</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_center_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_center_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5133</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5134</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"add_wave_fold"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5135</span> </span><span class="WHIT">                    </span><span class="NAME">add_wavefold_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkWaveFold</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.add_wave_fold</span><span class="PUNC">,</span><span class="NAME">x_skew_perc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5136</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5137</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5138</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"x_skew_perc"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5139</span> </span><span class="WHIT">                    </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.x_skew_perc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5140</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5141</span> </span><span class="WHIT">                </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateMushRoomLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_center_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="NAME">x_skew_perc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5142</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5143</span> </span><span class="WHIT">            </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5144</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5145</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5146</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5147</span> 
<span class='line'>5148</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5149</span>      * Generate loop points for short and long loops of scaled y growth "step" sizes according to their aanumber
<span class='line'>5150</span>      * @namespace
<span class='line'>5151</span>      * @exports NaView
<span class='line'>5152</span>      * @name calculateScaledPointData 
<span class='line'>5153</span>      * @param {Array} short_loop_data array of short or long loop data generated by processRawUniProt
<span class='line'>5154</span>      * @param {Object} loop_length_calculation Object part of style_obj describing how loop length should be calculated
<span class='line'>5155</span>      * @param {Object} loop_drawing_shape Object part of style_obj describing which loop shape should be drawn
<span class='line'>5156</span>      * @yields {Array} array of short or long loop data generated by processRawUniProt with points describing loop added
<span class='line'>5157</span>      */</span><span class="WHIT">
<span class='line'>5158</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">calculateScaledPointData</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5159</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aa_num_sld_array</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_data.map</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5160</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">a.aanum</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5161</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5162</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sorted_aa_num_sld_array</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aa_num_sld_array.sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5163</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5164</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5165</span> </span><span class="WHIT">        </span><span class="COMM">//get: maximum residue number</span><span class="WHIT">
<span class='line'>5166</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">max_aanum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sorted_aa_num_sld_array</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5167</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">max_aanum_index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sorted_aa_num_sld_array</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5168</span> 
<span class='line'>5169</span> </span><span class="WHIT">        </span><span class="COMM">//get: neeeded variables for step scales to be generated</span><span class="WHIT">
<span class='line'>5170</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">scale_vars</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5171</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"simple"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5172</span> </span><span class="WHIT">            </span><span class="NAME">scale_vars.y_step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5173</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"swirl"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5174</span> </span><span class="WHIT">            </span><span class="NAME">scale_vars.y_step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5175</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"bulb"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5176</span> </span><span class="WHIT">            </span><span class="NAME">scale_vars.y_step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5177</span> </span><span class="WHIT">            </span><span class="NAME">scale_vars.x_step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5178</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"mushroom"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5179</span> </span><span class="WHIT">            </span><span class="NAME">scale_vars.y_step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5180</span> </span><span class="WHIT">            </span><span class="NAME">scale_vars.x_step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5181</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5182</span> 
<span class='line'>5183</span> </span><span class="WHIT">        </span><span class="COMM">//get: maximum possible height and width for a curve</span><span class="WHIT">
<span class='line'>5184</span> </span><span class="WHIT">        </span><span class="COMM">//get: corresponding maximum step for generating these dimensions</span><span class="WHIT">
<span class='line'>5185</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_maxheight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5186</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_maxwidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5187</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"simple"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5188</span> </span><span class="WHIT">            </span><span class="NAME">curve_maxheight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.calc.height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5189</span> </span><span class="WHIT">            </span><span class="NAME">scale_vars.y_step.max_step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curve_maxheight</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.y_step</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5190</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"swirl"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5191</span> </span><span class="WHIT">                </span><span class="NAME">curve_maxheight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.calc.height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5192</span> </span><span class="WHIT">                </span><span class="NAME">scale_vars.y_step.max_step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curve_maxheight</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.y_step</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5193</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"bulb"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5194</span> </span><span class="WHIT">            </span><span class="NAME">curve_maxheight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.calc.height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5195</span> </span><span class="WHIT">            </span><span class="NAME">curve_maxwidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.calc.width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5196</span> </span><span class="WHIT">            </span><span class="NAME">scale_vars.y_step.max_step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curve_maxheight</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.y_step</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5197</span> </span><span class="WHIT">            </span><span class="NAME">scale_vars.x_step.max_step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curve_maxwidth</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.x_step</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5198</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"mushroom"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5199</span> </span><span class="WHIT">            </span><span class="NAME">curve_maxheight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.calc.height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5200</span> </span><span class="WHIT">            </span><span class="NAME">curve_maxwidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.calc.width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5201</span> </span><span class="WHIT">            </span><span class="NAME">scale_vars.y_step.max_step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curve_maxheight</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.y_step</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5202</span> </span><span class="WHIT">            </span><span class="NAME">scale_vars.x_step.max_step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curve_maxwidth</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.x_step</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5203</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5204</span> </span><span class="WHIT">        </span><span class="COMM">//create: step scaling for each loop, based on their aanumber</span><span class="WHIT">
<span class='line'>5205</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">scale_var</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">scale_vars</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5206</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">scale_vars.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">scale_var</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5207</span> </span><span class="WHIT">                </span><span class="NAME">scale_vars</span><span class="PUNC">[</span><span class="NAME">scale_var</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"scale"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.calc.scale</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5208</span> </span><span class="WHIT">                </span><span class="NAME">scale_vars</span><span class="PUNC">[</span><span class="NAME">scale_var</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"domain"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">max_aanum</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5209</span> </span><span class="WHIT">                </span><span class="NAME">scale_vars</span><span class="PUNC">[</span><span class="NAME">scale_var</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"range"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scale_vars</span><span class="PUNC">[</span><span class="NAME">scale_var</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"max_step"</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5210</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5211</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5212</span> 
<span class='line'>5213</span> </span><span class="WHIT">        </span><span class="COMM">//for each loop: generate path with given scaling</span><span class="WHIT">
<span class='line'>5214</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isld</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">isld</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">short_loop_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">isld</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5215</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5216</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5217</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5218</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">note</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"Cytoplasmic"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5219</span> </span><span class="WHIT">                </span><span class="NAME">y_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5220</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5221</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5222</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"simple"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5223</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_scaling</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">makeLoopScaling</span><span class="PUNC">(</span><span class="NAME">scale_vars.y_step</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5224</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">step_number</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_scaling</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">aanum</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5225</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_number</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.y_step</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5226</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5227</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"x_skew_perc"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5228</span> </span><span class="WHIT">                    </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.x_skew_perc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5229</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5230</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5231</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"add_wave_fold"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5232</span> </span><span class="WHIT">                    </span><span class="NAME">add_wavefold_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkWaveFold</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.add_wave_fold</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5233</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5234</span> </span><span class="WHIT">                </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateSimpleLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5235</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"swirl"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5236</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_scaling</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">makeLoopScaling</span><span class="PUNC">(</span><span class="NAME">scale_vars.y_step</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5237</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">step_number</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_scaling</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">aanum</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5238</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_number</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.y_step</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5239</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">swirl_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.swirl_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5240</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_step_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_step_y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5241</span> </span><span class="WHIT">                </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateSwirlLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">swirl_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5242</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"bulb"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5243</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_scaling_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">makeLoopScaling</span><span class="PUNC">(</span><span class="NAME">scale_vars.y_step</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5244</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">step_number_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_scaling_y</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">aanum</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5245</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_number_y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.y_step</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5246</span> 
<span class='line'>5247</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_scaling_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">makeLoopScaling</span><span class="PUNC">(</span><span class="NAME">scale_vars.x_step</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5248</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">step_number_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_scaling_x</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">aanum</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5249</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_number_x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.x_step</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">// + short_loop_data[isld].anchorage.dist;</span><span class="WHIT">
<span class='line'>5250</span> 
<span class='line'>5251</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_step_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_step_y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5252</span> 
<span class='line'>5253</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5254</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"add_wave_fold"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5255</span> </span><span class="WHIT">                    </span><span class="NAME">add_wavefold_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkWaveFold</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.add_wave_fold</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5256</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5257</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5258</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"x_skew_perc"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5259</span> </span><span class="WHIT">                    </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.x_skew_perc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5260</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5261</span> </span><span class="WHIT">                </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateBulbLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="NAME">x_skew_perc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5262</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"mushroom"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5263</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_scaling_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">makeLoopScaling</span><span class="PUNC">(</span><span class="NAME">scale_vars.y_step</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5264</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">step_number_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_scaling_y</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">aanum</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5265</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_number_y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.y_step</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5266</span> 
<span class='line'>5267</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_scaling_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">makeLoopScaling</span><span class="PUNC">(</span><span class="NAME">scale_vars.x_step</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5268</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">step_number_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_scaling_x</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">aanum</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5269</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_number_x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.x_step</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">// + short_loop_data[isld].anchorage.dist;</span><span class="WHIT">
<span class='line'>5270</span> 
<span class='line'>5271</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_step_y1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_step_y1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5272</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_step_y2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_step_y2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5273</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_center_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_center_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5274</span> 
<span class='line'>5275</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5276</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"add_wave_fold"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5277</span> </span><span class="WHIT">                    </span><span class="NAME">add_wavefold_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkWaveFold</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.add_wave_fold</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5278</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5279</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5280</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"x_skew_perc"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5281</span> </span><span class="WHIT">                    </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.x_skew_perc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5282</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5283</span> </span><span class="WHIT">                </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateMushRoomLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_center_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="NAME">x_skew_perc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5284</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5285</span> </span><span class="WHIT">            </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5286</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5287</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5288</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5289</span> 
<span class='line'>5290</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5291</span>      * Iterates over multiple step sizes until loop of an expected length is generated for a given curve.
<span class='line'>5292</span>      * @namespace
<span class='line'>5293</span>      * @exports NaView
<span class='line'>5294</span>      * @name generatePathWithLength 
<span class='line'>5295</span>      * @param {Object} p1 starting point of curve
<span class='line'>5296</span>      * @param {Object} p2 end point of curve
<span class='line'>5297</span>      * @param {number} loop_length expected length of curve
<span class='line'>5298</span>      * @param {number} y_direction 1.0 or -1.0 indicating orientation of curve
<span class='line'>5299</span>      * @param {Object} loop_drawing_shape Object part of style_obj describing which loop shape should be drawn
<span class='line'>5300</span>      * @param {String} loop_drawing_shape_type String describing curve type according to style_obj
<span class='line'>5301</span>      * @param {Object} extra_variables dictionary containing extra style_obj parameters not included in shape
<span class='line'>5302</span>      * @param {Object} loop_data original loop data generated by processRawUniProt
<span class='line'>5303</span>      * @yields {Array} array of points describing curve of loop
<span class='line'>5304</span>      */</span><span class="WHIT">
<span class='line'>5305</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">generatePathWithLength</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="NAME">p2</span><span class="PUNC">,</span><span class="NAME">loop_length</span><span class="PUNC">,</span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="NAME">loop_drawing_shape</span><span class="PUNC">,</span><span class="NAME">loop_drawing_shape_type</span><span class="PUNC">,</span><span class="NAME">extra_variables</span><span class="PUNC">,</span><span class="NAME">loop_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5306</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">step_number</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5307</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">current_length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5308</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">current_points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5309</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5310</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">extra_variables.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"x_skew_perc"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5311</span> </span><span class="WHIT">            </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">extra_variables</span><span class="PUNC">[</span><span class="STRN">"x_skew_perc"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5312</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5313</span> </span><span class="WHIT">        </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">current_length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5314</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape_type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"simple"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5315</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_number</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">extra_variables.y_step</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5316</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5317</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"x_skew_perc"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5318</span> </span><span class="WHIT">                    </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.x_skew_perc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5319</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5320</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5321</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"add_wave_fold"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5322</span> </span><span class="WHIT">                    </span><span class="NAME">add_wavefold_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkWaveFold</span><span class="PUNC">(</span><span class="NAME">loop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.add_wave_fold</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5323</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5324</span> </span><span class="WHIT">                </span><span class="NAME">current_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateSimpleLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5325</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape_type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"swirl"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5326</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_number</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">extra_variables.y_step</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5327</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">swirl_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">extra_variables.swirl_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5328</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_step_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">extra_variables.perc_step_y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5329</span> </span><span class="WHIT">                </span><span class="NAME">current_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateSwirlLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">swirl_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5330</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape_type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"simple_skewed"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5331</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_number</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">extra_variables.y_step</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>5332</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_center_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">extra_variables.perc_center_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5333</span> </span><span class="WHIT">                </span><span class="NAME">current_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateSkewedSimpleLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_center_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5334</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape_type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"bulb"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5335</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_number</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">extra_variables.y_step</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>5336</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_number</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">extra_variables.x_step</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5337</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_step_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">extra_variables.perc_step_y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5338</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5339</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"add_wave_fold"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5340</span> </span><span class="WHIT">                    </span><span class="NAME">add_wavefold_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkWaveFold</span><span class="PUNC">(</span><span class="NAME">loop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.add_wave_fold</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5341</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5342</span> </span><span class="WHIT">                </span><span class="NAME">current_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateBulbLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="NAME">x_skew_perc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5343</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape_type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"mushroom"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5344</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_number</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">extra_variables.y_step</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>5345</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_number</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">extra_variables.x_step</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5346</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_center_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">extra_variables.perc_center_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5347</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_step_y1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">extra_variables.perc_step_y1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5348</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_step_y2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">extra_variables.perc_step_y2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5349</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5350</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"add_wave_fold"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5351</span> </span><span class="WHIT">                    </span><span class="NAME">add_wavefold_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkWaveFold</span><span class="PUNC">(</span><span class="NAME">loop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.add_wave_fold</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5352</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5353</span> </span><span class="WHIT">                </span><span class="NAME">current_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateMushRoomLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_center_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="NAME">x_skew_perc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5354</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape_type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"n_curves"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5355</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_number</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">extra_variables.y_step</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5356</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">n_centers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.n_centers</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5357</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_centers_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_centers_height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5358</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_rotation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.loop_rotation</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5359</span> </span><span class="WHIT">                </span><span class="NAME">current_points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateNWaveCurves</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">n_centers</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_centers_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_rotation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5360</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5361</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">hasNaN</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkForNaN</span><span class="PUNC">(</span><span class="NAME">current_points</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5362</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hasNaN</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">current_points.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5363</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5364</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5365</span> </span><span class="WHIT">            </span><span class="NAME">current_length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getGhostPathLength</span><span class="PUNC">(</span><span class="NAME">current_points</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5366</span> </span><span class="WHIT">            </span><span class="NAME">step_number</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5367</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5368</span> </span><span class="WHIT">        </span><span class="COMM">// gname += 1;</span><span class="WHIT">
<span class='line'>5369</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">current_points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5370</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5371</span> 
<span class='line'>5372</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5373</span>      * Generate loop points for short and long loops of length according to the expected length of each aminoacid in style_obj.
<span class='line'>5374</span>      * @namespace
<span class='line'>5375</span>      * @exports NaView
<span class='line'>5376</span>      * @name calculateResLengthPointData 
<span class='line'>5377</span>      * @param {Array} short_loop_data array of short or long loop data generated by processRawUniProt
<span class='line'>5378</span>      * @param {Object} loop_length_calculation Object part of style_obj describing how loop length should be calculated
<span class='line'>5379</span>      * @param {Object} loop_drawing_shape Object part of style_obj describing which loop shape should be drawn
<span class='line'>5380</span>      * @yields {Array} array of short or long loop data generated by processRawUniProt with points describing loop added
<span class='line'>5381</span>      */</span><span class="WHIT">
<span class='line'>5382</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">calculateResLengthPointData</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5383</span> </span><span class="WHIT">        </span><span class="COMM">//if smaller than, refactor length</span><span class="WHIT">
<span class='line'>5384</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aa_dist_sld_aanum_array</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_data.map</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5385</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">a.anchorage.dist</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a.aanum</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5386</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5387</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sorted_aa_dist_sld_array</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aa_dist_sld_aanum_array.sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5388</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5389</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5390</span> </span><span class="WHIT">        </span><span class="COMM">//get: minimum anchorage euclidean distance</span><span class="WHIT">
<span class='line'>5391</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">min_dist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sorted_aa_dist_sld_array</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5392</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">min_dist_index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sorted_aa_dist_sld_array</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5393</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">min_dist_aanum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sorted_aa_dist_sld_array</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5394</span> 
<span class='line'>5395</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">minimum_possible_reslen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">min_dist</span><span class="PUNC">/</span><span class="NAME">min_dist_aanum</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5396</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">current_reslen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.calc.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5397</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">current_reslen</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">minimum_possible_reslen</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5398</span> </span><span class="WHIT">            </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"WARNING: Reslength is smaller than what is possible. Refactoring..."</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5399</span> </span><span class="WHIT">            </span><span class="NAME">current_reslen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">minimum_possible_reslen</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5400</span> </span><span class="WHIT">            </span><span class="NAME">loop_length_calculation.calc.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">minimum_possible_reslen</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5401</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5402</span> 
<span class='line'>5403</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">extra_variables</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5404</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">[</span><span class="STRN">"calc"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5405</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape</span><span class="PUNC">[</span><span class="STRN">"calc"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5406</span> </span><span class="WHIT">                </span><span class="NAME">extra_variables</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">[</span><span class="STRN">"calc"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5407</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5408</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5409</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isld</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">isld</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">short_loop_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">isld</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5410</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5411</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5412</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5413</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">note</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"Cytoplasmic"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5414</span> </span><span class="WHIT">                </span><span class="NAME">y_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5415</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5416</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"n_curves"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5417</span> </span><span class="WHIT">                </span><span class="NAME">y_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5418</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5419</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">aanum</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">current_reslen</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5420</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generatePathWithLength</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="NAME">p2</span><span class="PUNC">,</span><span class="NAME">loop_length</span><span class="PUNC">,</span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="NAME">loop_drawing_shape</span><span class="PUNC">,</span><span class="NAME">loop_drawing_shape.type</span><span class="PUNC">,</span><span class="NAME">extra_variables</span><span class="PUNC">,</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5421</span> </span><span class="WHIT">            </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5422</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5423</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5424</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5425</span> 
<span class='line'>5426</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5427</span>      * Generate loop points for short and long loops of custom height and width according to style_obj
<span class='line'>5428</span>      * @namespace
<span class='line'>5429</span>      * @exports NaView
<span class='line'>5430</span>      * @name calculateCustomPointData 
<span class='line'>5431</span>      * @param {Array} short_loop_data array of short or long loop data generated by processRawUniProt
<span class='line'>5432</span>      * @param {Object} loop_length_calculation Object part of style_obj describing how loop length should be calculated
<span class='line'>5433</span>      * @param {Object} loop_drawing_shape Object part of style_obj describing which loop shape should be drawn
<span class='line'>5434</span>      * @yields {Array} array of short or long loop data generated by processRawUniProt with points describing loop added
<span class='line'>5435</span>      */</span><span class="WHIT">
<span class='line'>5436</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">calculateCustomPointData</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5437</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isld</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">isld</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">short_loop_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">isld</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5438</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5439</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5440</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5441</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">note</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"Cytoplasmic"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5442</span> </span><span class="WHIT">                </span><span class="NAME">y_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5443</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5444</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5445</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5446</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"dom_name"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5447</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5448</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_itype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_itype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5449</span> </span><span class="WHIT">                </span><span class="NAME">curve_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">[</span><span class="STRN">"calc"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"width"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">dom_name</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">dom_itype</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT">  </span><span class="NAME">svg_width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5450</span> </span><span class="WHIT">                </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">[</span><span class="STRN">"calc"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"height"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">dom_name</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">dom_itype</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5451</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5452</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_iname</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_iname</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5453</span> </span><span class="WHIT">                </span><span class="NAME">curve_width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">[</span><span class="STRN">"calc"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"width"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">dom_iname</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT">  </span><span class="NAME">svg_width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5454</span> </span><span class="WHIT">                </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">[</span><span class="STRN">"calc"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"height"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">dom_iname</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5455</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5456</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5457</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"simple"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5458</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5459</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"x_skew_perc"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5460</span> </span><span class="WHIT">                    </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.x_skew_perc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5461</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5462</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5463</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"add_wave_fold"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5464</span> </span><span class="WHIT">                    </span><span class="NAME">add_wavefold_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkWaveFold</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.add_wave_fold</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5465</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5466</span> </span><span class="WHIT">                </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateSimpleLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5467</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"swirl"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5468</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">swirl_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.swirl_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5469</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_step_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_step_y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5470</span> </span><span class="WHIT">                </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateSwirlLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">swirl_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5471</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"bulb"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5472</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_step_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_step_y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5473</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5474</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"add_wave_fold"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5475</span> </span><span class="WHIT">                    </span><span class="NAME">add_wavefold_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkWaveFold</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.add_wave_fold</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5476</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5477</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5478</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"x_skew_perc"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5479</span> </span><span class="WHIT">                    </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.x_skew_perc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5480</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5481</span> </span><span class="WHIT">                </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateBulbLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5482</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"mushroom"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5483</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_step_y1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_step_y1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5484</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_step_y2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_step_y2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5485</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_center_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_center_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5486</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5487</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"add_wave_fold"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5488</span> </span><span class="WHIT">                    </span><span class="NAME">add_wavefold_obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkWaveFold</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.add_wave_fold</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5489</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5490</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5491</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.calc.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"x_skew_perc"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5492</span> </span><span class="WHIT">                    </span><span class="NAME">x_skew_perc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.x_skew_perc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5493</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5494</span> </span><span class="WHIT">                </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateMushRoomLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_center_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_step_y2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x_skew_perc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add_wavefold_obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5495</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5496</span> </span><span class="WHIT">            </span><span class="NAME">short_loop_data</span><span class="PUNC">[</span><span class="NAME">isld</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5497</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5498</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">short_loop_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5499</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5500</span> 
<span class='line'>5501</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5502</span>      * After loop parent elements are drawn and partitioned to individual aminoacid, appends centroid data for each aminoacid in loops.
<span class='line'>5503</span>      * @namespace
<span class='line'>5504</span>      * @exports NaView
<span class='line'>5505</span>      * @name gen_centroids_loop_paths_resids 
<span class='line'>5506</span>      * @param {String} given_class class which loop group elements were named
<span class='line'>5507</span>      */</span><span class="WHIT">
<span class='line'>5508</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">gen_centroids_loop_paths_resids</span><span class="PUNC">(</span><span class="NAME">given_class</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5509</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">created_paths</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementsByClassName</span><span class="PUNC">(</span><span class="NAME">given_class</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5510</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">icp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">icp</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">created_paths.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">icp</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5511</span> </span><span class="WHIT">            </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">created_paths</span><span class="PUNC">[</span><span class="NAME">icp</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5512</span> </span><span class="WHIT">            </span><span class="COMM">// let path_box = element.getBoundingClientRect();</span><span class="WHIT">
<span class='line'>5513</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">path_box</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">element.getBBox</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5514</span> </span><span class="WHIT">            </span><span class="COMM">// let xCenter = (path_box.left + path_box.right) / 2;</span><span class="WHIT">
<span class='line'>5515</span> </span><span class="WHIT">            </span><span class="COMM">// let yCenter = (path_box.top + path_box.bottom) / 2;</span><span class="WHIT">
<span class='line'>5516</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">xCenter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">path_box.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">path_box.width</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5517</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">yCenter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">path_box.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">path_box.height</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5518</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">new_datum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">datum</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5519</span> </span><span class="WHIT">            </span><span class="NAME">new_datum</span><span class="PUNC">[</span><span class="STRN">"centroid"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">xCenter</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">yCenter</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5520</span> </span><span class="WHIT">            </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">datum</span><span class="PUNC">(</span><span class="NAME">new_datum</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5521</span> </span><span class="WHIT">            </span><span class="COMM">// if (new_datum.res_ind === "NaN") {</span><span class="WHIT">
<span class='line'>5522</span> </span><span class="WHIT">            </span><span class="COMM">//     d3.select(element).remove();</span><span class="WHIT">
<span class='line'>5523</span> </span><span class="WHIT">            </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>5524</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5525</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5526</span> 
<span class='line'>5527</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5528</span>      * Function to create loop path elements to each individual amino acid in loop by partitioning the parent loop element
<span class='line'>5529</span>      * @namespace
<span class='line'>5530</span>      * @exports NaView
<span class='line'>5531</span>      * @name draw_loop_paths_resids 
<span class='line'>5532</span>      * @param {D3 Selection} enter_element parent loop element d3.js selection
<span class='line'>5533</span>      * @param {String} class_naming class to name loop group elements
<span class='line'>5534</span>      */</span><span class="WHIT">
<span class='line'>5535</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_loop_paths_resids</span><span class="PUNC">(</span><span class="NAME">enter_element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">class_naming</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5536</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.line</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">curve</span><span class="PUNC">(</span><span class="NAME">d3.curveNatural</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5537</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">enter_element.datum</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5538</span> 
<span class='line'>5539</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">identifier_1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"dom_name"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5540</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">identifier_2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"dom_itype"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5541</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">identifier_1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">identifier_1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5542</span> </span><span class="WHIT">            </span><span class="NAME">identifier_1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5543</span> </span><span class="WHIT">            </span><span class="NAME">identifier_2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5544</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5545</span> 
<span class='line'>5546</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">data_resids</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data.resids</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5547</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">g_short_loop_resids</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">enter_element.append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5548</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5549</span> </span><span class="WHIT">            </span><span class="COMM">// return "g_"+class_naming+"_resids_" + d.dom_name + "_" + d.dom_itype;</span><span class="WHIT">
<span class='line'>5550</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"g_"</span><span class="PUNC">+</span><span class="NAME">class_naming</span><span class="PUNC">+</span><span class="STRN">"_resids_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">identifier_1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">identifier_2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5551</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5552</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"g_"</span><span class="PUNC">+</span><span class="NAME">class_naming</span><span class="PUNC">+</span><span class="STRN">"_resids residue_path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5553</span> </span><span class="WHIT">        </span><span class="COMM">// .attr("class", "g_"+class_naming+"_resids")</span><span class="WHIT">
<span class='line'>5554</span> </span><span class="WHIT">        </span><span class="COMM">// .style("display", "none")</span><span class="WHIT">
<span class='line'>5555</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">style</span><span class="PUNC">(</span><span class="STRN">"visibility"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"hidden"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5556</span> </span><span class="WHIT">        </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5557</span> </span><span class="WHIT">        
<span class='line'>5558</span>         </span><span class="NAME">g_short_loop_resids.selectAll</span><span class="PUNC">(</span><span class="PUNC">+</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5559</span> </span><span class="WHIT">            </span><span class="COMM">// return "."+class_naming+"_resid_" + d.dom_name + "_" + d.dom_itype;</span><span class="WHIT">
<span class='line'>5560</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"."</span><span class="PUNC">+</span><span class="NAME">class_naming</span><span class="PUNC">+</span><span class="STRN">"_resid_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">identifier_1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">identifier_2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5561</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5562</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5563</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aa_array</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d.aas.split</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5564</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">height_per_aa</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d.draw_area.height</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">aa_array.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5565</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">d_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5566</span> </span><span class="WHIT">            
<span class='line'>5567</span>             </span><span class="COMM">// let p_element = d3.select("#g_"+class_naming+"_" + d.dom_name + "_" + d.dom_itype);</span><span class="WHIT">
<span class='line'>5568</span> </span><span class="WHIT">            </span><span class="COMM">// let p_element = d3.select("#g_"+class_naming+"_" + d[identifier_1] + "_" + d[identifier_2]);</span><span class="WHIT">
<span class='line'>5569</span> </span><span class="WHIT">            </span><span class="COMM">// let p_length = p_element.node().getTotalLength();</span><span class="WHIT">
<span class='line'>5570</span> </span><span class="WHIT">            </span><span class="COMM">// let p_length_per_resid = p_length / data_resids.length;</span><span class="WHIT">
<span class='line'>5571</span> </span><span class="WHIT">            </span><span class="COMM">// let p_length_per_resid = document.getElementById("g_"+class_naming+"_" + d.dom_name + "_" + d.dom_itype).getTotalLength() / data_resids.length;</span><span class="WHIT">
<span class='line'>5572</span> </span><span class="WHIT">            </span><span class="COMM">// let p_length_per_resid = document.getElementById("g_"+class_naming+"_" + d.dom_name + "_" + d.dom_itype).getTotalLength() / d.resids.length;</span><span class="WHIT">
<span class='line'>5573</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">path_resids_id_name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"g_"</span><span class="PUNC">+</span><span class="NAME">class_naming</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">identifier_1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">identifier_2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5574</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p_length_per_resid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">path_resids_id_name</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTotalLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">d.resids.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5575</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">segmentstart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5576</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">iaaa</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iaaa</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aa_array.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iaaa</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5577</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aa</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aa_array</span><span class="PUNC">[</span><span class="NAME">iaaa</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5578</span> </span><span class="WHIT">                </span><span class="COMM">// segmentstart = segmentend + 0;</span><span class="WHIT">
<span class='line'>5579</span> </span><span class="WHIT">                </span><span class="NAME">segmentstart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p_length_per_resid</span><span class="PUNC">*</span><span class="NAME">iaaa</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5580</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">segmentend</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">segmentstart</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">p_length_per_resid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5581</span> </span><span class="WHIT">                </span><span class="COMM">// let path_piece_pts = pathSegmentToXYPoints(document.getElementById("g_"+class_naming+"_" + d.dom_name + "_" + d.dom_itype), segmentstart, segmentend, 1);</span><span class="WHIT">
<span class='line'>5582</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">path_piece_pts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pathSegmentToXYPoints</span><span class="PUNC">(</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"g_"</span><span class="PUNC">+</span><span class="NAME">class_naming</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">identifier_1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">identifier_2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">segmentstart</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">segmentend</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5583</span> </span><span class="WHIT">                </span><span class="NAME">d_data.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5584</span> </span><span class="WHIT">                    </span><span class="STRN">"id"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">d.id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5585</span> </span><span class="WHIT">                    </span><span class="STRN">"type"</span><span class="PUNC">:</span><span class="NAME">d.type</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5586</span> </span><span class="WHIT">                    </span><span class="STRN">"dom_name"</span><span class="PUNC">:</span><span class="NAME">d.dom_name</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5587</span> </span><span class="WHIT">                    </span><span class="STRN">"dom_itype"</span><span class="PUNC">:</span><span class="NAME">d.dom_itype</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5588</span> </span><span class="WHIT">                    </span><span class="STRN">"path_piece_pts"</span><span class="PUNC">:</span><span class="NAME">path_piece_pts</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5589</span> </span><span class="WHIT">                    </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="NAME">data.fill</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5590</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke"</span><span class="PUNC">:</span><span class="NAME">data.stroke</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5591</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_width"</span><span class="PUNC">:</span><span class="NAME">data.stroke_size</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5592</span> </span><span class="WHIT">                    </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="NAME">data.opacity</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5593</span> </span><span class="WHIT">                    </span><span class="STRN">"res_1"</span><span class="PUNC">:</span><span class="NAME">d.resids</span><span class="PUNC">[</span><span class="NAME">iaaa</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">res_1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5594</span> </span><span class="WHIT">                    </span><span class="STRN">"res_3"</span><span class="PUNC">:</span><span class="NAME">d.resids</span><span class="PUNC">[</span><span class="NAME">iaaa</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">res_3</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5595</span> </span><span class="WHIT">                    </span><span class="STRN">"res_ind"</span><span class="PUNC">:</span><span class="NAME">d.resids</span><span class="PUNC">[</span><span class="NAME">iaaa</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">res_ind</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5596</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5597</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5598</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5599</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5600</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>5601</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">enter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5602</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">e2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">enter.append</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5603</span> </span><span class="WHIT">                </span><span class="COMM">// .attr("class", function(d) { return class_naming+"_resid_" + d.dom_name + "_" + d.dom_itype + " short_loops_residues"; })</span><span class="WHIT">
<span class='line'>5604</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">class_naming</span><span class="PUNC">+</span><span class="STRN">"_resid_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">identifier_1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">identifier_2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">class_naming</span><span class="PUNC">+</span><span class="STRN">"_residues single_residue_path"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5605</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"resname"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.res_3</span><span class="PUNC">+</span><span class="NAME">d.res_ind</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5606</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"d"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5607</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">curve</span><span class="PUNC">(</span><span class="NAME">d.path_piece_pts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5608</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5609</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke-width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke_width</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5610</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5611</span> </span><span class="WHIT">                    </span><span class="COMM">// let f_color = checkFillResidue(d)[0];</span><span class="WHIT">
<span class='line'>5612</span> </span><span class="WHIT">                    </span><span class="COMM">// if (f_color) {</span><span class="WHIT">
<span class='line'>5613</span> </span><span class="WHIT">                    </span><span class="COMM">//     return f_color;</span><span class="WHIT">
<span class='line'>5614</span> </span><span class="WHIT">                    </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>5615</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5616</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5617</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5618</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5619</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5620</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="PUNC">;</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5621</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5622</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5623</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5624</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5625</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5626</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5627</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5628</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5629</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5630</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5631</span> </span><span class="WHIT">                </span><span class="COMM">// .style("vector-effect", "non-scaling-stroke")</span><span class="WHIT">
<span class='line'>5632</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">on</span><span class="PUNC">(</span><span class="STRN">"mouseover"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5633</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5634</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"#######"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5635</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"MOUSE OVER PATH"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5636</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"data:"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5637</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5638</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"#######"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5639</span> </span><span class="WHIT">                    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5640</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5641</span> </span><span class="WHIT">                </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5642</span> </span><span class="WHIT">                </span><span class="NAME">gen_centroids_loop_paths_resids</span><span class="PUNC">(</span><span class="NAME">class_naming</span><span class="PUNC">+</span><span class="STRN">"_residues"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5643</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5644</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5645</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">update</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5646</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">update</span><span class="WHIT">
<span class='line'>5647</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">transition</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5648</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5649</span> </span><span class="WHIT">                    </span><span class="COMM">// let f_color = checkFillResidue(d)[0];</span><span class="WHIT">
<span class='line'>5650</span> </span><span class="WHIT">                    </span><span class="COMM">// if (f_color) {</span><span class="WHIT">
<span class='line'>5651</span> </span><span class="WHIT">                    </span><span class="COMM">//     return f_color;</span><span class="WHIT">
<span class='line'>5652</span> </span><span class="WHIT">                    </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>5653</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5654</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5655</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5656</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5657</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5658</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5659</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5660</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5661</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5662</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5663</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">checkFillResidue</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5664</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f_color</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5665</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f_color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5666</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5667</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.stroke</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5668</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5669</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5670</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5671</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5672</span> 
<span class='line'>5673</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5674</span>      * Function responsible for drawing loop curves according to d3.curveNatural and points of each curve
<span class='line'>5675</span>      * @namespace
<span class='line'>5676</span>      * @exports NaView
<span class='line'>5677</span>      * @name draw_loop_paths 
<span class='line'>5678</span>      * @param {Array} short_loop_data  Array of loop data to draw
<span class='line'>5679</span>      * @param {String} class_naming class to name loop group elements
<span class='line'>5680</span>      */</span><span class="WHIT">
<span class='line'>5681</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_loop_paths</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">class_naming</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5682</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.line</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">curve</span><span class="PUNC">(</span><span class="NAME">d3.curveNatural</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5683</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">svg_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="STRN">"#"</span><span class="PUNC">+</span><span class="NAME">svg_id</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5684</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5685</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">class_naming</span><span class="PUNC">+</span><span class="STRN">"_group"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5686</span> 
<span class='line'>5687</span> </span><span class="WHIT">        </span><span class="NAME">svg_element.selectAll</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">+</span><span class="NAME">class_naming</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5688</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5689</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>5690</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">enter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5691</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">enter.append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5692</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">class_naming</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" element_path_group"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5693</span> 
<span class='line'>5694</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.append</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5695</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5696</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">identifier_1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"dom_name"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5697</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">identifier_2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"dom_itype"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5698</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"dom_name"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"dom_name"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5699</span> </span><span class="WHIT">                        </span><span class="NAME">identifier_1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5700</span> </span><span class="WHIT">                        </span><span class="NAME">identifier_2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5701</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5702</span> </span><span class="WHIT">                    </span><span class="COMM">// return "g_"+class_naming+"_" + d.dom_name + "_" + d.dom_itype;</span><span class="WHIT">
<span class='line'>5703</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"g_"</span><span class="PUNC">+</span><span class="NAME">class_naming</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">identifier_1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">identifier_2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5704</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5705</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"element_path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5706</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"d"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5707</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">curve</span><span class="PUNC">(</span><span class="NAME">d.points</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5708</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5709</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'stroke'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5710</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"stroke"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5711</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5712</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5713</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5714</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5715</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5716</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5717</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5718</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'stroke-width'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5719</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"stroke_size"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5720</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5721</span> </span><span class="WHIT">                </span><span class="COMM">// .style("vector-effect", "non-scaling-stroke")</span><span class="WHIT">
<span class='line'>5722</span> </span><span class="WHIT">                </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5723</span> </span><span class="WHIT">                </span><span class="NAME">draw_loop_paths_resids</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">class_naming</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5724</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5725</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5726</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">update</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5727</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">update</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5728</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5729</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5730</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">exit.remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5731</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5732</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5733</span> </span><span class="WHIT">        </span><span class="COMM">//here d3 is used for append data to each path of loop to be generated with curveNatural</span><span class="WHIT">
<span class='line'>5734</span> 
<span class='line'>5735</span> </span><span class="WHIT">        </span><span class="COMM">// for each loop:</span><span class="WHIT">
<span class='line'>5736</span> </span><span class="WHIT">        </span><span class="COMM">// call point generation function according to parameters</span><span class="WHIT">
<span class='line'>5737</span> </span><span class="WHIT">        </span><span class="COMM">// retrieve points</span><span class="WHIT">
<span class='line'>5738</span> </span><span class="WHIT">        </span><span class="COMM">// draw path according to configs</span><span class="WHIT">
<span class='line'>5739</span> </span><span class="WHIT">        </span><span class="COMM">// split path into sub paths of residues</span><span class="WHIT">
<span class='line'>5740</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5741</span> 
<span class='line'>5742</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5743</span>      * Function responsbile for controlling addition of points to termini data and drawing of termini curves
<span class='line'>5744</span>      * @namespace
<span class='line'>5745</span>      * @exports NaView
<span class='line'>5746</span>      * @name draw_shortLoops 
<span class='line'>5747</span>      * @param {Array} short_loop_data array of short or long loop data generated by processRawUniProt
<span class='line'>5748</span>      */</span><span class="WHIT">
<span class='line'>5749</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_shortLoops</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5750</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.protein.short_loops_draw_opts.calc_len</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5751</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.protein.short_loops_draw_opts.shape</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5752</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_length_calculation.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"fixed"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5753</span> </span><span class="WHIT">            </span><span class="NAME">short_loop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateFixedPointData</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5754</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_length_calculation.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"scaled"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5755</span> </span><span class="WHIT">            </span><span class="NAME">short_loop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateScaledPointData</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5756</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_length_calculation.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"reslen"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5757</span> </span><span class="WHIT">            </span><span class="NAME">short_loop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateResLengthPointData</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5758</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_length_calculation.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"custom"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5759</span> </span><span class="WHIT">            </span><span class="NAME">short_loop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateCustomPointData</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5760</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5761</span> </span><span class="WHIT">        </span><span class="NAME">draw_loop_paths</span><span class="PUNC">(</span><span class="NAME">short_loop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"short_loops"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5762</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5763</span> 
<span class='line'>5764</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5765</span>      * Generate loop points for pore loops of fixed or custom (per style_obj) height and width
<span class='line'>5766</span>      * @namespace
<span class='line'>5767</span>      * @exports NaView
<span class='line'>5768</span>      * @name calculateFixedCustomPointDataPore 
<span class='line'>5769</span>      * @param {Array} pores_data array of pore loop data generated by processRawUniProt
<span class='line'>5770</span>      * @param {Object} loop_length_calculation Object part of style_obj describing how loop length should be calculated
<span class='line'>5771</span>      * @param {Object} loop_drawing_shape Object part of style_obj describing which loop shape should be drawn
<span class='line'>5772</span>      * @yields {Array} array of pore loop data generated by processRawUniProt with points describing loop added
<span class='line'>5773</span>      */</span><span class="WHIT">
<span class='line'>5774</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">calculateFixedCustomPointDataPore</span><span class="PUNC">(</span><span class="NAME">pores_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5775</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ipd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ipd</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">pores_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ipd</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5776</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5777</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dom_itype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dom_itype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5778</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5779</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5780</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5781</span> </span><span class="WHIT">            
<span class='line'>5782</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">box_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">draw_area.height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5783</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5784</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_length_calculation</span><span class="PUNC">[</span><span class="STRN">"calc"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"height"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5785</span> </span><span class="WHIT">                </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">[</span><span class="STRN">"calc"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"height"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">dom_name</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">dom_itype</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">box_height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5786</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5787</span> </span><span class="WHIT">                </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">[</span><span class="STRN">"calc"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"height"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">box_height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5788</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5789</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5790</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_center_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_center_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5791</span> </span><span class="WHIT">            </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateSkewedSimpleLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_center_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5792</span> </span><span class="WHIT">            </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5793</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5794</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5795</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5796</span> 
<span class='line'>5797</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5798</span>      * Generate loop points for pore loops of scaled y growth "step" sizes according to their aanumber
<span class='line'>5799</span>      * @namespace
<span class='line'>5800</span>      * @exports NaView
<span class='line'>5801</span>      * @name calculateScaledPointDataPore 
<span class='line'>5802</span>      * @param {Array} pores_data array of pore loop data generated by processRawUniProt
<span class='line'>5803</span>      * @param {Object} loop_length_calculation Object part of style_obj describing how loop length should be calculated
<span class='line'>5804</span>      * @param {Object} loop_drawing_shape Object part of style_obj describing which loop shape should be drawn
<span class='line'>5805</span>      * @yields {Array} array of pore loop data generated by processRawUniProt with points describing loop added
<span class='line'>5806</span>      */</span><span class="WHIT">
<span class='line'>5807</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">calculateScaledPointDataPore</span><span class="PUNC">(</span><span class="NAME">pores_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5808</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aa_num_pore_array</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pores_data.map</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5809</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">a.aanum</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a.draw_area.height</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5810</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5811</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sorted_aa_num_pore_array</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aa_num_pore_array.sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5812</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5813</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5814</span> 
<span class='line'>5815</span> </span><span class="WHIT">        </span><span class="COMM">//get: maximum residue number</span><span class="WHIT">
<span class='line'>5816</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">max_aanum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sorted_aa_num_pore_array</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5817</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">max_aanum_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sorted_aa_num_pore_array</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5818</span> 
<span class='line'>5819</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_maxheight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">max_aanum_height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.calc.height</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>5820</span> 
<span class='line'>5821</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">scale_vars</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5822</span> </span><span class="WHIT">        </span><span class="NAME">scale_vars</span><span class="PUNC">[</span><span class="STRN">"y_step"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5823</span> </span><span class="WHIT">        </span><span class="NAME">scale_vars</span><span class="PUNC">[</span><span class="STRN">"y_step"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"max_step"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">curve_maxheight</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.y_step</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5824</span> </span><span class="WHIT">        </span><span class="NAME">scale_vars</span><span class="PUNC">[</span><span class="STRN">"y_step"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"scale"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.calc.scale</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5825</span> </span><span class="WHIT">        </span><span class="NAME">scale_vars</span><span class="PUNC">[</span><span class="STRN">"y_step"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"domain"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">max_aanum</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5826</span> </span><span class="WHIT">        </span><span class="NAME">scale_vars</span><span class="PUNC">[</span><span class="STRN">"y_step"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"range"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NAME">curve_maxheight</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.y_step</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5827</span> 
<span class='line'>5828</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_scaling</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">makeLoopScaling</span><span class="PUNC">(</span><span class="NAME">scale_vars.y_step</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5829</span> 
<span class='line'>5830</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ipd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ipd</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">pores_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ipd</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5831</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5832</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5833</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5834</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5835</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">step_number</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_scaling</span><span class="PUNC">(</span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">aanum</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5836</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">step_number</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.y_step</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5837</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_center_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_center_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5838</span> </span><span class="WHIT">            </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateSkewedSimpleLoopPoints</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_center_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5839</span> </span><span class="WHIT">            </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5840</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5841</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5842</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5843</span> 
<span class='line'>5844</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5845</span>      * Generate loop points for pore loops of length according to the expected length of each aminoacid in style_obj.
<span class='line'>5846</span>      * @namespace
<span class='line'>5847</span>      * @exports NaView
<span class='line'>5848</span>      * @name calculateResLengthPointDataPore 
<span class='line'>5849</span>      * @param {Array} pores_data array of pore loop data generated by processRawUniProt
<span class='line'>5850</span>      * @param {Object} loop_length_calculation Object part of style_obj describing how loop length should be calculated
<span class='line'>5851</span>      * @param {Object} loop_drawing_shape Object part of style_obj describing which loop shape should be drawn
<span class='line'>5852</span>      * @yields {Array} array of pore loop data generated by processRawUniProt with points describing loop added
<span class='line'>5853</span>      */</span><span class="WHIT">
<span class='line'>5854</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">calculateResLengthPointDataPore</span><span class="PUNC">(</span><span class="NAME">pores_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5855</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">aa_dist_sld_aanum_array</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pores_data.map</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5856</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">a.anchorage.dist</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a.aanum</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5857</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5858</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sorted_aa_dist_sld_array</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aa_dist_sld_aanum_array.sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5859</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5860</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5861</span> </span><span class="WHIT">        </span><span class="COMM">//get: minimum anchorage euclidean distance</span><span class="WHIT">
<span class='line'>5862</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">min_dist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sorted_aa_dist_sld_array</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5863</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">min_dist_index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sorted_aa_dist_sld_array</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5864</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">min_dist_aanum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sorted_aa_dist_sld_array</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5865</span> 
<span class='line'>5866</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">minimum_possible_reslen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">min_dist</span><span class="PUNC">/</span><span class="NAME">min_dist_aanum</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5867</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">current_reslen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.calc.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5868</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">current_reslen</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">minimum_possible_reslen</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5869</span> </span><span class="WHIT">            </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"WARNING: Reslength is smaller than what is possible. Refactoring..."</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5870</span> </span><span class="WHIT">            </span><span class="NAME">current_reslen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">minimum_possible_reslen</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5871</span> </span><span class="WHIT">            </span><span class="NAME">loop_length_calculation.calc.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">minimum_possible_reslen</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5872</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5873</span> 
<span class='line'>5874</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">extra_variables</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5875</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">[</span><span class="STRN">"calc"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5876</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape</span><span class="PUNC">[</span><span class="STRN">"calc"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5877</span> </span><span class="WHIT">                </span><span class="NAME">extra_variables</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">[</span><span class="STRN">"calc"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5878</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5879</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5880</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ipd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ipd</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">pores_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ipd</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5881</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5882</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchorage.p2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5883</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5884</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">aanum</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">current_reslen</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5885</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generatePathWithLength</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="NAME">p2</span><span class="PUNC">,</span><span class="NAME">loop_length</span><span class="PUNC">,</span><span class="NAME">y_direction</span><span class="PUNC">,</span><span class="NAME">loop_drawing_shape</span><span class="PUNC">,</span><span class="NAME">loop_drawing_shape.type</span><span class="PUNC">,</span><span class="NAME">extra_variables</span><span class="PUNC">,</span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5886</span> </span><span class="WHIT">            </span><span class="NAME">pores_data</span><span class="PUNC">[</span><span class="NAME">ipd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5887</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5888</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">pores_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5889</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5890</span> 
<span class='line'>5891</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5892</span>      * Function responsbile for controlling addition of points to pore data and drawing of pore curves
<span class='line'>5893</span>      * @namespace
<span class='line'>5894</span>      * @exports NaView
<span class='line'>5895</span>      * @name draw_poreLoops 
<span class='line'>5896</span>      * @param {Array} pores_data array of pore loop data generated by processRawUniProt
<span class='line'>5897</span>      */</span><span class="WHIT">
<span class='line'>5898</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_poreLoops</span><span class="PUNC">(</span><span class="NAME">pores_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5899</span> </span><span class="WHIT">        </span><span class="COMM">// pore drawing. pain in the arse. basically can be scaled alongside helix height</span><span class="WHIT">
<span class='line'>5900</span> </span><span class="WHIT">        </span><span class="COMM">// can have a custom breakpoint residue</span><span class="WHIT">
<span class='line'>5901</span> </span><span class="WHIT">        </span><span class="COMM">// and can be scaled according to a custom residue length</span><span class="WHIT">
<span class='line'>5902</span> 
<span class='line'>5903</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.protein.pore_loops_draw_opts.calc_len</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5904</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.protein.pore_loops_draw_opts.shape</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5905</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_length_calculation.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"fixed"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"custom"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5906</span> </span><span class="WHIT">            </span><span class="NAME">pores_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateFixedCustomPointDataPore</span><span class="PUNC">(</span><span class="NAME">pores_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5907</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_length_calculation.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"scaled"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5908</span> </span><span class="WHIT">            </span><span class="NAME">pores_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateScaledPointDataPore</span><span class="PUNC">(</span><span class="NAME">pores_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5909</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_length_calculation.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"reslen"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5910</span> </span><span class="WHIT">            </span><span class="NAME">pores_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateResLengthPointDataPore</span><span class="PUNC">(</span><span class="NAME">pores_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5911</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5912</span> </span><span class="WHIT">        </span><span class="NAME">draw_loop_paths</span><span class="PUNC">(</span><span class="NAME">pores_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"pore_loops"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5913</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5914</span> 
<span class='line'>5915</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5916</span>      * Function responsbile for controlling addition of points to long loops data and drawing of long loops curves
<span class='line'>5917</span>      * @namespace
<span class='line'>5918</span>      * @exports NaView
<span class='line'>5919</span>      * @name draw_longLoops 
<span class='line'>5920</span>      * @param {Array} longloop_data  array of long loop data generated by processRawUniProt
<span class='line'>5921</span>      */</span><span class="WHIT">
<span class='line'>5922</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_longLoops</span><span class="PUNC">(</span><span class="NAME">longloop_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5923</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.protein.long_loops_draw_opts.calc_len</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5924</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.protein.long_loops_draw_opts.shape</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5925</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_length_calculation.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"fixed"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5926</span> </span><span class="WHIT">            </span><span class="NAME">longloop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateFixedPointData</span><span class="PUNC">(</span><span class="NAME">longloop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5927</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_length_calculation.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"scaled"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5928</span> </span><span class="WHIT">            </span><span class="NAME">longloop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateScaledPointData</span><span class="PUNC">(</span><span class="NAME">longloop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5929</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_length_calculation.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"reslen"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5930</span> </span><span class="WHIT">            </span><span class="NAME">longloop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateResLengthPointData</span><span class="PUNC">(</span><span class="NAME">longloop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5931</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_length_calculation.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"custom"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5932</span> </span><span class="WHIT">            </span><span class="NAME">longloop_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateCustomPointData</span><span class="PUNC">(</span><span class="NAME">longloop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5933</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5934</span> </span><span class="WHIT">        </span><span class="NAME">draw_loop_paths</span><span class="PUNC">(</span><span class="NAME">longloop_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"long_loops"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5935</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5936</span> 
<span class='line'>5937</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5938</span>      * Generate loop points for termini loops of fixed or custom (per style_obj) height and width
<span class='line'>5939</span>      * @namespace
<span class='line'>5940</span>      * @exports NaView
<span class='line'>5941</span>      * @name calculateFixedPointTermini 
<span class='line'>5942</span>      * @param {Object} termini_data termini loop data Object generated by processRawUniProt
<span class='line'>5943</span>      * @param {Object} loop_length_calculation Object part of style_obj describing how loop length should be calculated
<span class='line'>5944</span>      * @param {Object} loop_drawing_shape Object part of style_obj describing which loop shape should be drawn
<span class='line'>5945</span>      * @yields {Object} termini loop data Object generated by processRawUniProt with points describing loop added
<span class='line'>5946</span>      */</span><span class="WHIT">
<span class='line'>5947</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">calculateFixedPointTermini</span><span class="PUNC">(</span><span class="NAME">termini_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5948</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">termini_height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5949</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">termini_data.terminus_type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"N"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5950</span> </span><span class="WHIT">            </span><span class="NAME">termini_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_drawarea.end_y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">svg_drawarea.membrane_end</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5951</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5952</span> </span><span class="WHIT">            </span><span class="NAME">termini_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_drawarea.end_y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">svg_drawarea.membrane_end</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5953</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5954</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">termini_height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation.calc.height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5955</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">termini_data.anchorage.p1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5956</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">termini_data.anchorage.p2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5957</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">starting_y_direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5958</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5959</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_drawing_shape.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"n_curves"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5960</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">n_centers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.n_centers</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5961</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_centers_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.perc_centers_height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5962</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_rotation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape.calc.loop_rotation</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5963</span> </span><span class="WHIT">            </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">generateNWaveCurves</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">n_centers</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curve_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">perc_centers_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">starting_y_direction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_rotation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5964</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5965</span> </span><span class="WHIT">        </span><span class="NAME">termini_data.points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5966</span> </span><span class="WHIT">        </span><span class="NAME">draw_loop_paths</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">termini_data</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">termini_data.terminus_type</span><span class="PUNC">+</span><span class="STRN">"ter_loops"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5967</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">termini_data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5968</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5969</span> 
<span class='line'>5970</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5971</span>      * Function responsbile for controlling addition of points to termini data and drawing of termini curves
<span class='line'>5972</span>      * @namespace
<span class='line'>5973</span>      * @exports NaView
<span class='line'>5974</span>      * @name draw_termini 
<span class='line'>5975</span>      * @param {Object} termini_data termini loop data Object generated by processRawUniProt
<span class='line'>5976</span>      */</span><span class="WHIT">
<span class='line'>5977</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_termini</span><span class="PUNC">(</span><span class="NAME">termini_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5978</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">;</span><span class="COMM">// = style_obj.protein.pore_loops_draw_opts.calc_len;</span><span class="WHIT">
<span class='line'>5979</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">;</span><span class="COMM">// = style_obj.protein.pore_loops_draw_opts.shape;</span><span class="WHIT">
<span class='line'>5980</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">termini_data.terminus_type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"N"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5981</span> </span><span class="WHIT">            </span><span class="NAME">loop_length_calculation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.protein.nter_loop_draw_opts.calc_len</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5982</span> </span><span class="WHIT">            </span><span class="NAME">loop_drawing_shape</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.protein.nter_loop_draw_opts.shape</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5983</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5984</span> </span><span class="WHIT">            </span><span class="NAME">loop_length_calculation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.protein.cter_loop_draw_opts.calc_len</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5985</span> </span><span class="WHIT">            </span><span class="NAME">loop_drawing_shape</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.protein.cter_loop_draw_opts.shape</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5986</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5987</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_length_calculation.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"fixed"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5988</span> </span><span class="WHIT">            </span><span class="NAME">termini_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateFixedPointTermini</span><span class="PUNC">(</span><span class="NAME">termini_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5989</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">loop_length_calculation.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"reslen"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5990</span> </span><span class="WHIT">            </span><span class="NAME">termini_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateResLengthPointData</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">termini_data</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_length_calculation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loop_drawing_shape</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5991</span> </span><span class="WHIT">            </span><span class="NAME">draw_loop_paths</span><span class="PUNC">(</span><span class="NAME">termini_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">termini_data</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">terminus_type</span><span class="PUNC">+</span><span class="STRN">"ter_loops"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5992</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5993</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5994</span> </span><span class="WHIT">    
<span class='line'>5995</span>     </span><span class="COMM">/**
<span class='line'>5996</span>      * Function to parse residue relations description array and style_obj, generating points, width and color scales to each relation object.&lt;br>
<span class='line'>5997</span>      * Relations between any residues or drawn elements follows the below syntax:&lt;br>
<span class='line'>5998</span>      * {&lt;br>
<span class='line'>5999</span>      *     "source":"random_residue_source", //index OR residue_name+index of residue in relationship or valid element name such as: "DomainI;Helix1"&lt;br>
<span class='line'>6000</span>      *     "target":"random_residue_target", //index OR residue_name+index of residue in relationship or valid element name such as: "DomainI;Helix1"&lt;br>
<span class='line'>6001</span>      *     "raw_weight":possibly_random_residue_weight //number indicating strength of each residue or element relationship&lt;br>
<span class='line'>6002</span>      *     "type": "type" //optional type object for describing multiple types of relationships in plor&lt;br>
<span class='line'>6003</span>      * }&lt;br>
<span class='line'>6004</span>      * @see allowed_element_names
<span class='line'>6005</span>      * @see draw_relation_paths
<span class='line'>6006</span>      * @see whereIsResIdElName
<span class='line'>6007</span>      * @namespace
<span class='line'>6008</span>      * @exports NaView
<span class='line'>6009</span>      * @name draw_residue_relations 
<span class='line'>6010</span>      * @param {Array} residue_relation_data array of residue relation Objects
<span class='line'>6011</span>      * @param {Object} centroid_data Dictionary containing centroids of elements and residues
<span class='line'>6012</span>      * @param {Object} full_protein_data full data generated by processRawUniProt
<span class='line'>6013</span>      */</span><span class="WHIT">
<span class='line'>6014</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_residue_relations</span><span class="PUNC">(</span><span class="NAME">residue_relation_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">centroid_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">full_protein_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6015</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">draw_opts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.protein.residue_relations_draw_opts</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6016</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">group_weights_by_type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6017</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">draw_opts.path_width_scaling.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"calc"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6018</span> </span><span class="WHIT">            </span><span class="NAME">group_weights_by_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draw_opts.path_width_scaling.group_by_type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6019</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6020</span> </span><span class="WHIT">    
<span class='line'>6021</span>         </span><span class="NAME">residue_relation_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mergeDrawData</span><span class="PUNC">(</span><span class="STRN">"residue_relations"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">residue_relation_data</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6022</span> </span><span class="WHIT">    
<span class='line'>6023</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">list_of_types</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6024</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">total_weights_by_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6025</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">group_weights_by_type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6026</span> </span><span class="WHIT">            </span><span class="NAME">list_of_types</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">residue_relation_data.map</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6027</span> </span><span class="WHIT">                </span><span class="NAME">total_weights_by_type</span><span class="PUNC">[</span><span class="NAME">a.type</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6028</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6029</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6030</span> </span><span class="WHIT">            </span><span class="NAME">list_of_types</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">list_of_types</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">filter</span><span class="PUNC">(</span><span class="NAME">onlyUnique</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6031</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6032</span> </span><span class="WHIT">    
<span class='line'>6033</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">total_weights</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">residue_relation_data.reduce</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6034</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">a.raw_weight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6035</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6036</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">group_weights_by_type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6037</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">irrd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">irrd</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">residue_relation_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">irrd</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6038</span> </span><span class="WHIT">                </span><span class="NAME">total_weights_by_type</span><span class="PUNC">[</span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"type"</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"raw_weight"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6039</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6040</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6041</span> </span><span class="WHIT">    
<span class='line'>6042</span>     
<span class='line'>6043</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">all_relative_weights</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6044</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">all_absolute_weights</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6045</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">all_relative_weights_by_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6046</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">all_absolute_weights_by_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6047</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">irrd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">irrd</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">residue_relation_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">irrd</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6048</span> </span><span class="WHIT">            </span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"absolute_weight"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"raw_weight"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6049</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">group_weights_by_type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6050</span> </span><span class="WHIT">                </span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"relative_weight"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"raw_weight"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">total_weights_by_type</span><span class="PUNC">[</span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"type"</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6051</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">all_relative_weights_by_type.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"type"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6052</span> </span><span class="WHIT">                    </span><span class="NAME">all_relative_weights_by_type</span><span class="PUNC">[</span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"type"</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6053</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6054</span> </span><span class="WHIT">                </span><span class="NAME">all_relative_weights_by_type</span><span class="PUNC">[</span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"type"</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"relative_weight"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6055</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">all_absolute_weights_by_type.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"type"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6056</span> </span><span class="WHIT">                    </span><span class="NAME">all_absolute_weights_by_type</span><span class="PUNC">[</span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"type"</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6057</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6058</span> </span><span class="WHIT">                </span><span class="NAME">all_absolute_weights_by_type</span><span class="PUNC">[</span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"type"</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"absolute_weight"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6059</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6060</span> </span><span class="WHIT">                </span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"relative_weight"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"raw_weight"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">total_weights</span><span class="PUNC">;</span><span class="WHIT">        
<span class='line'>6061</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6062</span> </span><span class="WHIT">            </span><span class="NAME">all_absolute_weights.push</span><span class="PUNC">(</span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"absolute_weight"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6063</span> </span><span class="WHIT">            </span><span class="NAME">all_relative_weights.push</span><span class="PUNC">(</span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"relative_weight"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6064</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6065</span> </span><span class="WHIT">        </span><span class="COMM">// let all_relative_weights = residue_relation_data.map(function(a) {</span><span class="WHIT">
<span class='line'>6066</span> </span><span class="WHIT">        </span><span class="COMM">//     return a.relative_weight;</span><span class="WHIT">
<span class='line'>6067</span> </span><span class="WHIT">        </span><span class="COMM">// });</span><span class="WHIT">
<span class='line'>6068</span> </span><span class="WHIT">        </span><span class="COMM">// let all_absolute_weights = residue_relation_data.map(function(a) {</span><span class="WHIT">
<span class='line'>6069</span> </span><span class="WHIT">        </span><span class="COMM">//     return a.raw_weight;</span><span class="WHIT">
<span class='line'>6070</span> </span><span class="WHIT">        </span><span class="COMM">// });</span><span class="WHIT">
<span class='line'>6071</span> </span><span class="WHIT">    
<span class='line'>6072</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">to_use_weights</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">all_relative_weights</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6073</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">to_use_weights_by_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">all_relative_weights_by_type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6074</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">draw_opts.weight_scaling</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"absolute"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6075</span> </span><span class="WHIT">            </span><span class="NAME">to_use_weights</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">all_absolute_weights</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6076</span> </span><span class="WHIT">            </span><span class="NAME">to_use_weights_by_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">all_absolute_weights_by_type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6077</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6078</span> </span><span class="WHIT">    
<span class='line'>6079</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">current_width_scale</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6080</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">draw_opts.path_width_scaling.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"calc"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6081</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">wdomain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draw_opts.path_width_scaling.domain</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6082</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">wrange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draw_opts.path_width_scaling.range</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6083</span> </span><span class="WHIT">    
<span class='line'>6084</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">group_weights_by_type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6085</span> </span><span class="WHIT">                </span><span class="NAME">current_width_scale</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">etc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">etctype</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6086</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cwdomain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">wdomain</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6087</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cwdomain</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"min"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6088</span> </span><span class="WHIT">                        </span><span class="NAME">cwdomain</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.min</span><span class="PUNC">(</span><span class="NAME">to_use_weights_by_type</span><span class="PUNC">[</span><span class="NAME">etctype</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6089</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6090</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cwdomain</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"max"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6091</span> </span><span class="WHIT">                        </span><span class="NAME">cwdomain</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.max</span><span class="PUNC">(</span><span class="NAME">to_use_weights_by_type</span><span class="PUNC">[</span><span class="NAME">etctype</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6092</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6093</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cwrange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">wrange</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6094</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.scaleLinear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6095</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">domain</span><span class="PUNC">(</span><span class="NAME">cwdomain</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6096</span> </span><span class="WHIT">                    </span><span class="PUNC">.</span><span class="NAME">range</span><span class="PUNC">(</span><span class="NAME">cwrange</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6097</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">sc</span><span class="PUNC">(</span><span class="NAME">etc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6098</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6099</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6100</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">wdomain</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"min"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6101</span> </span><span class="WHIT">                    </span><span class="NAME">wdomain</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.min</span><span class="PUNC">(</span><span class="NAME">to_use_weights</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6102</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6103</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">wdomain</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"max"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6104</span> </span><span class="WHIT">                    </span><span class="NAME">wdomain</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.max</span><span class="PUNC">(</span><span class="NAME">to_use_weights</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6105</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6106</span> </span><span class="WHIT">    
<span class='line'>6107</span>                 </span><span class="NAME">current_width_scale</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.scaleLinear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6108</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">domain</span><span class="PUNC">(</span><span class="NAME">wdomain</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6109</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">range</span><span class="PUNC">(</span><span class="NAME">wrange</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6110</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6111</span> </span><span class="WHIT">            </span><span class="COMM">// console.log(current_width_scale)</span><span class="WHIT">
<span class='line'>6112</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">draw_opts.path_width_scaling.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"fixed"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6113</span> </span><span class="WHIT">            </span><span class="NAME">current_width_scale</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">etc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6114</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">draw_opts.path_width_scaling.perc_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6115</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6116</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6117</span> </span><span class="WHIT">            </span><span class="NAME">current_width_scale</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">etc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6118</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6119</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6120</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6121</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">current_color_scale</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6122</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">current_color_scale_prop</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6123</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lighter_fill_scale</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draw_opts.color_scaling.lighter_fill</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6124</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">draw_opts.color_scaling.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"calc"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6125</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">draw_opts.color_scaling.property</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"weight"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6126</span> </span><span class="WHIT">                </span><span class="NAME">current_color_scale_prop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draw_opts.weight_scaling</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">draw_opts.color_scaling.property</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6127</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cdomain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draw_opts.color_scaling.domain</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6128</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cdomain</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"min"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6129</span> </span><span class="WHIT">                    </span><span class="NAME">cdomain</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.min</span><span class="PUNC">(</span><span class="NAME">to_use_weights</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6130</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6131</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cdomain</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"max"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6132</span> </span><span class="WHIT">                    </span><span class="NAME">cdomain</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.max</span><span class="PUNC">(</span><span class="NAME">to_use_weights</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6133</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6134</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">crange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draw_opts.color_scaling.range</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6135</span> </span><span class="WHIT">                </span><span class="NAME">current_color_scale</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.scaleLinear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6136</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">domain</span><span class="PUNC">(</span><span class="NAME">cdomain</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6137</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">range</span><span class="PUNC">(</span><span class="NAME">crange</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6138</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">draw_opts.color_scaling.property</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"type"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6139</span> </span><span class="WHIT">                </span><span class="NAME">current_color_scale_prop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draw_opts.color_scaling.property</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6140</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cdomain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draw_opts.color_scaling.domain</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6141</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">crange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draw_opts.color_scaling.range</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6142</span> </span><span class="WHIT">                </span><span class="COMM">// current_color_scale= d3.scaleLinear()</span><span class="WHIT">
<span class='line'>6143</span> </span><span class="WHIT">                </span><span class="COMM">// .domain(cdomain)</span><span class="WHIT">
<span class='line'>6144</span> </span><span class="WHIT">                </span><span class="COMM">// .range(crange);</span><span class="WHIT">
<span class='line'>6145</span> </span><span class="WHIT">                </span><span class="NAME">current_color_scale</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">etc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6146</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">crange</span><span class="PUNC">[</span><span class="NAME">cdomain.indexOf</span><span class="PUNC">(</span><span class="NAME">etc</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6147</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6148</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6149</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6150</span> </span><span class="WHIT">        </span><span class="COMM">// color_scaling</span><span class="WHIT">
<span class='line'>6151</span> </span><span class="WHIT">        </span><span class="COMM">// property</span><span class="WHIT">
<span class='line'>6152</span> </span><span class="WHIT">        
<span class='line'>6153</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">current_centroid_radius</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6154</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">draw_opts.element_centroid_scaling.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"fixed"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6155</span> </span><span class="WHIT">            </span><span class="NAME">current_centroid_radius</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draw_opts.element_centroid_scaling.radius</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6156</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6157</span> </span><span class="WHIT">    
<span class='line'>6158</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">test_relation_circle_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6159</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">irrd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">irrd</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">residue_relation_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">irrd</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6160</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">raw_relation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6161</span> </span><span class="WHIT">    
<span class='line'>6162</span>             </span><span class="COMM">//TODO: test check for elements</span><span class="WHIT">
<span class='line'>6163</span> </span><span class="WHIT">            </span><span class="COMM">//TODO: check for stretches of residues</span><span class="WHIT">
<span class='line'>6164</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">source_txt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">raw_relation</span><span class="PUNC">[</span><span class="STRN">"source"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6165</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">target_txt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">raw_relation</span><span class="PUNC">[</span><span class="STRN">"target"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6166</span> </span><span class="WHIT">    
<span class='line'>6167</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">source_idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">source_txt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6168</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">target_idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">target_txt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6169</span> </span><span class="WHIT">    
<span class='line'>6170</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">source_resel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">whereIsResIdElName</span><span class="PUNC">(</span><span class="NAME">source_idx</span><span class="PUNC">,</span><span class="NAME">full_protein_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6171</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">target_resel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">whereIsResIdElName</span><span class="PUNC">(</span><span class="NAME">target_idx</span><span class="PUNC">,</span><span class="NAME">full_protein_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6172</span> </span><span class="WHIT">    
<span class='line'>6173</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">source_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">centroid_data</span><span class="PUNC">[</span><span class="NAME">source_idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">point</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6174</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">target_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">centroid_data</span><span class="PUNC">[</span><span class="NAME">target_idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">point</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6175</span> </span><span class="WHIT">    
<span class='line'>6176</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">before_source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6177</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">after_target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6178</span> </span><span class="WHIT">            </span><span class="COMM">// let source_idx_str = source_idx+"";</span><span class="WHIT">
<span class='line'>6179</span> </span><span class="WHIT">            </span><span class="COMM">// let target_idx_str = target_idx+"";</span><span class="WHIT">
<span class='line'>6180</span> </span><span class="WHIT">            </span><span class="COMM">// if (source_idx_str.includes(";") && current_centroid_radius) {</span><span class="WHIT">
<span class='line'>6181</span> </span><span class="WHIT">            </span><span class="COMM">//     console.log("source is element");</span><span class="WHIT">
<span class='line'>6182</span> </span><span class="WHIT">            </span><span class="COMM">//     let before_centroids_vector = createVector(source_centroid, target_centroid);</span><span class="WHIT">
<span class='line'>6183</span> </span><span class="WHIT">            </span><span class="COMM">//     let before_centroids_vector_normalized = normalizeVector(before_centroids_vector);</span><span class="WHIT">
<span class='line'>6184</span> </span><span class="WHIT">            </span><span class="COMM">//     let before_centroids_vector_scaled = scaleVector(before_centroids_vector_normalized, current_centroid_radius);</span><span class="WHIT">
<span class='line'>6185</span> </span><span class="WHIT">            </span><span class="COMM">//     let before_centroids_vector_rotated_1 = rotateByAng(before_centroids_vector_scaled, source_centroid, 90);</span><span class="WHIT">
<span class='line'>6186</span> </span><span class="WHIT">            </span><span class="COMM">//     let before_centroids_vector_rotated_2 = rotateByAng(before_centroids_vector_scaled, source_centroid, -90);</span><span class="WHIT">
<span class='line'>6187</span> </span><span class="WHIT">            </span><span class="COMM">//     before_source.push(before_centroids_vector_rotated_1);</span><span class="WHIT">
<span class='line'>6188</span> </span><span class="WHIT">            </span><span class="COMM">//     before_source.push(before_centroids_vector_rotated_2);</span><span class="WHIT">
<span class='line'>6189</span> </span><span class="WHIT">            </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>6190</span> </span><span class="WHIT">            </span><span class="COMM">// if (target_idx_str.includes(";") && current_centroid_radius) {</span><span class="WHIT">
<span class='line'>6191</span> </span><span class="WHIT">            </span><span class="COMM">//     console.log("target is element");</span><span class="WHIT">
<span class='line'>6192</span> </span><span class="WHIT">            </span><span class="COMM">//     let after_centroids_vector = createVector(source_centroid, target_centroid);</span><span class="WHIT">
<span class='line'>6193</span> </span><span class="WHIT">            </span><span class="COMM">//     let after_centroids_vector_normalized = normalizeVector(after_centroids_vector);</span><span class="WHIT">
<span class='line'>6194</span> </span><span class="WHIT">            </span><span class="COMM">//     let after_centroids_vector_scaled = scaleVector(after_centroids_vector_normalized, current_centroid_radius);</span><span class="WHIT">
<span class='line'>6195</span> </span><span class="WHIT">            </span><span class="COMM">//     let after_centroids_vector_rotated_1 = rotateByAng(after_centroids_vector_scaled, target_centroid, 90);</span><span class="WHIT">
<span class='line'>6196</span> </span><span class="WHIT">            </span><span class="COMM">//     let after_centroids_vector_rotated_2 = rotateByAng(after_centroids_vector_scaled, target_centroid, -90);</span><span class="WHIT">
<span class='line'>6197</span> </span><span class="WHIT">            </span><span class="COMM">//     after_target.push(after_centroids_vector_rotated_1);</span><span class="WHIT">
<span class='line'>6198</span> </span><span class="WHIT">            </span><span class="COMM">//     after_target.push(after_centroids_vector_rotated_2);</span><span class="WHIT">
<span class='line'>6199</span> </span><span class="WHIT">            </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>6200</span> </span><span class="WHIT">    
<span class='line'>6201</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">between_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6202</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">after_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6203</span> </span><span class="WHIT">    
<span class='line'>6204</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">value_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"relative_weight"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6205</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">draw_opts.weight_scaling</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"absolute"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6206</span> </span><span class="WHIT">                </span><span class="NAME">value_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"absolute_weight"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6207</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6208</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">centroid_height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6209</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">group_weights_by_type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6210</span> </span><span class="WHIT">                </span><span class="NAME">centroid_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current_width_scale</span><span class="PUNC">(</span><span class="NAME">value_height</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"type"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6211</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6212</span> </span><span class="WHIT">                </span><span class="NAME">centroid_height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current_width_scale</span><span class="PUNC">(</span><span class="NAME">value_height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6213</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6214</span> </span><span class="WHIT">    
<span class='line'>6215</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">mid_point</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateDotArrayMiddlePoint</span><span class="PUNC">(</span><span class="NAME">source_centroid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">target_centroid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6216</span> </span><span class="WHIT">    
<span class='line'>6217</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">draw_opts.centroid_pos.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"fixed"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6218</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">draw_opts.centroid_pos.perc_y</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">"between"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6219</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">between_centroid_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">draw_opts.centroid_pos.perc_y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6220</span> </span><span class="WHIT">                    </span><span class="NAME">mid_point</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">between_centroid_y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6221</span> </span><span class="WHIT">                    </span><span class="COMM">// console.log("between_centroid_y");</span><span class="WHIT">
<span class='line'>6222</span> </span><span class="WHIT">                    </span><span class="COMM">// console.log(between_centroid_y);</span><span class="WHIT">
<span class='line'>6223</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6224</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">draw_opts.centroid_pos.perc_x</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">"between"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6225</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">between_centroid_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">draw_opts.centroid_pos.perc_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6226</span> </span><span class="WHIT">                    </span><span class="NAME">mid_point</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">between_centroid_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6227</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6228</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6229</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">source_resel_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"extracellular"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6230</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">source_resel.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"helix"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">source_resel.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"pore"</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6231</span> </span><span class="WHIT">                    </span><span class="NAME">source_resel_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"intramembrane"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6232</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">source_resel.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"loop"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">source_resel.draw_area.start_y</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">svg_height</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6233</span> </span><span class="WHIT">                    </span><span class="NAME">source_resel_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"intracellular"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6234</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6235</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">target_resel_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"extracellular"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6236</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">target_resel.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"helix"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">target_resel.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"pore"</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6237</span> </span><span class="WHIT">                    </span><span class="NAME">target_resel_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"intramembrane"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6238</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">target_resel.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"loop"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">target_resel.draw_area.start_y</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">svg_height</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6239</span> </span><span class="WHIT">                    </span><span class="NAME">target_resel_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"intracellular"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6240</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6241</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">perc_dict</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draw_opts</span><span class="PUNC">[</span><span class="STRN">"centroid_pos"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"perc_dict"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">source_resel_type</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">target_resel_type</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6242</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">perc_dict</span><span class="PUNC">[</span><span class="STRN">"perc_y"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">"between"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6243</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">between_centroid_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">perc_dict</span><span class="PUNC">[</span><span class="STRN">"perc_y"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6244</span> </span><span class="WHIT">                    </span><span class="NAME">mid_point</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">between_centroid_y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6245</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6246</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">perc_dict</span><span class="PUNC">[</span><span class="STRN">"perc_x"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">"between"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6247</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">between_centroid_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">svg_width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">perc_dict</span><span class="PUNC">[</span><span class="STRN">"perc_x"</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>6248</span> </span><span class="WHIT">                    </span><span class="NAME">mid_point</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">between_centroid_x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6249</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6250</span> </span><span class="WHIT">                </span><span class="NAME">between_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">mid_point</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6251</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6252</span> </span><span class="WHIT">            </span><span class="COMM">// let between_centroids_vector = createVector(source_centroid, target_centroid);</span><span class="WHIT">
<span class='line'>6253</span> </span><span class="WHIT">            </span><span class="COMM">// console.log("centroid_height");</span><span class="WHIT">
<span class='line'>6254</span> </span><span class="WHIT">            </span><span class="COMM">// console.log(centroid_height);</span><span class="WHIT">
<span class='line'>6255</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">centroid_height</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6256</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">between_centroids_vector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">createVector</span><span class="PUNC">(</span><span class="NAME">source_centroid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">target_centroid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6257</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">between_centroids_vector_normalized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">normalizeVector</span><span class="PUNC">(</span><span class="NAME">between_centroids_vector</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6258</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">between_centroids_vector_scaled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scaleVector</span><span class="PUNC">(</span><span class="NAME">between_centroids_vector_normalized</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">centroid_height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6259</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">between_centroids_vector_rotated_1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rotateByAng</span><span class="PUNC">(</span><span class="NAME">between_centroids_vector_scaled</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mid_point</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">90</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6260</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">between_centroids_vector_rotated_2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rotateByAng</span><span class="PUNC">(</span><span class="NAME">between_centroids_vector_scaled</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mid_point</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">90</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6261</span> </span><span class="WHIT">                </span><span class="NAME">between_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">between_centroids_vector_rotated_1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6262</span> </span><span class="WHIT">                </span><span class="NAME">after_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">between_centroids_vector_rotated_2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6263</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6264</span> </span><span class="WHIT">    
<span class='line'>6265</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6266</span> </span><span class="WHIT">            </span><span class="COMM">// if (before_source.length > 0) {</span><span class="WHIT">
<span class='line'>6267</span> </span><span class="WHIT">            </span><span class="COMM">//     points.push(...before_source);</span><span class="WHIT">
<span class='line'>6268</span> </span><span class="WHIT">            </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>6269</span> </span><span class="WHIT">            </span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="NAME">source_centroid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6270</span> </span><span class="WHIT">            </span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">between_centroid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6271</span> </span><span class="WHIT">            </span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="NAME">target_centroid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6272</span> </span><span class="WHIT">            </span><span class="COMM">// if (after_target.length > 0) {</span><span class="WHIT">
<span class='line'>6273</span> </span><span class="WHIT">            </span><span class="COMM">//     points.push(...after_target);</span><span class="WHIT">
<span class='line'>6274</span> </span><span class="WHIT">            </span><span class="COMM">//     points.push(target_centroid);</span><span class="WHIT">
<span class='line'>6275</span> </span><span class="WHIT">            </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>6276</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">after_centroid.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6277</span> </span><span class="WHIT">                </span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">after_centroid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6278</span> </span><span class="WHIT">                </span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="NAME">source_centroid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6279</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6280</span> </span><span class="WHIT">            </span><span class="COMM">// if (before_source.length > 0) {</span><span class="WHIT">
<span class='line'>6281</span> </span><span class="WHIT">            </span><span class="COMM">//     points.push(before_source[0]);</span><span class="WHIT">
<span class='line'>6282</span> </span><span class="WHIT">            </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>6283</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ip</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">points.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ip</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6284</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"blue"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6285</span> </span><span class="WHIT">                </span><span class="NAME">test_relation_circle_data.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6286</span> </span><span class="WHIT">                    </span><span class="STRN">"point"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">ip</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6287</span> </span><span class="WHIT">                    </span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6288</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"yellow"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6289</span> </span><span class="WHIT">                    </span><span class="STRN">"stroke_size"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"1px"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6290</span> </span><span class="WHIT">                    </span><span class="STRN">"opacity"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"1"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6291</span> </span><span class="WHIT">                    </span><span class="STRN">"circle_radius"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"4px"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6292</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6293</span> </span><span class="WHIT">                
<span class='line'>6294</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6295</span> </span><span class="WHIT">    
<span class='line'>6296</span>             </span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"source_resid"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">raw_relation</span><span class="PUNC">[</span><span class="STRN">"source"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6297</span> </span><span class="WHIT">            </span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"target_resid"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">raw_relation</span><span class="PUNC">[</span><span class="STRN">"target"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6298</span> </span><span class="WHIT">            </span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"points"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">points</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6299</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">current_color_scale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6300</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">to_fill</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current_color_scale</span><span class="PUNC">(</span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">current_color_scale_prop</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6301</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lighter_fill_scale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6302</span> </span><span class="WHIT">                    </span><span class="NAME">to_fill</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"rgba("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">colorToRGBA</span><span class="PUNC">(</span><span class="NAME">to_fill</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">")"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6303</span> </span><span class="WHIT">                    </span><span class="NAME">to_fill</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pSBC</span><span class="PUNC">(</span><span class="NUMB">0.20</span><span class="PUNC">,</span><span class="NAME">to_fill</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6304</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6305</span> </span><span class="WHIT">                </span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">to_fill</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6306</span> </span><span class="WHIT">                </span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"stroke"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current_color_scale</span><span class="PUNC">(</span><span class="NAME">residue_relation_data</span><span class="PUNC">[</span><span class="NAME">irrd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">current_color_scale_prop</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6307</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6308</span> </span><span class="WHIT">    
<span class='line'>6309</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6310</span> </span><span class="WHIT">        </span><span class="COMM">// plotDotsCircles(test_relation_circle_data, "test_relation_circle_g", "test_relation_circle")</span><span class="WHIT">
<span class='line'>6311</span> </span><span class="WHIT">        </span><span class="NAME">draw_relation_paths</span><span class="PUNC">(</span><span class="NAME">residue_relation_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6312</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6313</span> 
<span class='line'>6314</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6315</span>      * Searches for residue/element data in processRawUniProt generated data
<span class='line'>6316</span>      * @namespace
<span class='line'>6317</span>      * @exports NaView
<span class='line'>6318</span>      * @name whereIsResIdElName 
<span class='line'>6319</span>      * @param {String} resid_or_elname String containing name of a given residue/element
<span class='line'>6320</span>      * @param {Object} full_protein_data full data generated by processRawUniProt
<span class='line'>6321</span>      * @yields {Object} fresidue/element data of String containing name of a given residue/element
<span class='line'>6322</span>      */</span><span class="WHIT">
<span class='line'>6323</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">whereIsResIdElName</span><span class="PUNC">(</span><span class="NAME">resid_or_elname</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">full_protein_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6324</span> </span><span class="WHIT">        </span><span class="COMM">// parsed_protein_data</span><span class="WHIT">
<span class='line'>6325</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">resid_or_elname_str</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">resid_or_elname</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6326</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">keywords</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"Domain"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"InterDomain"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6327</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">filtered</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6328</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">resid_or_elname_str.includes</span><span class="PUNC">(</span><span class="NAME">keywords</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">resid_or_elname_str.includes</span><span class="PUNC">(</span><span class="NAME">keywords</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6329</span> </span><span class="WHIT">            </span><span class="NAME">filtered</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">full_protein_data</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6330</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.start</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">resid_or_elname</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a.end</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">resid_or_elname</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6331</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6332</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">resid_or_elname_str.includes</span><span class="PUNC">(</span><span class="NAME">keywords</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6333</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">interdomainindex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">resid_or_elname.split</span><span class="PUNC">(</span><span class="STRN">"InterDomain"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">";"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6334</span> </span><span class="WHIT">            </span><span class="NAME">filtered</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">full_protein_data</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6335</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.dom_iname</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">interdomainindex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6336</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6337</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">resid_or_elname_str.includes</span><span class="PUNC">(</span><span class="NAME">keywords</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6338</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">domain_name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">resid_or_elname.split</span><span class="PUNC">(</span><span class="STRN">"Domain"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">";"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6339</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">el_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">resid_or_elname.split</span><span class="PUNC">(</span><span class="STRN">";"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6340</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el_type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"Pore"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6341</span> </span><span class="WHIT">                </span><span class="NAME">el_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el_type.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6342</span> </span><span class="WHIT">                </span><span class="NAME">filtered</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">full_protein_data</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6343</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.dom_name</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">domain_name</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">el_type</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>6344</span>                 </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6345</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6346</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">index_search</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">el_type.split</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NAME">el_type.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6347</span> </span><span class="WHIT">                </span><span class="NAME">el_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el_type.slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">el_type.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6348</span> </span><span class="WHIT">                </span><span class="NAME">el_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el_type.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6349</span> </span><span class="WHIT">                </span><span class="NAME">filtered</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">full_protein_data</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6350</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.dom_name</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">domain_name</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">el_type</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a.dom_itype</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">index_search</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>6351</span>                 </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6352</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6353</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6354</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">filtered</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6355</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6356</span> 
<span class='line'>6357</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6358</span>      * Plots paths indicating residue/element relationships
<span class='line'>6359</span>      * @namespace
<span class='line'>6360</span>      * @exports NaView
<span class='line'>6361</span>      * @name draw_relation_paths 
<span class='line'>6362</span>      * @param {Array} residue_relation_data array of parsed residue relation Objects
<span class='line'>6363</span>      */</span><span class="WHIT">
<span class='line'>6364</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_relation_paths</span><span class="PUNC">(</span><span class="NAME">residue_relation_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6365</span> </span><span class="WHIT">        </span><span class="COMM">// let curveN = d3.line().curve(d3.curveNatural);</span><span class="WHIT">
<span class='line'>6366</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">curveN</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.line</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">curve</span><span class="PUNC">(</span><span class="NAME">d3.curveCatmullRom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6367</span> </span><span class="WHIT">        </span><span class="COMM">// let curveN = d3.line().curve(d3.curveBasis);</span><span class="WHIT">
<span class='line'>6368</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">svg_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="STRN">"#"</span><span class="PUNC">+</span><span class="NAME">svg_id</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6369</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6370</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"relations_group"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6371</span> </span><span class="WHIT">    
<span class='line'>6372</span>         </span><span class="NAME">svg_element.selectAll</span><span class="PUNC">(</span><span class="STRN">".relation_paths_g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6373</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="NAME">residue_relation_data</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6374</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>6375</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">enter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6376</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">enter.append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6377</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"relation_paths_g"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6378</span> </span><span class="WHIT">    
<span class='line'>6379</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.append</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6380</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6381</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.source_resid</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.target_resid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6382</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6383</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"relation_path"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6384</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"d"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6385</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">curveN</span><span class="PUNC">(</span><span class="NAME">d.points</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6386</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6387</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'stroke'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6388</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"stroke"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6389</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6390</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6391</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6392</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6393</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"opacity"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6394</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6395</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6396</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'stroke-width'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6397</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"stroke_size"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6398</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6399</span> </span><span class="WHIT">                
<span class='line'>6400</span>                 </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6401</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6402</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">update</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6403</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">update</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6404</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6405</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6406</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">exit.remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6407</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6408</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6409</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6410</span> 
<span class='line'>6411</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6412</span>      * Generates text data based on text plotting rules syntax.&lt;br>
<span class='line'>6413</span>      * Text data object syntax examples:&lt;br>
<span class='line'>6414</span>      * {&lt;br>
<span class='line'>6415</span>      *  "text": "text to be drawn" //text to be drawn&lt;br>
<span class='line'>6416</span>      *  "positioning": {&lt;br>
<span class='line'>6417</span>      *     "type": "absolute" //for specific text drawing coordinates&lt;br>
<span class='line'>6418</span>      *     "x": number //x positioning on svg&lt;br>
<span class='line'>6419</span>      *     "y": number //y positioning on svg&lt;br>
<span class='line'>6420</span>      *     },&lt;br>
<span class='line'>6421</span>      *  "fill": "text color" //text color. when absent, defaults froms style object are used&lt;br>
<span class='line'>6422</span>      *  "font_style": "normal" //normal, italic or bold. when absent, defaults froms style object are used&lt;br>
<span class='line'>6423</span>      *  "font_size": number //size of font. when absent, defaults froms style object are used&lt;br>
<span class='line'>6424</span>      *  "font_family": Arial //font family. when absent, defaults froms style object are used&lt;br>
<span class='line'>6425</span>      * }&lt;br>
<span class='line'>6426</span>      * &lt;br>
<span class='line'>6427</span>      * positioning anchored to a given residue/protein element is also possible:&lt;br>
<span class='line'>6428</span>      * &lt;br>
<span class='line'>6429</span>      * {&lt;br>
<span class='line'>6430</span>      *  "text": "text to be drawn" //text to be drawn&lt;br>
<span class='line'>6431</span>      *  "positioning": {&lt;br>
<span class='line'>6432</span>      *     "type": "residue_or_element" //for text drawing coordinates centered to an element selection&lt;br>
<span class='line'>6433</span>      *     "reference": 5 // examples include: 5, W5, DomainI;Helix4, and all possible objects with a centroid&lt;br>
<span class='line'>6434</span>      *     "dx": number // optional: number of pixels to move from reference centroid in the horizontal axis&lt;br>
<span class='line'>6435</span>      *     "dy": number // optional: number of pixels to move from reference centroid in the vertical axis&lt;br>
<span class='line'>6436</span>      *      }&lt;br>
<span class='line'>6437</span>      *  ...&lt;br>
<span class='line'>6438</span>      * }&lt;br>
<span class='line'>6439</span>      * drawing a residue name, id and properties is also possible when reference indicates a residue:&lt;br>
<span class='line'>6440</span>      * {&lt;br>
<span class='line'>6441</span>      *  "props": ["residue_attribute", "random_string", "residue_property"]&lt;br>
<span class='line'>6442</span>      *  "positioning": {&lt;br>&lt;br>
<span class='line'>6443</span>      *     "type": "residue_or_element" //for text drawing coordinates centered to an element selection&lt;br>
<span class='line'>6444</span>      *     "reference": 5&lt;br>
<span class='line'>6445</span>      *      ...&lt;br>
<span class='line'>6446</span>      *   }&lt;br>
<span class='line'>6447</span>      *  ...&lt;br>
<span class='line'>6448</span>      * }&lt;br>
<span class='line'>6449</span>      * residue properties include one and three letter names ("res_1" and "res_3"), residue index in protein ("res_ind")&lt;br>
<span class='line'>6450</span>      * random strings such as ",", "  ", ": " are summed to attributes and properties&lt;br>
<span class='line'>6451</span>      * @see convertToResInd
<span class='line'>6452</span>      * @see whereIsResIdElName
<span class='line'>6453</span>      * @see draw_text_symbols
<span class='line'>6454</span>      * @namespace
<span class='line'>6455</span>      * @exports NaView
<span class='line'>6456</span>      * @name draw_symbols 
<span class='line'>6457</span>      * @param {Array} symbols_data array of objects including text data to be drawn
<span class='line'>6458</span>      * @param {Object} centroid_data dictionary of valid residue indexes and protein element names
<span class='line'>6459</span>      * @param {Object} property_data dictionary of properties per each valid residue indexes
<span class='line'>6460</span>      * @param {Ibject} full_protein_data parsed protein data generated from processRawUniProt
<span class='line'>6461</span>      */</span><span class="WHIT">
<span class='line'>6462</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_symbols</span><span class="PUNC">(</span><span class="NAME">symbols_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">centroid_data</span><span class="PUNC">,</span><span class="NAME">property_data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">full_protein_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6463</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">isd</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">symbols_data.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">isd</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6464</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"font_family"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6465</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"font_family"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.text_defs.font_family</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6466</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6467</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"font_style"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6468</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"font_style"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.text_defs.font_style</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6469</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6470</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"font_size"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6471</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"font_size"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.text_defs.font_size</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6472</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6473</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6474</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style_obj.text_defs.fill</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6475</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6476</span> </span><span class="WHIT">            </span><span class="COMM">//pre calc element width and height for collision checking</span><span class="WHIT">
<span class='line'>6477</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">symbol_bbox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getBBoxGhostText</span><span class="PUNC">(</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6478</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">positioning.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"absolute"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6479</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"tdx"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">positioning.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6480</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"tdy"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">positioning.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6481</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"x"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">positioning.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6482</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"y"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">positioning.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6483</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">positioning.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"residue_or_element"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6484</span> </span><span class="WHIT">            </span><span class="COMM">// } else {</span><span class="WHIT">
<span class='line'>6485</span> </span><span class="WHIT">                </span><span class="COMM">//get anchoring element centroid and append it</span><span class="WHIT">
<span class='line'>6486</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">obj_index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">convertToResInd</span><span class="PUNC">(</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">positioning.reference</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6487</span> </span><span class="WHIT">                </span><span class="COMM">// let target_resel = whereIsResIdElName(obj_index,full_protein_data);</span><span class="WHIT">
<span class='line'>6488</span> </span><span class="WHIT">                </span><span class="NAME">obj_index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">obj_index</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6489</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">target_centroid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">centroid_data</span><span class="PUNC">[</span><span class="NAME">obj_index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">point</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6490</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"tdx"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">target_centroid</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6491</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"tdy"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">target_centroid</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6492</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"x"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">target_centroid</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6493</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"y"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">target_centroid</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6494</span> </span><span class="WHIT">            </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>6495</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">positioning.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"residue_relation"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6496</span> </span><span class="WHIT">                </span><span class="COMM">//TODO: Allow anchoring on residue relation?</span><span class="WHIT">
<span class='line'>6497</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6498</span> </span><span class="WHIT">            </span><span class="COMM">//centering element</span><span class="WHIT">
<span class='line'>6499</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style_obj.text_defs.center_xy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6500</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"tdx"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">symbol_bbox.width</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6501</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"tdy"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">symbol_bbox.height</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6502</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"x"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">symbol_bbox.width</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6503</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"y"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">symbol_bbox.height</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6504</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6505</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">positioning.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"dx"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6506</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"tdx"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">positioning.dx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6507</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"x"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">positioning.dx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6508</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6509</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">positioning.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"dy"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6510</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"tdy"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">positioning.dy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6511</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"y"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">positioning.dy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6512</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6513</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">current_draw_area</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6514</span> </span><span class="WHIT">                </span><span class="STRN">"start_x"</span><span class="PUNC">:</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"x"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6515</span> </span><span class="WHIT">                </span><span class="STRN">"start_y"</span><span class="PUNC">:</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"y"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6516</span> </span><span class="WHIT">                </span><span class="STRN">"centroid"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"x"</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">symbol_bbox.width</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"y"</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">symbol_bbox.height</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6517</span> </span><span class="WHIT">                </span><span class="STRN">"end_x"</span><span class="PUNC">:</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"x"</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">symbol_bbox.width</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6518</span> </span><span class="WHIT">                </span><span class="STRN">"end_y"</span><span class="PUNC">:</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"y"</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">symbol_bbox.height</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6519</span> </span><span class="WHIT">                </span><span class="STRN">"width"</span><span class="PUNC">:</span><span class="NAME">symbol_bbox.width</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6520</span> </span><span class="WHIT">                </span><span class="STRN">"height"</span><span class="PUNC">:</span><span class="NAME">symbol_bbox.height</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6521</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6522</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"text"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"props"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">positioning.type</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">"residue_relation"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6523</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">to_text</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6524</span> </span><span class="WHIT">    
<span class='line'>6525</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">obj_index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">convertToResInd</span><span class="PUNC">(</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">positioning.reference</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6526</span> </span><span class="WHIT">                </span><span class="NAME">obj_index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">obj_index</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6527</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">target_data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">whereIsResIdElName</span><span class="PUNC">(</span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">positioning.reference</span><span class="PUNC">,</span><span class="NAME">full_protein_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6528</span> </span><span class="WHIT">                
<span class='line'>6529</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">target_data_keys</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Object.keys</span><span class="PUNC">(</span><span class="NAME">target_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6530</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">centroid_data_keys</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Object.keys</span><span class="PUNC">(</span><span class="NAME">centroid_data</span><span class="PUNC">[</span><span class="NAME">obj_index</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6531</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">property_data_keys</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Object.keys</span><span class="PUNC">(</span><span class="NAME">property_data</span><span class="PUNC">[</span><span class="NAME">obj_index</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6532</span> </span><span class="WHIT">    
<span class='line'>6533</span>                 </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">iprop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iprop</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"props"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">iprop</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6534</span> </span><span class="WHIT">                    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">prop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"props"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">iprop</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6535</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">target_data_keys.indexOf</span><span class="PUNC">(</span><span class="NAME">prop</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6536</span> </span><span class="WHIT">                        </span><span class="NAME">to_text</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">target_data</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6537</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">centroid_data_keys.indexOf</span><span class="PUNC">(</span><span class="NAME">prop</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6538</span> </span><span class="WHIT">                        </span><span class="NAME">to_text</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">centroid_data</span><span class="PUNC">[</span><span class="NAME">obj_index</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6539</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">property_data_keys.indexOf</span><span class="PUNC">(</span><span class="NAME">prop</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6540</span> </span><span class="WHIT">                        </span><span class="NAME">to_text</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">property_data</span><span class="PUNC">[</span><span class="NAME">obj_index</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6541</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6542</span> </span><span class="WHIT">                        </span><span class="NAME">to_text</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prop</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6543</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6544</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6545</span> </span><span class="WHIT">                </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"text"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">to_text</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6546</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6547</span> </span><span class="WHIT">            </span><span class="COMM">// else if (symbols_data[isd].hasOwnProperty("text") === false && symbols_data[isd].hasOwnProperty("props") === true && symbols_data[isd].positioning.type === "residue_relation") {</span><span class="WHIT">
<span class='line'>6548</span> </span><span class="WHIT">            </span><span class="COMM">// }            </span><span class="WHIT">
<span class='line'>6549</span> </span><span class="WHIT">            </span><span class="NAME">symbols_data</span><span class="PUNC">[</span><span class="NAME">isd</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current_draw_area</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6550</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6551</span> </span><span class="WHIT">        </span><span class="NAME">draw_text_symbols</span><span class="PUNC">(</span><span class="NAME">symbols_data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6552</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6553</span> 
<span class='line'>6554</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6555</span>      * Generates text elements with attributes embedded in data array
<span class='line'>6556</span>      * @namespace
<span class='line'>6557</span>      * @exports NaView
<span class='line'>6558</span>      * @name draw_text_symbols 
<span class='line'>6559</span>      * @param {Array} symbols_data array of objects including text data to be drawn
<span class='line'>6560</span>      */</span><span class="WHIT">
<span class='line'>6561</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">draw_text_symbols</span><span class="PUNC">(</span><span class="NAME">symbols_data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6562</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">svg_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="STRN">"#"</span><span class="PUNC">+</span><span class="NAME">svg_id</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6563</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6564</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"text_symbols_group"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6565</span> 
<span class='line'>6566</span> </span><span class="WHIT">        </span><span class="NAME">svg_element.selectAll</span><span class="PUNC">(</span><span class="STRN">".text_symbols_g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6567</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">data</span><span class="PUNC">(</span><span class="NAME">symbols_data</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6568</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>6569</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">enter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6570</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">enter.append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6571</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"text_symbols_g"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6572</span> 
<span class='line'>6573</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.append</span><span class="PUNC">(</span><span class="STRN">"text"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6574</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6575</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"text_symbol_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6576</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6577</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"text_symbols_el"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6578</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6579</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6580</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6581</span> </span><span class="WHIT">                </span><span class="COMM">// .attr("font", function(d) {</span><span class="WHIT">
<span class='line'>6582</span> </span><span class="WHIT">                </span><span class="COMM">//     return d["font"];</span><span class="WHIT">
<span class='line'>6583</span> </span><span class="WHIT">                </span><span class="COMM">// })</span><span class="WHIT">
<span class='line'>6584</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"font-style"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6585</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"font_style"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6586</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6587</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"font-family"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6588</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"font_family"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6589</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6590</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"font-size"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6591</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"font_size"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6592</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6593</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">text</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6594</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"text"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6595</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6596</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"x"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6597</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"start_x"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6598</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6599</span> </span><span class="WHIT">                </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"y"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6600</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="STRN">"draw_area"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"start_y"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6601</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6602</span> </span><span class="WHIT">                </span><span class="COMM">// drawTextCenterArrows(e);</span><span class="WHIT">
<span class='line'>6603</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6604</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6605</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">update</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6606</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">update</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6607</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6608</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">exit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6609</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">exit.remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6610</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6611</span> </span><span class="WHIT">        </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6612</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6613</span> 
<span class='line'>6614</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6615</span>      * Calculates the BBox of a SVG text element without displaying it on a screen
<span class='line'>6616</span>      * @namespace
<span class='line'>6617</span>      * @exports NaView
<span class='line'>6618</span>      * @name getBBoxGhostText 
<span class='line'>6619</span>      * @param {Object} data data object for the text object including font and text to be drawn
<span class='line'>6620</span>      * @param {String} path_id_keep optional id for keeping element after generation
<span class='line'>6621</span>      * @yields {Object} getBBox results of text
<span class='line'>6622</span>      */</span><span class="WHIT">
<span class='line'>6623</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getBBoxGhostText</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path_id_keep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6624</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">pg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3.select</span><span class="PUNC">(</span><span class="STRN">"#"</span><span class="PUNC">+</span><span class="NAME">svg_id</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6625</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="STRN">"g"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6626</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6627</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">path_id_keep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6628</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"par"</span><span class="PUNC">+</span><span class="NAME">path_id_keep</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6629</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6630</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6631</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6632</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"visibility"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"hidden"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6633</span> 
<span class='line'>6634</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pg.append</span><span class="PUNC">(</span><span class="STRN">"text"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6635</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6636</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">path_id_keep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6637</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">path_id_keep</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6638</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6639</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6640</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6641</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6642</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6643</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6644</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"font-style"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6645</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"font_style"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6646</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6647</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"font-family"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6648</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"font_family"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6649</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6650</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">"font-size"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6651</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="STRN">"font_size"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6652</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6653</span> </span><span class="WHIT">        </span><span class="PUNC">.</span><span class="NAME">text</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6654</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">data.text</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6655</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6656</span> </span><span class="WHIT">        </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6657</span> 
<span class='line'>6658</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.node</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getBBox</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6659</span> </span><span class="WHIT">        </span><span class="COMM">// val = roundDecimals(val, 2);</span><span class="WHIT">
<span class='line'>6660</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">path_id_keep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6661</span> </span><span class="WHIT">            </span><span class="NAME">pg.remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6662</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6663</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6664</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6665</span> 
<span class='line'>6666</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6667</span>      * Verifies if current selection has a number corresponding to a residue Id
<span class='line'>6668</span>      * @namespace
<span class='line'>6669</span>      * @exports NaView
<span class='line'>6670</span>      * @name convertToResInd 
<span class='line'>6671</span>      * @param {String} resobj selection string to be checked
<span class='line'>6672</span>      * @yields {Array} if selection has index returns index of current selection, true&lt;br>
<span class='line'>6673</span>      * else returns current selection, false
<span class='line'>6674</span>      */</span><span class="WHIT">
<span class='line'>6675</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">convertToResInd</span><span class="PUNC">(</span><span class="NAME">resobj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6676</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">resobj_str</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">resobj</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6677</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="REGX">/\d+/</span><span class="PUNC">.</span><span class="NAME">test</span><span class="PUNC">(</span><span class="NAME">resobj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">resobj_str.includes</span><span class="PUNC">(</span><span class="STRN">";"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6678</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">objind</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">resobj_str.match</span><span class="PUNC">(</span><span class="REGX">/\d+/</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6679</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">objind</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6680</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6681</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">resobj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6682</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6683</span> </span><span class="WHIT">    
<span class='line'>6684</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6685</span> 
<span class='line'>6686</span> </span></pre></body></html>